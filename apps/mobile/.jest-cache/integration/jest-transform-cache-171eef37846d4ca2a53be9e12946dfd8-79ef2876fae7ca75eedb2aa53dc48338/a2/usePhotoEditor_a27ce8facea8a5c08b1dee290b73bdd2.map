{"version":3,"names":["_react","require","ImageManipulator","_interopRequireWildcard","_reactNative","_core","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","_t2","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","ownKeys","keys","getOwnPropertySymbols","filter","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty2","getOwnPropertyDescriptors","defineProperties","DEFAULT_ADJUSTMENTS","exports","brightness","contrast","saturation","warmth","blur","sharpen","usePhotoEditor","initialUri","options","undefined","_options$maxWidth","maxWidth","_options$maxHeight","maxHeight","_options$quality","quality","_useState","useState","_useState2","_slicedToArray2","uri","setUri","_useState3","_useState4","isLoading","setIsLoading","_useState5","_useState6","adjustments","setAdjustments","_useState7","_useState8","rotation","setRotation","_useState9","_useState0","flipHorizontal","setFlipHorizontal","_useState1","_useState10","flipVertical","setFlipVertical","manipulationHistoryRef","useRef","updateAdjustment","useCallback","key","value","prev","rotateLeft","newRotation","rotateRight","applyFilter","resetAdjustments","current","saveImage","_asyncToGenerator2","actions","rotate","flip","FlipType","Horizontal","Vertical","resize","width","height","result","manipulateAsync","compress","format","SaveFormat","JPEG","adjustmentsParam","encodeURIComponent","JSON","stringify","finalUri","logger","info","error","Alert","alert"],"sources":["usePhotoEditor.ts"],"sourcesContent":["import { useState, useCallback, useRef } from 'react';\nimport * as ImageManipulator from 'expo-image-manipulator';\nimport { Alert } from 'react-native';\nimport { logger } from '@pawfectmatch/core';\nimport type { PhotoAdjustments } from '../components/photo/AdvancedPhotoEditor';\n\nexport interface UsePhotoEditorOptions {\n  maxWidth?: number;\n  maxHeight?: number;\n  quality?: number;\n}\n\nexport interface UsePhotoEditorReturn {\n  uri: string; // original URI, for editing\n  isLoading: boolean;\n  adjustments: PhotoAdjustments;\n  rotation: number;\n  flipHorizontal: boolean;\n  flipVertical: boolean;\n  updateAdjustment: (key: keyof PhotoAdjustments, value: number) => void;\n  setRotation: (degrees: number) => void;\n  setFlipHorizontal: (flip: boolean) => void;\n  setFlipVertical: (flip: boolean) => void;\n  applyFilter: (filter: Partial<PhotoAdjustments>) => void;\n  resetAdjustments: () => void;\n  saveImage: () => Promise<string | null>;\n  rotateLeft: () => void;\n  rotateRight: () => void;\n}\n\nexport const DEFAULT_ADJUSTMENTS: PhotoAdjustments = {\n  brightness: 100,\n  contrast: 100,\n  saturation: 100,\n  warmth: 0,\n  blur: 0,\n  sharpen: 0,\n};\n\nexport function usePhotoEditor(\n  initialUri: string,\n  options: UsePhotoEditorOptions = {},\n): UsePhotoEditorReturn {\n  const { maxWidth = 1920, maxHeight = 1920, quality = 0.9 } = options;\n\n  const [uri, setUri] = useState(initialUri);\n  const [isLoading, setIsLoading] = useState(false);\n  const [adjustments, setAdjustments] = useState<PhotoAdjustments>(DEFAULT_ADJUSTMENTS);\n  const [rotation, setRotation] = useState(0);\n  const [flipHorizontal, setFlipHorizontal] = useState(false);\n  const [flipVertical, setFlipVertical] = useState(false);\n  const manipulationHistoryRef = useRef<string[]>([initialUri]);\n\n  const updateAdjustment = useCallback(\n    (key: keyof PhotoAdjustments, value: number) => {\n      setAdjustments((prev) => ({ ...prev, [key]: value }));\n    },\n    [],\n  );\n\n  const rotateLeft = useCallback(() => {\n    setRotation((prev) => {\n      const newRotation = (prev - 90) % 360;\n      return newRotation < 0 ? 360 + newRotation : newRotation;\n    });\n  }, []);\n\n  const rotateRight = useCallback(() => {\n    setRotation((prev) => (prev + 90) % 360);\n  }, []);\n\n  const applyFilter = useCallback((filter: Partial<PhotoAdjustments>) => {\n    setAdjustments((prev) => ({ ...prev, ...filter }));\n  }, []);\n\n  const resetAdjustments = useCallback(() => {\n    setAdjustments(DEFAULT_ADJUSTMENTS);\n    setRotation(0);\n    setFlipHorizontal(false);\n    setFlipVertical(false);\n    setUri(initialUri);\n    manipulationHistoryRef.current = [initialUri];\n  }, [initialUri]);\n\n  const saveImage = useCallback(async (): Promise<string | null> => {\n    setIsLoading(true);\n    try {\n      const actions: ImageManipulator.Action[] = [];\n\n      // Apply rotation\n      if (rotation !== 0) {\n        actions.push({ rotate: rotation });\n      }\n\n      // Apply flips\n      if (flipHorizontal) {\n        actions.push({ flip: ImageManipulator.FlipType.Horizontal });\n      }\n      if (flipVertical) {\n        actions.push({ flip: ImageManipulator.FlipType.Vertical });\n      }\n\n      // Apply resize if needed\n      actions.push({\n        resize: { width: maxWidth, height: maxHeight },\n      });\n\n      let result;\n      if (actions.length > 0) {\n        result = await ImageManipulator.manipulateAsync(\n          uri,\n          actions,\n          { compress: quality, format: ImageManipulator.SaveFormat.JPEG },\n        );\n      } else {\n        result = await ImageManipulator.manipulateAsync(\n          uri,\n          [],\n          { compress: quality, format: ImageManipulator.SaveFormat.JPEG },\n        );\n      }\n\n      // Apply advanced adjustments using Cloudinary transformations\n      // Encode adjustments in the URI for server-side processing\n      const adjustmentsParam = encodeURIComponent(JSON.stringify(adjustments));\n      const finalUri = `${result.uri}?adjustments=${adjustmentsParam}`;\n\n      manipulationHistoryRef.current.push(finalUri);\n      logger.info('Photo saved with adjustments', { finalUri });\n\n      return finalUri;\n    } catch (error) {\n      logger.error('Photo save failed', { error });\n      Alert.alert('Error', 'Failed to save image. Please try again.');\n      return null;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [uri, rotation, flipHorizontal, flipVertical, adjustments, maxWidth, maxHeight, quality]);\n\n  return {\n    uri,\n    isLoading,\n    adjustments,\n    rotation,\n    flipHorizontal,\n    flipVertical,\n    updateAdjustment,\n    setRotation,\n    setFlipHorizontal,\n    setFlipVertical,\n    applyFilter,\n    resetAdjustments,\n    saveImage,\n    rotateLeft,\n    rotateRight,\n  };\n}\n\n"],"mappings":";;;;;;;;;;;AAAA,IAAAA,MAAA,GAAAC,OAAA;AACA,IAAAC,gBAAA,GAAAC,uBAAA,CAAAF,OAAA;AACA,IAAAG,YAAA,GAAAH,OAAA;AACA,IAAAI,KAAA,GAAAJ,OAAA;AAA4C,SAAAE,wBAAAG,CAAA,EAAAC,CAAA,6BAAAC,OAAA,MAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAL,uBAAA,YAAAA,wBAAAG,CAAA,EAAAC,CAAA,SAAAA,CAAA,IAAAD,CAAA,IAAAA,CAAA,CAAAK,UAAA,SAAAL,CAAA,MAAAM,CAAA,EAAAC,CAAA,EAAAC,CAAA,KAAAC,SAAA,QAAAC,OAAA,EAAAV,CAAA,iBAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,SAAAQ,CAAA,MAAAF,CAAA,GAAAL,CAAA,GAAAG,CAAA,GAAAD,CAAA,QAAAG,CAAA,CAAAK,GAAA,CAAAX,CAAA,UAAAM,CAAA,CAAAM,GAAA,CAAAZ,CAAA,GAAAM,CAAA,CAAAO,GAAA,CAAAb,CAAA,EAAAQ,CAAA,cAAAM,GAAA,IAAAd,CAAA,gBAAAc,GAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,GAAA,OAAAP,CAAA,IAAAD,CAAA,GAAAW,MAAA,CAAAC,cAAA,KAAAD,MAAA,CAAAE,wBAAA,CAAAnB,CAAA,EAAAc,GAAA,OAAAP,CAAA,CAAAK,GAAA,IAAAL,CAAA,CAAAM,GAAA,IAAAP,CAAA,CAAAE,CAAA,EAAAM,GAAA,EAAAP,CAAA,IAAAC,CAAA,CAAAM,GAAA,IAAAd,CAAA,CAAAc,GAAA,WAAAN,CAAA,KAAAR,CAAA,EAAAC,CAAA;AAAA,SAAAmB,QAAApB,CAAA,EAAAG,CAAA,QAAAF,CAAA,GAAAgB,MAAA,CAAAI,IAAA,CAAArB,CAAA,OAAAiB,MAAA,CAAAK,qBAAA,QAAAhB,CAAA,GAAAW,MAAA,CAAAK,qBAAA,CAAAtB,CAAA,GAAAG,CAAA,KAAAG,CAAA,GAAAA,CAAA,CAAAiB,MAAA,WAAApB,CAAA,WAAAc,MAAA,CAAAE,wBAAA,CAAAnB,CAAA,EAAAG,CAAA,EAAAqB,UAAA,OAAAvB,CAAA,CAAAwB,IAAA,CAAAC,KAAA,CAAAzB,CAAA,EAAAK,CAAA,YAAAL,CAAA;AAAA,SAAA0B,cAAA3B,CAAA,aAAAG,CAAA,MAAAA,CAAA,GAAAyB,SAAA,CAAAC,MAAA,EAAA1B,CAAA,UAAAF,CAAA,WAAA2B,SAAA,CAAAzB,CAAA,IAAAyB,SAAA,CAAAzB,CAAA,QAAAA,CAAA,OAAAiB,OAAA,CAAAH,MAAA,CAAAhB,CAAA,OAAA6B,OAAA,WAAA3B,CAAA,QAAA4B,gBAAA,CAAArB,OAAA,EAAAV,CAAA,EAAAG,CAAA,EAAAF,CAAA,CAAAE,CAAA,SAAAc,MAAA,CAAAe,yBAAA,GAAAf,MAAA,CAAAgB,gBAAA,CAAAjC,CAAA,EAAAiB,MAAA,CAAAe,yBAAA,CAAA/B,CAAA,KAAAmB,OAAA,CAAAH,MAAA,CAAAhB,CAAA,GAAA6B,OAAA,WAAA3B,CAAA,IAAAc,MAAA,CAAAC,cAAA,CAAAlB,CAAA,EAAAG,CAAA,EAAAc,MAAA,CAAAE,wBAAA,CAAAlB,CAAA,EAAAE,CAAA,iBAAAH,CAAA;AA2BrC,IAAMkC,mBAAqC,GAAAC,OAAA,CAAAD,mBAAA,GAAG;EACnDE,UAAU,EAAE,GAAG;EACfC,QAAQ,EAAE,GAAG;EACbC,UAAU,EAAE,GAAG;EACfC,MAAM,EAAE,CAAC;EACTC,IAAI,EAAE,CAAC;EACPC,OAAO,EAAE;AACX,CAAC;AAEM,SAASC,cAAcA,CAC5BC,UAAkB,EAEI;EAAA,IADtBC,OAA8B,GAAAhB,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAiB,SAAA,GAAAjB,SAAA,MAAG,CAAC,CAAC;EAEnC,IAAAkB,iBAAA,GAA6DF,OAAO,CAA5DG,QAAQ;IAARA,QAAQ,GAAAD,iBAAA,cAAG,IAAI,GAAAA,iBAAA;IAAAE,kBAAA,GAAsCJ,OAAO,CAA3CK,SAAS;IAATA,SAAS,GAAAD,kBAAA,cAAG,IAAI,GAAAA,kBAAA;IAAAE,gBAAA,GAAoBN,OAAO,CAAzBO,OAAO;IAAPA,OAAO,GAAAD,gBAAA,cAAG,GAAG,GAAAA,gBAAA;EAExD,IAAAE,SAAA,GAAsB,IAAAC,eAAQ,EAACV,UAAU,CAAC;IAAAW,UAAA,OAAAC,eAAA,CAAA7C,OAAA,EAAA0C,SAAA;IAAnCI,GAAG,GAAAF,UAAA;IAAEG,MAAM,GAAAH,UAAA;EAClB,IAAAI,UAAA,GAAkC,IAAAL,eAAQ,EAAC,KAAK,CAAC;IAAAM,UAAA,OAAAJ,eAAA,CAAA7C,OAAA,EAAAgD,UAAA;IAA1CE,SAAS,GAAAD,UAAA;IAAEE,YAAY,GAAAF,UAAA;EAC9B,IAAAG,UAAA,GAAsC,IAAAT,eAAQ,EAAmBnB,mBAAmB,CAAC;IAAA6B,UAAA,OAAAR,eAAA,CAAA7C,OAAA,EAAAoD,UAAA;IAA9EE,WAAW,GAAAD,UAAA;IAAEE,cAAc,GAAAF,UAAA;EAClC,IAAAG,UAAA,GAAgC,IAAAb,eAAQ,EAAC,CAAC,CAAC;IAAAc,UAAA,OAAAZ,eAAA,CAAA7C,OAAA,EAAAwD,UAAA;IAApCE,QAAQ,GAAAD,UAAA;IAAEE,WAAW,GAAAF,UAAA;EAC5B,IAAAG,UAAA,GAA4C,IAAAjB,eAAQ,EAAC,KAAK,CAAC;IAAAkB,UAAA,OAAAhB,eAAA,CAAA7C,OAAA,EAAA4D,UAAA;IAApDE,cAAc,GAAAD,UAAA;IAAEE,iBAAiB,GAAAF,UAAA;EACxC,IAAAG,UAAA,GAAwC,IAAArB,eAAQ,EAAC,KAAK,CAAC;IAAAsB,WAAA,OAAApB,eAAA,CAAA7C,OAAA,EAAAgE,UAAA;IAAhDE,YAAY,GAAAD,WAAA;IAAEE,eAAe,GAAAF,WAAA;EACpC,IAAMG,sBAAsB,GAAG,IAAAC,aAAM,EAAW,CAACpC,UAAU,CAAC,CAAC;EAE7D,IAAMqC,gBAAgB,GAAG,IAAAC,kBAAW,EAClC,UAACC,GAA2B,EAAEC,KAAa,EAAK;IAC9ClB,cAAc,CAAC,UAACmB,IAAI;MAAA,OAAAzD,aAAA,CAAAA,aAAA,KAAWyD,IAAI,WAAArD,gBAAA,CAAArB,OAAA,MAAGwE,GAAG,EAAGC,KAAK;IAAA,CAAG,CAAC;EACvD,CAAC,EACD,EACF,CAAC;EAED,IAAME,UAAU,GAAG,IAAAJ,kBAAW,EAAC,YAAM;IACnCZ,WAAW,CAAC,UAACe,IAAI,EAAK;MACpB,IAAME,WAAW,GAAG,CAACF,IAAI,GAAG,EAAE,IAAI,GAAG;MACrC,OAAOE,WAAW,GAAG,CAAC,GAAG,GAAG,GAAGA,WAAW,GAAGA,WAAW;IAC1D,CAAC,CAAC;EACJ,CAAC,EAAE,EAAE,CAAC;EAEN,IAAMC,WAAW,GAAG,IAAAN,kBAAW,EAAC,YAAM;IACpCZ,WAAW,CAAC,UAACe,IAAI;MAAA,OAAK,CAACA,IAAI,GAAG,EAAE,IAAI,GAAG;IAAA,EAAC;EAC1C,CAAC,EAAE,EAAE,CAAC;EAEN,IAAMI,WAAW,GAAG,IAAAP,kBAAW,EAAC,UAAC1D,MAAiC,EAAK;IACrE0C,cAAc,CAAC,UAACmB,IAAI;MAAA,OAAAzD,aAAA,CAAAA,aAAA,KAAWyD,IAAI,GAAK7D,MAAM;IAAA,CAAG,CAAC;EACpD,CAAC,EAAE,EAAE,CAAC;EAEN,IAAMkE,gBAAgB,GAAG,IAAAR,kBAAW,EAAC,YAAM;IACzChB,cAAc,CAAC/B,mBAAmB,CAAC;IACnCmC,WAAW,CAAC,CAAC,CAAC;IACdI,iBAAiB,CAAC,KAAK,CAAC;IACxBI,eAAe,CAAC,KAAK,CAAC;IACtBpB,MAAM,CAACd,UAAU,CAAC;IAClBmC,sBAAsB,CAACY,OAAO,GAAG,CAAC/C,UAAU,CAAC;EAC/C,CAAC,EAAE,CAACA,UAAU,CAAC,CAAC;EAEhB,IAAMgD,SAAS,GAAG,IAAAV,kBAAW,MAAAW,kBAAA,CAAAlF,OAAA,EAAC,aAAoC;IAChEmD,YAAY,CAAC,IAAI,CAAC;IAClB,IAAI;MACF,IAAMgC,OAAkC,GAAG,EAAE;MAG7C,IAAIzB,QAAQ,KAAK,CAAC,EAAE;QAClByB,OAAO,CAACpE,IAAI,CAAC;UAAEqE,MAAM,EAAE1B;QAAS,CAAC,CAAC;MACpC;MAGA,IAAII,cAAc,EAAE;QAClBqB,OAAO,CAACpE,IAAI,CAAC;UAAEsE,IAAI,EAAEnG,gBAAgB,CAACoG,QAAQ,CAACC;QAAW,CAAC,CAAC;MAC9D;MACA,IAAIrB,YAAY,EAAE;QAChBiB,OAAO,CAACpE,IAAI,CAAC;UAAEsE,IAAI,EAAEnG,gBAAgB,CAACoG,QAAQ,CAACE;QAAS,CAAC,CAAC;MAC5D;MAGAL,OAAO,CAACpE,IAAI,CAAC;QACX0E,MAAM,EAAE;UAAEC,KAAK,EAAErD,QAAQ;UAAEsD,MAAM,EAAEpD;QAAU;MAC/C,CAAC,CAAC;MAEF,IAAIqD,MAAM;MACV,IAAIT,OAAO,CAAChE,MAAM,GAAG,CAAC,EAAE;QACtByE,MAAM,SAAS1G,gBAAgB,CAAC2G,eAAe,CAC7C/C,GAAG,EACHqC,OAAO,EACP;UAAEW,QAAQ,EAAErD,OAAO;UAAEsD,MAAM,EAAE7G,gBAAgB,CAAC8G,UAAU,CAACC;QAAK,CAChE,CAAC;MACH,CAAC,MAAM;QACLL,MAAM,SAAS1G,gBAAgB,CAAC2G,eAAe,CAC7C/C,GAAG,EACH,EAAE,EACF;UAAEgD,QAAQ,EAAErD,OAAO;UAAEsD,MAAM,EAAE7G,gBAAgB,CAAC8G,UAAU,CAACC;QAAK,CAChE,CAAC;MACH;MAIA,IAAMC,gBAAgB,GAAGC,kBAAkB,CAACC,IAAI,CAACC,SAAS,CAAC/C,WAAW,CAAC,CAAC;MACxE,IAAMgD,QAAQ,GAAG,GAAGV,MAAM,CAAC9C,GAAG,gBAAgBoD,gBAAgB,EAAE;MAEhE9B,sBAAsB,CAACY,OAAO,CAACjE,IAAI,CAACuF,QAAQ,CAAC;MAC7CC,YAAM,CAACC,IAAI,CAAC,8BAA8B,EAAE;QAAEF,QAAQ,EAARA;MAAS,CAAC,CAAC;MAEzD,OAAOA,QAAQ;IACjB,CAAC,CAAC,OAAOG,KAAK,EAAE;MACdF,YAAM,CAACE,KAAK,CAAC,mBAAmB,EAAE;QAAEA,KAAK,EAALA;MAAM,CAAC,CAAC;MAC5CC,kBAAK,CAACC,KAAK,CAAC,OAAO,EAAE,yCAAyC,CAAC;MAC/D,OAAO,IAAI;IACb,CAAC,SAAS;MACRxD,YAAY,CAAC,KAAK,CAAC;IACrB;EACF,CAAC,GAAE,CAACL,GAAG,EAAEY,QAAQ,EAAEI,cAAc,EAAEI,YAAY,EAAEZ,WAAW,EAAEjB,QAAQ,EAAEE,SAAS,EAAEE,OAAO,CAAC,CAAC;EAE5F,OAAO;IACLK,GAAG,EAAHA,GAAG;IACHI,SAAS,EAATA,SAAS;IACTI,WAAW,EAAXA,WAAW;IACXI,QAAQ,EAARA,QAAQ;IACRI,cAAc,EAAdA,cAAc;IACdI,YAAY,EAAZA,YAAY;IACZI,gBAAgB,EAAhBA,gBAAgB;IAChBX,WAAW,EAAXA,WAAW;IACXI,iBAAiB,EAAjBA,iBAAiB;IACjBI,eAAe,EAAfA,eAAe;IACfW,WAAW,EAAXA,WAAW;IACXC,gBAAgB,EAAhBA,gBAAgB;IAChBE,SAAS,EAATA,SAAS;IACTN,UAAU,EAAVA,UAAU;IACVE,WAAW,EAAXA;EACF,CAAC;AACH","ignoreList":[]}