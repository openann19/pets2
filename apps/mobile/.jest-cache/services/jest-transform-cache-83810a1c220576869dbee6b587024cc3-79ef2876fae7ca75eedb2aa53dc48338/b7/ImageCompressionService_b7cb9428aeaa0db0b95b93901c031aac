7b03f6d744ae3eefec1f6c5a44eef87e
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.imageCompression = exports.default = void 0;
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var ImageManipulator = _interopRequireWildcard(require("expo-image-manipulator"));
var FileSystem = _interopRequireWildcard(require("expo-file-system"));
var _core = require("@pawfectmatch/core");
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function _interopRequireWildcard(e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (var _t in e) "default" !== _t && {}.hasOwnProperty.call(e, _t) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, _t)) && (i.get || i.set) ? o(f, _t, i) : f[_t] = e[_t]); return f; })(e, t); }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
var ImageCompressionService = function () {
  function ImageCompressionService() {
    (0, _classCallCheck2.default)(this, ImageCompressionService);
  }
  return (0, _createClass2.default)(ImageCompressionService, [{
    key: "compressImage",
    value: (function () {
      var _compressImage = (0, _asyncToGenerator2.default)(function* (imageUri) {
        var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
        try {
          var opts = _objectSpread(_objectSpread({}, ImageCompressionService.DEFAULT_OPTIONS), options);
          _core.logger.info("Starting image compression", {
            uri: imageUri.substring(0, 50) + "...",
            options: opts
          });
          var originalInfo = yield FileSystem.getInfoAsync(imageUri);
          var originalSize = originalInfo.exists ? originalInfo.size : 0;
          var manipulatedImage = yield ImageManipulator.manipulateAsync(imageUri, [{
            resize: {
              width: opts.maxWidth,
              height: opts.maxHeight
            }
          }], {
            compress: opts.quality,
            format: opts.format === "png" ? ImageManipulator.SaveFormat.PNG : ImageManipulator.SaveFormat.JPEG
          });
          var compressedInfo = yield FileSystem.getInfoAsync(manipulatedImage.uri);
          var compressedSize = compressedInfo.exists ? compressedInfo.size : 0;
          var compressionRatio = originalSize > 0 ? (originalSize - compressedSize) / originalSize : 0;
          var result = {
            uri: manipulatedImage.uri,
            width: manipulatedImage.width,
            height: manipulatedImage.height,
            size: compressedSize,
            originalSize: originalSize,
            compressionRatio: compressionRatio
          };
          _core.logger.info("Image compression completed", {
            originalSize: this.formatFileSize(originalSize),
            compressedSize: this.formatFileSize(compressedSize),
            compressionRatio: `${(compressionRatio * 100).toFixed(1)}%`,
            dimensions: `${String(manipulatedImage.width)}x${String(manipulatedImage.height)}`
          });
          return result;
        } catch (error) {
          _core.logger.error("Image compression failed", {
            error: error,
            imageUri: imageUri
          });
          throw new Error("Failed to compress image");
        }
      });
      function compressImage(_x) {
        return _compressImage.apply(this, arguments);
      }
      return compressImage;
    }())
  }, {
    key: "compressImages",
    value: (function () {
      var _compressImages = (0, _asyncToGenerator2.default)(function* (imageUris) {
        var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
        var results = [];
        for (var uri of imageUris) {
          try {
            var result = yield this.compressImage(uri, options);
            results.push(result);
          } catch (error) {
            _core.logger.error("Failed to compress image in batch", {
              error: error,
              uri: uri
            });
          }
        }
        return results;
      });
      function compressImages(_x2) {
        return _compressImages.apply(this, arguments);
      }
      return compressImages;
    }())
  }, {
    key: "getOptimalCompressionSettings",
    value: function getOptimalCompressionSettings(imageUri) {
      var isJpeg = imageUri.toLowerCase().includes(".jpg") || imageUri.toLowerCase().includes(".jpeg");
      var isPng = imageUri.toLowerCase().includes(".png");
      if (isJpeg) {
        return {
          maxWidth: 1920,
          maxHeight: 1920,
          quality: 0.75,
          format: "jpeg"
        };
      } else if (isPng) {
        return {
          maxWidth: 1920,
          maxHeight: 1920,
          quality: 0.9,
          format: "png"
        };
      }
      return ImageCompressionService.DEFAULT_OPTIONS;
    }
  }, {
    key: "compressAvatarImage",
    value: (function () {
      var _compressAvatarImage = (0, _asyncToGenerator2.default)(function* (imageUri) {
        return this.compressImage(imageUri, {
          maxWidth: 512,
          maxHeight: 512,
          quality: 0.8,
          format: "jpeg"
        });
      });
      function compressAvatarImage(_x3) {
        return _compressAvatarImage.apply(this, arguments);
      }
      return compressAvatarImage;
    }())
  }, {
    key: "compressPetImage",
    value: (function () {
      var _compressPetImage = (0, _asyncToGenerator2.default)(function* (imageUri) {
        return this.compressImage(imageUri, this.getOptimalCompressionSettings(imageUri));
      });
      function compressPetImage(_x4) {
        return _compressPetImage.apply(this, arguments);
      }
      return compressPetImage;
    }())
  }, {
    key: "compressChatImage",
    value: (function () {
      var _compressChatImage = (0, _asyncToGenerator2.default)(function* (imageUri) {
        return this.compressImage(imageUri, {
          maxWidth: 1024,
          maxHeight: 1024,
          quality: 0.7,
          format: "jpeg"
        });
      });
      function compressChatImage(_x5) {
        return _compressChatImage.apply(this, arguments);
      }
      return compressChatImage;
    }())
  }, {
    key: "validateImage",
    value: (function () {
      var _validateImage = (0, _asyncToGenerator2.default)(function* (imageUri) {
        try {
          var info = yield FileSystem.getInfoAsync(imageUri);
          if (!info.exists) {
            return {
              isValid: false,
              error: "Image file does not exist"
            };
          }
          var maxSize = 20 * 1024 * 1024;
          if (info.size > maxSize) {
            return {
              isValid: false,
              error: "Image file is too large (max 20MB)"
            };
          }
          var supportedExtensions = [".jpg", ".jpeg", ".png", ".gif", ".webp"];
          var hasValidExtension = supportedExtensions.some(function (ext) {
            return imageUri.toLowerCase().endsWith(ext);
          });
          if (!hasValidExtension) {
            return {
              isValid: false,
              error: "Unsupported image format"
            };
          }
          return {
            isValid: true
          };
        } catch (error) {
          _core.logger.error("Image validation failed", {
            error: error,
            imageUri: imageUri
          });
          return {
            isValid: false,
            error: "Failed to validate image"
          };
        }
      });
      function validateImage(_x6) {
        return _validateImage.apply(this, arguments);
      }
      return validateImage;
    }())
  }, {
    key: "cleanupTempImages",
    value: (function () {
      var _cleanupTempImages = (0, _asyncToGenerator2.default)(function* (imageUris) {
        for (var uri of imageUris) {
          try {
            if (uri.includes("ImageManipulator") || uri.includes("temp") || uri.includes("cache")) {
              yield FileSystem.deleteAsync(uri, {
                idempotent: true
              });
            }
          } catch (error) {
            _core.logger.warn("Failed to cleanup temp image", {
              error: error,
              uri: uri
            });
          }
        }
      });
      function cleanupTempImages(_x7) {
        return _cleanupTempImages.apply(this, arguments);
      }
      return cleanupTempImages;
    }())
  }, {
    key: "formatFileSize",
    value: function formatFileSize(bytes) {
      var _sizes$Math$min;
      if (bytes === 0) return "0 B";
      var k = 1024;
      var sizes = ["B", "KB", "MB", "GB"];
      var i = Math.floor(Math.log(bytes) / Math.log(k));
      var sizeUnit = (_sizes$Math$min = sizes[Math.min(i, sizes.length - 1)]) != null ? _sizes$Math$min : "B";
      return `${(bytes / Math.pow(k, i)).toFixed(1)} ${sizeUnit}`;
    }
  }, {
    key: "getImageDimensions",
    value: (function () {
      var _getImageDimensions = (0, _asyncToGenerator2.default)(function* (imageUri) {
        try {
          var result = yield ImageManipulator.manipulateAsync(imageUri, [], {
            format: ImageManipulator.SaveFormat.JPEG
          });
          return {
            width: result.width,
            height: result.height
          };
        } catch (error) {
          _core.logger.error("Failed to get image dimensions", {
            error: error,
            imageUri: imageUri
          });
          return null;
        }
      });
      function getImageDimensions(_x8) {
        return _getImageDimensions.apply(this, arguments);
      }
      return getImageDimensions;
    }())
  }]);
}();
ImageCompressionService.DEFAULT_OPTIONS = {
  maxWidth: 1920,
  maxHeight: 1920,
  quality: 0.8,
  format: "jpeg",
  maintainAspectRatio: true
};
var imageCompression = exports.imageCompression = new ImageCompressionService();
var _default = exports.default = imageCompression;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJJbWFnZU1hbmlwdWxhdG9yIiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJyZXF1aXJlIiwiRmlsZVN5c3RlbSIsIl9jb3JlIiwiZSIsInQiLCJXZWFrTWFwIiwiciIsIm4iLCJfX2VzTW9kdWxlIiwibyIsImkiLCJmIiwiX19wcm90b19fIiwiZGVmYXVsdCIsImhhcyIsImdldCIsInNldCIsIl90IiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJvd25LZXlzIiwia2V5cyIsImdldE93blByb3BlcnR5U3ltYm9scyIsImZpbHRlciIsImVudW1lcmFibGUiLCJwdXNoIiwiYXBwbHkiLCJfb2JqZWN0U3ByZWFkIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiZm9yRWFjaCIsIl9kZWZpbmVQcm9wZXJ0eTIiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzIiwiZGVmaW5lUHJvcGVydGllcyIsIkltYWdlQ29tcHJlc3Npb25TZXJ2aWNlIiwiX2NsYXNzQ2FsbENoZWNrMiIsIl9jcmVhdGVDbGFzczIiLCJrZXkiLCJ2YWx1ZSIsIl9jb21wcmVzc0ltYWdlIiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwiaW1hZ2VVcmkiLCJvcHRpb25zIiwidW5kZWZpbmVkIiwib3B0cyIsIkRFRkFVTFRfT1BUSU9OUyIsImxvZ2dlciIsImluZm8iLCJ1cmkiLCJzdWJzdHJpbmciLCJvcmlnaW5hbEluZm8iLCJnZXRJbmZvQXN5bmMiLCJvcmlnaW5hbFNpemUiLCJleGlzdHMiLCJzaXplIiwibWFuaXB1bGF0ZWRJbWFnZSIsIm1hbmlwdWxhdGVBc3luYyIsInJlc2l6ZSIsIndpZHRoIiwibWF4V2lkdGgiLCJoZWlnaHQiLCJtYXhIZWlnaHQiLCJjb21wcmVzcyIsInF1YWxpdHkiLCJmb3JtYXQiLCJTYXZlRm9ybWF0IiwiUE5HIiwiSlBFRyIsImNvbXByZXNzZWRJbmZvIiwiY29tcHJlc3NlZFNpemUiLCJjb21wcmVzc2lvblJhdGlvIiwicmVzdWx0IiwiZm9ybWF0RmlsZVNpemUiLCJ0b0ZpeGVkIiwiZGltZW5zaW9ucyIsIlN0cmluZyIsImVycm9yIiwiRXJyb3IiLCJjb21wcmVzc0ltYWdlIiwiX3giLCJfY29tcHJlc3NJbWFnZXMiLCJpbWFnZVVyaXMiLCJyZXN1bHRzIiwiY29tcHJlc3NJbWFnZXMiLCJfeDIiLCJnZXRPcHRpbWFsQ29tcHJlc3Npb25TZXR0aW5ncyIsImlzSnBlZyIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJpc1BuZyIsIl9jb21wcmVzc0F2YXRhckltYWdlIiwiY29tcHJlc3NBdmF0YXJJbWFnZSIsIl94MyIsIl9jb21wcmVzc1BldEltYWdlIiwiY29tcHJlc3NQZXRJbWFnZSIsIl94NCIsIl9jb21wcmVzc0NoYXRJbWFnZSIsImNvbXByZXNzQ2hhdEltYWdlIiwiX3g1IiwiX3ZhbGlkYXRlSW1hZ2UiLCJpc1ZhbGlkIiwibWF4U2l6ZSIsInN1cHBvcnRlZEV4dGVuc2lvbnMiLCJoYXNWYWxpZEV4dGVuc2lvbiIsInNvbWUiLCJleHQiLCJlbmRzV2l0aCIsInZhbGlkYXRlSW1hZ2UiLCJfeDYiLCJfY2xlYW51cFRlbXBJbWFnZXMiLCJkZWxldGVBc3luYyIsImlkZW1wb3RlbnQiLCJ3YXJuIiwiY2xlYW51cFRlbXBJbWFnZXMiLCJfeDciLCJieXRlcyIsIl9zaXplcyRNYXRoJG1pbiIsImsiLCJzaXplcyIsIk1hdGgiLCJmbG9vciIsImxvZyIsInNpemVVbml0IiwibWluIiwicG93IiwiX2dldEltYWdlRGltZW5zaW9ucyIsImdldEltYWdlRGltZW5zaW9ucyIsIl94OCIsIm1haW50YWluQXNwZWN0UmF0aW8iLCJpbWFnZUNvbXByZXNzaW9uIiwiZXhwb3J0cyIsIl9kZWZhdWx0Il0sInNvdXJjZXMiOlsiSW1hZ2VDb21wcmVzc2lvblNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBJbWFnZSBDb21wcmVzc2lvbiBTZXJ2aWNlIGZvciBQYXdmZWN0TWF0Y2ggTW9iaWxlIEFwcFxuICogUHJvdmlkZXMgY2xpZW50LXNpZGUgaW1hZ2UgcmVzaXppbmcgYW5kIGNvbXByZXNzaW9uIGJlZm9yZSB1cGxvYWRcbiAqL1xuaW1wb3J0ICogYXMgSW1hZ2VNYW5pcHVsYXRvciBmcm9tIFwiZXhwby1pbWFnZS1tYW5pcHVsYXRvclwiO1xuaW1wb3J0ICogYXMgRmlsZVN5c3RlbSBmcm9tIFwiZXhwby1maWxlLXN5c3RlbVwiO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIkBwYXdmZWN0bWF0Y2gvY29yZVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIEltYWdlQ29tcHJlc3Npb25PcHRpb25zIHtcbiAgbWF4V2lkdGg/OiBudW1iZXI7XG4gIG1heEhlaWdodD86IG51bWJlcjtcbiAgcXVhbGl0eT86IG51bWJlcjsgLy8gMC0xXG4gIGZvcm1hdD86IFwianBlZ1wiIHwgXCJwbmdcIjtcbiAgbWFpbnRhaW5Bc3BlY3RSYXRpbz86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tcHJlc3NlZEltYWdlUmVzdWx0IHtcbiAgdXJpOiBzdHJpbmc7XG4gIHdpZHRoOiBudW1iZXI7XG4gIGhlaWdodDogbnVtYmVyO1xuICBzaXplOiBudW1iZXI7XG4gIG9yaWdpbmFsU2l6ZTogbnVtYmVyO1xuICBjb21wcmVzc2lvblJhdGlvOiBudW1iZXI7XG59XG5cbmNsYXNzIEltYWdlQ29tcHJlc3Npb25TZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgREVGQVVMVF9PUFRJT05TOiBSZXF1aXJlZDxJbWFnZUNvbXByZXNzaW9uT3B0aW9ucz4gPSB7XG4gICAgbWF4V2lkdGg6IDE5MjAsXG4gICAgbWF4SGVpZ2h0OiAxOTIwLFxuICAgIHF1YWxpdHk6IDAuOCxcbiAgICBmb3JtYXQ6IFwianBlZ1wiLFxuICAgIG1haW50YWluQXNwZWN0UmF0aW86IHRydWUsXG4gIH07XG5cbiAgLyoqXG4gICAqIENvbXByZXNzIGFuZCByZXNpemUgYW4gaW1hZ2VcbiAgICovXG4gIGFzeW5jIGNvbXByZXNzSW1hZ2UoXG4gICAgaW1hZ2VVcmk6IHN0cmluZyxcbiAgICBvcHRpb25zOiBJbWFnZUNvbXByZXNzaW9uT3B0aW9ucyA9IHt9LFxuICApOiBQcm9taXNlPENvbXByZXNzZWRJbWFnZVJlc3VsdD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBvcHRzID0geyAuLi5JbWFnZUNvbXByZXNzaW9uU2VydmljZS5ERUZBVUxUX09QVElPTlMsIC4uLm9wdGlvbnMgfTtcblxuICAgICAgbG9nZ2VyLmluZm8oXCJTdGFydGluZyBpbWFnZSBjb21wcmVzc2lvblwiLCB7XG4gICAgICAgIHVyaTogaW1hZ2VVcmkuc3Vic3RyaW5nKDAsIDUwKSArIFwiLi4uXCIsXG4gICAgICAgIG9wdGlvbnM6IG9wdHMsXG4gICAgICB9KTtcblxuICAgICAgLy8gR2V0IG9yaWdpbmFsIGZpbGUgaW5mb1xuICAgICAgY29uc3Qgb3JpZ2luYWxJbmZvID0gYXdhaXQgRmlsZVN5c3RlbS5nZXRJbmZvQXN5bmMoaW1hZ2VVcmkpO1xuICAgICAgY29uc3Qgb3JpZ2luYWxTaXplID0gb3JpZ2luYWxJbmZvLmV4aXN0cyA/IG9yaWdpbmFsSW5mby5zaXplIDogMDtcblxuICAgICAgLy8gUGVyZm9ybSBpbWFnZSBtYW5pcHVsYXRpb25cbiAgICAgIGNvbnN0IG1hbmlwdWxhdGVkSW1hZ2UgPSBhd2FpdCBJbWFnZU1hbmlwdWxhdG9yLm1hbmlwdWxhdGVBc3luYyhcbiAgICAgICAgaW1hZ2VVcmksXG4gICAgICAgIFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICByZXNpemU6IHtcbiAgICAgICAgICAgICAgd2lkdGg6IG9wdHMubWF4V2lkdGgsXG4gICAgICAgICAgICAgIGhlaWdodDogb3B0cy5tYXhIZWlnaHQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIHtcbiAgICAgICAgICBjb21wcmVzczogb3B0cy5xdWFsaXR5LFxuICAgICAgICAgIGZvcm1hdDpcbiAgICAgICAgICAgIG9wdHMuZm9ybWF0ID09PSBcInBuZ1wiXG4gICAgICAgICAgICAgID8gSW1hZ2VNYW5pcHVsYXRvci5TYXZlRm9ybWF0LlBOR1xuICAgICAgICAgICAgICA6IEltYWdlTWFuaXB1bGF0b3IuU2F2ZUZvcm1hdC5KUEVHLFxuICAgICAgICB9LFxuICAgICAgKTtcblxuICAgICAgLy8gR2V0IGNvbXByZXNzZWQgZmlsZSBpbmZvXG4gICAgICBjb25zdCBjb21wcmVzc2VkSW5mbyA9IGF3YWl0IEZpbGVTeXN0ZW0uZ2V0SW5mb0FzeW5jKFxuICAgICAgICBtYW5pcHVsYXRlZEltYWdlLnVyaSxcbiAgICAgICk7XG4gICAgICBjb25zdCBjb21wcmVzc2VkU2l6ZSA9IGNvbXByZXNzZWRJbmZvLmV4aXN0cyA/IGNvbXByZXNzZWRJbmZvLnNpemUgOiAwO1xuXG4gICAgICBjb25zdCBjb21wcmVzc2lvblJhdGlvID1cbiAgICAgICAgb3JpZ2luYWxTaXplID4gMCA/IChvcmlnaW5hbFNpemUgLSBjb21wcmVzc2VkU2l6ZSkgLyBvcmlnaW5hbFNpemUgOiAwO1xuXG4gICAgICBjb25zdCByZXN1bHQ6IENvbXByZXNzZWRJbWFnZVJlc3VsdCA9IHtcbiAgICAgICAgdXJpOiBtYW5pcHVsYXRlZEltYWdlLnVyaSxcbiAgICAgICAgd2lkdGg6IG1hbmlwdWxhdGVkSW1hZ2Uud2lkdGgsXG4gICAgICAgIGhlaWdodDogbWFuaXB1bGF0ZWRJbWFnZS5oZWlnaHQsXG4gICAgICAgIHNpemU6IGNvbXByZXNzZWRTaXplLFxuICAgICAgICBvcmlnaW5hbFNpemUsXG4gICAgICAgIGNvbXByZXNzaW9uUmF0aW8sXG4gICAgICB9O1xuXG4gICAgICBsb2dnZXIuaW5mbyhcIkltYWdlIGNvbXByZXNzaW9uIGNvbXBsZXRlZFwiLCB7XG4gICAgICAgIG9yaWdpbmFsU2l6ZTogdGhpcy5mb3JtYXRGaWxlU2l6ZShvcmlnaW5hbFNpemUpLFxuICAgICAgICBjb21wcmVzc2VkU2l6ZTogdGhpcy5mb3JtYXRGaWxlU2l6ZShjb21wcmVzc2VkU2l6ZSksXG4gICAgICAgIGNvbXByZXNzaW9uUmF0aW86IGAkeyhjb21wcmVzc2lvblJhdGlvICogMTAwKS50b0ZpeGVkKDEpfSVgLFxuICAgICAgICBkaW1lbnNpb25zOiBgJHtTdHJpbmcobWFuaXB1bGF0ZWRJbWFnZS53aWR0aCl9eCR7U3RyaW5nKG1hbmlwdWxhdGVkSW1hZ2UuaGVpZ2h0KX1gLFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihcIkltYWdlIGNvbXByZXNzaW9uIGZhaWxlZFwiLCB7IGVycm9yLCBpbWFnZVVyaSB9KTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBjb21wcmVzcyBpbWFnZVwiKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ29tcHJlc3MgbXVsdGlwbGUgaW1hZ2VzIGluIGJhdGNoXG4gICAqL1xuICBhc3luYyBjb21wcmVzc0ltYWdlcyhcbiAgICBpbWFnZVVyaXM6IHN0cmluZ1tdLFxuICAgIG9wdGlvbnM6IEltYWdlQ29tcHJlc3Npb25PcHRpb25zID0ge30sXG4gICk6IFByb21pc2U8Q29tcHJlc3NlZEltYWdlUmVzdWx0W10+IHtcbiAgICBjb25zdCByZXN1bHRzOiBDb21wcmVzc2VkSW1hZ2VSZXN1bHRbXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCB1cmkgb2YgaW1hZ2VVcmlzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNvbXByZXNzSW1hZ2UodXJpLCBvcHRpb25zKTtcbiAgICAgICAgcmVzdWx0cy5wdXNoKHJlc3VsdCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBsb2dnZXIuZXJyb3IoXCJGYWlsZWQgdG8gY29tcHJlc3MgaW1hZ2UgaW4gYmF0Y2hcIiwgeyBlcnJvciwgdXJpIH0pO1xuICAgICAgICAvLyBDb250aW51ZSB3aXRoIG90aGVyIGltYWdlcyBldmVuIGlmIG9uZSBmYWlsc1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRzO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBvcHRpbWFsIGNvbXByZXNzaW9uIHNldHRpbmdzIGJhc2VkIG9uIGltYWdlIHR5cGVcbiAgICovXG4gIGdldE9wdGltYWxDb21wcmVzc2lvblNldHRpbmdzKGltYWdlVXJpOiBzdHJpbmcpOiBJbWFnZUNvbXByZXNzaW9uT3B0aW9ucyB7XG4gICAgLy8gQ2hlY2sgZmlsZSBleHRlbnNpb24gb3IgTUlNRSB0eXBlIGZvciBvcHRpbWl6YXRpb25cbiAgICBjb25zdCBpc0pwZWcgPVxuICAgICAgaW1hZ2VVcmkudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhcIi5qcGdcIikgfHxcbiAgICAgIGltYWdlVXJpLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCIuanBlZ1wiKTtcbiAgICBjb25zdCBpc1BuZyA9IGltYWdlVXJpLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCIucG5nXCIpO1xuXG4gICAgaWYgKGlzSnBlZykge1xuICAgICAgLy8gSlBFR3MgY2FuIGhhbmRsZSBoaWdoZXIgY29tcHJlc3Npb25cbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1heFdpZHRoOiAxOTIwLFxuICAgICAgICBtYXhIZWlnaHQ6IDE5MjAsXG4gICAgICAgIHF1YWxpdHk6IDAuNzUsXG4gICAgICAgIGZvcm1hdDogXCJqcGVnXCIsXG4gICAgICB9O1xuICAgIH0gZWxzZSBpZiAoaXNQbmcpIHtcbiAgICAgIC8vIFBOR3MgYXJlIGxvc3NsZXNzLCBidXQgd2UgY2FuIHN0aWxsIHJlc2l6ZVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWF4V2lkdGg6IDE5MjAsXG4gICAgICAgIG1heEhlaWdodDogMTkyMCxcbiAgICAgICAgcXVhbGl0eTogMC45LFxuICAgICAgICBmb3JtYXQ6IFwicG5nXCIsXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIERlZmF1bHQgc2V0dGluZ3NcbiAgICByZXR1cm4gSW1hZ2VDb21wcmVzc2lvblNlcnZpY2UuREVGQVVMVF9PUFRJT05TO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbXByZXNzIGltYWdlIGZvciBhdmF0YXIgKHNtYWxsZXIgZGltZW5zaW9ucylcbiAgICovXG4gIGFzeW5jIGNvbXByZXNzQXZhdGFySW1hZ2UoaW1hZ2VVcmk6IHN0cmluZyk6IFByb21pc2U8Q29tcHJlc3NlZEltYWdlUmVzdWx0PiB7XG4gICAgcmV0dXJuIHRoaXMuY29tcHJlc3NJbWFnZShpbWFnZVVyaSwge1xuICAgICAgbWF4V2lkdGg6IDUxMixcbiAgICAgIG1heEhlaWdodDogNTEyLFxuICAgICAgcXVhbGl0eTogMC44LFxuICAgICAgZm9ybWF0OiBcImpwZWdcIixcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb21wcmVzcyBpbWFnZSBmb3IgcGV0IHBob3RvcyAoc3RhbmRhcmQgZGltZW5zaW9ucylcbiAgICovXG4gIGFzeW5jIGNvbXByZXNzUGV0SW1hZ2UoaW1hZ2VVcmk6IHN0cmluZyk6IFByb21pc2U8Q29tcHJlc3NlZEltYWdlUmVzdWx0PiB7XG4gICAgcmV0dXJuIHRoaXMuY29tcHJlc3NJbWFnZShcbiAgICAgIGltYWdlVXJpLFxuICAgICAgdGhpcy5nZXRPcHRpbWFsQ29tcHJlc3Npb25TZXR0aW5ncyhpbWFnZVVyaSksXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb21wcmVzcyBpbWFnZSBmb3IgY2hhdCBtZXNzYWdlcyAoc21hbGxlciBmb3IgZmFzdGVyIHVwbG9hZClcbiAgICovXG4gIGFzeW5jIGNvbXByZXNzQ2hhdEltYWdlKGltYWdlVXJpOiBzdHJpbmcpOiBQcm9taXNlPENvbXByZXNzZWRJbWFnZVJlc3VsdD4ge1xuICAgIHJldHVybiB0aGlzLmNvbXByZXNzSW1hZ2UoaW1hZ2VVcmksIHtcbiAgICAgIG1heFdpZHRoOiAxMDI0LFxuICAgICAgbWF4SGVpZ2h0OiAxMDI0LFxuICAgICAgcXVhbGl0eTogMC43LFxuICAgICAgZm9ybWF0OiBcImpwZWdcIixcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBpbWFnZSBiZWZvcmUgY29tcHJlc3Npb25cbiAgICovXG4gIGFzeW5jIHZhbGlkYXRlSW1hZ2UoXG4gICAgaW1hZ2VVcmk6IHN0cmluZyxcbiAgKTogUHJvbWlzZTx7IGlzVmFsaWQ6IGJvb2xlYW47IGVycm9yPzogc3RyaW5nIH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaW5mbyA9IGF3YWl0IEZpbGVTeXN0ZW0uZ2V0SW5mb0FzeW5jKGltYWdlVXJpKTtcblxuICAgICAgaWYgKCFpbmZvLmV4aXN0cykge1xuICAgICAgICByZXR1cm4geyBpc1ZhbGlkOiBmYWxzZSwgZXJyb3I6IFwiSW1hZ2UgZmlsZSBkb2VzIG5vdCBleGlzdFwiIH07XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGZpbGUgc2l6ZSAobWF4IDIwTUIpXG4gICAgICBjb25zdCBtYXhTaXplID0gMjAgKiAxMDI0ICogMTAyNDsgLy8gMjBNQlxuICAgICAgaWYgKGluZm8uc2l6ZSA+IG1heFNpemUpIHtcbiAgICAgICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yOiBcIkltYWdlIGZpbGUgaXMgdG9vIGxhcmdlIChtYXggMjBNQilcIiB9O1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiBpdCdzIGFjdHVhbGx5IGFuIGltYWdlXG4gICAgICBjb25zdCBzdXBwb3J0ZWRFeHRlbnNpb25zID0gW1wiLmpwZ1wiLCBcIi5qcGVnXCIsIFwiLnBuZ1wiLCBcIi5naWZcIiwgXCIud2VicFwiXTtcbiAgICAgIGNvbnN0IGhhc1ZhbGlkRXh0ZW5zaW9uID0gc3VwcG9ydGVkRXh0ZW5zaW9ucy5zb21lKChleHQpID0+XG4gICAgICAgIGltYWdlVXJpLnRvTG93ZXJDYXNlKCkuZW5kc1dpdGgoZXh0KSxcbiAgICAgICk7XG5cbiAgICAgIGlmICghaGFzVmFsaWRFeHRlbnNpb24pIHtcbiAgICAgICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yOiBcIlVuc3VwcG9ydGVkIGltYWdlIGZvcm1hdFwiIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7IGlzVmFsaWQ6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKFwiSW1hZ2UgdmFsaWRhdGlvbiBmYWlsZWRcIiwgeyBlcnJvciwgaW1hZ2VVcmkgfSk7XG4gICAgICByZXR1cm4geyBpc1ZhbGlkOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIHZhbGlkYXRlIGltYWdlXCIgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2xlYW4gdXAgdGVtcG9yYXJ5IGNvbXByZXNzZWQgaW1hZ2VzXG4gICAqL1xuICBhc3luYyBjbGVhbnVwVGVtcEltYWdlcyhpbWFnZVVyaXM6IHN0cmluZ1tdKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgZm9yIChjb25zdCB1cmkgb2YgaW1hZ2VVcmlzKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBPbmx5IGRlbGV0ZSBmaWxlcyB0aGF0IGFyZSBpbiB0aGUgY2FjaGUvdGVtcCBkaXJlY3RvcnlcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHVyaS5pbmNsdWRlcyhcIkltYWdlTWFuaXB1bGF0b3JcIikgfHxcbiAgICAgICAgICB1cmkuaW5jbHVkZXMoXCJ0ZW1wXCIpIHx8XG4gICAgICAgICAgdXJpLmluY2x1ZGVzKFwiY2FjaGVcIilcbiAgICAgICAgKSB7XG4gICAgICAgICAgYXdhaXQgRmlsZVN5c3RlbS5kZWxldGVBc3luYyh1cmksIHsgaWRlbXBvdGVudDogdHJ1ZSB9KTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgbG9nZ2VyLndhcm4oXCJGYWlsZWQgdG8gY2xlYW51cCB0ZW1wIGltYWdlXCIsIHsgZXJyb3IsIHVyaSB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRm9ybWF0IGZpbGUgc2l6ZSBpbiBodW1hbiByZWFkYWJsZSBmb3JtYXRcbiAgICovXG4gIHByaXZhdGUgZm9ybWF0RmlsZVNpemUoYnl0ZXM6IG51bWJlcik6IHN0cmluZyB7XG4gICAgaWYgKGJ5dGVzID09PSAwKSByZXR1cm4gXCIwIEJcIjtcblxuICAgIGNvbnN0IGsgPSAxMDI0O1xuICAgIGNvbnN0IHNpemVzID0gW1wiQlwiLCBcIktCXCIsIFwiTUJcIiwgXCJHQlwiXTtcbiAgICBjb25zdCBpID0gTWF0aC5mbG9vcihNYXRoLmxvZyhieXRlcykgLyBNYXRoLmxvZyhrKSk7XG4gICAgY29uc3Qgc2l6ZVVuaXQgPSBzaXplc1tNYXRoLm1pbihpLCBzaXplcy5sZW5ndGggLSAxKV0gPz8gXCJCXCI7XG5cbiAgICByZXR1cm4gYCR7KGJ5dGVzIC8gTWF0aC5wb3coaywgaSkpLnRvRml4ZWQoMSl9ICR7c2l6ZVVuaXR9YDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgaW1hZ2UgZGltZW5zaW9ucyB3aXRob3V0IGxvYWRpbmcgZnVsbCBpbWFnZVxuICAgKi9cbiAgYXN5bmMgZ2V0SW1hZ2VEaW1lbnNpb25zKFxuICAgIGltYWdlVXJpOiBzdHJpbmcsXG4gICk6IFByb21pc2U8eyB3aWR0aDogbnVtYmVyOyBoZWlnaHQ6IG51bWJlciB9IHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBJbWFnZU1hbmlwdWxhdG9yLm1hbmlwdWxhdGVBc3luYyhcbiAgICAgICAgaW1hZ2VVcmksXG4gICAgICAgIFtdLCAvLyBObyBtYW5pcHVsYXRpb25zXG4gICAgICAgIHsgZm9ybWF0OiBJbWFnZU1hbmlwdWxhdG9yLlNhdmVGb3JtYXQuSlBFRyB9LFxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgd2lkdGg6IHJlc3VsdC53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiByZXN1bHQuaGVpZ2h0LFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKFwiRmFpbGVkIHRvIGdldCBpbWFnZSBkaW1lbnNpb25zXCIsIHsgZXJyb3IsIGltYWdlVXJpIH0pO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG59XG5cbi8vIENyZWF0ZSBzaW5nbGV0b24gaW5zdGFuY2VcbmV4cG9ydCBjb25zdCBpbWFnZUNvbXByZXNzaW9uID0gbmV3IEltYWdlQ29tcHJlc3Npb25TZXJ2aWNlKCk7XG5cbi8vIEV4cG9ydCB0eXBlcyBhbmQgdXRpbGl0aWVzXG5leHBvcnQgZGVmYXVsdCBpbWFnZUNvbXByZXNzaW9uO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUlBLElBQUFBLGdCQUFBLEdBQUFDLHVCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxVQUFBLEdBQUFGLHVCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRSxLQUFBLEdBQUFGLE9BQUE7QUFBNEMsU0FBQUQsd0JBQUFJLENBQUEsRUFBQUMsQ0FBQSw2QkFBQUMsT0FBQSxNQUFBQyxDQUFBLE9BQUFELE9BQUEsSUFBQUUsQ0FBQSxPQUFBRixPQUFBLFlBQUFOLHVCQUFBLFlBQUFBLHdCQUFBSSxDQUFBLEVBQUFDLENBQUEsU0FBQUEsQ0FBQSxJQUFBRCxDQUFBLElBQUFBLENBQUEsQ0FBQUssVUFBQSxTQUFBTCxDQUFBLE1BQUFNLENBQUEsRUFBQUMsQ0FBQSxFQUFBQyxDQUFBLEtBQUFDLFNBQUEsUUFBQUMsT0FBQSxFQUFBVixDQUFBLGlCQUFBQSxDQUFBLHVCQUFBQSxDQUFBLHlCQUFBQSxDQUFBLFNBQUFRLENBQUEsTUFBQUYsQ0FBQSxHQUFBTCxDQUFBLEdBQUFHLENBQUEsR0FBQUQsQ0FBQSxRQUFBRyxDQUFBLENBQUFLLEdBQUEsQ0FBQVgsQ0FBQSxVQUFBTSxDQUFBLENBQUFNLEdBQUEsQ0FBQVosQ0FBQSxHQUFBTSxDQUFBLENBQUFPLEdBQUEsQ0FBQWIsQ0FBQSxFQUFBUSxDQUFBLGNBQUFNLEVBQUEsSUFBQWQsQ0FBQSxnQkFBQWMsRUFBQSxPQUFBQyxjQUFBLENBQUFDLElB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