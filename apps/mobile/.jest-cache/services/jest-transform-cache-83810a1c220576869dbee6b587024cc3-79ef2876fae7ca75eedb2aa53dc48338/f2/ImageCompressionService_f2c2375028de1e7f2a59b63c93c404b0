6b4c4123675aefd65c1ece2ec5aa1204
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.imageCompression = exports.default = void 0;
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var ImageManipulator = _interopRequireWildcard(require("expo-image-manipulator"));
var FileSystem = _interopRequireWildcard(require("expo-file-system"));
var _core = require("@pawfectmatch/core");
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function _interopRequireWildcard(e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (var _t2 in e) "default" !== _t2 && {}.hasOwnProperty.call(e, _t2) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, _t2)) && (i.get || i.set) ? o(f, _t2, i) : f[_t2] = e[_t2]); return f; })(e, t); }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
var ImageCompressionService = function () {
  function ImageCompressionService() {
    (0, _classCallCheck2.default)(this, ImageCompressionService);
  }
  return (0, _createClass2.default)(ImageCompressionService, [{
    key: "compressImage",
    value: (function () {
      var _compressImage = (0, _asyncToGenerator2.default)(function* (imageUri) {
        var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
        try {
          var opts = _objectSpread(_objectSpread({}, ImageCompressionService.DEFAULT_OPTIONS), options);
          _core.logger.info("Starting image compression", {
            uri: imageUri.substring(0, 50) + "...",
            options: opts
          });
          var originalInfo = yield FileSystem.getInfoAsync(imageUri);
          var originalSize = originalInfo.exists ? originalInfo.size : 0;
          var manipulatedImage = yield ImageManipulator.manipulateAsync(imageUri, [{
            resize: {
              width: opts.maxWidth,
              height: opts.maxHeight
            }
          }], {
            compress: opts.quality,
            format: opts.format === "png" ? ImageManipulator.SaveFormat.PNG : ImageManipulator.SaveFormat.JPEG
          });
          var compressedInfo = yield FileSystem.getInfoAsync(manipulatedImage.uri);
          var compressedSize = compressedInfo.exists ? compressedInfo.size : 0;
          var compressionRatio = originalSize > 0 ? (originalSize - compressedSize) / originalSize : 0;
          var result = {
            uri: manipulatedImage.uri,
            width: manipulatedImage.width,
            height: manipulatedImage.height,
            size: compressedSize,
            originalSize: originalSize,
            compressionRatio: compressionRatio
          };
          _core.logger.info("Image compression completed", {
            originalSize: this.formatFileSize(originalSize),
            compressedSize: this.formatFileSize(compressedSize),
            compressionRatio: `${(compressionRatio * 100).toFixed(1)}%`,
            dimensions: `${String(manipulatedImage.width)}x${String(manipulatedImage.height)}`
          });
          return result;
        } catch (error) {
          _core.logger.error("Image compression failed", {
            error: error,
            imageUri: imageUri
          });
          throw new Error("Failed to compress image");
        }
      });
      function compressImage(_x) {
        return _compressImage.apply(this, arguments);
      }
      return compressImage;
    }())
  }, {
    key: "compressImages",
    value: (function () {
      var _compressImages = (0, _asyncToGenerator2.default)(function* (imageUris) {
        var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
        var results = [];
        for (var uri of imageUris) {
          try {
            var result = yield this.compressImage(uri, options);
            results.push(result);
          } catch (error) {
            _core.logger.error("Failed to compress image in batch", {
              error: error,
              uri: uri
            });
          }
        }
        return results;
      });
      function compressImages(_x2) {
        return _compressImages.apply(this, arguments);
      }
      return compressImages;
    }())
  }, {
    key: "getOptimalCompressionSettings",
    value: function getOptimalCompressionSettings(imageUri) {
      var isJpeg = imageUri.toLowerCase().includes(".jpg") || imageUri.toLowerCase().includes(".jpeg");
      var isPng = imageUri.toLowerCase().includes(".png");
      if (isJpeg) {
        return {
          maxWidth: 1920,
          maxHeight: 1920,
          quality: 0.75,
          format: "jpeg"
        };
      } else if (isPng) {
        return {
          maxWidth: 1920,
          maxHeight: 1920,
          quality: 0.9,
          format: "png"
        };
      }
      return ImageCompressionService.DEFAULT_OPTIONS;
    }
  }, {
    key: "compressAvatarImage",
    value: (function () {
      var _compressAvatarImage = (0, _asyncToGenerator2.default)(function* (imageUri) {
        return this.compressImage(imageUri, {
          maxWidth: 512,
          maxHeight: 512,
          quality: 0.8,
          format: "jpeg"
        });
      });
      function compressAvatarImage(_x3) {
        return _compressAvatarImage.apply(this, arguments);
      }
      return compressAvatarImage;
    }())
  }, {
    key: "compressPetImage",
    value: (function () {
      var _compressPetImage = (0, _asyncToGenerator2.default)(function* (imageUri) {
        return this.compressImage(imageUri, this.getOptimalCompressionSettings(imageUri));
      });
      function compressPetImage(_x4) {
        return _compressPetImage.apply(this, arguments);
      }
      return compressPetImage;
    }())
  }, {
    key: "compressChatImage",
    value: (function () {
      var _compressChatImage = (0, _asyncToGenerator2.default)(function* (imageUri) {
        return this.compressImage(imageUri, {
          maxWidth: 1024,
          maxHeight: 1024,
          quality: 0.7,
          format: "jpeg"
        });
      });
      function compressChatImage(_x5) {
        return _compressChatImage.apply(this, arguments);
      }
      return compressChatImage;
    }())
  }, {
    key: "validateImage",
    value: (function () {
      var _validateImage = (0, _asyncToGenerator2.default)(function* (imageUri) {
        try {
          var info = yield FileSystem.getInfoAsync(imageUri);
          if (!info.exists) {
            return {
              isValid: false,
              error: "Image file does not exist"
            };
          }
          var maxSize = 20 * 1024 * 1024;
          if (info.size > maxSize) {
            return {
              isValid: false,
              error: "Image file is too large (max 20MB)"
            };
          }
          var supportedExtensions = [".jpg", ".jpeg", ".png", ".gif", ".webp"];
          var hasValidExtension = supportedExtensions.some(function (ext) {
            return imageUri.toLowerCase().endsWith(ext);
          });
          if (!hasValidExtension) {
            return {
              isValid: false,
              error: "Unsupported image format"
            };
          }
          return {
            isValid: true
          };
        } catch (error) {
          _core.logger.error("Image validation failed", {
            error: error,
            imageUri: imageUri
          });
          return {
            isValid: false,
            error: "Failed to validate image"
          };
        }
      });
      function validateImage(_x6) {
        return _validateImage.apply(this, arguments);
      }
      return validateImage;
    }())
  }, {
    key: "cleanupTempImages",
    value: (function () {
      var _cleanupTempImages = (0, _asyncToGenerator2.default)(function* (imageUris) {
        for (var uri of imageUris) {
          try {
            if (uri.includes("ImageManipulator") || uri.includes("temp") || uri.includes("cache")) {
              yield FileSystem.deleteAsync(uri, {
                idempotent: true
              });
            }
          } catch (error) {
            _core.logger.warn("Failed to cleanup temp image", {
              error: error,
              uri: uri
            });
          }
        }
      });
      function cleanupTempImages(_x7) {
        return _cleanupTempImages.apply(this, arguments);
      }
      return cleanupTempImages;
    }())
  }, {
    key: "formatFileSize",
    value: function formatFileSize(bytes) {
      var _sizes$Math$min;
      if (bytes === 0) return "0 B";
      var k = 1024;
      var sizes = ["B", "KB", "MB", "GB"];
      var i = Math.floor(Math.log(bytes) / Math.log(k));
      var sizeUnit = (_sizes$Math$min = sizes[Math.min(i, sizes.length - 1)]) != null ? _sizes$Math$min : "B";
      return `${(bytes / Math.pow(k, i)).toFixed(1)} ${sizeUnit}`;
    }
  }, {
    key: "getImageDimensions",
    value: (function () {
      var _getImageDimensions = (0, _asyncToGenerator2.default)(function* (imageUri) {
        try {
          var result = yield ImageManipulator.manipulateAsync(imageUri, [], {
            format: ImageManipulator.SaveFormat.JPEG
          });
          return {
            width: result.width,
            height: result.height
          };
        } catch (error) {
          _core.logger.error("Failed to get image dimensions", {
            error: error,
            imageUri: imageUri
          });
          return null;
        }
      });
      function getImageDimensions(_x8) {
        return _getImageDimensions.apply(this, arguments);
      }
      return getImageDimensions;
    }())
  }]);
}();
ImageCompressionService.DEFAULT_OPTIONS = {
  maxWidth: 1920,
  maxHeight: 1920,
  quality: 0.8,
  format: "jpeg",
  maintainAspectRatio: true
};
var imageCompression = exports.imageCompression = new ImageCompressionService();
var _default = exports.default = imageCompression;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJJbWFnZU1hbmlwdWxhdG9yIiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJyZXF1aXJlIiwiRmlsZVN5c3RlbSIsIl9jb3JlIiwiZSIsInQiLCJXZWFrTWFwIiwiciIsIm4iLCJfX2VzTW9kdWxlIiwibyIsImkiLCJmIiwiX19wcm90b19fIiwiZGVmYXVsdCIsImhhcyIsImdldCIsInNldCIsIl90MiIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwib3duS2V5cyIsImtleXMiLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJmaWx0ZXIiLCJlbnVtZXJhYmxlIiwicHVzaCIsImFwcGx5IiwiX29iamVjdFNwcmVhZCIsImFyZ3VtZW50cyIsImxlbmd0aCIsImZvckVhY2giLCJfZGVmaW5lUHJvcGVydHkyIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyIsImRlZmluZVByb3BlcnRpZXMiLCJJbWFnZUNvbXByZXNzaW9uU2VydmljZSIsIl9jbGFzc0NhbGxDaGVjazIiLCJfY3JlYXRlQ2xhc3MyIiwia2V5IiwidmFsdWUiLCJfY29tcHJlc3NJbWFnZSIsIl9hc3luY1RvR2VuZXJhdG9yMiIsImltYWdlVXJpIiwib3B0aW9ucyIsInVuZGVmaW5lZCIsIm9wdHMiLCJERUZBVUxUX09QVElPTlMiLCJsb2dnZXIiLCJpbmZvIiwidXJpIiwic3Vic3RyaW5nIiwib3JpZ2luYWxJbmZvIiwiZ2V0SW5mb0FzeW5jIiwib3JpZ2luYWxTaXplIiwiZXhpc3RzIiwic2l6ZSIsIm1hbmlwdWxhdGVkSW1hZ2UiLCJtYW5pcHVsYXRlQXN5bmMiLCJyZXNpemUiLCJ3aWR0aCIsIm1heFdpZHRoIiwiaGVpZ2h0IiwibWF4SGVpZ2h0IiwiY29tcHJlc3MiLCJxdWFsaXR5IiwiZm9ybWF0IiwiU2F2ZUZvcm1hdCIsIlBORyIsIkpQRUciLCJjb21wcmVzc2VkSW5mbyIsImNvbXByZXNzZWRTaXplIiwiY29tcHJlc3Npb25SYXRpbyIsInJlc3VsdCIsImZvcm1hdEZpbGVTaXplIiwidG9GaXhlZCIsImRpbWVuc2lvbnMiLCJTdHJpbmciLCJlcnJvciIsIkVycm9yIiwiY29tcHJlc3NJbWFnZSIsIl94IiwiX2NvbXByZXNzSW1hZ2VzIiwiaW1hZ2VVcmlzIiwicmVzdWx0cyIsImNvbXByZXNzSW1hZ2VzIiwiX3gyIiwiZ2V0T3B0aW1hbENvbXByZXNzaW9uU2V0dGluZ3MiLCJpc0pwZWciLCJ0b0xvd2VyQ2FzZSIsImluY2x1ZGVzIiwiaXNQbmciLCJfY29tcHJlc3NBdmF0YXJJbWFnZSIsImNvbXByZXNzQXZhdGFySW1hZ2UiLCJfeDMiLCJfY29tcHJlc3NQZXRJbWFnZSIsImNvbXByZXNzUGV0SW1hZ2UiLCJfeDQiLCJfY29tcHJlc3NDaGF0SW1hZ2UiLCJjb21wcmVzc0NoYXRJbWFnZSIsIl94NSIsIl92YWxpZGF0ZUltYWdlIiwiaXNWYWxpZCIsIm1heFNpemUiLCJzdXBwb3J0ZWRFeHRlbnNpb25zIiwiaGFzVmFsaWRFeHRlbnNpb24iLCJzb21lIiwiZXh0IiwiZW5kc1dpdGgiLCJ2YWxpZGF0ZUltYWdlIiwiX3g2IiwiX2NsZWFudXBUZW1wSW1hZ2VzIiwiZGVsZXRlQXN5bmMiLCJpZGVtcG90ZW50Iiwid2FybiIsImNsZWFudXBUZW1wSW1hZ2VzIiwiX3g3IiwiYnl0ZXMiLCJfc2l6ZXMkTWF0aCRtaW4iLCJrIiwic2l6ZXMiLCJNYXRoIiwiZmxvb3IiLCJsb2ciLCJzaXplVW5pdCIsIm1pbiIsInBvdyIsIl9nZXRJbWFnZURpbWVuc2lvbnMiLCJnZXRJbWFnZURpbWVuc2lvbnMiLCJfeDgiLCJtYWludGFpbkFzcGVjdFJhdGlvIiwiaW1hZ2VDb21wcmVzc2lvbiIsImV4cG9ydHMiLCJfZGVmYXVsdCJdLCJzb3VyY2VzIjpbIkltYWdlQ29tcHJlc3Npb25TZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSW1hZ2UgQ29tcHJlc3Npb24gU2VydmljZSBmb3IgUGF3ZmVjdE1hdGNoIE1vYmlsZSBBcHBcbiAqIFByb3ZpZGVzIGNsaWVudC1zaWRlIGltYWdlIHJlc2l6aW5nIGFuZCBjb21wcmVzc2lvbiBiZWZvcmUgdXBsb2FkXG4gKi9cbmltcG9ydCAqIGFzIEltYWdlTWFuaXB1bGF0b3IgZnJvbSBcImV4cG8taW1hZ2UtbWFuaXB1bGF0b3JcIjtcbmltcG9ydCAqIGFzIEZpbGVTeXN0ZW0gZnJvbSBcImV4cG8tZmlsZS1zeXN0ZW1cIjtcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gXCJAcGF3ZmVjdG1hdGNoL2NvcmVcIjtcblxuZXhwb3J0IGludGVyZmFjZSBJbWFnZUNvbXByZXNzaW9uT3B0aW9ucyB7XG4gIG1heFdpZHRoPzogbnVtYmVyO1xuICBtYXhIZWlnaHQ/OiBudW1iZXI7XG4gIHF1YWxpdHk/OiBudW1iZXI7IC8vIDAtMVxuICBmb3JtYXQ/OiBcImpwZWdcIiB8IFwicG5nXCI7XG4gIG1haW50YWluQXNwZWN0UmF0aW8/OiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbXByZXNzZWRJbWFnZVJlc3VsdCB7XG4gIHVyaTogc3RyaW5nO1xuICB3aWR0aDogbnVtYmVyO1xuICBoZWlnaHQ6IG51bWJlcjtcbiAgc2l6ZTogbnVtYmVyO1xuICBvcmlnaW5hbFNpemU6IG51bWJlcjtcbiAgY29tcHJlc3Npb25SYXRpbzogbnVtYmVyO1xufVxuXG5jbGFzcyBJbWFnZUNvbXByZXNzaW9uU2VydmljZSB7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IERFRkFVTFRfT1BUSU9OUzogUmVxdWlyZWQ8SW1hZ2VDb21wcmVzc2lvbk9wdGlvbnM+ID0ge1xuICAgIG1heFdpZHRoOiAxOTIwLFxuICAgIG1heEhlaWdodDogMTkyMCxcbiAgICBxdWFsaXR5OiAwLjgsXG4gICAgZm9ybWF0OiBcImpwZWdcIixcbiAgICBtYWludGFpbkFzcGVjdFJhdGlvOiB0cnVlLFxuICB9O1xuXG4gIC8qKlxuICAgKiBDb21wcmVzcyBhbmQgcmVzaXplIGFuIGltYWdlXG4gICAqL1xuICBhc3luYyBjb21wcmVzc0ltYWdlKFxuICAgIGltYWdlVXJpOiBzdHJpbmcsXG4gICAgb3B0aW9uczogSW1hZ2VDb21wcmVzc2lvbk9wdGlvbnMgPSB7fSxcbiAgKTogUHJvbWlzZTxDb21wcmVzc2VkSW1hZ2VSZXN1bHQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb3B0cyA9IHsgLi4uSW1hZ2VDb21wcmVzc2lvblNlcnZpY2UuREVGQVVMVF9PUFRJT05TLCAuLi5vcHRpb25zIH07XG5cbiAgICAgIGxvZ2dlci5pbmZvKFwiU3RhcnRpbmcgaW1hZ2UgY29tcHJlc3Npb25cIiwge1xuICAgICAgICB1cmk6IGltYWdlVXJpLnN1YnN0cmluZygwLCA1MCkgKyBcIi4uLlwiLFxuICAgICAgICBvcHRpb25zOiBvcHRzLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEdldCBvcmlnaW5hbCBmaWxlIGluZm9cbiAgICAgIGNvbnN0IG9yaWdpbmFsSW5mbyA9IGF3YWl0IEZpbGVTeXN0ZW0uZ2V0SW5mb0FzeW5jKGltYWdlVXJpKTtcbiAgICAgIGNvbnN0IG9yaWdpbmFsU2l6ZSA9IG9yaWdpbmFsSW5mby5leGlzdHMgPyBvcmlnaW5hbEluZm8uc2l6ZSA6IDA7XG5cbiAgICAgIC8vIFBlcmZvcm0gaW1hZ2UgbWFuaXB1bGF0aW9uXG4gICAgICBjb25zdCBtYW5pcHVsYXRlZEltYWdlID0gYXdhaXQgSW1hZ2VNYW5pcHVsYXRvci5tYW5pcHVsYXRlQXN5bmMoXG4gICAgICAgIGltYWdlVXJpLFxuICAgICAgICBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgcmVzaXplOiB7XG4gICAgICAgICAgICAgIHdpZHRoOiBvcHRzLm1heFdpZHRoLFxuICAgICAgICAgICAgICBoZWlnaHQ6IG9wdHMubWF4SGVpZ2h0LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICB7XG4gICAgICAgICAgY29tcHJlc3M6IG9wdHMucXVhbGl0eSxcbiAgICAgICAgICBmb3JtYXQ6XG4gICAgICAgICAgICBvcHRzLmZvcm1hdCA9PT0gXCJwbmdcIlxuICAgICAgICAgICAgICA/IEltYWdlTWFuaXB1bGF0b3IuU2F2ZUZvcm1hdC5QTkdcbiAgICAgICAgICAgICAgOiBJbWFnZU1hbmlwdWxhdG9yLlNhdmVGb3JtYXQuSlBFRyxcbiAgICAgICAgfSxcbiAgICAgICk7XG5cbiAgICAgIC8vIEdldCBjb21wcmVzc2VkIGZpbGUgaW5mb1xuICAgICAgY29uc3QgY29tcHJlc3NlZEluZm8gPSBhd2FpdCBGaWxlU3lzdGVtLmdldEluZm9Bc3luYyhcbiAgICAgICAgbWFuaXB1bGF0ZWRJbWFnZS51cmksXG4gICAgICApO1xuICAgICAgY29uc3QgY29tcHJlc3NlZFNpemUgPSBjb21wcmVzc2VkSW5mby5leGlzdHMgPyBjb21wcmVzc2VkSW5mby5zaXplIDogMDtcblxuICAgICAgY29uc3QgY29tcHJlc3Npb25SYXRpbyA9XG4gICAgICAgIG9yaWdpbmFsU2l6ZSA+IDAgPyAob3JpZ2luYWxTaXplIC0gY29tcHJlc3NlZFNpemUpIC8gb3JpZ2luYWxTaXplIDogMDtcblxuICAgICAgY29uc3QgcmVzdWx0OiBDb21wcmVzc2VkSW1hZ2VSZXN1bHQgPSB7XG4gICAgICAgIHVyaTogbWFuaXB1bGF0ZWRJbWFnZS51cmksXG4gICAgICAgIHdpZHRoOiBtYW5pcHVsYXRlZEltYWdlLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IG1hbmlwdWxhdGVkSW1hZ2UuaGVpZ2h0LFxuICAgICAgICBzaXplOiBjb21wcmVzc2VkU2l6ZSxcbiAgICAgICAgb3JpZ2luYWxTaXplLFxuICAgICAgICBjb21wcmVzc2lvblJhdGlvLFxuICAgICAgfTtcblxuICAgICAgbG9nZ2VyLmluZm8oXCJJbWFnZSBjb21wcmVzc2lvbiBjb21wbGV0ZWRcIiwge1xuICAgICAgICBvcmlnaW5hbFNpemU6IHRoaXMuZm9ybWF0RmlsZVNpemUob3JpZ2luYWxTaXplKSxcbiAgICAgICAgY29tcHJlc3NlZFNpemU6IHRoaXMuZm9ybWF0RmlsZVNpemUoY29tcHJlc3NlZFNpemUpLFxuICAgICAgICBjb21wcmVzc2lvblJhdGlvOiBgJHsoY29tcHJlc3Npb25SYXRpbyAqIDEwMCkudG9GaXhlZCgxKX0lYCxcbiAgICAgICAgZGltZW5zaW9uczogYCR7U3RyaW5nKG1hbmlwdWxhdGVkSW1hZ2Uud2lkdGgpfXgke1N0cmluZyhtYW5pcHVsYXRlZEltYWdlLmhlaWdodCl9YCxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoXCJJbWFnZSBjb21wcmVzc2lvbiBmYWlsZWRcIiwgeyBlcnJvciwgaW1hZ2VVcmkgfSk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gY29tcHJlc3MgaW1hZ2VcIik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENvbXByZXNzIG11bHRpcGxlIGltYWdlcyBpbiBiYXRjaFxuICAgKi9cbiAgYXN5bmMgY29tcHJlc3NJbWFnZXMoXG4gICAgaW1hZ2VVcmlzOiBzdHJpbmdbXSxcbiAgICBvcHRpb25zOiBJbWFnZUNvbXByZXNzaW9uT3B0aW9ucyA9IHt9LFxuICApOiBQcm9taXNlPENvbXByZXNzZWRJbWFnZVJlc3VsdFtdPiB7XG4gICAgY29uc3QgcmVzdWx0czogQ29tcHJlc3NlZEltYWdlUmVzdWx0W10gPSBbXTtcblxuICAgIGZvciAoY29uc3QgdXJpIG9mIGltYWdlVXJpcykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5jb21wcmVzc0ltYWdlKHVyaSwgb3B0aW9ucyk7XG4gICAgICAgIHJlc3VsdHMucHVzaChyZXN1bHQpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKFwiRmFpbGVkIHRvIGNvbXByZXNzIGltYWdlIGluIGJhdGNoXCIsIHsgZXJyb3IsIHVyaSB9KTtcbiAgICAgICAgLy8gQ29udGludWUgd2l0aCBvdGhlciBpbWFnZXMgZXZlbiBpZiBvbmUgZmFpbHNcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgb3B0aW1hbCBjb21wcmVzc2lvbiBzZXR0aW5ncyBiYXNlZCBvbiBpbWFnZSB0eXBlXG4gICAqL1xuICBnZXRPcHRpbWFsQ29tcHJlc3Npb25TZXR0aW5ncyhpbWFnZVVyaTogc3RyaW5nKTogSW1hZ2VDb21wcmVzc2lvbk9wdGlvbnMge1xuICAgIC8vIENoZWNrIGZpbGUgZXh0ZW5zaW9uIG9yIE1JTUUgdHlwZSBmb3Igb3B0aW1pemF0aW9uXG4gICAgY29uc3QgaXNKcGVnID1cbiAgICAgIGltYWdlVXJpLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCIuanBnXCIpIHx8XG4gICAgICBpbWFnZVVyaS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwiLmpwZWdcIik7XG4gICAgY29uc3QgaXNQbmcgPSBpbWFnZVVyaS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwiLnBuZ1wiKTtcblxuICAgIGlmIChpc0pwZWcpIHtcbiAgICAgIC8vIEpQRUdzIGNhbiBoYW5kbGUgaGlnaGVyIGNvbXByZXNzaW9uXG4gICAgICByZXR1cm4ge1xuICAgICAgICBtYXhXaWR0aDogMTkyMCxcbiAgICAgICAgbWF4SGVpZ2h0OiAxOTIwLFxuICAgICAgICBxdWFsaXR5OiAwLjc1LFxuICAgICAgICBmb3JtYXQ6IFwianBlZ1wiLFxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKGlzUG5nKSB7XG4gICAgICAvLyBQTkdzIGFyZSBsb3NzbGVzcywgYnV0IHdlIGNhbiBzdGlsbCByZXNpemVcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1heFdpZHRoOiAxOTIwLFxuICAgICAgICBtYXhIZWlnaHQ6IDE5MjAsXG4gICAgICAgIHF1YWxpdHk6IDAuOSxcbiAgICAgICAgZm9ybWF0OiBcInBuZ1wiLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBEZWZhdWx0IHNldHRpbmdzXG4gICAgcmV0dXJuIEltYWdlQ29tcHJlc3Npb25TZXJ2aWNlLkRFRkFVTFRfT1BUSU9OUztcbiAgfVxuXG4gIC8qKlxuICAgKiBDb21wcmVzcyBpbWFnZSBmb3IgYXZhdGFyIChzbWFsbGVyIGRpbWVuc2lvbnMpXG4gICAqL1xuICBhc3luYyBjb21wcmVzc0F2YXRhckltYWdlKGltYWdlVXJpOiBzdHJpbmcpOiBQcm9taXNlPENvbXByZXNzZWRJbWFnZVJlc3VsdD4ge1xuICAgIHJldHVybiB0aGlzLmNvbXByZXNzSW1hZ2UoaW1hZ2VVcmksIHtcbiAgICAgIG1heFdpZHRoOiA1MTIsXG4gICAgICBtYXhIZWlnaHQ6IDUxMixcbiAgICAgIHF1YWxpdHk6IDAuOCxcbiAgICAgIGZvcm1hdDogXCJqcGVnXCIsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ29tcHJlc3MgaW1hZ2UgZm9yIHBldCBwaG90b3MgKHN0YW5kYXJkIGRpbWVuc2lvbnMpXG4gICAqL1xuICBhc3luYyBjb21wcmVzc1BldEltYWdlKGltYWdlVXJpOiBzdHJpbmcpOiBQcm9taXNlPENvbXByZXNzZWRJbWFnZVJlc3VsdD4ge1xuICAgIHJldHVybiB0aGlzLmNvbXByZXNzSW1hZ2UoXG4gICAgICBpbWFnZVVyaSxcbiAgICAgIHRoaXMuZ2V0T3B0aW1hbENvbXByZXNzaW9uU2V0dGluZ3MoaW1hZ2VVcmkpLFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQ29tcHJlc3MgaW1hZ2UgZm9yIGNoYXQgbWVzc2FnZXMgKHNtYWxsZXIgZm9yIGZhc3RlciB1cGxvYWQpXG4gICAqL1xuICBhc3luYyBjb21wcmVzc0NoYXRJbWFnZShpbWFnZVVyaTogc3RyaW5nKTogUHJvbWlzZTxDb21wcmVzc2VkSW1hZ2VSZXN1bHQ+IHtcbiAgICByZXR1cm4gdGhpcy5jb21wcmVzc0ltYWdlKGltYWdlVXJpLCB7XG4gICAgICBtYXhXaWR0aDogMTAyNCxcbiAgICAgIG1heEhlaWdodDogMTAyNCxcbiAgICAgIHF1YWxpdHk6IDAuNyxcbiAgICAgIGZvcm1hdDogXCJqcGVnXCIsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgaW1hZ2UgYmVmb3JlIGNvbXByZXNzaW9uXG4gICAqL1xuICBhc3luYyB2YWxpZGF0ZUltYWdlKFxuICAgIGltYWdlVXJpOiBzdHJpbmcsXG4gICk6IFByb21pc2U8eyBpc1ZhbGlkOiBib29sZWFuOyBlcnJvcj86IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGluZm8gPSBhd2FpdCBGaWxlU3lzdGVtLmdldEluZm9Bc3luYyhpbWFnZVVyaSk7XG5cbiAgICAgIGlmICghaW5mby5leGlzdHMpIHtcbiAgICAgICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yOiBcIkltYWdlIGZpbGUgZG9lcyBub3QgZXhpc3RcIiB9O1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBmaWxlIHNpemUgKG1heCAyME1CKVxuICAgICAgY29uc3QgbWF4U2l6ZSA9IDIwICogMTAyNCAqIDEwMjQ7IC8vIDIwTUJcbiAgICAgIGlmIChpbmZvLnNpemUgPiBtYXhTaXplKSB7XG4gICAgICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcjogXCJJbWFnZSBmaWxlIGlzIHRvbyBsYXJnZSAobWF4IDIwTUIpXCIgfTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhY3R1YWxseSBhbiBpbWFnZVxuICAgICAgY29uc3Qgc3VwcG9ydGVkRXh0ZW5zaW9ucyA9IFtcIi5qcGdcIiwgXCIuanBlZ1wiLCBcIi5wbmdcIiwgXCIuZ2lmXCIsIFwiLndlYnBcIl07XG4gICAgICBjb25zdCBoYXNWYWxpZEV4dGVuc2lvbiA9IHN1cHBvcnRlZEV4dGVuc2lvbnMuc29tZSgoZXh0KSA9PlxuICAgICAgICBpbWFnZVVyaS50b0xvd2VyQ2FzZSgpLmVuZHNXaXRoKGV4dCksXG4gICAgICApO1xuXG4gICAgICBpZiAoIWhhc1ZhbGlkRXh0ZW5zaW9uKSB7XG4gICAgICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcjogXCJVbnN1cHBvcnRlZCBpbWFnZSBmb3JtYXRcIiB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4geyBpc1ZhbGlkOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihcIkltYWdlIHZhbGlkYXRpb24gZmFpbGVkXCIsIHsgZXJyb3IsIGltYWdlVXJpIH0pO1xuICAgICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yOiBcIkZhaWxlZCB0byB2YWxpZGF0ZSBpbWFnZVwiIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENsZWFuIHVwIHRlbXBvcmFyeSBjb21wcmVzc2VkIGltYWdlc1xuICAgKi9cbiAgYXN5bmMgY2xlYW51cFRlbXBJbWFnZXMoaW1hZ2VVcmlzOiBzdHJpbmdbXSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGZvciAoY29uc3QgdXJpIG9mIGltYWdlVXJpcykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gT25seSBkZWxldGUgZmlsZXMgdGhhdCBhcmUgaW4gdGhlIGNhY2hlL3RlbXAgZGlyZWN0b3J5XG4gICAgICAgIGlmIChcbiAgICAgICAgICB1cmkuaW5jbHVkZXMoXCJJbWFnZU1hbmlwdWxhdG9yXCIpIHx8XG4gICAgICAgICAgdXJpLmluY2x1ZGVzKFwidGVtcFwiKSB8fFxuICAgICAgICAgIHVyaS5pbmNsdWRlcyhcImNhY2hlXCIpXG4gICAgICAgICkge1xuICAgICAgICAgIGF3YWl0IEZpbGVTeXN0ZW0uZGVsZXRlQXN5bmModXJpLCB7IGlkZW1wb3RlbnQ6IHRydWUgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGxvZ2dlci53YXJuKFwiRmFpbGVkIHRvIGNsZWFudXAgdGVtcCBpbWFnZVwiLCB7IGVycm9yLCB1cmkgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZvcm1hdCBmaWxlIHNpemUgaW4gaHVtYW4gcmVhZGFibGUgZm9ybWF0XG4gICAqL1xuICBwcml2YXRlIGZvcm1hdEZpbGVTaXplKGJ5dGVzOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIGlmIChieXRlcyA9PT0gMCkgcmV0dXJuIFwiMCBCXCI7XG5cbiAgICBjb25zdCBrID0gMTAyNDtcbiAgICBjb25zdCBzaXplcyA9IFtcIkJcIiwgXCJLQlwiLCBcIk1CXCIsIFwiR0JcIl07XG4gICAgY29uc3QgaSA9IE1hdGguZmxvb3IoTWF0aC5sb2coYnl0ZXMpIC8gTWF0aC5sb2coaykpO1xuICAgIGNvbnN0IHNpemVVbml0ID0gc2l6ZXNbTWF0aC5taW4oaSwgc2l6ZXMubGVuZ3RoIC0gMSldID8/IFwiQlwiO1xuXG4gICAgcmV0dXJuIGAkeyhieXRlcyAvIE1hdGgucG93KGssIGkpKS50b0ZpeGVkKDEpfSAke3NpemVVbml0fWA7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGltYWdlIGRpbWVuc2lvbnMgd2l0aG91dCBsb2FkaW5nIGZ1bGwgaW1hZ2VcbiAgICovXG4gIGFzeW5jIGdldEltYWdlRGltZW5zaW9ucyhcbiAgICBpbWFnZVVyaTogc3RyaW5nLFxuICApOiBQcm9taXNlPHsgd2lkdGg6IG51bWJlcjsgaGVpZ2h0OiBudW1iZXIgfSB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgSW1hZ2VNYW5pcHVsYXRvci5tYW5pcHVsYXRlQXN5bmMoXG4gICAgICAgIGltYWdlVXJpLFxuICAgICAgICBbXSwgLy8gTm8gbWFuaXB1bGF0aW9uc1xuICAgICAgICB7IGZvcm1hdDogSW1hZ2VNYW5pcHVsYXRvci5TYXZlRm9ybWF0LkpQRUcgfSxcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHdpZHRoOiByZXN1bHQud2lkdGgsXG4gICAgICAgIGhlaWdodDogcmVzdWx0LmhlaWdodCxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihcIkZhaWxlZCB0byBnZXQgaW1hZ2UgZGltZW5zaW9uc1wiLCB7IGVycm9yLCBpbWFnZVVyaSB9KTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxufVxuXG4vLyBDcmVhdGUgc2luZ2xldG9uIGluc3RhbmNlXG5leHBvcnQgY29uc3QgaW1hZ2VDb21wcmVzc2lvbiA9IG5ldyBJbWFnZUNvbXByZXNzaW9uU2VydmljZSgpO1xuXG4vLyBFeHBvcnQgdHlwZXMgYW5kIHV0aWxpdGllc1xuZXhwb3J0IGRlZmF1bHQgaW1hZ2VDb21wcmVzc2lvbjtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFJQSxJQUFBQSxnQkFBQSxHQUFBQyx1QkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsVUFBQSxHQUFBRix1QkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUUsS0FBQSxHQUFBRixPQUFBO0FBQTRDLFNBQUFELHdCQUFBSSxDQUFBLEVBQUFDLENBQUEsNkJBQUFDLE9BQUEsTUFBQUMsQ0FBQSxPQUFBRCxPQUFBLElBQUFFLENBQUEsT0FBQUYsT0FBQSxZQUFBTix1QkFBQSxZQUFBQSx3QkFBQUksQ0FBQSxFQUFBQyxDQUFBLFNBQUFBLENBQUEsSUFBQUQsQ0FBQSxJQUFBQSxDQUFBLENBQUFLLFVBQUEsU0FBQUwsQ0FBQSxNQUFBTSxDQUFBLEVBQUFDLENBQUEsRUFBQUMsQ0FBQSxLQUFBQyxTQUFBLFFBQUFDLE9BQUEsRUFBQVYsQ0FBQSxpQkFBQUEsQ0FBQSx1QkFBQUEsQ0FBQSx5QkFBQUEsQ0FBQSxTQUFBUSxDQUFBLE1BQUFGLENBQUEsR0FBQUwsQ0FBQSxHQUFBRyxDQUFBLEdBQUFELENBQUEsUUFBQUcsQ0FBQSxDQUFBSyxHQUFBLENBQUFYLENBQUEsVUFBQU0sQ0FBQSxDQUFBTSxHQUFBLENBQUFaLENBQUEsR0FBQU0sQ0FBQSxDQUFBTyxHQUFBLENBQUFiLENBQUEsRUFBQVEsQ0FBQSxjQUFBTSxHQUFBLElBQUFkLENBQUEsZ0JBQUFjLEdBQUEsT0FBQUMsY0FBQSxDQUFBQyxJ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