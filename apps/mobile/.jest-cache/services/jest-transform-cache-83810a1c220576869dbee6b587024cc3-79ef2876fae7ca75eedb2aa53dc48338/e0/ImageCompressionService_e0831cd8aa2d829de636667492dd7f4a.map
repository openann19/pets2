{"version":3,"names":["ImageManipulator","_interopRequireWildcard","require","FileSystem","_core","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","_t2","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","ownKeys","keys","getOwnPropertySymbols","filter","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty2","getOwnPropertyDescriptors","defineProperties","ImageCompressionService","_classCallCheck2","_createClass2","key","value","_compressImage","_asyncToGenerator2","imageUri","options","undefined","opts","DEFAULT_OPTIONS","logger","info","uri","substring","originalInfo","getInfoAsync","originalSize","exists","size","manipulatedImage","manipulateAsync","resize","width","maxWidth","height","maxHeight","compress","quality","format","SaveFormat","PNG","JPEG","compressedInfo","compressedSize","compressionRatio","result","formatFileSize","toFixed","dimensions","String","error","Error","compressImage","_x","_compressImages","imageUris","results","compressImages","_x2","getOptimalCompressionSettings","isJpeg","toLowerCase","includes","isPng","_compressAvatarImage","compressAvatarImage","_x3","_compressPetImage","compressPetImage","_x4","_compressChatImage","compressChatImage","_x5","_validateImage","isValid","maxSize","supportedExtensions","hasValidExtension","some","ext","endsWith","validateImage","_x6","_cleanupTempImages","deleteAsync","idempotent","warn","cleanupTempImages","_x7","bytes","_sizes$Math$min","k","sizes","Math","floor","log","sizeUnit","min","pow","_getImageDimensions","getImageDimensions","_x8","maintainAspectRatio","imageCompression","exports","_default"],"sources":["ImageCompressionService.ts"],"sourcesContent":["/**\n * Image Compression Service for PawfectMatch Mobile App\n * Provides client-side image resizing and compression before upload\n */\nimport * as ImageManipulator from \"expo-image-manipulator\";\nimport * as FileSystem from \"expo-file-system\";\nimport { logger } from \"@pawfectmatch/core\";\n\nexport interface ImageCompressionOptions {\n  maxWidth?: number;\n  maxHeight?: number;\n  quality?: number; // 0-1\n  format?: \"jpeg\" | \"png\";\n  maintainAspectRatio?: boolean;\n}\n\nexport interface CompressedImageResult {\n  uri: string;\n  width: number;\n  height: number;\n  size: number;\n  originalSize: number;\n  compressionRatio: number;\n}\n\nclass ImageCompressionService {\n  private static readonly DEFAULT_OPTIONS: Required<ImageCompressionOptions> = {\n    maxWidth: 1920,\n    maxHeight: 1920,\n    quality: 0.8,\n    format: \"jpeg\",\n    maintainAspectRatio: true,\n  };\n\n  /**\n   * Compress and resize an image\n   */\n  async compressImage(\n    imageUri: string,\n    options: ImageCompressionOptions = {},\n  ): Promise<CompressedImageResult> {\n    try {\n      const opts = { ...ImageCompressionService.DEFAULT_OPTIONS, ...options };\n\n      logger.info(\"Starting image compression\", {\n        uri: imageUri.substring(0, 50) + \"...\",\n        options: opts,\n      });\n\n      // Get original file info\n      const originalInfo = await FileSystem.getInfoAsync(imageUri);\n      const originalSize = originalInfo.exists ? originalInfo.size : 0;\n\n      // Perform image manipulation\n      const manipulatedImage = await ImageManipulator.manipulateAsync(\n        imageUri,\n        [\n          {\n            resize: {\n              width: opts.maxWidth,\n              height: opts.maxHeight,\n            },\n          },\n        ],\n        {\n          compress: opts.quality,\n          format:\n            opts.format === \"png\"\n              ? ImageManipulator.SaveFormat.PNG\n              : ImageManipulator.SaveFormat.JPEG,\n        },\n      );\n\n      // Get compressed file info\n      const compressedInfo = await FileSystem.getInfoAsync(\n        manipulatedImage.uri,\n      );\n      const compressedSize = compressedInfo.exists ? compressedInfo.size : 0;\n\n      const compressionRatio =\n        originalSize > 0 ? (originalSize - compressedSize) / originalSize : 0;\n\n      const result: CompressedImageResult = {\n        uri: manipulatedImage.uri,\n        width: manipulatedImage.width,\n        height: manipulatedImage.height,\n        size: compressedSize,\n        originalSize,\n        compressionRatio,\n      };\n\n      logger.info(\"Image compression completed\", {\n        originalSize: this.formatFileSize(originalSize),\n        compressedSize: this.formatFileSize(compressedSize),\n        compressionRatio: `${(compressionRatio * 100).toFixed(1)}%`,\n        dimensions: `${String(manipulatedImage.width)}x${String(manipulatedImage.height)}`,\n      });\n\n      return result;\n    } catch (error) {\n      logger.error(\"Image compression failed\", { error, imageUri });\n      throw new Error(\"Failed to compress image\");\n    }\n  }\n\n  /**\n   * Compress multiple images in batch\n   */\n  async compressImages(\n    imageUris: string[],\n    options: ImageCompressionOptions = {},\n  ): Promise<CompressedImageResult[]> {\n    const results: CompressedImageResult[] = [];\n\n    for (const uri of imageUris) {\n      try {\n        const result = await this.compressImage(uri, options);\n        results.push(result);\n      } catch (error) {\n        logger.error(\"Failed to compress image in batch\", { error, uri });\n        // Continue with other images even if one fails\n      }\n    }\n\n    return results;\n  }\n\n  /**\n   * Get optimal compression settings based on image type\n   */\n  getOptimalCompressionSettings(imageUri: string): ImageCompressionOptions {\n    // Check file extension or MIME type for optimization\n    const isJpeg =\n      imageUri.toLowerCase().includes(\".jpg\") ||\n      imageUri.toLowerCase().includes(\".jpeg\");\n    const isPng = imageUri.toLowerCase().includes(\".png\");\n\n    if (isJpeg) {\n      // JPEGs can handle higher compression\n      return {\n        maxWidth: 1920,\n        maxHeight: 1920,\n        quality: 0.75,\n        format: \"jpeg\",\n      };\n    } else if (isPng) {\n      // PNGs are lossless, but we can still resize\n      return {\n        maxWidth: 1920,\n        maxHeight: 1920,\n        quality: 0.9,\n        format: \"png\",\n      };\n    }\n\n    // Default settings\n    return ImageCompressionService.DEFAULT_OPTIONS;\n  }\n\n  /**\n   * Compress image for avatar (smaller dimensions)\n   */\n  async compressAvatarImage(imageUri: string): Promise<CompressedImageResult> {\n    return this.compressImage(imageUri, {\n      maxWidth: 512,\n      maxHeight: 512,\n      quality: 0.8,\n      format: \"jpeg\",\n    });\n  }\n\n  /**\n   * Compress image for pet photos (standard dimensions)\n   */\n  async compressPetImage(imageUri: string): Promise<CompressedImageResult> {\n    return this.compressImage(\n      imageUri,\n      this.getOptimalCompressionSettings(imageUri),\n    );\n  }\n\n  /**\n   * Compress image for chat messages (smaller for faster upload)\n   */\n  async compressChatImage(imageUri: string): Promise<CompressedImageResult> {\n    return this.compressImage(imageUri, {\n      maxWidth: 1024,\n      maxHeight: 1024,\n      quality: 0.7,\n      format: \"jpeg\",\n    });\n  }\n\n  /**\n   * Validate image before compression\n   */\n  async validateImage(\n    imageUri: string,\n  ): Promise<{ isValid: boolean; error?: string }> {\n    try {\n      const info = await FileSystem.getInfoAsync(imageUri);\n\n      if (!info.exists) {\n        return { isValid: false, error: \"Image file does not exist\" };\n      }\n\n      // Check file size (max 20MB)\n      const maxSize = 20 * 1024 * 1024; // 20MB\n      if (info.size > maxSize) {\n        return { isValid: false, error: \"Image file is too large (max 20MB)\" };\n      }\n\n      // Check if it's actually an image\n      const supportedExtensions = [\".jpg\", \".jpeg\", \".png\", \".gif\", \".webp\"];\n      const hasValidExtension = supportedExtensions.some((ext) =>\n        imageUri.toLowerCase().endsWith(ext),\n      );\n\n      if (!hasValidExtension) {\n        return { isValid: false, error: \"Unsupported image format\" };\n      }\n\n      return { isValid: true };\n    } catch (error) {\n      logger.error(\"Image validation failed\", { error, imageUri });\n      return { isValid: false, error: \"Failed to validate image\" };\n    }\n  }\n\n  /**\n   * Clean up temporary compressed images\n   */\n  async cleanupTempImages(imageUris: string[]): Promise<void> {\n    for (const uri of imageUris) {\n      try {\n        // Only delete files that are in the cache/temp directory\n        if (\n          uri.includes(\"ImageManipulator\") ||\n          uri.includes(\"temp\") ||\n          uri.includes(\"cache\")\n        ) {\n          await FileSystem.deleteAsync(uri, { idempotent: true });\n        }\n      } catch (error) {\n        logger.warn(\"Failed to cleanup temp image\", { error, uri });\n      }\n    }\n  }\n\n  /**\n   * Format file size in human readable format\n   */\n  private formatFileSize(bytes: number): string {\n    if (bytes === 0) return \"0 B\";\n\n    const k = 1024;\n    const sizes = [\"B\", \"KB\", \"MB\", \"GB\"];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    const sizeUnit = sizes[Math.min(i, sizes.length - 1)] ?? \"B\";\n\n    return `${(bytes / Math.pow(k, i)).toFixed(1)} ${sizeUnit}`;\n  }\n\n  /**\n   * Get image dimensions without loading full image\n   */\n  async getImageDimensions(\n    imageUri: string,\n  ): Promise<{ width: number; height: number } | null> {\n    try {\n      const result = await ImageManipulator.manipulateAsync(\n        imageUri,\n        [], // No manipulations\n        { format: ImageManipulator.SaveFormat.JPEG },\n      );\n\n      return {\n        width: result.width,\n        height: result.height,\n      };\n    } catch (error) {\n      logger.error(\"Failed to get image dimensions\", { error, imageUri });\n      return null;\n    }\n  }\n}\n\n// Create singleton instance\nexport const imageCompression = new ImageCompressionService();\n\n// Export types and utilities\nexport default imageCompression;\n"],"mappings":"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","ignoreList":[]}