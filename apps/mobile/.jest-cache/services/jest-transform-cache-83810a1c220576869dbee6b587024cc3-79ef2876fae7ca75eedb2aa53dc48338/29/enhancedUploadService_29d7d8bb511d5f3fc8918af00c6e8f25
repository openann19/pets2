4da1fd1b5abe437f91c1229f8ff5d63e
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.EnhancedUploadService = void 0;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _uploadHygiene = require("./uploadHygiene");
var _api = require("./api");
var _logger = require("./logger");
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function _interopRequireWildcard(e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (var _t2 in e) "default" !== _t2 && {}.hasOwnProperty.call(e, _t2) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, _t2)) && (i.get || i.set) ? o(f, _t2, i) : f[_t2] = e[_t2]); return f; })(e, t); }
var EnhancedUploadService = exports.EnhancedUploadService = function () {
  function EnhancedUploadService() {
    (0, _classCallCheck2.default)(this, EnhancedUploadService);
  }
  return (0, _createClass2.default)(EnhancedUploadService, [{
    key: "uploadProcessedImage",
    value: (function () {
      var _uploadProcessedImage = (0, _asyncToGenerator2.default)(function* (processedImage) {
        var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'pet';
        var petId = arguments.length > 2 ? arguments[2] : undefined;
        var onProgress = arguments.length > 3 ? arguments[3] : undefined;
        try {
          if (onProgress) {
            try {
              onProgress({
                phase: 'presign',
                percent: 10,
                message: 'Requesting upload URL...'
              });
            } catch (error) {
              var err = error instanceof Error ? error : new Error(String(error));
              _logger.logger.warn('Progress callback error', {
                error: err
              });
            }
          }
          var presignResponse = yield _api.api.presignPhoto(processedImage.mimeType);
          var key = presignResponse.key,
            url = presignResponse.url;
          var headers = {
            'Content-Type': processedImage.mimeType
          };
          if (onProgress) {
            try {
              onProgress({
                phase: 'upload',
                percent: 30,
                message: 'Uploading to secure storage...'
              });
            } catch (error) {
              var _err = error instanceof Error ? error : new Error(String(error));
              _logger.logger.warn('Progress callback error', {
                error: _err
              });
            }
          }
          var uploadResponse = yield fetch(url, {
            method: 'PUT',
            headers: headers || {
              'Content-Type': processedImage.mimeType
            },
            body: yield this.fileUriToBlob(processedImage.uri)
          });
          if (!uploadResponse.ok) {
            throw new Error('S3 upload failed');
          }
          if (onProgress) {
            try {
              onProgress({
                phase: 'register',
                percent: 60,
                message: 'Registering upload...'
              });
            } catch (error) {
              var _err2 = error instanceof Error ? error : new Error(String(error));
              _logger.logger.warn('Progress callback error', {
                error: _err2
              });
            }
          }
          var idempotencyKey = `upload-${Date.now()}-${Math.random()}`;
          var registerResponse = yield (0, _api.request)('/uploads', {
            method: 'POST',
            body: {
              key: key,
              type: type,
              petId: petId,
              contentType: processedImage.mimeType,
              bytes: processedImage.fileSize,
              idempotencyKey: idempotencyKey
            }
          });
          var upload = registerResponse.data.upload;
          if (onProgress) {
            try {
              onProgress({
                phase: 'analyze',
                percent: 80,
                message: 'Analyzing photo...'
              });
            } catch (error) {
              var _err3 = error instanceof Error ? error : new Error(String(error));
              _logger.logger.warn('Progress callback error', {
                error: _err3
              });
            }
          }
          if (onProgress) {
            try {
              onProgress({
                phase: 'pending',
                percent: 90,
                message: 'Awaiting moderation...'
              });
            } catch (error) {
              var _err4 = error instanceof Error ? error : new Error(String(error));
              _logger.logger.warn('Progress callback error', {
                error: _err4
              });
            }
          }
          return {
            uploadId: upload._id || upload.id || '',
            s3Key: upload.s3Key || key,
            url: upload.url || `https://s3.amazonaws.com/${process.env.AWS_BUCKET}/${key}`,
            status: upload.status || 'pending',
            analysis: undefined
          };
        } catch (error) {
          var _err5 = error instanceof Error ? error : new Error(String(error));
          _logger.logger.error('Upload failed', {
            error: _err5
          });
          throw _err5;
        }
      });
      function uploadProcessedImage(_x) {
        return _uploadProcessedImage.apply(this, arguments);
      }
      return uploadProcessedImage;
    }())
  }, {
    key: "uploadFromPicker",
    value: (function () {
      var _uploadFromPicker = (0, _asyncToGenerator2.default)(function* (options, onProgress) {
        var _options$allowEditing, _options$useCamera;
        var opts = {
          maxDimension: (options == null ? void 0 : options.maxDimension) || 2048,
          quality: (options == null ? void 0 : options.quality) || 0.9,
          type: (options == null ? void 0 : options.type) || 'pet',
          allowEditing: (_options$allowEditing = options == null ? void 0 : options.allowEditing) != null ? _options$allowEditing : true,
          useCamera: (_options$useCamera = options == null ? void 0 : options.useCamera) != null ? _options$useCamera : false
        };
        try {
          var quota = yield (0, _uploadHygiene.checkUploadQuota)('current-user-id');
          if (!quota.allowed) {
            throw new Error('Upload quota exceeded');
          }
          var _yield$import = yield Promise.resolve().then(function () {
              return _interopRequireWildcard(require("./uploadHygiene"));
            }),
            pickAndProcessImage = _yield$import.pickAndProcessImage,
            captureAndProcessImage = _yield$import.captureAndProcessImage;
          var processed = opts.useCamera ? yield captureAndProcessImage({
            maxDimension: opts.maxDimension,
            quality: opts.quality
          }) : yield pickAndProcessImage(opts.allowEditing, {
            maxDimension: opts.maxDimension,
            quality: opts.quality
          });
          if (!processed) {
            throw new Error('No image selected');
          }
          return yield this.uploadProcessedImage(processed, opts.type, options == null ? void 0 : options.petId, onProgress);
        } catch (error) {
          var err = error instanceof Error ? error : new Error(String(error));
          _logger.logger.error('Upload from picker failed', {
            error: err
          });
          throw err;
        }
      });
      function uploadFromPicker(_x2, _x3) {
        return _uploadFromPicker.apply(this, arguments);
      }
      return uploadFromPicker;
    }())
  }, {
    key: "pollUploadStatus",
    value: (function () {
      var _pollUploadStatus = (0, _asyncToGenerator2.default)(function* (uploadId) {
        var maxAttempts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 10;
        var intervalMs = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1000;
        for (var i = 0; i < maxAttempts; i++) {
          var response = yield (0, _api.request)(`/uploads/${uploadId}`, {
            method: 'GET'
          });
          var _response$data = response.data,
            upload = _response$data.upload,
            analysis = _response$data.analysis;
          if (upload.status === 'approved') {
            return {
              uploadId: uploadId,
              s3Key: upload.s3Key || '',
              url: upload.url || '',
              status: 'approved',
              analysis: analysis
            };
          }
          if (upload.status === 'rejected') {
            throw new Error(`Upload rejected: ${upload.flagReason || 'Unknown reason'}`);
          }
          yield new Promise(function (resolve) {
            return setTimeout(resolve, intervalMs);
          });
        }
        throw new Error('Upload status polling timeout');
      });
      function pollUploadStatus(_x4) {
        return _pollUploadStatus.apply(this, arguments);
      }
      return pollUploadStatus;
    }())
  }, {
    key: "uploadBatch",
    value: (function () {
      var _uploadBatch = (0, _asyncToGenerator2.default)(function* (photos) {
        var _this = this;
        var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'pet';
        var petId = arguments.length > 2 ? arguments[2] : undefined;
        var onProgress = arguments.length > 3 ? arguments[3] : undefined;
        var results = [];
        var _loop = function* _loop(i) {
          var photo = photos[i];
          if (onProgress) {
            onProgress(i, {
              phase: 'presign',
              percent: 0,
              message: `Processing photo ${i + 1}/${photos.length}`
            });
          }
          try {
            var result = yield _this.uploadProcessedImage(photo, type, petId, function (progress) {
              if (onProgress) {
                onProgress(i, progress);
              }
            });
            results.push(result);
          } catch (error) {
            var err = error instanceof Error ? error : new Error(String(error));
            _logger.logger.error('Batch upload failed', {
              error: err,
              photoIndex: i + 1
            });
          }
        };
        for (var i = 0; i < photos.length; i++) {
          yield* _loop(i);
        }
        return results;
      });
      function uploadBatch(_x5) {
        return _uploadBatch.apply(this, arguments);
      }
      return uploadBatch;
    }())
  }, {
    key: "checkDuplicate",
    value: (function () {
      var _checkDuplicate = (0, _asyncToGenerator2.default)(function* (uploadId) {
        try {
          var response = yield (0, _api.request)(`/uploads/${uploadId}/duplicate-check`, {
            method: 'GET'
          });
          if (response.data && typeof response.data === 'object' && 'isDuplicate' in response.data) {
            return response.data;
          }
          _logger.logger.warn('Duplicate check returned malformed response', {
            data: response.data
          });
          return {
            isDuplicate: false
          };
        } catch (error) {
          var err = error instanceof Error ? error : new Error(String(error));
          _logger.logger.error('Duplicate check failed', {
            error: err
          });
          return {
            isDuplicate: false
          };
        }
      });
      function checkDuplicate(_x6) {
        return _checkDuplicate.apply(this, arguments);
      }
      return checkDuplicate;
    }())
  }, {
    key: "fileUriToBlob",
    value: (function () {
      var _fileUriToBlob = (0, _asyncToGenerator2.default)(function* (uri) {
        try {
          var FileSystem = yield Promise.resolve().then(function () {
            return _interopRequireWildcard(require('expo-file-system'));
          });
          var base64 = yield FileSystem.readAsStringAsync(uri, {
            encoding: FileSystem.EncodingType.Base64
          });
          var byteCharacters = atob(base64);
          var byteNumbers = new Array(byteCharacters.length);
          for (var i = 0; i < byteCharacters.length; i++) {
            byteNumbers[i] = byteCharacters.charCodeAt(i);
          }
          var byteArray = new Uint8Array(byteNumbers);
          return new Blob([byteArray], {
            type: 'image/jpeg'
          });
        } catch (error) {
          if (error instanceof Error) {
            throw error;
          }
          throw new Error(error ? String(error) : 'File system error');
        }
      });
      function fileUriToBlob(_x7) {
        return _fileUriToBlob.apply(this, arguments);
      }
      return fileUriToBlob;
    }())
  }, {
    key: "retryUpload",
    value: (function () {
      var _retryUpload = (0, _asyncToGenerator2.default)(function* (processedImage) {
        var _this2 = this;
        var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'pet';
        var petId = arguments.length > 2 ? arguments[2] : undefined;
        var maxRetries = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 3;
        return (0, _uploadHygiene.uploadWithRetry)(function () {
          return _this2.uploadProcessedImage(processedImage, type, petId);
        }, maxRetries, 1000);
      });
      function retryUpload(_x8) {
        return _retryUpload.apply(this, arguments);
      }
      return retryUpload;
    }())
  }], [{
    key: "getInstance",
    value: function getInstance() {
      if (!EnhancedUploadService.instance) {
        EnhancedUploadService.instance = new EnhancedUploadService();
      }
      return EnhancedUploadService.instance;
    }
  }]);
}();
var _default = exports.default = EnhancedUploadService.getInstance();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfdXBsb2FkSHlnaWVuZSIsInJlcXVpcmUiLCJfYXBpIiwiX2xvZ2dlciIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwiZSIsInQiLCJXZWFrTWFwIiwiciIsIm4iLCJfX2VzTW9kdWxlIiwibyIsImkiLCJmIiwiX19wcm90b19fIiwiZGVmYXVsdCIsImhhcyIsImdldCIsInNldCIsIl90MiIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiRW5oYW5jZWRVcGxvYWRTZXJ2aWNlIiwiZXhwb3J0cyIsIl9jbGFzc0NhbGxDaGVjazIiLCJfY3JlYXRlQ2xhc3MyIiwia2V5IiwidmFsdWUiLCJfdXBsb2FkUHJvY2Vzc2VkSW1hZ2UiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJwcm9jZXNzZWRJbWFnZSIsInR5cGUiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJwZXRJZCIsIm9uUHJvZ3Jlc3MiLCJwaGFzZSIsInBlcmNlbnQiLCJtZXNzYWdlIiwiZXJyb3IiLCJlcnIiLCJFcnJvciIsIlN0cmluZyIsImxvZ2dlciIsIndhcm4iLCJwcmVzaWduUmVzcG9uc2UiLCJhcGkiLCJwcmVzaWduUGhvdG8iLCJtaW1lVHlwZSIsInVybCIsImhlYWRlcnMiLCJ1cGxvYWRSZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiYm9keSIsImZpbGVVcmlUb0Jsb2IiLCJ1cmkiLCJvayIsImlkZW1wb3RlbmN5S2V5IiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJyZWdpc3RlclJlc3BvbnNlIiwicmVxdWVzdCIsImNvbnRlbnRUeXBlIiwiYnl0ZXMiLCJmaWxlU2l6ZSIsInVwbG9hZCIsImRhdGEiLCJ1cGxvYWRJZCIsIl9pZCIsImlkIiwiczNLZXkiLCJwcm9jZXNzIiwiZW52IiwiQVdTX0JVQ0tFVCIsInN0YXR1cyIsImFuYWx5c2lzIiwidXBsb2FkUHJvY2Vzc2VkSW1hZ2UiLCJfeCIsImFwcGx5IiwiX3VwbG9hZEZyb21QaWNrZXIiLCJvcHRpb25zIiwiX29wdGlvbnMkYWxsb3dFZGl0aW5nIiwiX29wdGlvbnMkdXNlQ2FtZXJhIiwib3B0cyIsIm1heERpbWVuc2lvbiIsInF1YWxpdHkiLCJhbGxvd0VkaXRpbmciLCJ1c2VDYW1lcmEiLCJxdW90YSIsImNoZWNrVXBsb2FkUXVvdGEiLCJhbGxvd2VkIiwiX3lpZWxkJGltcG9ydCIsIlByb21pc2UiLCJyZXNvbHZlIiwidGhlbiIsInBpY2tBbmRQcm9jZXNzSW1hZ2UiLCJjYXB0dXJlQW5kUHJvY2Vzc0ltYWdlIiwicHJvY2Vzc2VkIiwidXBsb2FkRnJvbVBpY2tlciIsIl94MiIsIl94MyIsIl9wb2xsVXBsb2FkU3RhdHVzIiwibWF4QXR0ZW1wdHMiLCJpbnRlcnZhbE1zIiwicmVzcG9uc2UiLCJfcmVzcG9uc2UkZGF0YSIsImZsYWdSZWFzb24iLCJzZXRUaW1lb3V0IiwicG9sbFVwbG9hZFN0YXR1cyIsIl94NCIsIl91cGxvYWRCYXRjaCIsInBob3RvcyIsIl90aGlzIiwicmVzdWx0cyIsIl9sb29wIiwicGhvdG8iLCJyZXN1bHQiLCJwcm9ncmVzcyIsInB1c2giLCJwaG90b0luZGV4IiwidXBsb2FkQmF0Y2giLCJfeDUiLCJfY2hlY2tEdXBsaWNhdGUiLCJpc0R1cGxpY2F0ZSIsImNoZWNrRHVwbGljYXRlIiwiX3g2IiwiX2ZpbGVVcmlUb0Jsb2IiLCJGaWxlU3lzdGVtIiwiYmFzZTY0IiwicmVhZEFzU3RyaW5nQXN5bmMiLCJlbmNvZGluZyIsIkVuY29kaW5nVHlwZSIsIkJhc2U2NCIsImJ5dGVDaGFyYWN0ZXJzIiwiYXRvYiIsImJ5dGVOdW1iZXJzIiwiQXJyYXkiLCJjaGFyQ29kZUF0IiwiYnl0ZUFycmF5IiwiVWludDhBcnJheSIsIkJsb2IiLCJfeDciLCJfcmV0cnlVcGxvYWQiLCJfdGhpczIiLCJtYXhSZXRyaWVzIiwidXBsb2FkV2l0aFJldHJ5IiwicmV0cnlVcGxvYWQiLCJfeDgiLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwiX2RlZmF1bHQiXSwic291cmNlcyI6WyJlbmhhbmNlZFVwbG9hZFNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBFbmhhbmNlZCBVcGxvYWQgU2VydmljZSAtIE1vYmlsZVxuICogXG4gKiBJbnRlZ3JhdGVzIHVwbG9hZEh5Z2llbmUgd2l0aCBBUEkgdXBsb2FkcywgcHJvdmlkaW5nIGEgY29tcGxldGVcbiAqIHVwbG9hZC10by1tb2RlcmF0aW9uIHBpcGVsaW5lIHdpdGggcHJvZ3Jlc3MgdHJhY2tpbmcgYW5kIGVycm9yIGhhbmRsaW5nLlxuICovXG5cbmltcG9ydCB7IFxuICBwcm9jZXNzSW1hZ2VGb3JVcGxvYWQsIFxuICB0eXBlIFByb2Nlc3NlZEltYWdlLFxuICBjaGVja1VwbG9hZFF1b3RhLFxuICB1cGxvYWRXaXRoUmV0cnkgXG59IGZyb20gJy4vdXBsb2FkSHlnaWVuZSc7XG5pbXBvcnQgeyBhcGksIHJlcXVlc3QgfSBmcm9tICcuL2FwaSc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuL2xvZ2dlcic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBsb2FkUHJvZ3Jlc3Mge1xuICBwaGFzZTogJ3ByZXNpZ24nIHwgJ3VwbG9hZCcgfCAncmVnaXN0ZXInIHwgJ2FuYWx5emUnIHwgJ3BlbmRpbmcnIHwgJ2FwcHJvdmVkJyB8ICdyZWplY3RlZCc7XG4gIHBlcmNlbnQ6IG51bWJlcjtcbiAgbWVzc2FnZT86IHN0cmluZztcbn1cblxuLyoqXG4gKiBQaG90byB1cGxvYWQgYW5hbHlzaXMgcmVzdWx0IGZyb20gYmFja2VuZCBtb2RlcmF0aW9uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUGhvdG9VcGxvYWRBbmFseXNpcyB7XG4gIGlzUGV0OiBib29sZWFuO1xuICBvdmVyYWxsOiBudW1iZXI7XG4gIGxhYmVsczogQXJyYXk8eyBuYW1lOiBzdHJpbmc7IGNvbmZpZGVuY2U6IG51bWJlciB9PjtcbiAgYnJlZWRDYW5kaWRhdGVzOiBBcnJheTx7IG5hbWU6IHN0cmluZzsgY29uZmlkZW5jZTogbnVtYmVyIH0+O1xuICBxdWFsaXR5OiB7XG4gICAgZGltczogeyB3aWR0aDogbnVtYmVyOyBoZWlnaHQ6IG51bWJlciB9O1xuICAgIGV4cG9zdXJlOiBudW1iZXI7XG4gICAgY29udHJhc3Q6IG51bWJlcjtcbiAgICBzaGFycG5lc3M6IG51bWJlcjtcbiAgfTtcbiAgaGVhbHRoU2lnbmFsczoge1xuICAgIGNvYXRTY29yZTogbnVtYmVyO1xuICAgIGV5ZXNTY29yZTogbnVtYmVyO1xuICAgIHBvc3R1cmVTY29yZTogbnVtYmVyO1xuICAgIGVuZXJneVNjb3JlOiBudW1iZXI7XG4gIH07XG4gIHNhZmV0eToge1xuICAgIGxhYmVsczogQXJyYXk8eyBsYWJlbDogc3RyaW5nOyBjb25maWRlbmNlOiBudW1iZXIgfT47XG4gICAgc2FmZTogYm9vbGVhbjtcbiAgICBtb2RlcmF0aW9uU2NvcmU6IG51bWJlcjtcbiAgfTtcbiAgc3VnZ2VzdGlvbnM6IHN0cmluZ1tdO1xuICBhbmFseXplZEF0Pzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwbG9hZFJlc3VsdCB7XG4gIHVwbG9hZElkOiBzdHJpbmc7XG4gIHMzS2V5OiBzdHJpbmc7XG4gIHVybDogc3RyaW5nO1xuICBzdGF0dXM6IHN0cmluZztcbiAgYW5hbHlzaXM/OiBQaG90b1VwbG9hZEFuYWx5c2lzO1xufVxuXG4vKipcbiAqIENvbXBsZXRlIHVwbG9hZCBmbG93IGZyb20gaW1hZ2UgcHJvY2Vzc2luZyB0byBBUEkgcmVnaXN0cmF0aW9uXG4gKi9cbmV4cG9ydCBjbGFzcyBFbmhhbmNlZFVwbG9hZFNlcnZpY2Uge1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogRW5oYW5jZWRVcGxvYWRTZXJ2aWNlO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IoKSB7fVxuXG4gIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBFbmhhbmNlZFVwbG9hZFNlcnZpY2Uge1xuICAgIGlmICghRW5oYW5jZWRVcGxvYWRTZXJ2aWNlLmluc3RhbmNlKSB7XG4gICAgICBFbmhhbmNlZFVwbG9hZFNlcnZpY2UuaW5zdGFuY2UgPSBuZXcgRW5oYW5jZWRVcGxvYWRTZXJ2aWNlKCk7XG4gICAgfVxuICAgIHJldHVybiBFbmhhbmNlZFVwbG9hZFNlcnZpY2UuaW5zdGFuY2U7XG4gIH1cblxuICAvKipcbiAgICogVXBsb2FkIGEgcHJvY2Vzc2VkIGltYWdlIHRocm91Z2ggdGhlIGNvbXBsZXRlIHBpcGVsaW5lXG4gICAqL1xuICBhc3luYyB1cGxvYWRQcm9jZXNzZWRJbWFnZShcbiAgICBwcm9jZXNzZWRJbWFnZTogUHJvY2Vzc2VkSW1hZ2UsXG4gICAgdHlwZTogJ3Byb2ZpbGUnIHwgJ3BldCcgfCAndmVyaWZpY2F0aW9uJyA9ICdwZXQnLFxuICAgIHBldElkPzogc3RyaW5nLFxuICAgIG9uUHJvZ3Jlc3M/OiAocHJvZ3Jlc3M6IFVwbG9hZFByb2dyZXNzKSA9PiB2b2lkXG4gICk6IFByb21pc2U8VXBsb2FkUmVzdWx0PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIDEuIFByZXNpZ25cbiAgICAgIGlmIChvblByb2dyZXNzKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgb25Qcm9ncmVzcyh7IHBoYXNlOiAncHJlc2lnbicsIHBlcmNlbnQ6IDEwLCBtZXNzYWdlOiAnUmVxdWVzdGluZyB1cGxvYWQgVVJMLi4uJyB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6IHVua25vd24pIHtcbiAgICAgICAgICBjb25zdCBlcnIgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoU3RyaW5nKGVycm9yKSk7XG4gICAgICAgICAgbG9nZ2VyLndhcm4oJ1Byb2dyZXNzIGNhbGxiYWNrIGVycm9yJywgeyBlcnJvcjogZXJyIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHByZXNpZ25SZXNwb25zZSA9IGF3YWl0IGFwaS5wcmVzaWduUGhvdG8ocHJvY2Vzc2VkSW1hZ2UubWltZVR5cGUpO1xuXG4gICAgICBjb25zdCB7IGtleSwgdXJsIH0gPSBwcmVzaWduUmVzcG9uc2U7XG4gICAgICBjb25zdCBoZWFkZXJzID0geyAnQ29udGVudC1UeXBlJzogcHJvY2Vzc2VkSW1hZ2UubWltZVR5cGUgfTtcblxuICAgICAgLy8gMi4gVXBsb2FkIHRvIFMzXG4gICAgICBpZiAob25Qcm9ncmVzcykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIG9uUHJvZ3Jlc3MoeyBwaGFzZTogJ3VwbG9hZCcsIHBlcmNlbnQ6IDMwLCBtZXNzYWdlOiAnVXBsb2FkaW5nIHRvIHNlY3VyZSBzdG9yYWdlLi4uJyB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6IHVua25vd24pIHtcbiAgICAgICAgICBjb25zdCBlcnIgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoU3RyaW5nKGVycm9yKSk7XG4gICAgICAgICAgbG9nZ2VyLndhcm4oJ1Byb2dyZXNzIGNhbGxiYWNrIGVycm9yJywgeyBlcnJvcjogZXJyIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFVwbG9hZCBmaWxlIHRvIHByZXNpZ25lZCBVUkxcbiAgICAgIGNvbnN0IHVwbG9hZFJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCB7XG4gICAgICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgICAgIGhlYWRlcnM6IGhlYWRlcnMgfHwge1xuICAgICAgICAgICdDb250ZW50LVR5cGUnOiBwcm9jZXNzZWRJbWFnZS5taW1lVHlwZSxcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogYXdhaXQgdGhpcy5maWxlVXJpVG9CbG9iKHByb2Nlc3NlZEltYWdlLnVyaSksXG4gICAgICB9KTtcblxuICAgICAgaWYgKCF1cGxvYWRSZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1MzIHVwbG9hZCBmYWlsZWQnKTtcbiAgICAgIH1cblxuICAgICAgLy8gMy4gUmVnaXN0ZXIgdXBsb2FkXG4gICAgICBpZiAob25Qcm9ncmVzcykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIG9uUHJvZ3Jlc3MoeyBwaGFzZTogJ3JlZ2lzdGVyJywgcGVyY2VudDogNjAsIG1lc3NhZ2U6ICdSZWdpc3RlcmluZyB1cGxvYWQuLi4nIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnJvcjogdW5rbm93bikge1xuICAgICAgICAgIGNvbnN0IGVyciA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvciA6IG5ldyBFcnJvcihTdHJpbmcoZXJyb3IpKTtcbiAgICAgICAgICBsb2dnZXIud2FybignUHJvZ3Jlc3MgY2FsbGJhY2sgZXJyb3InLCB7IGVycm9yOiBlcnIgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3QgaWRlbXBvdGVuY3lLZXkgPSBgdXBsb2FkLSR7RGF0ZS5ub3coKX0tJHtNYXRoLnJhbmRvbSgpfWA7XG5cbiAgICAgIGNvbnN0IHJlZ2lzdGVyUmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0PHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHVwbG9hZDoge1xuICAgICAgICAgICAgX2lkPzogc3RyaW5nO1xuICAgICAgICAgICAgaWQ/OiBzdHJpbmc7XG4gICAgICAgICAgICBzM0tleT86IHN0cmluZztcbiAgICAgICAgICAgIHVybD86IHN0cmluZztcbiAgICAgICAgICAgIHN0YXR1cz86IHN0cmluZztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0+KCcvdXBsb2FkcycsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGJvZHk6IHtcbiAgICAgICAgICBrZXksXG4gICAgICAgICAgdHlwZSxcbiAgICAgICAgICBwZXRJZCxcbiAgICAgICAgICBjb250ZW50VHlwZTogcHJvY2Vzc2VkSW1hZ2UubWltZVR5cGUsXG4gICAgICAgICAgYnl0ZXM6IHByb2Nlc3NlZEltYWdlLmZpbGVTaXplLFxuICAgICAgICAgIGlkZW1wb3RlbmN5S2V5LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHVwbG9hZCA9IHJlZ2lzdGVyUmVzcG9uc2UuZGF0YS51cGxvYWQ7XG5cbiAgICAgIGlmIChvblByb2dyZXNzKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgb25Qcm9ncmVzcyh7IHBoYXNlOiAnYW5hbHl6ZScsIHBlcmNlbnQ6IDgwLCBtZXNzYWdlOiAnQW5hbHl6aW5nIHBob3RvLi4uJyB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6IHVua25vd24pIHtcbiAgICAgICAgICBjb25zdCBlcnIgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoU3RyaW5nKGVycm9yKSk7XG4gICAgICAgICAgbG9nZ2VyLndhcm4oJ1Byb2dyZXNzIGNhbGxiYWNrIGVycm9yJywgeyBlcnJvcjogZXJyIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIDQuIFRyaWdnZXIgYW5hbHlzaXMgKG9wdGlvbmFsLCBhc3luYyBieSBkZWZhdWx0KVxuICAgICAgaWYgKG9uUHJvZ3Jlc3MpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBvblByb2dyZXNzKHsgcGhhc2U6ICdwZW5kaW5nJywgcGVyY2VudDogOTAsIG1lc3NhZ2U6ICdBd2FpdGluZyBtb2RlcmF0aW9uLi4uJyB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6IHVua25vd24pIHtcbiAgICAgICAgICBjb25zdCBlcnIgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoU3RyaW5nKGVycm9yKSk7XG4gICAgICAgICAgbG9nZ2VyLndhcm4oJ1Byb2dyZXNzIGNhbGxiYWNrIGVycm9yJywgeyBlcnJvcjogZXJyIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVwbG9hZElkOiB1cGxvYWQuX2lkIHx8IHVwbG9hZC5pZCB8fCAnJyxcbiAgICAgICAgczNLZXk6IHVwbG9hZC5zM0tleSB8fCBrZXksXG4gICAgICAgIHVybDogdXBsb2FkLnVybCB8fCBgaHR0cHM6Ly9zMy5hbWF6b25hd3MuY29tLyR7cHJvY2Vzcy5lbnYuQVdTX0JVQ0tFVH0vJHtrZXl9YCxcbiAgICAgICAgc3RhdHVzOiB1cGxvYWQuc3RhdHVzIHx8ICdwZW5kaW5nJyxcbiAgICAgICAgYW5hbHlzaXM6IHVuZGVmaW5lZCxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3I6IHVua25vd24pIHtcbiAgICAgIGNvbnN0IGVyciA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvciA6IG5ldyBFcnJvcihTdHJpbmcoZXJyb3IpKTtcbiAgICAgIGxvZ2dlci5lcnJvcignVXBsb2FkIGZhaWxlZCcsIHsgZXJyb3I6IGVyciB9KTtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ29tcGxldGUgdXBsb2FkIGZsb3cgZnJvbSBpbWFnZSBwaWNrZXJcbiAgICovXG4gIGFzeW5jIHVwbG9hZEZyb21QaWNrZXIoXG4gICAgb3B0aW9ucz86IHtcbiAgICAgIG1heERpbWVuc2lvbj86IG51bWJlcjtcbiAgICAgIHF1YWxpdHk/OiBudW1iZXI7XG4gICAgICB0eXBlPzogJ3Byb2ZpbGUnIHwgJ3BldCcgfCAndmVyaWZpY2F0aW9uJztcbiAgICAgIHBldElkPzogc3RyaW5nO1xuICAgICAgYWxsb3dFZGl0aW5nPzogYm9vbGVhbjtcbiAgICAgIHVzZUNhbWVyYT86IGJvb2xlYW47XG4gICAgfSxcbiAgICBvblByb2dyZXNzPzogKHByb2dyZXNzOiBVcGxvYWRQcm9ncmVzcykgPT4gdm9pZFxuICApOiBQcm9taXNlPFVwbG9hZFJlc3VsdD4ge1xuICAgIGNvbnN0IG9wdHMgPSB7XG4gICAgICBtYXhEaW1lbnNpb246IG9wdGlvbnM/Lm1heERpbWVuc2lvbiB8fCAyMDQ4LFxuICAgICAgcXVhbGl0eTogb3B0aW9ucz8ucXVhbGl0eSB8fCAwLjksXG4gICAgICB0eXBlOiBvcHRpb25zPy50eXBlIHx8ICdwZXQnLFxuICAgICAgYWxsb3dFZGl0aW5nOiBvcHRpb25zPy5hbGxvd0VkaXRpbmcgPz8gdHJ1ZSxcbiAgICAgIHVzZUNhbWVyYTogb3B0aW9ucz8udXNlQ2FtZXJhID8/IGZhbHNlLFxuICAgIH07XG5cbiAgICB0cnkge1xuICAgICAgLy8gQ2hlY2sgcXVvdGFcbiAgICAgIGNvbnN0IHF1b3RhID0gYXdhaXQgY2hlY2tVcGxvYWRRdW90YSgnY3VycmVudC11c2VyLWlkJyk7IC8vIFRPRE86IEdldCBmcm9tIGF1dGhcbiAgICAgIGlmICghcXVvdGEuYWxsb3dlZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VwbG9hZCBxdW90YSBleGNlZWRlZCcpO1xuICAgICAgfVxuXG4gICAgICAvLyBQcm9jZXNzIGltYWdlXG4gICAgICBjb25zdCB7IHBpY2tBbmRQcm9jZXNzSW1hZ2UsIGNhcHR1cmVBbmRQcm9jZXNzSW1hZ2UgfSA9IGF3YWl0IGltcG9ydCgnLi91cGxvYWRIeWdpZW5lJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IHByb2Nlc3NlZCA9IG9wdHMudXNlQ2FtZXJhXG4gICAgICAgID8gYXdhaXQgY2FwdHVyZUFuZFByb2Nlc3NJbWFnZSh7IFxuICAgICAgICAgICAgbWF4RGltZW5zaW9uOiBvcHRzLm1heERpbWVuc2lvbixcbiAgICAgICAgICAgIHF1YWxpdHk6IG9wdHMucXVhbGl0eSxcbiAgICAgICAgICB9KVxuICAgICAgICA6IGF3YWl0IHBpY2tBbmRQcm9jZXNzSW1hZ2Uob3B0cy5hbGxvd0VkaXRpbmcsIHtcbiAgICAgICAgICAgIG1heERpbWVuc2lvbjogb3B0cy5tYXhEaW1lbnNpb24sXG4gICAgICAgICAgICBxdWFsaXR5OiBvcHRzLnF1YWxpdHksXG4gICAgICAgICAgfSk7XG5cbiAgICAgIGlmICghcHJvY2Vzc2VkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gaW1hZ2Ugc2VsZWN0ZWQnKTtcbiAgICAgIH1cblxuICAgICAgLy8gVXBsb2FkXG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy51cGxvYWRQcm9jZXNzZWRJbWFnZShcbiAgICAgICAgcHJvY2Vzc2VkLFxuICAgICAgICBvcHRzLnR5cGUsXG4gICAgICAgIG9wdGlvbnM/LnBldElkLFxuICAgICAgICBvblByb2dyZXNzXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGVycm9yOiB1bmtub3duKSB7XG4gICAgICBjb25zdCBlcnIgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoU3RyaW5nKGVycm9yKSk7XG4gICAgICBsb2dnZXIuZXJyb3IoJ1VwbG9hZCBmcm9tIHBpY2tlciBmYWlsZWQnLCB7IGVycm9yOiBlcnIgfSk7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBvbGwgdXBsb2FkIHN0YXR1cyB1bnRpbCBjb21wbGV0aW9uXG4gICAqL1xuICBhc3luYyBwb2xsVXBsb2FkU3RhdHVzKFxuICAgIHVwbG9hZElkOiBzdHJpbmcsXG4gICAgbWF4QXR0ZW1wdHMgPSAxMCxcbiAgICBpbnRlcnZhbE1zID0gMTAwMFxuICApOiBQcm9taXNlPFVwbG9hZFJlc3VsdD4ge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF4QXR0ZW1wdHM7IGkrKykge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0PHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHVwbG9hZDoge1xuICAgICAgICAgICAgczNLZXk/OiBzdHJpbmc7XG4gICAgICAgICAgICB1cmw/OiBzdHJpbmc7XG4gICAgICAgICAgICBzdGF0dXM6IHN0cmluZztcbiAgICAgICAgICAgIGZsYWdSZWFzb24/OiBzdHJpbmc7XG4gICAgICAgICAgfTtcbiAgICAgICAgICBhbmFseXNpcz86IFBob3RvVXBsb2FkQW5hbHlzaXM7XG4gICAgICAgIH1cbiAgICAgIH0+KGAvdXBsb2Fkcy8ke3VwbG9hZElkfWAsIHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJ1xuICAgICAgfSk7XG4gICAgICBjb25zdCB7IHVwbG9hZCwgYW5hbHlzaXMgfSA9IHJlc3BvbnNlLmRhdGE7XG5cbiAgICAgIGlmICh1cGxvYWQuc3RhdHVzID09PSAnYXBwcm92ZWQnKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdXBsb2FkSWQsXG4gICAgICAgICAgczNLZXk6IHVwbG9hZC5zM0tleSB8fCAnJyxcbiAgICAgICAgICB1cmw6IHVwbG9hZC51cmwgfHwgJycsXG4gICAgICAgICAgc3RhdHVzOiAnYXBwcm92ZWQnLFxuICAgICAgICAgIGFuYWx5c2lzLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICBpZiAodXBsb2FkLnN0YXR1cyA9PT0gJ3JlamVjdGVkJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVwbG9hZCByZWplY3RlZDogJHt1cGxvYWQuZmxhZ1JlYXNvbiB8fCAnVW5rbm93biByZWFzb24nfWApO1xuICAgICAgfVxuXG4gICAgICAvLyBTdGlsbCBwcm9jZXNzaW5nXG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgaW50ZXJ2YWxNcykpO1xuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcignVXBsb2FkIHN0YXR1cyBwb2xsaW5nIHRpbWVvdXQnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCYXRjaCB1cGxvYWQgbXVsdGlwbGUgcGhvdG9zXG4gICAqL1xuICBhc3luYyB1cGxvYWRCYXRjaChcbiAgICBwaG90b3M6IFByb2Nlc3NlZEltYWdlW10sXG4gICAgdHlwZTogJ3Byb2ZpbGUnIHwgJ3BldCcgfCAndmVyaWZpY2F0aW9uJyA9ICdwZXQnLFxuICAgIHBldElkPzogc3RyaW5nLFxuICAgIG9uUHJvZ3Jlc3M/OiAoaW5kZXg6IG51bWJlciwgcHJvZ3Jlc3M6IFVwbG9hZFByb2dyZXNzKSA9PiB2b2lkXG4gICk6IFByb21pc2U8VXBsb2FkUmVzdWx0W10+IHtcbiAgICBjb25zdCByZXN1bHRzOiBVcGxvYWRSZXN1bHRbXSA9IFtdO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwaG90b3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHBob3RvID0gcGhvdG9zW2ldO1xuICAgICAgXG4gICAgICBpZiAob25Qcm9ncmVzcykge1xuICAgICAgICBvblByb2dyZXNzKGksIHsgcGhhc2U6ICdwcmVzaWduJywgcGVyY2VudDogMCwgbWVzc2FnZTogYFByb2Nlc3NpbmcgcGhvdG8gJHtpICsgMX0vJHtwaG90b3MubGVuZ3RofWAgfSk7XG4gICAgICB9XG5cbiAgICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnVwbG9hZFByb2Nlc3NlZEltYWdlKFxuICAgICAgICBwaG90byEsXG4gICAgICAgIHR5cGUsXG4gICAgICAgIHBldElkLFxuICAgICAgICAocHJvZ3Jlc3MpID0+IHtcbiAgICAgICAgICBpZiAob25Qcm9ncmVzcykge1xuICAgICAgICAgICAgb25Qcm9ncmVzcyhpLCBwcm9ncmVzcyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgICByZXN1bHRzLnB1c2gocmVzdWx0KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yOiB1bmtub3duKSB7XG4gICAgICAgIGNvbnN0IGVyciA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvciA6IG5ldyBFcnJvcihTdHJpbmcoZXJyb3IpKTtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdCYXRjaCB1cGxvYWQgZmFpbGVkJywgeyBlcnJvcjogZXJyLCBwaG90b0luZGV4OiBpICsgMSB9KTtcbiAgICAgICAgLy8gQ29udGludWUgd2l0aCBvdGhlciBwaG90b3NcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiB1cGxvYWQgaXMgZHVwbGljYXRlXG4gICAqL1xuICBhc3luYyBjaGVja0R1cGxpY2F0ZSh1cGxvYWRJZDogc3RyaW5nKTogUHJvbWlzZTx7IGlzRHVwbGljYXRlOiBib29sZWFuOyBzaW1pbGFySW1hZ2VzPzogc3RyaW5nW10gfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3Q8eyBkYXRhOiB7IGlzRHVwbGljYXRlOiBib29sZWFuOyBzaW1pbGFySW1hZ2VzPzogc3RyaW5nW10gfSB9PihcbiAgICAgICAgYC91cGxvYWRzLyR7dXBsb2FkSWR9L2R1cGxpY2F0ZS1jaGVja2AsXG4gICAgICAgIHsgbWV0aG9kOiAnR0VUJyB9XG4gICAgICApO1xuICAgICAgXG4gICAgICAvLyBWYWxpZGF0ZSByZXNwb25zZSBkYXRhIGlzIHRoZSBleHBlY3RlZCBmb3JtYXRcbiAgICAgIGlmIChyZXNwb25zZS5kYXRhICYmIHR5cGVvZiByZXNwb25zZS5kYXRhID09PSAnb2JqZWN0JyAmJiAnaXNEdXBsaWNhdGUnIGluIHJlc3BvbnNlLmRhdGEpIHtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIE1hbGZvcm1lZCByZXNwb25zZSAtIHJldHVybiBzYWZlIGRlZmF1bHRcbiAgICAgIGxvZ2dlci53YXJuKCdEdXBsaWNhdGUgY2hlY2sgcmV0dXJuZWQgbWFsZm9ybWVkIHJlc3BvbnNlJywgeyBkYXRhOiByZXNwb25zZS5kYXRhIH0pO1xuICAgICAgcmV0dXJuIHsgaXNEdXBsaWNhdGU6IGZhbHNlIH07XG4gICAgfSBjYXRjaCAoZXJyb3I6IHVua25vd24pIHtcbiAgICAgIGNvbnN0IGVyciA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvciA6IG5ldyBFcnJvcihTdHJpbmcoZXJyb3IpKTtcbiAgICAgIGxvZ2dlci5lcnJvcignRHVwbGljYXRlIGNoZWNrIGZhaWxlZCcsIHsgZXJyb3I6IGVyciB9KTtcbiAgICAgIHJldHVybiB7IGlzRHVwbGljYXRlOiBmYWxzZSB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIZWxwZXI6IENvbnZlcnQgZmlsZSBVUkkgdG8gYmxvYiBmb3IgZmV0Y2ggdXBsb2FkXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGZpbGVVcmlUb0Jsb2IodXJpOiBzdHJpbmcpOiBQcm9taXNlPEJsb2I+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgRmlsZVN5c3RlbSA9IGF3YWl0IGltcG9ydCgnZXhwby1maWxlLXN5c3RlbScpO1xuICAgICAgY29uc3QgYmFzZTY0ID0gYXdhaXQgRmlsZVN5c3RlbS5yZWFkQXNTdHJpbmdBc3luYyh1cmksIHtcbiAgICAgICAgZW5jb2Rpbmc6IEZpbGVTeXN0ZW0uRW5jb2RpbmdUeXBlLkJhc2U2NCxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgYnl0ZUNoYXJhY3RlcnMgPSBhdG9iKGJhc2U2NCk7XG4gICAgICBjb25zdCBieXRlTnVtYmVycyA9IG5ldyBBcnJheShieXRlQ2hhcmFjdGVycy5sZW5ndGgpO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBieXRlQ2hhcmFjdGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICBieXRlTnVtYmVyc1tpXSA9IGJ5dGVDaGFyYWN0ZXJzLmNoYXJDb2RlQXQoaSk7XG4gICAgICB9XG4gICAgICBjb25zdCBieXRlQXJyYXkgPSBuZXcgVWludDhBcnJheShieXRlTnVtYmVycyk7XG4gICAgICByZXR1cm4gbmV3IEJsb2IoW2J5dGVBcnJheV0sIHsgdHlwZTogJ2ltYWdlL2pwZWcnIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiB1bmtub3duKSB7XG4gICAgICAvLyBSZS10aHJvdyB3aXRoIHByb3BlciBlcnJvciBtZXNzYWdlXG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvciA/IFN0cmluZyhlcnJvcikgOiAnRmlsZSBzeXN0ZW0gZXJyb3InKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0cnkgZmFpbGVkIHVwbG9hZCB3aXRoIGV4cG9uZW50aWFsIGJhY2tvZmZcbiAgICovXG4gIGFzeW5jIHJldHJ5VXBsb2FkKFxuICAgIHByb2Nlc3NlZEltYWdlOiBQcm9jZXNzZWRJbWFnZSxcbiAgICB0eXBlOiAncHJvZmlsZScgfCAncGV0JyB8ICd2ZXJpZmljYXRpb24nID0gJ3BldCcsXG4gICAgcGV0SWQ/OiBzdHJpbmcsXG4gICAgbWF4UmV0cmllcyA9IDNcbiAgKTogUHJvbWlzZTxVcGxvYWRSZXN1bHQ+IHtcbiAgICByZXR1cm4gdXBsb2FkV2l0aFJldHJ5KFxuICAgICAgKCkgPT4gdGhpcy51cGxvYWRQcm9jZXNzZWRJbWFnZShwcm9jZXNzZWRJbWFnZSwgdHlwZSwgcGV0SWQpLFxuICAgICAgbWF4UmV0cmllcyxcbiAgICAgIDEwMDBcbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEVuaGFuY2VkVXBsb2FkU2VydmljZS5nZXRJbnN0YW5jZSgpO1xuXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFPQSxJQUFBQSxjQUFBLEdBQUFDLE9BQUE7QUFNQSxJQUFBQyxJQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxPQUFBLEdBQUFGLE9BQUE7QUFBa0MsU0FBQUcsd0JBQUFDLENBQUEsRUFBQUMsQ0FBQSw2QkFBQUMsT0FBQSxNQUFBQyxDQUFBLE9BQUFELE9BQUEsSUFBQUUsQ0FBQSxPQUFBRixPQUFBLFlBQUFILHVCQUFBLFlBQUFBLHdCQUFBQyxDQUFBLEVBQUFDLENBQUEsU0FBQUEsQ0FBQSxJQUFBRCxDQUFBLElBQUFBLENBQUEsQ0FBQUssVUFBQSxTQUFBTCxDQUFBLE1BQUFNLENBQUEsRUFBQUMsQ0FBQSxFQUFBQyxDQUFBLEtBQUFDLFNBQUEsUUFBQUMsT0FBQSxFQUFBVixDQUFBLGlCQUFBQSxDQUFBLHVCQUFBQSxDQUFBLHlCQUFBQSxDQUFBLFNBQUFRLENBQUEsTUFBQUYsQ0FBQSxHQUFBTCxDQUFBLEdBQUFHLENBQUEsR0FBQUQsQ0FBQSxRQUFBRyxDQUFBLENBQUFLLEdBQUEsQ0FBQVgs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