22b1a3d3c5fed98f1704175a480e46c9
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.chatService = void 0;
exports.sendVoiceNoteNative = sendVoiceNoteNative;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _core = require("@pawfectmatch/core");
var _api = require("./api");
var FileSystem = _interopRequireWildcard(require("expo-file-system"));
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function _interopRequireWildcard(e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (var _t2 in e) "default" !== _t2 && {}.hasOwnProperty.call(e, _t2) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, _t2)) && (i.get || i.set) ? o(f, _t2, i) : f[_t2] = e[_t2]); return f; })(e, t); }
var ChatService = function () {
  function ChatService() {
    (0, _classCallCheck2.default)(this, ChatService);
  }
  return (0, _createClass2.default)(ChatService, [{
    key: "sendReaction",
    value: (function () {
      var _sendReaction = (0, _asyncToGenerator2.default)(function* (matchId, messageId, reaction) {
        try {
          var response = yield (0, _api.request)("/chat/reactions", {
            method: "POST",
            body: {
              matchId: matchId,
              messageId: messageId,
              reaction: reaction
            }
          });
          _core.logger.info("Reaction sent successfully", {
            matchId: matchId,
            messageId: messageId,
            reaction: reaction
          });
          return response;
        } catch (error) {
          _core.logger.error("Failed to send reaction", {
            error: error,
            matchId: matchId,
            messageId: messageId,
            reaction: reaction
          });
          throw error;
        }
      });
      function sendReaction(_x, _x2, _x3) {
        return _sendReaction.apply(this, arguments);
      }
      return sendReaction;
    }())
  }, {
    key: "sendAttachment",
    value: (function () {
      var _sendAttachment = (0, _asyncToGenerator2.default)(function* (params) {
        try {
          var formData = new FormData();
          formData.append("file", params.file);
          formData.append("matchId", params.matchId);
          formData.append("type", params.attachmentType);
          if (params.name) {
            formData.append("name", params.name);
          }
          var response = yield (0, _api.request)("/chat/attachments", {
            method: "POST",
            body: formData,
            headers: {}
          });
          _core.logger.info("Attachment sent successfully", {
            params: params
          });
          return response;
        } catch (error) {
          _core.logger.error("Failed to send attachment", {
            error: error,
            params: params
          });
          throw error;
        }
      });
      function sendAttachment(_x4) {
        return _sendAttachment.apply(this, arguments);
      }
      return sendAttachment;
    }())
  }, {
    key: "sendVoiceNote",
    value: function () {
      var _sendVoiceNote = (0, _asyncToGenerator2.default)(function* (matchIdOrParams, file, duration) {
        try {
          var formData;
          var _matchId;
          var voiceDuration;
          if (typeof matchIdOrParams === "string") {
            _matchId = matchIdOrParams;
            if (file instanceof FormData) {
              formData = file;
              formData.append("matchId", _matchId);
            } else if (file instanceof Blob) {
              formData = new FormData();
              var audioFile = new File([file], "voice-note.webm", {
                type: "audio/webm"
              });
              formData.append("audioBlob", audioFile);
              formData.append("matchId", _matchId);
            } else {
              throw new Error("Invalid file type");
            }
            voiceDuration = duration || 0;
          } else {
            var _params = matchIdOrParams;
            _matchId = _params.matchId;
            formData = new FormData();
            var _audioFile = new File([_params.audioBlob], "voice-note.m4a", {
              type: "audio/m4a"
            });
            formData.append("audioBlob", _audioFile);
            formData.append("matchId", _matchId);
            formData.append("duration", String(_params.duration));
            voiceDuration = _params.duration;
          }
          var response = yield (0, _api.request)("/api/chat/voice", {
            method: "POST",
            body: formData,
            headers: {}
          });
          _core.logger.info("Voice note sent successfully", {
            matchId: _matchId,
            duration: voiceDuration
          });
          if (typeof matchIdOrParams !== "string") {
            return response;
          }
        } catch (error) {
          _core.logger.error("Failed to send voice note", {
            error: error,
            matchIdOrParams: matchIdOrParams
          });
          throw error;
        }
      });
      function sendVoiceNote(_x5, _x6, _x7) {
        return _sendVoiceNote.apply(this, arguments);
      }
      return sendVoiceNote;
    }()
  }]);
}();
var chatService = exports.chatService = new ChatService();
function sendVoiceNoteNative(_x8, _x9) {
  return _sendVoiceNoteNative.apply(this, arguments);
}
function _sendVoiceNoteNative() {
  _sendVoiceNoteNative = (0, _asyncToGenerator2.default)(function* (matchId, p) {
    var presign = yield (0, _api.request)("/api/chat/voice/presign", {
      method: "POST",
      body: {
        contentType: "audio/webm"
      }
    });
    var url = presign.url,
      key = presign.key;
    yield FileSystem.uploadAsync(url, p.fileUri, {
      httpMethod: "PUT",
      headers: {
        "Content-Type": "audio/webm"
      },
      uploadType: FileSystem.FileSystemUploadType.BINARY_CONTENT
    });
    yield (0, _api.request)(`/api/chat/${matchId}/voice-note`, {
      method: "POST",
      body: {
        key: key,
        duration: p.duration,
        waveform: []
      }
    });
  });
  return _sendVoiceNoteNative.apply(this, arguments);
}
Object.assign(chatService, {
  sendVoiceNoteNative: sendVoiceNoteNative
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfY29yZSIsInJlcXVpcmUiLCJfYXBpIiwiRmlsZVN5c3RlbSIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwiZSIsInQiLCJXZWFrTWFwIiwiciIsIm4iLCJfX2VzTW9kdWxlIiwibyIsImkiLCJmIiwiX19wcm90b19fIiwiZGVmYXVsdCIsImhhcyIsImdldCIsInNldCIsIl90MiIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiQ2hhdFNlcnZpY2UiLCJfY2xhc3NDYWxsQ2hlY2syIiwiX2NyZWF0ZUNsYXNzMiIsImtleSIsInZhbHVlIiwiX3NlbmRSZWFjdGlvbiIsIl9hc3luY1RvR2VuZXJhdG9yMiIsIm1hdGNoSWQiLCJtZXNzYWdlSWQiLCJyZWFjdGlvbiIsInJlc3BvbnNlIiwicmVxdWVzdCIsIm1ldGhvZCIsImJvZHkiLCJsb2dnZXIiLCJpbmZvIiwiZXJyb3IiLCJzZW5kUmVhY3Rpb24iLCJfeCIsIl94MiIsIl94MyIsImFwcGx5IiwiYXJndW1lbnRzIiwiX3NlbmRBdHRhY2htZW50IiwicGFyYW1zIiwiZm9ybURhdGEiLCJGb3JtRGF0YSIsImFwcGVuZCIsImZpbGUiLCJhdHRhY2htZW50VHlwZSIsIm5hbWUiLCJoZWFkZXJzIiwic2VuZEF0dGFjaG1lbnQiLCJfeDQiLCJfc2VuZFZvaWNlTm90ZSIsIm1hdGNoSWRPclBhcmFtcyIsImR1cmF0aW9uIiwidm9pY2VEdXJhdGlvbiIsIkJsb2IiLCJhdWRpb0ZpbGUiLCJGaWxlIiwidHlwZSIsIkVycm9yIiwiYXVkaW9CbG9iIiwiU3RyaW5nIiwic2VuZFZvaWNlTm90ZSIsIl94NSIsIl94NiIsIl94NyIsImNoYXRTZXJ2aWNlIiwiZXhwb3J0cyIsInNlbmRWb2ljZU5vdGVOYXRpdmUiLCJfeDgiLCJfeDkiLCJfc2VuZFZvaWNlTm90ZU5hdGl2ZSIsInAiLCJwcmVzaWduIiwiY29udGVudFR5cGUiLCJ1cmwiLCJ1cGxvYWRBc3luYyIsImZpbGVVcmkiLCJodHRwTWV0aG9kIiwidXBsb2FkVHlwZSIsIkZpbGVTeXN0ZW1VcGxvYWRUeXBlIiwiQklOQVJZX0NPTlRFTlQiLCJ3YXZlZm9ybSIsImFzc2lnbiJdLCJzb3VyY2VzIjpbImNoYXRTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ2hhdCBTZXJ2aWNlIGZvciBQYXdmZWN0TWF0Y2ggTW9iaWxlXG4gKiBIYW5kbGVzIGNoYXQgZmVhdHVyZXM6IHJlYWN0aW9ucywgYXR0YWNobWVudHMsIHZvaWNlIG5vdGVzXG4gKi9cblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIkBwYXdmZWN0bWF0Y2gvY29yZVwiO1xuaW1wb3J0IHR5cGUgeyBNZXNzYWdlIH0gZnJvbSBcIkBwYXdmZWN0bWF0Y2gvY29yZVwiO1xuaW1wb3J0IHsgcmVxdWVzdCB9IGZyb20gXCIuL2FwaVwiO1xuaW1wb3J0ICogYXMgRmlsZVN5c3RlbSBmcm9tIFwiZXhwby1maWxlLXN5c3RlbVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIENoYXRSZWFjdGlvbiB7XG4gIGVtb2ppOiBzdHJpbmc7XG4gIHVzZXJJZDogc3RyaW5nO1xuICB0aW1lc3RhbXA6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNZXNzYWdlV2l0aFJlYWN0aW9ucyBleHRlbmRzIE1lc3NhZ2Uge1xuICByZWFjdGlvbnM/OiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENoYXRBdHRhY2htZW50IHtcbiAgdHlwZTogXCJpbWFnZVwiIHwgXCJ2aWRlb1wiIHwgXCJmaWxlXCI7XG4gIHVybDogc3RyaW5nO1xuICBuYW1lPzogc3RyaW5nO1xuICBzaXplPzogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFZvaWNlTm90ZSB7XG4gIHVybDogc3RyaW5nO1xuICBkdXJhdGlvbjogbnVtYmVyO1xuICB3YXZlZm9ybT86IG51bWJlcltdO1xufVxuXG5pbnRlcmZhY2UgU2VuZFJlYWN0aW9uUGFyYW1zIHtcbiAgbWF0Y2hJZDogc3RyaW5nO1xuICBtZXNzYWdlSWQ6IHN0cmluZztcbiAgcmVhY3Rpb246IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIFNlbmRBdHRhY2htZW50UGFyYW1zIHtcbiAgbWF0Y2hJZDogc3RyaW5nO1xuICBhdHRhY2htZW50VHlwZTogXCJpbWFnZVwiIHwgXCJ2aWRlb1wiIHwgXCJmaWxlXCI7XG4gIGZpbGU6IEZpbGUgfCBCbG9iO1xuICBuYW1lPzogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgU2VuZFZvaWNlTm90ZVBhcmFtcyB7XG4gIG1hdGNoSWQ6IHN0cmluZztcbiAgYXVkaW9CbG9iOiBCbG9iO1xuICBkdXJhdGlvbjogbnVtYmVyO1xufVxuXG4vKipcbiAqIENoYXQgU2VydmljZSBmb3IgcmVhY3Rpb25zLCBhdHRhY2htZW50cywgYW5kIHZvaWNlIG5vdGVzXG4gKi9cbmNsYXNzIENoYXRTZXJ2aWNlIHtcbiAgLyoqXG4gICAqIFNlbmQgYSByZWFjdGlvbiB0byBhIG1lc3NhZ2VcbiAgICovXG4gIGFzeW5jIHNlbmRSZWFjdGlvbihcbiAgICBtYXRjaElkOiBzdHJpbmcsXG4gICAgbWVzc2FnZUlkOiBzdHJpbmcsXG4gICAgcmVhY3Rpb246IHN0cmluZ1xuICApOiBQcm9taXNlPHtcbiAgICBzdWNjZXNzOiBib29sZWFuO1xuICAgIG1lc3NhZ2VJZDogc3RyaW5nO1xuICAgIHJlYWN0aW9uczogQ2hhdFJlYWN0aW9uW107XG4gIH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0PHtcbiAgICAgICAgc3VjY2VzczogYm9vbGVhbjtcbiAgICAgICAgbWVzc2FnZUlkOiBzdHJpbmc7XG4gICAgICAgIHJlYWN0aW9uczogQ2hhdFJlYWN0aW9uW107XG4gICAgICB9PihcIi9jaGF0L3JlYWN0aW9uc1wiLCB7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIGJvZHk6IHtcbiAgICAgICAgICBtYXRjaElkLFxuICAgICAgICAgIG1lc3NhZ2VJZCxcbiAgICAgICAgICByZWFjdGlvbixcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBsb2dnZXIuaW5mbyhcIlJlYWN0aW9uIHNlbnQgc3VjY2Vzc2Z1bGx5XCIsIHsgbWF0Y2hJZCwgbWVzc2FnZUlkLCByZWFjdGlvbiB9KTtcblxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoXCJGYWlsZWQgdG8gc2VuZCByZWFjdGlvblwiLCB7IGVycm9yLCBtYXRjaElkLCBtZXNzYWdlSWQsIHJlYWN0aW9uIH0pO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNlbmQgYW4gYXR0YWNobWVudCB0byBhIG1hdGNoXG4gICAqL1xuICBhc3luYyBzZW5kQXR0YWNobWVudChwYXJhbXM6IFNlbmRBdHRhY2htZW50UGFyYW1zKTogUHJvbWlzZTx7XG4gICAgc3VjY2VzczogYm9vbGVhbjtcbiAgICB1cmw6IHN0cmluZztcbiAgICB0eXBlOiBzdHJpbmc7XG4gIH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgIGZvcm1EYXRhLmFwcGVuZChcImZpbGVcIiwgcGFyYW1zLmZpbGUpO1xuICAgICAgZm9ybURhdGEuYXBwZW5kKFwibWF0Y2hJZFwiLCBwYXJhbXMubWF0Y2hJZCk7XG4gICAgICBmb3JtRGF0YS5hcHBlbmQoXCJ0eXBlXCIsIHBhcmFtcy5hdHRhY2htZW50VHlwZSk7XG4gICAgICBpZiAocGFyYW1zLm5hbWUpIHtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwibmFtZVwiLCBwYXJhbXMubmFtZSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdDx7XG4gICAgICAgIHN1Y2Nlc3M6IGJvb2xlYW47XG4gICAgICAgIHVybDogc3RyaW5nO1xuICAgICAgICB0eXBlOiBzdHJpbmc7XG4gICAgICB9PihcIi9jaGF0L2F0dGFjaG1lbnRzXCIsIHtcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgYm9keTogZm9ybURhdGEsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAvLyBEb24ndCBzZXQgQ29udGVudC1UeXBlIC0gRm9ybURhdGEgc2V0cyBpdCBhdXRvbWF0aWNhbGx5XG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgbG9nZ2VyLmluZm8oXCJBdHRhY2htZW50IHNlbnQgc3VjY2Vzc2Z1bGx5XCIsIHsgcGFyYW1zIH0pO1xuXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihcIkZhaWxlZCB0byBzZW5kIGF0dGFjaG1lbnRcIiwgeyBlcnJvciwgcGFyYW1zIH0pO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNlbmQgYSB2b2ljZSBub3RlXG4gICAqIFN1cHBvcnRzIGJvdGggRm9ybURhdGEgKG5hdGl2ZSkgYW5kIEJsb2IgKHdlYilcbiAgICovXG4gIGFzeW5jIHNlbmRWb2ljZU5vdGUoXG4gICAgbWF0Y2hJZDogc3RyaW5nLFxuICAgIGZpbGU6IEZvcm1EYXRhIHwgQmxvYixcbiAgICBkdXJhdGlvbj86IG51bWJlclxuICApOiBQcm9taXNlPHZvaWQ+O1xuICBcbiAgLyoqXG4gICAqIFNlbmQgYSB2b2ljZSBub3RlIChsZWdhY3kgc2lnbmF0dXJlKVxuICAgKi9cbiAgYXN5bmMgc2VuZFZvaWNlTm90ZShwYXJhbXM6IFNlbmRWb2ljZU5vdGVQYXJhbXMpOiBQcm9taXNlPHtcbiAgICBzdWNjZXNzOiBib29sZWFuO1xuICAgIHVybDogc3RyaW5nO1xuICAgIGR1cmF0aW9uOiBudW1iZXI7XG4gIH0+O1xuICBcbiAgYXN5bmMgc2VuZFZvaWNlTm90ZShcbiAgICBtYXRjaElkT3JQYXJhbXM6IHN0cmluZyB8IFNlbmRWb2ljZU5vdGVQYXJhbXMsXG4gICAgZmlsZT86IEZvcm1EYXRhIHwgQmxvYixcbiAgICBkdXJhdGlvbj86IG51bWJlclxuICApOiBQcm9taXNlPHZvaWQgfCB7XG4gICAgc3VjY2VzczogYm9vbGVhbjtcbiAgICB1cmw6IHN0cmluZztcbiAgICBkdXJhdGlvbjogbnVtYmVyO1xuICB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEhhbmRsZSBib3RoIHNpZ25hdHVyZXNcbiAgICAgIGxldCBmb3JtRGF0YTogRm9ybURhdGE7XG4gICAgICBsZXQgbWF0Y2hJZDogc3RyaW5nO1xuICAgICAgbGV0IHZvaWNlRHVyYXRpb246IG51bWJlcjtcbiAgICAgIFxuICAgICAgaWYgKHR5cGVvZiBtYXRjaElkT3JQYXJhbXMgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgLy8gTmV3IHNpZ25hdHVyZTogc2VuZFZvaWNlTm90ZShtYXRjaElkLCBmaWxlLCBkdXJhdGlvbj8pXG4gICAgICAgIG1hdGNoSWQgPSBtYXRjaElkT3JQYXJhbXM7XG4gICAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgRm9ybURhdGEpIHtcbiAgICAgICAgICAvLyBOYXRpdmU6IEZvcm1EYXRhIGFscmVhZHkgaGFzIHRoZSBmaWxlIHdyYXBwZWRcbiAgICAgICAgICBmb3JtRGF0YSA9IGZpbGU7XG4gICAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwibWF0Y2hJZFwiLCBtYXRjaElkKTtcbiAgICAgICAgfSBlbHNlIGlmIChmaWxlIGluc3RhbmNlb2YgQmxvYikge1xuICAgICAgICAgIC8vIFdlYjogd3JhcCBCbG9iIGluIEZvcm1EYXRhXG4gICAgICAgICAgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgICBjb25zdCBhdWRpb0ZpbGUgPSBuZXcgRmlsZShbZmlsZV0sIFwidm9pY2Utbm90ZS53ZWJtXCIsIHtcbiAgICAgICAgICAgIHR5cGU6IFwiYXVkaW8vd2VibVwiLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChcImF1ZGlvQmxvYlwiLCBhdWRpb0ZpbGUpO1xuICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChcIm1hdGNoSWRcIiwgbWF0Y2hJZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBmaWxlIHR5cGVcIik7XG4gICAgICAgIH1cbiAgICAgICAgdm9pY2VEdXJhdGlvbiA9IGR1cmF0aW9uIHx8IDA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBMZWdhY3kgc2lnbmF0dXJlOiBzZW5kVm9pY2VOb3RlKHsgbWF0Y2hJZCwgYXVkaW9CbG9iLCBkdXJhdGlvbiB9KVxuICAgICAgICBjb25zdCBwYXJhbXMgPSBtYXRjaElkT3JQYXJhbXM7XG4gICAgICAgIG1hdGNoSWQgPSBwYXJhbXMubWF0Y2hJZDtcbiAgICAgICAgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgY29uc3QgYXVkaW9GaWxlID0gbmV3IEZpbGUoW3BhcmFtcy5hdWRpb0Jsb2JdLCBcInZvaWNlLW5vdGUubTRhXCIsIHtcbiAgICAgICAgICB0eXBlOiBcImF1ZGlvL200YVwiLFxuICAgICAgICB9KTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwiYXVkaW9CbG9iXCIsIGF1ZGlvRmlsZSk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZChcIm1hdGNoSWRcIiwgbWF0Y2hJZCk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZChcImR1cmF0aW9uXCIsIFN0cmluZyhwYXJhbXMuZHVyYXRpb24pKTtcbiAgICAgICAgdm9pY2VEdXJhdGlvbiA9IHBhcmFtcy5kdXJhdGlvbjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0PHtcbiAgICAgICAgc3VjY2VzczogYm9vbGVhbjtcbiAgICAgICAgdXJsOiBzdHJpbmc7XG4gICAgICAgIGR1cmF0aW9uOiBudW1iZXI7XG4gICAgICB9PihcIi9hcGkvY2hhdC92b2ljZVwiLCB7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIGJvZHk6IGZvcm1EYXRhLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgLy8gRG9uJ3Qgc2V0IENvbnRlbnQtVHlwZSAtIEZvcm1EYXRhIHNldHMgaXQgYXV0b21hdGljYWxseVxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGxvZ2dlci5pbmZvKFwiVm9pY2Ugbm90ZSBzZW50IHN1Y2Nlc3NmdWxseVwiLCB7IG1hdGNoSWQsIGR1cmF0aW9uOiB2b2ljZUR1cmF0aW9uIH0pO1xuICAgICAgXG4gICAgICAvLyBSZXR1cm4gcmVzdWx0IGZvciBsZWdhY3kgc2lnbmF0dXJlXG4gICAgICBpZiAodHlwZW9mIG1hdGNoSWRPclBhcmFtcyAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihcIkZhaWxlZCB0byBzZW5kIHZvaWNlIG5vdGVcIiwgeyBlcnJvciwgbWF0Y2hJZE9yUGFyYW1zIH0pO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBjb25zdCBjaGF0U2VydmljZSA9IG5ldyBDaGF0U2VydmljZSgpO1xuXG4vLyBOYXRpdmUgdm9pY2Ugbm90ZSB1cGxvYWQgaGVscGVyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZFZvaWNlTm90ZU5hdGl2ZShtYXRjaElkOiBzdHJpbmcsIHA6IHsgZmlsZVVyaTogc3RyaW5nOyBkdXJhdGlvbjogbnVtYmVyIH0pIHtcbiAgLy8gcHJlc2lnblxuICBjb25zdCBwcmVzaWduID0gYXdhaXQgcmVxdWVzdDx7IHVybDogc3RyaW5nOyBrZXk6IHN0cmluZyB9PihcIi9hcGkvY2hhdC92b2ljZS9wcmVzaWduXCIsIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIGJvZHk6IHsgY29udGVudFR5cGU6IFwiYXVkaW8vd2VibVwiIH0sXG4gIH0pO1xuICBjb25zdCB7IHVybCwga2V5IH0gPSBwcmVzaWduO1xuXG4gIC8vIFBVVCB0byBTM1xuICBhd2FpdCBGaWxlU3lzdGVtLnVwbG9hZEFzeW5jKHVybCwgcC5maWxlVXJpLCB7XG4gICAgaHR0cE1ldGhvZDogXCJQVVRcIixcbiAgICBoZWFkZXJzOiB7IFwiQ29udGVudC1UeXBlXCI6IFwiYXVkaW8vd2VibVwiIH0sXG4gICAgdXBsb2FkVHlwZTogRmlsZVN5c3RlbS5GaWxlU3lzdGVtVXBsb2FkVHlwZS5CSU5BUllfQ09OVEVOVCxcbiAgfSk7XG5cbiAgLy8gcmVnaXN0ZXIgbWVzc2FnZVxuICBhd2FpdCByZXF1ZXN0KGAvYXBpL2NoYXQvJHttYXRjaElkfS92b2ljZS1ub3RlYCwge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgYm9keTogeyBrZXksIGR1cmF0aW9uOiBwLmR1cmF0aW9uLCB3YXZlZm9ybTogW10gfSxcbiAgfSk7XG59XG5cbi8vIEV4dGVuZGVkIENoYXRTZXJ2aWNlIGludGVyZmFjZSB3aXRoIG5hdGl2ZSBtZXRob2RzXG5pbnRlcmZhY2UgQ2hhdFNlcnZpY2VXaXRoTmF0aXZlIGV4dGVuZHMgQ2hhdFNlcnZpY2Uge1xuICBzZW5kVm9pY2VOb3RlTmF0aXZlOiB0eXBlb2Ygc2VuZFZvaWNlTm90ZU5hdGl2ZTtcbn1cblxuLy8gSW5qZWN0IHRvIGNoYXRTZXJ2aWNlIHdpdGggcHJvcGVyIHR5cGVcbk9iamVjdC5hc3NpZ24oY2hhdFNlcnZpY2UsIHsgc2VuZFZvaWNlTm90ZU5hdGl2ZSB9KTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFLQSxJQUFBQSxLQUFBLEdBQUFDLE9BQUE7QUFFQSxJQUFBQyxJQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxVQUFBLEdBQUFDLHVCQUFBLENBQUFILE9BQUE7QUFBK0MsU0FBQUcsd0JBQUFDLENBQUEsRUFBQUMsQ0FBQSw2QkFBQUMsT0FBQSxNQUFBQyxD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