3f64c935b673849a9c442aa4e7f7c713
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.premiumService = exports.default = void 0;
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _core = require("@pawfectmatch/core");
var _api = require("./api");
var _process$env$EXPO_PUB, _process$env$EXPO_PUB2, _process$env$EXPO_PUB3;
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
var PremiumService = function () {
  function PremiumService() {
    (0, _classCallCheck2.default)(this, PremiumService);
  }
  return (0, _createClass2.default)(PremiumService, [{
    key: "hasActiveSubscription",
    value: (function () {
      var _hasActiveSubscription = (0, _asyncToGenerator2.default)(function* () {
        try {
          var status = yield this.getSubscriptionStatus();
          return status.isActive;
        } catch (error) {
          _core.logger.error("Failed to check premium status", {
            error: error
          });
          return false;
        }
      });
      function hasActiveSubscription() {
        return _hasActiveSubscription.apply(this, arguments);
      }
      return hasActiveSubscription;
    }())
  }, {
    key: "getSubscriptionStatus",
    value: (function () {
      var _getSubscriptionStatus = (0, _asyncToGenerator2.default)(function* () {
        try {
          var cached = yield this.getCachedStatus();
          if (cached !== null && this.isCacheValid(cached.timestamp)) {
            return cached.status;
          }
          var response = yield _api.api.request("/premium/status");
          var status = _objectSpread(_objectSpread(_objectSpread({
            isActive: response.isActive,
            plan: response.plan,
            features: response.features,
            autoRenew: response.autoRenew
          }, response.expiresAt !== undefined ? {
            expiresAt: response.expiresAt
          } : {}), response.stripeCustomerId !== undefined ? {
            stripeCustomerId: response.stripeCustomerId
          } : {}), response.currentPeriodEnd !== undefined ? {
            currentPeriodEnd: response.currentPeriodEnd
          } : {});
          yield this.setCachedStatus(status);
          _core.logger.info("Fetched subscription status", {
            isActive: status.isActive,
            plan: status.plan,
            featuresCount: status.features.length
          });
          return status;
        } catch (error) {
          _core.logger.error("Failed to get subscription status", {
            error: error
          });
          return {
            isActive: false,
            plan: "free",
            features: [],
            autoRenew: false
          };
        }
      });
      function getSubscriptionStatus() {
        return _getSubscriptionStatus.apply(this, arguments);
      }
      return getSubscriptionStatus;
    }())
  }, {
    key: "getAvailablePlans",
    value: function getAvailablePlans() {
      return PremiumService.PLANS;
    }
  }, {
    key: "createCheckoutSession",
    value: (function () {
      var _createCheckoutSession = (0, _asyncToGenerator2.default)(function* (planId, successUrl, cancelUrl) {
        try {
          var plan = PremiumService.PLANS.find(function (p) {
            return p.id === planId;
          });
          if (plan === undefined) {
            throw new Error(`Invalid plan ID: ${planId}`);
          }
          var response = yield _api.api.request("/premium/subscribe", {
            method: "POST",
            body: JSON.stringify({
              plan: planId,
              interval: plan.interval
            })
          });
          _core.logger.info("Created checkout session", {
            planId: planId,
            sessionId: response.data.sessionId
          });
          return {
            sessionId: response.data.sessionId,
            url: response.data.url
          };
        } catch (error) {
          _core.logger.error("Failed to create checkout session", {
            error: error,
            planId: planId
          });
          throw error;
        }
      });
      function createCheckoutSession(_x, _x2, _x3) {
        return _createCheckoutSession.apply(this, arguments);
      }
      return createCheckoutSession;
    }())
  }, {
    key: "cancelSubscription",
    value: (function () {
      var _cancelSubscription = (0, _asyncToGenerator2.default)(function* () {
        try {
          var response = yield _api.api.request("/premium/cancel", {
            method: "POST"
          });
          yield this.clearCache();
          _core.logger.info("Subscription cancelled", response);
          return response;
        } catch (error) {
          _core.logger.error("Failed to cancel subscription", {
            error: error
          });
          throw error;
        }
      });
      function cancelSubscription() {
        return _cancelSubscription.apply(this, arguments);
      }
      return cancelSubscription;
    }())
  }, {
    key: "getPremiumLimits",
    value: (function () {
      var _getPremiumLimits = (0, _asyncToGenerator2.default)(function* () {
        try {
          var status = yield this.getSubscriptionStatus();
          var limits = {
            swipesPerDay: 50,
            likesPerDay: 100,
            superLikesPerDay: 3,
            canUndoSwipes: false,
            canSeeWhoLiked: false,
            canBoostProfile: false,
            advancedFilters: false,
            priorityMatching: false,
            unlimitedRewind: false
          };
          if (status.isActive) {
            switch (status.plan.toLowerCase()) {
              case "basic":
                limits.superLikesPerDay = 5;
                limits.canSeeWhoLiked = true;
                limits.advancedFilters = true;
                break;
              case "premium":
                limits.superLikesPerDay = -1;
                limits.canUndoSwipes = true;
                limits.canSeeWhoLiked = true;
                limits.canBoostProfile = true;
                limits.advancedFilters = true;
                limits.priorityMatching = true;
                break;
              case "ultimate":
                limits.superLikesPerDay = -1;
                limits.canUndoSwipes = true;
                limits.canSeeWhoLiked = true;
                limits.canBoostProfile = true;
                limits.advancedFilters = true;
                limits.priorityMatching = true;
                limits.unlimitedRewind = true;
                break;
            }
          }
          return limits;
        } catch (error) {
          _core.logger.error("Failed to get premium limits", {
            error: error
          });
          return {
            swipesPerDay: 50,
            likesPerDay: 100,
            superLikesPerDay: 3,
            canUndoSwipes: false,
            canSeeWhoLiked: false,
            canBoostProfile: false,
            advancedFilters: false,
            priorityMatching: false,
            unlimitedRewind: false
          };
        }
      });
      function getPremiumLimits() {
        return _getPremiumLimits.apply(this, arguments);
      }
      return getPremiumLimits;
    }())
  }, {
    key: "canUseFeature",
    value: (function () {
      var _canUseFeature = (0, _asyncToGenerator2.default)(function* (feature) {
        try {
          var limits = yield this.getPremiumLimits();
          return limits[feature];
        } catch (error) {
          _core.logger.error("Failed to check feature access", {
            error: error,
            feature: feature
          });
          return false;
        }
      });
      function canUseFeature(_x4) {
        return _canUseFeature.apply(this, arguments);
      }
      return canUseFeature;
    }())
  }, {
    key: "trackUsage",
    value: (function () {
      var _trackUsage = (0, _asyncToGenerator2.default)(function* (feature) {
        try {
          yield _api.api.request("/premium/track-usage", {
            method: "POST",
            body: JSON.stringify({
              feature: feature,
              timestamp: Date.now()
            })
          });
          _core.logger.info("Premium feature usage tracked", {
            feature: feature
          });
        } catch (error) {
          _core.logger.error("Failed to track premium usage", {
            error: error,
            feature: feature
          });
        }
      });
      function trackUsage(_x5) {
        return _trackUsage.apply(this, arguments);
      }
      return trackUsage;
    }())
  }, {
    key: "getCachedStatus",
    value: function getCachedStatus() {
      return Promise.resolve(null);
    }
  }, {
    key: "setCachedStatus",
    value: function () {
      var _setCachedStatus = (0, _asyncToGenerator2.default)(function* (_status) {});
      function setCachedStatus(_x6) {
        return _setCachedStatus.apply(this, arguments);
      }
      return setCachedStatus;
    }()
  }, {
    key: "isCacheValid",
    value: function isCacheValid(timestamp) {
      return Date.now() - timestamp < PremiumService.CACHE_DURATION;
    }
  }, {
    key: "clearCache",
    value: function () {
      var _clearCache = (0, _asyncToGenerator2.default)(function* () {});
      function clearCache() {
        return _clearCache.apply(this, arguments);
      }
      return clearCache;
    }()
  }]);
}();
PremiumService.CACHE_DURATION = 5 * 60 * 1000;
PremiumService.PLANS = [{
  id: "basic",
  name: "Basic",
  price: 4.99,
  interval: "month",
  features: ["5 Super Likes/day", "See who liked you", "Advanced filters"],
  stripePriceId: (_process$env$EXPO_PUB = process.env["EXPO_PUBLIC_STRIPE_BASIC_PRICE_ID"]) != null ? _process$env$EXPO_PUB : "price_1P1234567890abcdefghijklmn"
}, {
  id: "premium",
  name: "Premium",
  price: 9.99,
  interval: "month",
  features: ["Unlimited Super Likes", "Priority matching", "Profile boost", "Undo swipes"],
  stripePriceId: (_process$env$EXPO_PUB2 = process.env["EXPO_PUBLIC_STRIPE_PREMIUM_PRICE_ID"]) != null ? _process$env$EXPO_PUB2 : "price_1P2345678901bcdefghijklmnop",
  popular: true
}, {
  id: "ultimate",
  name: "Ultimate",
  price: 19.99,
  interval: "month",
  features: ["Everything in Premium", "Video calls", "Advanced analytics", "VIP support"],
  stripePriceId: (_process$env$EXPO_PUB3 = process.env["EXPO_PUBLIC_STRIPE_ULTIMATE_PRICE_ID"]) != null ? _process$env$EXPO_PUB3 : "price_1P3456789012cdefghijklmnopqr"
}];
var premiumService = exports.premiumService = new PremiumService();
var _default = exports.default = premiumService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfY29yZSIsInJlcXVpcmUiLCJfYXBpIiwiX3Byb2Nlc3MkZW52JEVYUE9fUFVCIiwiX3Byb2Nlc3MkZW52JEVYUE9fUFVCMiIsIl9wcm9jZXNzJGVudiRFWFBPX1BVQjMiLCJvd25LZXlzIiwiZSIsInIiLCJ0IiwiT2JqZWN0Iiwia2V5cyIsImdldE93blByb3BlcnR5U3ltYm9scyIsIm8iLCJmaWx0ZXIiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwicHVzaCIsImFwcGx5IiwiX29iamVjdFNwcmVhZCIsImFyZ3VtZW50cyIsImxlbmd0aCIsImZvckVhY2giLCJfZGVmaW5lUHJvcGVydHkyIiwiZGVmYXVsdCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvcnMiLCJkZWZpbmVQcm9wZXJ0aWVzIiwiZGVmaW5lUHJvcGVydHkiLCJQcmVtaXVtU2VydmljZSIsIl9jbGFzc0NhbGxDaGVjazIiLCJfY3JlYXRlQ2xhc3MyIiwia2V5IiwidmFsdWUiLCJfaGFzQWN0aXZlU3Vic2NyaXB0aW9uIiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwic3RhdHVzIiwiZ2V0U3Vic2NyaXB0aW9uU3RhdHVzIiwiaXNBY3RpdmUiLCJlcnJvciIsImxvZ2dlciIsImhhc0FjdGl2ZVN1YnNjcmlwdGlvbiIsIl9nZXRTdWJzY3JpcHRpb25TdGF0dXMiLCJjYWNoZWQiLCJnZXRDYWNoZWRTdGF0dXMiLCJpc0NhY2hlVmFsaWQiLCJ0aW1lc3RhbXAiLCJyZXNwb25zZSIsImFwaSIsInJlcXVlc3QiLCJwbGFuIiwiZmVhdHVyZXMiLCJhdXRvUmVuZXciLCJleHBpcmVzQXQiLCJ1bmRlZmluZWQiLCJzdHJpcGVDdXN0b21lcklkIiwiY3VycmVudFBlcmlvZEVuZCIsInNldENhY2hlZFN0YXR1cyIsImluZm8iLCJmZWF0dXJlc0NvdW50IiwiZ2V0QXZhaWxhYmxlUGxhbnMiLCJQTEFOUyIsIl9jcmVhdGVDaGVja291dFNlc3Npb24iLCJwbGFuSWQiLCJzdWNjZXNzVXJsIiwiY2FuY2VsVXJsIiwiZmluZCIsInAiLCJpZCIsIkVycm9yIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJpbnRlcnZhbCIsInNlc3Npb25JZCIsImRhdGEiLCJ1cmwiLCJjcmVhdGVDaGVja291dFNlc3Npb24iLCJfeCIsIl94MiIsIl94MyIsIl9jYW5jZWxTdWJzY3JpcHRpb24iLCJjbGVhckNhY2hlIiwiY2FuY2VsU3Vic2NyaXB0aW9uIiwiX2dldFByZW1pdW1MaW1pdHMiLCJsaW1pdHMiLCJzd2lwZXNQZXJEYXkiLCJsaWtlc1BlckRheSIsInN1cGVyTGlrZXNQZXJEYXkiLCJjYW5VbmRvU3dpcGVzIiwiY2FuU2VlV2hvTGlrZWQiLCJjYW5Cb29zdFByb2ZpbGUiLCJhZHZhbmNlZEZpbHRlcnMiLCJwcmlvcml0eU1hdGNoaW5nIiwidW5saW1pdGVkUmV3aW5kIiwidG9Mb3dlckNhc2UiLCJnZXRQcmVtaXVtTGltaXRzIiwiX2NhblVzZUZlYXR1cmUiLCJmZWF0dXJlIiwiY2FuVXNlRmVhdHVyZSIsIl94NCIsIl90cmFja1VzYWdlIiwiRGF0ZSIsIm5vdyIsInRyYWNrVXNhZ2UiLCJfeDUiLCJQcm9taXNlIiwicmVzb2x2ZSIsIl9zZXRDYWNoZWRTdGF0dXMiLCJfc3RhdHVzIiwiX3g2IiwiQ0FDSEVfRFVSQVRJT04iLCJfY2xlYXJDYWNoZSIsIm5hbWUiLCJwcmljZSIsInN0cmlwZVByaWNlSWQiLCJwcm9jZXNzIiwiZW52IiwicG9wdWxhciIsInByZW1pdW1TZXJ2aWNlIiwiZXhwb3J0cyIsIl9kZWZhdWx0Il0sInNvdXJjZXMiOlsiUHJlbWl1bVNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQcmVtaXVtIFNlcnZpY2UgZm9yIFBhd2ZlY3RNYXRjaCBNb2JpbGUgQXBwXG4gKiBIYW5kbGVzIFN0cmlwZSBzdWJzY3JpcHRpb24gbWFuYWdlbWVudCBhbmQgcHJlbWl1bSBmZWF0dXJlIGdhdGluZ1xuICovXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwiQHBhd2ZlY3RtYXRjaC9jb3JlXCI7XG5pbXBvcnQgeyBhcGkgfSBmcm9tIFwiLi9hcGlcIjtcblxuZXhwb3J0IGludGVyZmFjZSBTdWJzY3JpcHRpb25TdGF0dXMge1xuICBpc0FjdGl2ZTogYm9vbGVhbjtcbiAgcGxhbjogc3RyaW5nO1xuICBmZWF0dXJlczogc3RyaW5nW107XG4gIGV4cGlyZXNBdD86IHN0cmluZztcbiAgYXV0b1JlbmV3OiBib29sZWFuO1xuICBzdHJpcGVDdXN0b21lcklkPzogc3RyaW5nO1xuICBjdXJyZW50UGVyaW9kRW5kPzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFByZW1pdW1MaW1pdHMge1xuICBzd2lwZXNQZXJEYXk6IG51bWJlcjtcbiAgbGlrZXNQZXJEYXk6IG51bWJlcjtcbiAgc3VwZXJMaWtlc1BlckRheTogbnVtYmVyO1xuICBjYW5VbmRvU3dpcGVzOiBib29sZWFuO1xuICBjYW5TZWVXaG9MaWtlZDogYm9vbGVhbjtcbiAgY2FuQm9vc3RQcm9maWxlOiBib29sZWFuO1xuICBhZHZhbmNlZEZpbHRlcnM6IGJvb2xlYW47XG4gIHByaW9yaXR5TWF0Y2hpbmc6IGJvb2xlYW47XG4gIHVubGltaXRlZFJld2luZDogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTdWJzY3JpcHRpb25QbGFuIHtcbiAgaWQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBwcmljZTogbnVtYmVyO1xuICBpbnRlcnZhbDogXCJtb250aFwiIHwgXCJ5ZWFyXCI7XG4gIGZlYXR1cmVzOiBzdHJpbmdbXTtcbiAgc3RyaXBlUHJpY2VJZDogc3RyaW5nO1xuICBwb3B1bGFyPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQYXltZW50TWV0aG9kIHtcbiAgaWQ6IHN0cmluZztcbiAgdHlwZTogXCJjYXJkXCI7XG4gIGNhcmQ6IHtcbiAgICBicmFuZDogc3RyaW5nO1xuICAgIGxhc3Q0OiBzdHJpbmc7XG4gICAgZXhwTW9udGg6IG51bWJlcjtcbiAgICBleHBZZWFyOiBudW1iZXI7XG4gIH07XG59XG5cbmNsYXNzIFByZW1pdW1TZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgQ0FDSEVfRFVSQVRJT04gPSA1ICogNjAgKiAxMDAwOyAvLyA1IG1pbnV0ZXNcblxuICAvLyBBdmFpbGFibGUgc3Vic2NyaXB0aW9uIHBsYW5zXG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IFBMQU5TOiBTdWJzY3JpcHRpb25QbGFuW10gPSBbXG4gICAge1xuICAgICAgaWQ6IFwiYmFzaWNcIixcbiAgICAgIG5hbWU6IFwiQmFzaWNcIixcbiAgICAgIHByaWNlOiA0Ljk5LFxuICAgICAgaW50ZXJ2YWw6IFwibW9udGhcIixcbiAgICAgIGZlYXR1cmVzOiBbXCI1IFN1cGVyIExpa2VzL2RheVwiLCBcIlNlZSB3aG8gbGlrZWQgeW91XCIsIFwiQWR2YW5jZWQgZmlsdGVyc1wiXSxcbiAgICAgIHN0cmlwZVByaWNlSWQ6XG4gICAgICAgIHByb2Nlc3MuZW52W1wiRVhQT19QVUJMSUNfU1RSSVBFX0JBU0lDX1BSSUNFX0lEXCJdID8/XG4gICAgICAgIFwicHJpY2VfMVAxMjM0NTY3ODkwYWJjZGVmZ2hpamtsbW5cIixcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiBcInByZW1pdW1cIixcbiAgICAgIG5hbWU6IFwiUHJlbWl1bVwiLFxuICAgICAgcHJpY2U6IDkuOTksXG4gICAgICBpbnRlcnZhbDogXCJtb250aFwiLFxuICAgICAgZmVhdHVyZXM6IFtcbiAgICAgICAgXCJVbmxpbWl0ZWQgU3VwZXIgTGlrZXNcIixcbiAgICAgICAgXCJQcmlvcml0eSBtYXRjaGluZ1wiLFxuICAgICAgICBcIlByb2ZpbGUgYm9vc3RcIixcbiAgICAgICAgXCJVbmRvIHN3aXBlc1wiLFxuICAgICAgXSxcbiAgICAgIHN0cmlwZVByaWNlSWQ6XG4gICAgICAgIHByb2Nlc3MuZW52W1wiRVhQT19QVUJMSUNfU1RSSVBFX1BSRU1JVU1fUFJJQ0VfSURcIl0gPz9cbiAgICAgICAgXCJwcmljZV8xUDIzNDU2Nzg5MDFiY2RlZmdoaWprbG1ub3BcIixcbiAgICAgIHBvcHVsYXI6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBpZDogXCJ1bHRpbWF0ZVwiLFxuICAgICAgbmFtZTogXCJVbHRpbWF0ZVwiLFxuICAgICAgcHJpY2U6IDE5Ljk5LFxuICAgICAgaW50ZXJ2YWw6IFwibW9udGhcIixcbiAgICAgIGZlYXR1cmVzOiBbXG4gICAgICAgIFwiRXZlcnl0aGluZyBpbiBQcmVtaXVtXCIsXG4gICAgICAgIFwiVmlkZW8gY2FsbHNcIixcbiAgICAgICAgXCJBZHZhbmNlZCBhbmFseXRpY3NcIixcbiAgICAgICAgXCJWSVAgc3VwcG9ydFwiLFxuICAgICAgXSxcbiAgICAgIHN0cmlwZVByaWNlSWQ6XG4gICAgICAgIHByb2Nlc3MuZW52W1wiRVhQT19QVUJMSUNfU1RSSVBFX1VMVElNQVRFX1BSSUNFX0lEXCJdID8/XG4gICAgICAgIFwicHJpY2VfMVAzNDU2Nzg5MDEyY2RlZmdoaWprbG1ub3BxclwiLFxuICAgIH0sXG4gIF07XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHVzZXIgaGFzIGFjdGl2ZSBwcmVtaXVtIHN1YnNjcmlwdGlvblxuICAgKi9cbiAgYXN5bmMgaGFzQWN0aXZlU3Vic2NyaXB0aW9uKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzdGF0dXMgPSBhd2FpdCB0aGlzLmdldFN1YnNjcmlwdGlvblN0YXR1cygpO1xuICAgICAgcmV0dXJuIHN0YXR1cy5pc0FjdGl2ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKFwiRmFpbGVkIHRvIGNoZWNrIHByZW1pdW0gc3RhdHVzXCIsIHsgZXJyb3IgfSk7XG4gICAgICByZXR1cm4gZmFsc2U7IC8vIERlZmF1bHQgdG8gZnJlZSB0aWVyIG9uIGVycm9yXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBkZXRhaWxlZCBzdWJzY3JpcHRpb24gc3RhdHVzXG4gICAqL1xuICBhc3luYyBnZXRTdWJzY3JpcHRpb25TdGF0dXMoKTogUHJvbWlzZTxTdWJzY3JpcHRpb25TdGF0dXM+IHtcbiAgICB0cnkge1xuICAgICAgLy8gQ2hlY2sgY2FjaGUgZmlyc3RcbiAgICAgIGNvbnN0IGNhY2hlZCA9IGF3YWl0IHRoaXMuZ2V0Q2FjaGVkU3RhdHVzKCk7XG4gICAgICBpZiAoY2FjaGVkICE9PSBudWxsICYmIHRoaXMuaXNDYWNoZVZhbGlkKGNhY2hlZC50aW1lc3RhbXApKSB7XG4gICAgICAgIHJldHVybiBjYWNoZWQuc3RhdHVzO1xuICAgICAgfVxuXG4gICAgICAvLyBGZXRjaCBmcm9tIEFQSVxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhcGkucmVxdWVzdDx7XG4gICAgICAgIGlzQWN0aXZlOiBib29sZWFuO1xuICAgICAgICBwbGFuOiBzdHJpbmc7XG4gICAgICAgIGZlYXR1cmVzOiBzdHJpbmdbXTtcbiAgICAgICAgZXhwaXJlc0F0Pzogc3RyaW5nO1xuICAgICAgICBhdXRvUmVuZXc6IGJvb2xlYW47XG4gICAgICAgIHN0cmlwZUN1c3RvbWVySWQ/OiBzdHJpbmc7XG4gICAgICAgIGN1cnJlbnRQZXJpb2RFbmQ/OiBzdHJpbmc7XG4gICAgICB9PihcIi9wcmVtaXVtL3N0YXR1c1wiKTtcblxuICAgICAgY29uc3Qgc3RhdHVzOiBTdWJzY3JpcHRpb25TdGF0dXMgPSB7XG4gICAgICAgIGlzQWN0aXZlOiByZXNwb25zZS5pc0FjdGl2ZSxcbiAgICAgICAgcGxhbjogcmVzcG9uc2UucGxhbixcbiAgICAgICAgZmVhdHVyZXM6IHJlc3BvbnNlLmZlYXR1cmVzLFxuICAgICAgICBhdXRvUmVuZXc6IHJlc3BvbnNlLmF1dG9SZW5ldyxcbiAgICAgICAgLi4uKHJlc3BvbnNlLmV4cGlyZXNBdCAhPT0gdW5kZWZpbmVkXG4gICAgICAgICAgPyB7IGV4cGlyZXNBdDogcmVzcG9uc2UuZXhwaXJlc0F0IH1cbiAgICAgICAgICA6IHt9KSxcbiAgICAgICAgLi4uKHJlc3BvbnNlLnN0cmlwZUN1c3RvbWVySWQgIT09IHVuZGVmaW5lZFxuICAgICAgICAgID8geyBzdHJpcGVDdXN0b21lcklkOiByZXNwb25zZS5zdHJpcGVDdXN0b21lcklkIH1cbiAgICAgICAgICA6IHt9KSxcbiAgICAgICAgLi4uKHJlc3BvbnNlLmN1cnJlbnRQZXJpb2RFbmQgIT09IHVuZGVmaW5lZFxuICAgICAgICAgID8geyBjdXJyZW50UGVyaW9kRW5kOiByZXNwb25zZS5jdXJyZW50UGVyaW9kRW5kIH1cbiAgICAgICAgICA6IHt9KSxcbiAgICAgIH07XG5cbiAgICAgIC8vIENhY2hlIHRoZSByZXN1bHRcbiAgICAgIGF3YWl0IHRoaXMuc2V0Q2FjaGVkU3RhdHVzKHN0YXR1cyk7XG5cbiAgICAgIGxvZ2dlci5pbmZvKFwiRmV0Y2hlZCBzdWJzY3JpcHRpb24gc3RhdHVzXCIsIHtcbiAgICAgICAgaXNBY3RpdmU6IHN0YXR1cy5pc0FjdGl2ZSxcbiAgICAgICAgcGxhbjogc3RhdHVzLnBsYW4sXG4gICAgICAgIGZlYXR1cmVzQ291bnQ6IHN0YXR1cy5mZWF0dXJlcy5sZW5ndGgsXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHN0YXR1cztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKFwiRmFpbGVkIHRvIGdldCBzdWJzY3JpcHRpb24gc3RhdHVzXCIsIHsgZXJyb3IgfSk7XG4gICAgICAvLyBSZXR1cm4gZGVmYXVsdCBmcmVlIHRpZXIgc3RhdHVzXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpc0FjdGl2ZTogZmFsc2UsXG4gICAgICAgIHBsYW46IFwiZnJlZVwiLFxuICAgICAgICBmZWF0dXJlczogW10sXG4gICAgICAgIGF1dG9SZW5ldzogZmFsc2UsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYXZhaWxhYmxlIHN1YnNjcmlwdGlvbiBwbGFuc1xuICAgKi9cbiAgZ2V0QXZhaWxhYmxlUGxhbnMoKTogU3Vic2NyaXB0aW9uUGxhbltdIHtcbiAgICByZXR1cm4gUHJlbWl1bVNlcnZpY2UuUExBTlM7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIFN0cmlwZSBjaGVja291dCBzZXNzaW9uXG4gICAqL1xuICBhc3luYyBjcmVhdGVDaGVja291dFNlc3Npb24oXG4gICAgcGxhbklkOiBzdHJpbmcsXG4gICAgc3VjY2Vzc1VybD86IHN0cmluZyxcbiAgICBjYW5jZWxVcmw/OiBzdHJpbmcsXG4gICk6IFByb21pc2U8eyBzZXNzaW9uSWQ6IHN0cmluZzsgdXJsOiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBwbGFuID0gUHJlbWl1bVNlcnZpY2UuUExBTlMuZmluZCgocCkgPT4gcC5pZCA9PT0gcGxhbklkKTtcbiAgICAgIGlmIChwbGFuID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHBsYW4gSUQ6ICR7cGxhbklkfWApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGFwaS5yZXF1ZXN0PHsgZGF0YTogeyBzZXNzaW9uSWQ6IHN0cmluZzsgdXJsOiBzdHJpbmcgfSB9PihcbiAgICAgICAgXCIvcHJlbWl1bS9zdWJzY3JpYmVcIixcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgcGxhbjogcGxhbklkLFxuICAgICAgICAgICAgaW50ZXJ2YWw6IHBsYW4uaW50ZXJ2YWwsXG4gICAgICAgICAgfSksXG4gICAgICAgIH0sXG4gICAgICApO1xuXG4gICAgICBsb2dnZXIuaW5mbyhcIkNyZWF0ZWQgY2hlY2tvdXQgc2Vzc2lvblwiLCB7XG4gICAgICAgIHBsYW5JZCxcbiAgICAgICAgc2Vzc2lvbklkOiByZXNwb25zZS5kYXRhLnNlc3Npb25JZCxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzZXNzaW9uSWQ6IHJlc3BvbnNlLmRhdGEuc2Vzc2lvbklkLFxuICAgICAgICB1cmw6IHJlc3BvbnNlLmRhdGEudXJsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIGNoZWNrb3V0IHNlc3Npb25cIiwgeyBlcnJvciwgcGxhbklkIH0pO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENhbmNlbCBzdWJzY3JpcHRpb25cbiAgICovXG4gIGFzeW5jIGNhbmNlbFN1YnNjcmlwdGlvbigpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZTogc3RyaW5nIH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhcGkucmVxdWVzdDx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PihcbiAgICAgICAgXCIvcHJlbWl1bS9jYW5jZWxcIixcbiAgICAgICAgeyBtZXRob2Q6IFwiUE9TVFwiIH0sXG4gICAgICApO1xuXG4gICAgICAvLyBDbGVhciBjYWNoZSB0byBmb3JjZSByZWZyZXNoXG4gICAgICBhd2FpdCB0aGlzLmNsZWFyQ2FjaGUoKTtcblxuICAgICAgbG9nZ2VyLmluZm8oXCJTdWJzY3JpcHRpb24gY2FuY2VsbGVkXCIsIHJlc3BvbnNlKTtcblxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoXCJGYWlsZWQgdG8gY2FuY2VsIHN1YnNjcmlwdGlvblwiLCB7IGVycm9yIH0pO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBwcmVtaXVtIGZlYXR1cmUgbGltaXRzIGJhc2VkIG9uIHN1YnNjcmlwdGlvblxuICAgKi9cbiAgYXN5bmMgZ2V0UHJlbWl1bUxpbWl0cygpOiBQcm9taXNlPFByZW1pdW1MaW1pdHM+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3RhdHVzID0gYXdhaXQgdGhpcy5nZXRTdWJzY3JpcHRpb25TdGF0dXMoKTtcblxuICAgICAgLy8gRGVmYXVsdCBmcmVlIHRpZXIgbGltaXRzXG4gICAgICBjb25zdCBsaW1pdHM6IFByZW1pdW1MaW1pdHMgPSB7XG4gICAgICAgIHN3aXBlc1BlckRheTogNTAsXG4gICAgICAgIGxpa2VzUGVyRGF5OiAxMDAsXG4gICAgICAgIHN1cGVyTGlrZXNQZXJEYXk6IDMsIC8vIEZyZWUgdXNlcnMgZ2V0IDMgcGVyIGRheVxuICAgICAgICBjYW5VbmRvU3dpcGVzOiBmYWxzZSxcbiAgICAgICAgY2FuU2VlV2hvTGlrZWQ6IGZhbHNlLFxuICAgICAgICBjYW5Cb29zdFByb2ZpbGU6IGZhbHNlLFxuICAgICAgICBhZHZhbmNlZEZpbHRlcnM6IGZhbHNlLFxuICAgICAgICBwcmlvcml0eU1hdGNoaW5nOiBmYWxzZSxcbiAgICAgICAgdW5saW1pdGVkUmV3aW5kOiBmYWxzZSxcbiAgICAgIH07XG5cbiAgICAgIC8vIFVwZ3JhZGUgbGltaXRzIGJhc2VkIG9uIHBsYW5cbiAgICAgIGlmIChzdGF0dXMuaXNBY3RpdmUpIHtcbiAgICAgICAgc3dpdGNoIChzdGF0dXMucGxhbi50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgY2FzZSBcImJhc2ljXCI6XG4gICAgICAgICAgICBsaW1pdHMuc3VwZXJMaWtlc1BlckRheSA9IDU7XG4gICAgICAgICAgICBsaW1pdHMuY2FuU2VlV2hvTGlrZWQgPSB0cnVlO1xuICAgICAgICAgICAgbGltaXRzLmFkdmFuY2VkRmlsdGVycyA9IHRydWU7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgXCJwcmVtaXVtXCI6XG4gICAgICAgICAgICBsaW1pdHMuc3VwZXJMaWtlc1BlckRheSA9IC0xOyAvLyBVbmxpbWl0ZWRcbiAgICAgICAgICAgIGxpbWl0cy5jYW5VbmRvU3dpcGVzID0gdHJ1ZTtcbiAgICAgICAgICAgIGxpbWl0cy5jYW5TZWVXaG9MaWtlZCA9IHRydWU7XG4gICAgICAgICAgICBsaW1pdHMuY2FuQm9vc3RQcm9maWxlID0gdHJ1ZTtcbiAgICAgICAgICAgIGxpbWl0cy5hZHZhbmNlZEZpbHRlcnMgPSB0cnVlO1xuICAgICAgICAgICAgbGltaXRzLnByaW9yaXR5TWF0Y2hpbmcgPSB0cnVlO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIFwidWx0aW1hdGVcIjpcbiAgICAgICAgICAgIGxpbWl0cy5zdXBlckxpa2VzUGVyRGF5ID0gLTE7IC8vIFVubGltaXRlZFxuICAgICAgICAgICAgbGltaXRzLmNhblVuZG9Td2lwZXMgPSB0cnVlO1xuICAgICAgICAgICAgbGltaXRzLmNhblNlZVdob0xpa2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIGxpbWl0cy5jYW5Cb29zdFByb2ZpbGUgPSB0cnVlO1xuICAgICAgICAgICAgbGltaXRzLmFkdmFuY2VkRmlsdGVycyA9IHRydWU7XG4gICAgICAgICAgICBsaW1pdHMucHJpb3JpdHlNYXRjaGluZyA9IHRydWU7XG4gICAgICAgICAgICBsaW1pdHMudW5saW1pdGVkUmV3aW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBsaW1pdHM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihcIkZhaWxlZCB0byBnZXQgcHJlbWl1bSBsaW1pdHNcIiwgeyBlcnJvciB9KTtcbiAgICAgIC8vIFJldHVybiBmcmVlIHRpZXIgbGltaXRzIG9uIGVycm9yXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzd2lwZXNQZXJEYXk6IDUwLFxuICAgICAgICBsaWtlc1BlckRheTogMTAwLFxuICAgICAgICBzdXBlckxpa2VzUGVyRGF5OiAzLFxuICAgICAgICBjYW5VbmRvU3dpcGVzOiBmYWxzZSxcbiAgICAgICAgY2FuU2VlV2hvTGlrZWQ6IGZhbHNlLFxuICAgICAgICBjYW5Cb29zdFByb2ZpbGU6IGZhbHNlLFxuICAgICAgICBhZHZhbmNlZEZpbHRlcnM6IGZhbHNlLFxuICAgICAgICBwcmlvcml0eU1hdGNoaW5nOiBmYWxzZSxcbiAgICAgICAgdW5saW1pdGVkUmV3aW5kOiBmYWxzZSxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHVzZXIgY2FuIHVzZSBhIHNwZWNpZmljIHByZW1pdW0gZmVhdHVyZVxuICAgKi9cbiAgYXN5bmMgY2FuVXNlRmVhdHVyZShmZWF0dXJlOiBrZXlvZiBQcmVtaXVtTGltaXRzKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGxpbWl0cyA9IGF3YWl0IHRoaXMuZ2V0UHJlbWl1bUxpbWl0cygpO1xuICAgICAgcmV0dXJuIGxpbWl0c1tmZWF0dXJlXSBhcyBib29sZWFuO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoXCJGYWlsZWQgdG8gY2hlY2sgZmVhdHVyZSBhY2Nlc3NcIiwgeyBlcnJvciwgZmVhdHVyZSB9KTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVHJhY2sgcHJlbWl1bSBmZWF0dXJlIHVzYWdlXG4gICAqL1xuICBhc3luYyB0cmFja1VzYWdlKGZlYXR1cmU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBhcGkucmVxdWVzdChcIi9wcmVtaXVtL3RyYWNrLXVzYWdlXCIsIHtcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBmZWF0dXJlLCB0aW1lc3RhbXA6IERhdGUubm93KCkgfSksXG4gICAgICB9KTtcblxuICAgICAgbG9nZ2VyLmluZm8oXCJQcmVtaXVtIGZlYXR1cmUgdXNhZ2UgdHJhY2tlZFwiLCB7IGZlYXR1cmUgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihcIkZhaWxlZCB0byB0cmFjayBwcmVtaXVtIHVzYWdlXCIsIHsgZXJyb3IsIGZlYXR1cmUgfSk7XG4gICAgICAvLyBEb24ndCB0aHJvdyAtIHRyYWNraW5nIGZhaWx1cmVzIHNob3VsZG4ndCBicmVhayB0aGUgdXNlciBleHBlcmllbmNlXG4gICAgfVxuICB9XG5cbiAgLy8gUHJpdmF0ZSBoZWxwZXIgbWV0aG9kc1xuXG4gIHByaXZhdGUgZ2V0Q2FjaGVkU3RhdHVzKCk6IFByb21pc2U8e1xuICAgIHN0YXR1czogU3Vic2NyaXB0aW9uU3RhdHVzO1xuICAgIHRpbWVzdGFtcDogbnVtYmVyO1xuICB9IHwgbnVsbD4ge1xuICAgIC8vIFRoaXMgd291bGQgdHlwaWNhbGx5IHVzZSBBc3luY1N0b3JhZ2Ugb3Igc2ltaWxhclxuICAgIC8vIEZvciBub3csIHJldHVybiBudWxsIHRvIGFsd2F5cyBmZXRjaCBmcmVzaCBkYXRhXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc2V0Q2FjaGVkU3RhdHVzKF9zdGF0dXM6IFN1YnNjcmlwdGlvblN0YXR1cyk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIENhY2hlIGltcGxlbWVudGF0aW9uIHdvdWxkIGdvIGhlcmVcbiAgICAvLyBGb3Igbm93LCBkbyBub3RoaW5nXG4gIH1cblxuICBwcml2YXRlIGlzQ2FjaGVWYWxpZCh0aW1lc3RhbXA6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIHJldHVybiBEYXRlLm5vdygpIC0gdGltZXN0YW1wIDwgUHJlbWl1bVNlcnZpY2UuQ0FDSEVfRFVSQVRJT047XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNsZWFyQ2FjaGUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gQ2xlYXIgY2FjaGUgaW1wbGVtZW50YXRpb24gd291bGQgZ28gaGVyZVxuICB9XG59XG5cbi8vIEV4cG9ydCBzaW5nbGV0b24gaW5zdGFuY2VcbmV4cG9ydCBjb25zdCBwcmVtaXVtU2VydmljZSA9IG5ldyBQcmVtaXVtU2VydmljZSgpO1xuZXhwb3J0IGRlZmF1bHQgcHJlbWl1bVNlcnZpY2U7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBSUEsSUFBQUEsS0FBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsSUFBQSxHQUFBRCxPQUFBO0FBQTRCLElBQUFFLHFCQUFBLEVBQUFDLHNCQUFBLEVBQUFDLHNCQUFBO0FBQUEsU0FBQUMsUUFBQUMsQ0FBQSxFQUFBQyxDQUFBLFFBQUFDLENBQUEsR0FBQUMsTUFBQSxDQUFBQyxJQUFBLENBQUFKLENBQUEsT0FBQUcsTUFBQSxDQUFBRSxxQkFBQSxRQUFBQyxDQUFBLEdBQUFILE1BQUEsQ0FBQUUscUJBQUEsQ0FBQUwsQ0FBQSxHQUFBQyxDQUFBLEtBQUFLLENBQUEsR0FBQUEsQ0FBQSxDQUFBQyxNQUFBLFdBQUFOLENBQUEsV0FBQUUsTUFBQSxDQUFBSyx3QkFBQSxDQUFBUixDQUFBLEVBQUFDLENBQUEsRUFBQVEsVUFBQSxPQUFBUCxDQUFBLENBQUFRLElBQUEsQ0FBQUMsS0FBQSxDQUFBVCxDQUFBLEVBQUFJLENBQUEsWUFBQUosQ0FBQTtBQUFBLFNBQUFVLGNBQUFaLENBQUEsYUFBQUMsQ0FBQSxNQUFBQSxDQUFBLEdBQUFZLFNBQUEsQ0FBQUMsTUFBQSxFQUFBYixDQUFBLFVBQUFDLENBQUEsV0FBQVcsU0FBQSxDQUFBWixDQUFBLElBQUFZLFNBQUEsQ0FBQVosQ0FBQSxRQUFBQSxDQUFBLE9BQUFGLE9BQUEsQ0FBQUksTUFBQSxDQUFBRCxDQUFBLE9BQUFhLE9BQUEsV0FBQWQsQ0FBQSxRQUFBZSxnQkFBQSxDQUFBQyxPQUFBLEVBQUFqQixDQUFBLEVBQUFDLENBQUEsRUFBQUMsQ0FBQSxDQUFBRCxDQUFBLFNBQUFFLE1BQUEsQ0FBQWUseUJBQUEsR0FBQWYsTUFBQSxDQUFBZ0IsZ0JBQUEsQ0FBQW5CLENBQUEsRUFBQUcsTUFBQSxDQUFBZSx5QkFBQSxDQUFBaEIsQ0FBQSxLQUFBSCxPQUFBLENBQUFJLE1BQUEsQ0FB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