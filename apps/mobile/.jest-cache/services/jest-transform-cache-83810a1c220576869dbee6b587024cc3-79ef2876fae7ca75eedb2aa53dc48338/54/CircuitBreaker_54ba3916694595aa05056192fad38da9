9e579a2cca3e3c5895f3057cd7f3c365
"use strict";
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));
var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));
var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));
var _wrapNativeSuper2 = _interopRequireDefault(require("@babel/runtime/helpers/wrapNativeSuper"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
function _callSuper(t, o, e) { return o = (0, _getPrototypeOf2.default)(o), (0, _possibleConstructorReturn2.default)(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], (0, _getPrototypeOf2.default)(t).constructor) : o.apply(t, e)); }
function _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.CircuitBreakerOpenError = exports.CircuitBreaker = exports.CircuitState = void 0;
var logger_1 = require("../utils/logger");
var CircuitState;
(function (CircuitState) {
  CircuitState["CLOSED"] = "CLOSED";
  CircuitState["OPEN"] = "OPEN";
  CircuitState["HALF_OPEN"] = "HALF_OPEN";
})(CircuitState || (exports.CircuitState = CircuitState = {}));
var DEFAULT_CONFIG = {
  failureThreshold: 5,
  successThreshold: 2,
  timeout: 60000,
  resetTimeout: 60000,
  monitoringPeriod: 60000
};
var CircuitBreaker = function () {
  function CircuitBreaker() {
    var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    (0, _classCallCheck2.default)(this, CircuitBreaker);
    this.state = CircuitState.CLOSED;
    this.failures = 0;
    this.successes = 0;
    this.stateChangedAt = Date.now();
    this.totalRequests = 0;
    this.config = _objectSpread(_objectSpread({}, DEFAULT_CONFIG), config);
    this.startHealthCheck();
  }
  return (0, _createClass2.default)(CircuitBreaker, [{
    key: "execute",
    value: (function () {
      var _execute = (0, _asyncToGenerator2.default)(function* (fn) {
        this.totalRequests++;
        if (this.state === CircuitState.OPEN) {
          if (Date.now() - this.stateChangedAt >= this.config.resetTimeout) {
            this.transitionTo(CircuitState.HALF_OPEN);
          } else {
            throw new CircuitBreakerOpenError('Circuit breaker is OPEN');
          }
        }
        try {
          var result = yield fn();
          this.onSuccess();
          return result;
        } catch (error) {
          this.onFailure();
          throw error;
        }
      });
      function execute(_x) {
        return _execute.apply(this, arguments);
      }
      return execute;
    }())
  }, {
    key: "isHealthy",
    value: function isHealthy() {
      return this.state === CircuitState.CLOSED;
    }
  }, {
    key: "getMetrics",
    value: function getMetrics() {
      return {
        failures: this.failures,
        successes: this.successes,
        totalRequests: this.totalRequests,
        lastFailureTime: this.lastFailureTime,
        lastSuccessTime: this.lastSuccessTime,
        state: this.state,
        stateChangedAt: this.stateChangedAt
      };
    }
  }, {
    key: "reset",
    value: function reset() {
      this.state = CircuitState.CLOSED;
      this.failures = 0;
      this.successes = 0;
      this.stateChangedAt = Date.now();
      logger_1.logger.info('Circuit breaker manually reset');
    }
  }, {
    key: "onSuccess",
    value: function onSuccess() {
      this.lastSuccessTime = Date.now();
      if (this.state === CircuitState.HALF_OPEN) {
        this.successes++;
        if (this.successes >= this.config.successThreshold) {
          this.transitionTo(CircuitState.CLOSED);
        }
      } else if (this.state === CircuitState.CLOSED) {
        if (this.lastFailureTime && Date.now() - this.lastFailureTime > this.config.monitoringPeriod) {
          this.failures = 0;
        }
      }
    }
  }, {
    key: "onFailure",
    value: function onFailure() {
      this.lastFailureTime = Date.now();
      if (this.state === CircuitState.HALF_OPEN) {
        this.transitionTo(CircuitState.OPEN);
      } else if (this.state === CircuitState.CLOSED) {
        this.failures++;
        if (this.failures >= this.config.failureThreshold) {
          this.transitionTo(CircuitState.OPEN);
        }
      }
    }
  }, {
    key: "transitionTo",
    value: function transitionTo(newState) {
      var oldState = this.state;
      this.state = newState;
      this.stateChangedAt = Date.now();
      logger_1.logger.info('Circuit breaker state transition', {
        from: oldState,
        to: newState,
        failures: this.failures,
        successes: this.successes
      });
      if (newState === CircuitState.CLOSED) {
        this.failures = 0;
        this.successes = 0;
      } else if (newState === CircuitState.HALF_OPEN) {
        this.successes = 0;
      }
    }
  }, {
    key: "startHealthCheck",
    value: function startHealthCheck() {
      var _this = this;
      if (!this.config.healthCheckInterval || !this.config.healthCheckEndpoint) {
        return;
      }
      this.healthCheckTimer = setInterval(function () {
        if (_this.state === CircuitState.OPEN) {
          _this.performHealthCheck();
        }
      }, this.config.healthCheckInterval);
    }
  }, {
    key: "performHealthCheck",
    value: (function () {
      var _performHealthCheck = (0, _asyncToGenerator2.default)(function* () {
        if (!this.config.healthCheckEndpoint) {
          return;
        }
        try {
          var response = yield fetch(this.config.healthCheckEndpoint, {
            method: 'GET',
            signal: AbortSignal.timeout(5000)
          });
          if (response.ok) {
            this.transitionTo(CircuitState.HALF_OPEN);
          }
        } catch (error) {
          logger_1.logger.debug('Health check failed', {
            error: error
          });
        }
      });
      function performHealthCheck() {
        return _performHealthCheck.apply(this, arguments);
      }
      return performHealthCheck;
    }())
  }, {
    key: "destroy",
    value: function destroy() {
      if (this.healthCheckTimer) {
        clearInterval(this.healthCheckTimer);
      }
    }
  }]);
}();
exports.CircuitBreaker = CircuitBreaker;
var CircuitBreakerOpenError = function (_Error) {
  function CircuitBreakerOpenError(message) {
    var _this2;
    (0, _classCallCheck2.default)(this, CircuitBreakerOpenError);
    _this2 = _callSuper(this, CircuitBreakerOpenError, [message]);
    _this2.name = 'CircuitBreakerOpenError';
    return _this2;
  }
  (0, _inherits2.default)(CircuitBreakerOpenError, _Error);
  return (0, _createClass2.default)(CircuitBreakerOpenError);
}((0, _wrapNativeSuper2.default)(Error));
exports.CircuitBreakerOpenError = CircuitBreakerOpenError;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuMiIsIl9nZXRQcm90b3R5cGVPZjIiLCJfaW5oZXJpdHMyIiwiX3dyYXBOYXRpdmVTdXBlcjIiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJfZGVmaW5lUHJvcGVydHkyIiwiX2NsYXNzQ2FsbENoZWNrMiIsIl9jcmVhdGVDbGFzczIiLCJfY2FsbFN1cGVyIiwidCIsIm8iLCJlIiwiZGVmYXVsdCIsIl9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QiLCJSZWZsZWN0IiwiY29uc3RydWN0IiwiY29uc3RydWN0b3IiLCJhcHBseSIsIkJvb2xlYW4iLCJwcm90b3R5cGUiLCJ2YWx1ZU9mIiwiY2FsbCIsIm93bktleXMiLCJyIiwiT2JqZWN0Iiwia2V5cyIsImdldE93blByb3BlcnR5U3ltYm9scyIsImZpbHRlciIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJwdXNoIiwiX29iamVjdFNwcmVhZCIsImFyZ3VtZW50cyIsImxlbmd0aCIsImZvckVhY2giLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzIiwiZGVmaW5lUHJvcGVydGllcyIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiQ2lyY3VpdEJyZWFrZXJPcGVuRXJyb3IiLCJDaXJjdWl0QnJlYWtlciIsIkNpcmN1aXRTdGF0ZSIsImxvZ2dlcl8xIiwiREVGQVVMVF9DT05GSUciLCJmYWlsdXJlVGhyZXNob2xkIiwic3VjY2Vzc1RocmVzaG9sZCIsInRpbWVvdXQiLCJyZXNldFRpbWVvdXQiLCJtb25pdG9yaW5nUGVyaW9kIiwiY29uZmlnIiwidW5kZWZpbmVkIiwic3RhdGUiLCJDTE9TRUQiLCJmYWlsdXJlcyIsInN1Y2Nlc3NlcyIsInN0YXRlQ2hhbmdlZEF0IiwiRGF0ZSIsIm5vdyIsInRvdGFsUmVxdWVzdHMiLCJzdGFydEhlYWx0aENoZWNrIiwia2V5IiwiX2V4ZWN1dGUiLCJmbiIsIk9QRU4iLCJ0cmFuc2l0aW9uVG8iLCJIQUxGX09QRU4iLCJyZXN1bHQiLCJvblN1Y2Nlc3MiLCJlcnJvciIsIm9uRmFpbHVyZSIsImV4ZWN1dGUiLCJfeCIsImlzSGVhbHRoeSIsImdldE1ldHJpY3MiLCJsYXN0RmFpbHVyZVRpbWUiLCJsYXN0U3VjY2Vzc1RpbWUiLCJyZXNldCIsImxvZ2dlciIsImluZm8iLCJuZXdTdGF0ZSIsIm9sZFN0YXRlIiwiZnJvbSIsInRvIiwiX3RoaXMiLCJoZWFsdGhDaGVja0ludGVydmFsIiwiaGVhbHRoQ2hlY2tFbmRwb2ludCIsImhlYWx0aENoZWNrVGltZXIiLCJzZXRJbnRlcnZhbCIsInBlcmZvcm1IZWFsdGhDaGVjayIsIl9wZXJmb3JtSGVhbHRoQ2hlY2siLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwic2lnbmFsIiwiQWJvcnRTaWduYWwiLCJvayIsImRlYnVnIiwiZGVzdHJveSIsImNsZWFySW50ZXJ2YWwiLCJfRXJyb3IiLCJtZXNzYWdlIiwiX3RoaXMyIiwibmFtZSIsIkVycm9yIl0sInNvdXJjZXMiOlsiQ2lyY3VpdEJyZWFrZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG4vKipcbiAqIENpcmN1aXQgQnJlYWtlciBQYXR0ZXJuIEltcGxlbWVudGF0aW9uXG4gKiBQcmV2ZW50cyBjYXNjYWRpbmcgZmFpbHVyZXMgYnkgc3RvcHBpbmcgcmVxdWVzdHMgd2hlbiBzZXJ2aWNlIGlzIGRvd25cbiAqL1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5DaXJjdWl0QnJlYWtlck9wZW5FcnJvciA9IGV4cG9ydHMuQ2lyY3VpdEJyZWFrZXIgPSBleHBvcnRzLkNpcmN1aXRTdGF0ZSA9IHZvaWQgMDtcbmNvbnN0IGxvZ2dlcl8xID0gcmVxdWlyZShcIi4uL3V0aWxzL2xvZ2dlclwiKTtcbnZhciBDaXJjdWl0U3RhdGU7XG4oZnVuY3Rpb24gKENpcmN1aXRTdGF0ZSkge1xuICAgIENpcmN1aXRTdGF0ZVtcIkNMT1NFRFwiXSA9IFwiQ0xPU0VEXCI7XG4gICAgQ2lyY3VpdFN0YXRlW1wiT1BFTlwiXSA9IFwiT1BFTlwiO1xuICAgIENpcmN1aXRTdGF0ZVtcIkhBTEZfT1BFTlwiXSA9IFwiSEFMRl9PUEVOXCI7IC8vIFRlc3RpbmcgaWYgc2VydmljZSByZWNvdmVyZWRcbn0pKENpcmN1aXRTdGF0ZSB8fCAoZXhwb3J0cy5DaXJjdWl0U3RhdGUgPSBDaXJjdWl0U3RhdGUgPSB7fSkpO1xuY29uc3QgREVGQVVMVF9DT05GSUcgPSB7XG4gICAgZmFpbHVyZVRocmVzaG9sZDogNSxcbiAgICBzdWNjZXNzVGhyZXNob2xkOiAyLFxuICAgIHRpbWVvdXQ6IDYwMDAwLFxuICAgIHJlc2V0VGltZW91dDogNjAwMDAsXG4gICAgbW9uaXRvcmluZ1BlcmlvZDogNjAwMDAsXG59O1xuY2xhc3MgQ2lyY3VpdEJyZWFrZXIge1xuICAgIGNvbmZpZztcbiAgICBzdGF0ZSA9IENpcmN1aXRTdGF0ZS5DTE9TRUQ7XG4gICAgZmFpbHVyZXMgPSAwO1xuICAgIHN1Y2Nlc3NlcyA9IDA7XG4gICAgbGFzdEZhaWx1cmVUaW1lO1xuICAgIGxhc3RTdWNjZXNzVGltZTtcbiAgICBzdGF0ZUNoYW5nZWRBdCA9IERhdGUubm93KCk7XG4gICAgdG90YWxSZXF1ZXN0cyA9IDA7XG4gICAgaGVhbHRoQ2hlY2tUaW1lcjtcbiAgICBjb25zdHJ1Y3Rvcihjb25maWcgPSB7fSkge1xuICAgICAgICB0aGlzLmNvbmZpZyA9IHsgLi4uREVGQVVMVF9DT05GSUcsIC4uLmNvbmZpZyB9O1xuICAgICAgICB0aGlzLnN0YXJ0SGVhbHRoQ2hlY2soKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXhlY3V0ZSBhIHJlcXVlc3QgdGhyb3VnaCB0aGUgY2lyY3VpdCBicmVha2VyXG4gICAgICovXG4gICAgYXN5bmMgZXhlY3V0ZShmbikge1xuICAgICAgICB0aGlzLnRvdGFsUmVxdWVzdHMrKztcbiAgICAgICAgLy8gQ2hlY2sgaWYgY2lyY3VpdCBpcyBvcGVuXG4gICAgICAgIGlmICh0aGlzLnN0YXRlID09PSBDaXJjdWl0U3RhdGUuT1BFTikge1xuICAgICAgICAgICAgaWYgKERhdGUubm93KCkgLSB0aGlzLnN0YXRlQ2hhbmdlZEF0ID49IHRoaXMuY29uZmlnLnJlc2V0VGltZW91dCkge1xuICAgICAgICAgICAgICAgIHRoaXMudHJhbnNpdGlvblRvKENpcmN1aXRTdGF0ZS5IQUxGX09QRU4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IENpcmN1aXRCcmVha2VyT3BlbkVycm9yKCdDaXJjdWl0IGJyZWFrZXIgaXMgT1BFTicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBmbigpO1xuICAgICAgICAgICAgLy8gUmVjb3JkIHN1Y2Nlc3NcbiAgICAgICAgICAgIHRoaXMub25TdWNjZXNzKCk7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgLy8gUmVjb3JkIGZhaWx1cmVcbiAgICAgICAgICAgIHRoaXMub25GYWlsdXJlKCk7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiBjaXJjdWl0IGlzIGhlYWx0aHlcbiAgICAgKi9cbiAgICBpc0hlYWx0aHkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlID09PSBDaXJjdWl0U3RhdGUuQ0xPU0VEO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgY3VycmVudCBtZXRyaWNzXG4gICAgICovXG4gICAgZ2V0TWV0cmljcygpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGZhaWx1cmVzOiB0aGlzLmZhaWx1cmVzLFxuICAgICAgICAgICAgc3VjY2Vzc2VzOiB0aGlzLnN1Y2Nlc3NlcyxcbiAgICAgICAgICAgIHRvdGFsUmVxdWVzdHM6IHRoaXMudG90YWxSZXF1ZXN0cyxcbiAgICAgICAgICAgIGxhc3RGYWlsdXJlVGltZTogdGhpcy5sYXN0RmFpbHVyZVRpbWUsXG4gICAgICAgICAgICBsYXN0U3VjY2Vzc1RpbWU6IHRoaXMubGFzdFN1Y2Nlc3NUaW1lLFxuICAgICAgICAgICAgc3RhdGU6IHRoaXMuc3RhdGUsXG4gICAgICAgICAgICBzdGF0ZUNoYW5nZWRBdDogdGhpcy5zdGF0ZUNoYW5nZWRBdCxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTWFudWFsbHkgcmVzZXQgY2lyY3VpdCBicmVha2VyXG4gICAgICovXG4gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBDaXJjdWl0U3RhdGUuQ0xPU0VEO1xuICAgICAgICB0aGlzLmZhaWx1cmVzID0gMDtcbiAgICAgICAgdGhpcy5zdWNjZXNzZXMgPSAwO1xuICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlZEF0ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgbG9nZ2VyXzEubG9nZ2VyLmluZm8oJ0NpcmN1aXQgYnJlYWtlciBtYW51YWxseSByZXNldCcpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgc3VjY2Vzc2Z1bCByZXF1ZXN0XG4gICAgICovXG4gICAgb25TdWNjZXNzKCkge1xuICAgICAgICB0aGlzLmxhc3RTdWNjZXNzVGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlID09PSBDaXJjdWl0U3RhdGUuSEFMRl9PUEVOKSB7XG4gICAgICAgICAgICB0aGlzLnN1Y2Nlc3NlcysrO1xuICAgICAgICAgICAgaWYgKHRoaXMuc3VjY2Vzc2VzID49IHRoaXMuY29uZmlnLnN1Y2Nlc3NUaHJlc2hvbGQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zaXRpb25UbyhDaXJjdWl0U3RhdGUuQ0xPU0VEKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLnN0YXRlID09PSBDaXJjdWl0U3RhdGUuQ0xPU0VEKSB7XG4gICAgICAgICAgICAvLyBSZXNldCBmYWlsdXJlIGNvdW50IGFmdGVyIG1vbml0b3JpbmcgcGVyaW9kXG4gICAgICAgICAgICBpZiAodGhpcy5sYXN0RmFpbHVyZVRpbWUgJiZcbiAgICAgICAgICAgICAgICBEYXRlLm5vdygpIC0gdGhpcy5sYXN0RmFpbHVyZVRpbWUgPiB0aGlzLmNvbmZpZy5tb25pdG9yaW5nUGVyaW9kKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mYWlsdXJlcyA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogSGFuZGxlIGZhaWxlZCByZXF1ZXN0XG4gICAgICovXG4gICAgb25GYWlsdXJlKCkge1xuICAgICAgICB0aGlzLmxhc3RGYWlsdXJlVGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlID09PSBDaXJjdWl0U3RhdGUuSEFMRl9PUEVOKSB7XG4gICAgICAgICAgICAvLyBTaW5nbGUgZmFpbHVyZSBpbiBoYWxmLW9wZW4gc3RhdGUgb3BlbnMgY2lyY3VpdFxuICAgICAgICAgICAgdGhpcy50cmFuc2l0aW9uVG8oQ2lyY3VpdFN0YXRlLk9QRU4pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuc3RhdGUgPT09IENpcmN1aXRTdGF0ZS5DTE9TRUQpIHtcbiAgICAgICAgICAgIHRoaXMuZmFpbHVyZXMrKztcbiAgICAgICAgICAgIGlmICh0aGlzLmZhaWx1cmVzID49IHRoaXMuY29uZmlnLmZhaWx1cmVUaHJlc2hvbGQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zaXRpb25UbyhDaXJjdWl0U3RhdGUuT1BFTik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogVHJhbnNpdGlvbiB0byBhIG5ldyBzdGF0ZVxuICAgICAqL1xuICAgIHRyYW5zaXRpb25UbyhuZXdTdGF0ZSkge1xuICAgICAgICBjb25zdCBvbGRTdGF0ZSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBuZXdTdGF0ZTtcbiAgICAgICAgdGhpcy5zdGF0ZUNoYW5nZWRBdCA9IERhdGUubm93KCk7XG4gICAgICAgIGxvZ2dlcl8xLmxvZ2dlci5pbmZvKCdDaXJjdWl0IGJyZWFrZXIgc3RhdGUgdHJhbnNpdGlvbicsIHtcbiAgICAgICAgICAgIGZyb206IG9sZFN0YXRlLFxuICAgICAgICAgICAgdG86IG5ld1N0YXRlLFxuICAgICAgICAgICAgZmFpbHVyZXM6IHRoaXMuZmFpbHVyZXMsXG4gICAgICAgICAgICBzdWNjZXNzZXM6IHRoaXMuc3VjY2Vzc2VzLFxuICAgICAgICB9KTtcbiAgICAgICAgLy8gUmVzZXQgY291bnRlcnMgb24gc3RhdGUgY2hhbmdlXG4gICAgICAgIGlmIChuZXdTdGF0ZSA9PT0gQ2lyY3VpdFN0YXRlLkNMT1NFRCkge1xuICAgICAgICAgICAgdGhpcy5mYWlsdXJlcyA9IDA7XG4gICAgICAgICAgICB0aGlzLnN1Y2Nlc3NlcyA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobmV3U3RhdGUgPT09IENpcmN1aXRTdGF0ZS5IQUxGX09QRU4pIHtcbiAgICAgICAgICAgIHRoaXMuc3VjY2Vzc2VzID0gMDtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBTdGFydCBwZXJpb2RpYyBoZWFsdGggY2hlY2tzXG4gICAgICovXG4gICAgc3RhcnRIZWFsdGhDaGVjaygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmNvbmZpZy5oZWFsdGhDaGVja0ludGVydmFsIHx8ICF0aGlzLmNvbmZpZy5oZWFsdGhDaGVja0VuZHBvaW50KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5oZWFsdGhDaGVja1RpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUgPT09IENpcmN1aXRTdGF0ZS5PUEVOKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wZXJmb3JtSGVhbHRoQ2hlY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcy5jb25maWcuaGVhbHRoQ2hlY2tJbnRlcnZhbCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBlcmZvcm0gaGVhbHRoIGNoZWNrXG4gICAgICovXG4gICAgYXN5bmMgcGVyZm9ybUhlYWx0aENoZWNrKCkge1xuICAgICAgICBpZiAoIXRoaXMuY29uZmlnLmhlYWx0aENoZWNrRW5kcG9pbnQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh0aGlzLmNvbmZpZy5oZWFsdGhDaGVja0VuZHBvaW50LCB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICBzaWduYWw6IEFib3J0U2lnbmFsLnRpbWVvdXQoNTAwMCksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICAgIC8vIFNlcnZpY2UgaXMgaGVhbHRoeSwgdHJhbnNpdGlvbiB0byBoYWxmLW9wZW5cbiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zaXRpb25UbyhDaXJjdWl0U3RhdGUuSEFMRl9PUEVOKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGxvZ2dlcl8xLmxvZ2dlci5kZWJ1ZygnSGVhbHRoIGNoZWNrIGZhaWxlZCcsIHsgZXJyb3IgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2xlYW51cCByZXNvdXJjZXNcbiAgICAgKi9cbiAgICBkZXN0cm95KCkge1xuICAgICAgICBpZiAodGhpcy5oZWFsdGhDaGVja1RpbWVyKSB7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaGVhbHRoQ2hlY2tUaW1lcik7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnRzLkNpcmN1aXRCcmVha2VyID0gQ2lyY3VpdEJyZWFrZXI7XG5jbGFzcyBDaXJjdWl0QnJlYWtlck9wZW5FcnJvciBleHRlbmRzIEVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgICAgICB0aGlzLm5hbWUgPSAnQ2lyY3VpdEJyZWFrZXJPcGVuRXJyb3InO1xuICAgIH1cbn1cbmV4cG9ydHMuQ2lyY3VpdEJyZWFrZXJPcGVuRXJyb3IgPSBDaXJjdWl0QnJlYWtlck9wZW5FcnJvcjtcbiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWTtBQUFDLElBQUFBLHNCQUFBLEdBQUFDLE9BQUE7QUFBQSxJQUFBQywyQkFBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQUEsSUFBQUUsZ0JBQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUFBLElBQUFHLFVBQUEsR0FBQUosc0JBQUEsQ0FBQUMsT0FBQTtBQUFBLElBQUFJLGlCQUFBLEdBQUFMLHNCQUFBLENBQUFDLE9BQUE7QUFBQSxJQUFBSyxrQkFBQSxHQUFBTixzQkFBQSxDQUFBQyxPQUFBO0FBQUEsSUFBQU0sZ0JBQUEsR0FBQVAsc0JBQUEsQ0FBQUMsT0FBQTtBQUFBLElBQUFPLGdCQUFBLEdBQUFSLHNCQUFBLENBQUFDLE9BQUE7QUFBQSxJQUFBUSxhQUFBLEdBQUFULHNCQUFBLENBQUFDLE9BQUE7QUFBQSxTQUFBUyxXQUFBQyxDQUFBLEVBQUFDLENBQUEsRUFBQUMsQ0FBQSxXQUFBRCxDQUFBLE9BQUFULGdCQUFBLENBQUFXLE9BQUEsRUFBQUYsQ0FBQSxPQUFBViwyQkFBQSxDQUFBWSxPQUFBLEVBQUFILENBQUEsRUFBQUkseUJBQUEsS0FBQUMsT0FBQSxDQUFB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