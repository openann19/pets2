{"version":3,"names":["_core","require","_AuthService","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty2","default","getOwnPropertyDescriptors","defineProperties","defineProperty","LeaderboardService","_process$env$EXPO_PUB","_classCallCheck2","cache","Map","cacheExpiration","baseUrl","process","env","_createClass2","key","value","_getLeaderboard","_asyncToGenerator2","undefined","page","limit","cacheKey","JSON","stringify","toString","cached","getCachedData","params","URLSearchParams","response","fetch","method","headers","Authorization","getAuthToken","ok","Error","status","statusText","data","json","setCachedData","error","logger","getLeaderboard","_getUserRank","category","getUserRank","_x","_getCategories","getCategories","_getUserBadges","getUserBadges","_getPetStats","petId","getPetStats","_x2","_updateScore","points","reason","body","clearCacheByPattern","updateScore","_x3","_x4","_x5","_x6","_getLeaderboardHistory","period","weeks","getLeaderboardHistory","_x7","_getNearbyLeaders","latitude","longitude","radius","getNearbyLeaders","_x8","_x9","_getAchievementProgress","getAchievementProgress","_shareAchievement","badgeId","platform","shareUrl","shareAchievement","_x0","_x1","get","Date","now","timestamp","set","pattern","includes","delete","_getAuthToken","token","authService","getAccessToken","clearCache","clear","_default","exports"],"sources":["LeaderboardService.ts"],"sourcesContent":["/**\n * Leaderboard Service\n * Comprehensive leaderboard system for mobile app matching web functionality\n */\n\nimport { logger } from \"@pawfectmatch/core\";\nimport { authService } from \"./AuthService\";\n\nexport interface LeaderboardEntry {\n  id: string;\n  userId: string;\n  petId: string;\n  petName: string;\n  petImage: string;\n  ownerName: string;\n  score: number;\n  rank: number;\n  category: LeaderboardCategory;\n  badges: Badge[];\n  stats: LeaderboardStats;\n  lastUpdated: number;\n}\n\nexport interface LeaderboardStats {\n  matches: number;\n  likes: number;\n  superLikes: number;\n  messages: number;\n  profileViews: number;\n  daysActive: number;\n  streak: number;\n  achievements: number;\n}\n\nexport interface Badge {\n  id: string;\n  name: string;\n  description: string;\n  icon: string;\n  color: string;\n  earnedAt: number;\n  rarity: \"common\" | \"rare\" | \"epic\" | \"legendary\";\n}\n\nexport interface LeaderboardCategory {\n  id: string;\n  name: string;\n  description: string;\n  icon: string;\n  color: string;\n  period: \"daily\" | \"weekly\" | \"monthly\" | \"all_time\";\n  isActive: boolean;\n}\n\nexport interface LeaderboardFilter {\n  category?: string;\n  period?: \"daily\" | \"weekly\" | \"monthly\" | \"all_time\";\n  location?: {\n    latitude: number;\n    longitude: number;\n    radius: number; // in kilometers\n  };\n  ageRange?: {\n    min: number;\n    max: number;\n  };\n  breed?: string;\n  gender?: \"male\" | \"female\" | \"all\";\n}\n\nexport interface LeaderboardResponse {\n  entries: LeaderboardEntry[];\n  total: number;\n  page: number;\n  limit: number;\n  hasMore: boolean;\n  userRank?: number;\n  userEntry?: LeaderboardEntry;\n}\n\nclass LeaderboardService {\n  private baseUrl: string;\n  private cache = new Map<string, { data: unknown; timestamp: number }>();\n  private cacheExpiration: number = 5 * 60 * 1000; // 5 minutes\n\n  constructor() {\n    this.baseUrl =\n      process.env[\"EXPO_PUBLIC_API_URL\"] ?? \"https://api.pawfectmatch.com\";\n  }\n\n  /**\n   * Get leaderboard entries\n   */\n  async getLeaderboard(\n    filter: LeaderboardFilter = {},\n    page = 1,\n    limit = 20,\n  ): Promise<LeaderboardResponse> {\n    try {\n      const cacheKey = `leaderboard-${JSON.stringify(filter)}-${page.toString()}-${limit.toString()}`;\n      const cached = this.getCachedData(cacheKey) as LeaderboardResponse | null;\n\n      if (cached !== null) {\n        return cached;\n      }\n\n      // Cache was checked above, continue with API call\n\n      const params = new URLSearchParams({\n        page: page.toString(),\n        limit: limit.toString(),\n        ...(filter as Record<string, string>),\n      });\n\n      const response = await fetch(\n        `${this.baseUrl}/api/leaderboard?${params.toString()}`,\n        {\n          method: \"GET\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${await this.getAuthToken()}`,\n          },\n        },\n      );\n\n      if (!response.ok) {\n        throw new Error(\n          `HTTP ${response.status.toString()}: ${response.statusText}`,\n        );\n      }\n\n      const data = (await response.json()) as LeaderboardResponse;\n      this.setCachedData(cacheKey, data);\n\n      return data;\n    } catch (error) {\n      logger.error(\"Failed to get leaderboard\", { error });\n      throw error;\n    }\n  }\n\n  /**\n   * Get user's rank and entry\n   */\n  async getUserRank(\n    category?: string,\n  ): Promise<{ rank: number; entry: LeaderboardEntry | null }> {\n    try {\n      const cacheKey = `user-rank-${category ?? \"all\"}`;\n      const cached = this.getCachedData(cacheKey) as {\n        rank: number;\n        entry: LeaderboardEntry | null;\n      } | null;\n\n      if (cached !== null) {\n        return cached;\n      }\n\n      const params = category !== undefined ? `?category=${category}` : \"\";\n      const response = await fetch(\n        `${this.baseUrl}/api/leaderboard/user-rank${params}`,\n        {\n          method: \"GET\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${await this.getAuthToken()}`,\n          },\n        },\n      );\n\n      if (!response.ok) {\n        throw new Error(\n          `HTTP ${response.status.toString()}: ${response.statusText}`,\n        );\n      }\n\n      const data = (await response.json()) as {\n        rank: number;\n        entry: LeaderboardEntry | null;\n      };\n      this.setCachedData(cacheKey, data);\n\n      return data;\n    } catch (error) {\n      logger.error(\"Failed to get user rank\", { error });\n      throw error;\n    }\n  }\n\n  /**\n   * Get available categories\n   */\n  async getCategories(): Promise<LeaderboardCategory[]> {\n    try {\n      const cacheKey = \"leaderboard-categories\";\n      const cached = this.getCachedData(cacheKey) as\n        | LeaderboardCategory[]\n        | null;\n\n      if (cached !== null) {\n        return cached;\n      }\n\n      const response = await fetch(\n        `${this.baseUrl}/api/leaderboard/categories`,\n        {\n          method: \"GET\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${await this.getAuthToken()}`,\n          },\n        },\n      );\n\n      if (!response.ok) {\n        throw new Error(\n          `HTTP ${response.status.toString()}: ${response.statusText}`,\n        );\n      }\n\n      const data = (await response.json()) as LeaderboardCategory[];\n      this.setCachedData(cacheKey, data);\n\n      return data;\n    } catch (error) {\n      logger.error(\"Failed to get categories\", { error });\n      throw error;\n    }\n  }\n\n  /**\n   * Get user's badges\n   */\n  async getUserBadges(): Promise<Badge[]> {\n    try {\n      const cacheKey = \"user-badges\";\n      const cached = this.getCachedData(cacheKey) as Badge[] | null;\n\n      if (cached !== null) {\n        return cached;\n      }\n\n      const response = await fetch(`${this.baseUrl}/api/leaderboard/badges`, {\n        method: \"GET\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${await this.getAuthToken()}`,\n        },\n      });\n\n      if (!response.ok) {\n        throw new Error(\n          `HTTP ${response.status.toString()}: ${response.statusText}`,\n        );\n      }\n\n      const data = (await response.json()) as Badge[];\n      this.setCachedData(cacheKey, data);\n\n      return data;\n    } catch (error) {\n      logger.error(\"Failed to get user badges\", { error });\n      throw error;\n    }\n  }\n\n  /**\n   * Get leaderboard stats for a specific pet\n   */\n  async getPetStats(petId: string): Promise<LeaderboardStats> {\n    try {\n      const cacheKey = `pet-stats-${petId}`;\n      const cached = this.getCachedData(cacheKey) as LeaderboardStats | null;\n\n      if (cached !== null) {\n        return cached;\n      }\n\n      const response = await fetch(\n        `${this.baseUrl}/api/leaderboard/pet/${petId}/stats`,\n        {\n          method: \"GET\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${await this.getAuthToken()}`,\n          },\n        },\n      );\n\n      if (!response.ok) {\n        throw new Error(\n          `HTTP ${response.status.toString()}: ${response.statusText}`,\n        );\n      }\n\n      const data = (await response.json()) as LeaderboardStats;\n      this.setCachedData(cacheKey, data);\n\n      return data;\n    } catch (error) {\n      logger.error(\"Failed to get pet stats\", { error });\n      throw error;\n    }\n  }\n\n  /**\n   * Update leaderboard score\n   */\n  async updateScore(\n    petId: string,\n    category: string,\n    points: number,\n    reason: string,\n  ): Promise<void> {\n    try {\n      const response = await fetch(\n        `${this.baseUrl}/api/leaderboard/update-score`,\n        {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${await this.getAuthToken()}`,\n          },\n          body: JSON.stringify({\n            petId,\n            category,\n            points,\n            reason,\n          }),\n        },\n      );\n\n      if (!response.ok) {\n        throw new Error(\n          `HTTP ${response.status.toString()}: ${response.statusText}`,\n        );\n      }\n\n      // Clear relevant cache entries\n      this.clearCacheByPattern(\"leaderboard\");\n      this.clearCacheByPattern(\"user-rank\");\n      this.clearCacheByPattern(`pet-stats-${petId}`);\n    } catch (error) {\n      logger.error(\"Failed to update score\", { error });\n      throw error;\n    }\n  }\n\n  /**\n   * Get leaderboard history\n   */\n  async getLeaderboardHistory(\n    category: string,\n    period: \"daily\" | \"weekly\" | \"monthly\" = \"weekly\",\n    weeks = 4,\n  ): Promise<{ date: string; rank: number; score: number }[]> {\n    try {\n      const cacheKey = `leaderboard-history-${category}-${period}-${weeks.toString()}`;\n      const cached = this.getCachedData(cacheKey) as\n        | { date: string; rank: number; score: number }[]\n        | null;\n\n      if (cached !== null) {\n        return cached;\n      }\n\n      const params = new URLSearchParams({\n        category,\n        period,\n        weeks: weeks.toString(),\n      });\n\n      const response = await fetch(\n        `${this.baseUrl}/api/leaderboard/history?${params.toString()}`,\n        {\n          method: \"GET\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${await this.getAuthToken()}`,\n          },\n        },\n      );\n\n      if (!response.ok) {\n        throw new Error(\n          `HTTP ${response.status.toString()}: ${response.statusText}`,\n        );\n      }\n\n      const data = (await response.json()) as {\n        date: string;\n        rank: number;\n        score: number;\n      }[];\n      this.setCachedData(cacheKey, data);\n\n      return data;\n    } catch (error) {\n      logger.error(\"Failed to get leaderboard history\", { error });\n      throw error;\n    }\n  }\n\n  /**\n   * Get nearby leaders\n   */\n  async getNearbyLeaders(\n    latitude: number,\n    longitude: number,\n    radius = 10,\n  ): Promise<LeaderboardEntry[]> {\n    try {\n      const cacheKey = `nearby-leaders-${latitude.toString()}-${longitude.toString()}-${radius.toString()}`;\n      const cached = this.getCachedData(cacheKey) as LeaderboardEntry[] | null;\n\n      if (cached !== null) {\n        return cached;\n      }\n\n      const params = new URLSearchParams({\n        latitude: latitude.toString(),\n        longitude: longitude.toString(),\n        radius: radius.toString(),\n      });\n\n      const response = await fetch(\n        `${this.baseUrl}/api/leaderboard/nearby?${params.toString()}`,\n        {\n          method: \"GET\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${await this.getAuthToken()}`,\n          },\n        },\n      );\n\n      if (!response.ok) {\n        throw new Error(\n          `HTTP ${response.status.toString()}: ${response.statusText}`,\n        );\n      }\n\n      const data = (await response.json()) as LeaderboardEntry[];\n      this.setCachedData(cacheKey, data);\n\n      return data;\n    } catch (error) {\n      logger.error(\"Failed to get nearby leaders\", { error });\n      throw error;\n    }\n  }\n\n  /**\n   * Get achievement progress\n   */\n  async getAchievementProgress(): Promise<{\n    completed: Badge[];\n    inProgress: {\n      badge: Badge;\n      progress: number;\n      target: number;\n    }[];\n  }> {\n    try {\n      const cacheKey = \"achievement-progress\";\n      const cached = this.getCachedData(cacheKey) as {\n        completed: Badge[];\n        inProgress: {\n          badge: Badge;\n          progress: number;\n          target: number;\n        }[];\n      } | null;\n\n      if (cached !== null) {\n        return cached;\n      }\n\n      const response = await fetch(\n        `${this.baseUrl}/api/leaderboard/achievements/progress`,\n        {\n          method: \"GET\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${await this.getAuthToken()}`,\n          },\n        },\n      );\n\n      if (!response.ok) {\n        throw new Error(\n          `HTTP ${response.status.toString()}: ${response.statusText}`,\n        );\n      }\n\n      const data = (await response.json()) as {\n        completed: Badge[];\n        inProgress: {\n          badge: Badge;\n          progress: number;\n          target: number;\n        }[];\n      };\n      this.setCachedData(cacheKey, data);\n\n      return data;\n    } catch (error) {\n      logger.error(\"Failed to get achievement progress\", { error });\n      throw error;\n    }\n  }\n\n  /**\n   * Share leaderboard achievement\n   */\n  async shareAchievement(\n    badgeId: string,\n    platform: \"facebook\" | \"twitter\" | \"instagram\",\n  ): Promise<string> {\n    try {\n      const response = await fetch(`${this.baseUrl}/api/leaderboard/share`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${await this.getAuthToken()}`,\n        },\n        body: JSON.stringify({\n          badgeId,\n          platform,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(\n          `HTTP ${response.status.toString()}: ${response.statusText}`,\n        );\n      }\n\n      const data = (await response.json()) as { shareUrl: string };\n      return data.shareUrl;\n    } catch (error) {\n      logger.error(\"Failed to share achievement\", { error });\n      throw error;\n    }\n  }\n\n  /**\n   * Get cached data\n   */\n  private getCachedData(key: string): unknown {\n    const cached = this.cache.get(key);\n    if (\n      cached !== undefined &&\n      Date.now() - cached.timestamp < this.cacheExpiration\n    ) {\n      return cached.data;\n    }\n    return null;\n  }\n\n  /**\n   * Set cached data\n   */\n  private setCachedData(key: string, data: unknown): void {\n    this.cache.set(key, {\n      data,\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Clear cache by pattern\n   */\n  private clearCacheByPattern(pattern: string): void {\n    for (const key of this.cache.keys()) {\n      if (key.includes(pattern)) {\n        this.cache.delete(key);\n      }\n    }\n  }\n\n  /**\n   * Get auth token\n   */\n  private async getAuthToken(): Promise<string> {\n    const token = await authService.getAccessToken();\n    if (token === null) {\n      throw new Error(\"Authentication required for leaderboard access\");\n    }\n    return token;\n  }\n\n  /**\n   * Clear all cache\n   */\n  clearCache(): void {\n    this.cache.clear();\n  }\n}\n\nexport default new LeaderboardService();\n"],"mappings":"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","ignoreList":[]}