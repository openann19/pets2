{"version":3,"names":["_react","require","_asyncStorage","_interopRequireDefault","_logger","usePersistedState","_ref","key","initialValue","_ref$enabled","enabled","_useState","useState","_useState2","_slicedToArray2","default","value","setValueState","_useState3","_useState4","isLoading","setIsLoading","useEffect","load","_ref2","_asyncToGenerator2","saved","AsyncStorage","getItem","JSON","parse","error","err","Error","String","logger","apply","arguments","setValue","useCallback","newValue","setItem","stringify","clearStorage","removeItem"],"sources":["usePersistedState.ts"],"sourcesContent":["import { useCallback, useEffect, useState } from \"react\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport { logger } from \"../../services/logger\";\n\nexport interface UsePersistedStateOptions<T> {\n  key: string;\n  initialValue: T;\n  enabled?: boolean;\n}\n\nexport interface UsePersistedStateReturn<T> {\n  value: T;\n  setValue: (value: T) => void;\n  isLoading: boolean;\n  clearStorage: () => Promise<void>;\n}\n\n/**\n * Hook for persisting state to AsyncStorage\n *\n * @example\n * const { value, setValue } = usePersistedState({\n *   key: 'user_preferences',\n *   initialValue: { theme: 'light' }\n * });\n */\nexport function usePersistedState<T>({\n  key,\n  initialValue,\n  enabled = true,\n}: UsePersistedStateOptions<T>): UsePersistedStateReturn<T> {\n  const [value, setValueState] = useState<T>(initialValue);\n  const [isLoading, setIsLoading] = useState(enabled);\n\n  // Load from storage on mount\n  useEffect(() => {\n    const load = async () => {\n      if (!enabled) {\n        setIsLoading(false);\n        return;\n      }\n\n      try {\n        const saved = await AsyncStorage.getItem(key);\n        if (saved !== null) {\n          setValueState(JSON.parse(saved));\n        }\n      } catch (error: unknown) {\n        const err = error instanceof Error ? error : new Error(String(error));\n        logger.error('Failed to load persisted state', { key, error: err });\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    void load();\n  }, [key, enabled]);\n\n  // Save to storage when value changes\n  const setValue = useCallback(\n    (newValue: T) => {\n      setValueState(newValue);\n\n      if (!enabled) return;\n\n      try {\n        void AsyncStorage.setItem(key, JSON.stringify(newValue));\n      } catch (error: unknown) {\n        const err = error instanceof Error ? error : new Error(String(error));\n        logger.error('Failed to persist state', { key, error: err });\n      }\n    },\n    [key, enabled],\n  );\n\n  const clearStorage = useCallback(async () => {\n    try {\n      await AsyncStorage.removeItem(key);\n      setValueState(initialValue);\n    } catch (error: unknown) {\n      const err = error instanceof Error ? error : new Error(String(error));\n      logger.error('Failed to clear persisted state', { key, error: err });\n    }\n  }, [key, initialValue]);\n\n  return {\n    value,\n    setValue,\n    isLoading,\n    clearStorage,\n  };\n}\n"],"mappings":"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","ignoreList":[]}