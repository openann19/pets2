5e3795a9ade0ba9fd72a9da81c524d3b
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
var infoLog = require("../Utilities/infoLog");
var invariant = require('invariant');
var DEBUG = false;
var TaskQueue = function () {
  function TaskQueue(_ref) {
    var onMoreTasks = _ref.onMoreTasks;
    (0, _classCallCheck2.default)(this, TaskQueue);
    this._onMoreTasks = onMoreTasks;
    this._queueStack = [{
      tasks: [],
      popable: false
    }];
  }
  return (0, _createClass2.default)(TaskQueue, [{
    key: "enqueue",
    value: function enqueue(task) {
      this._getCurrentQueue().push(task);
    }
  }, {
    key: "enqueueTasks",
    value: function enqueueTasks(tasks) {
      var _this = this;
      tasks.forEach(function (task) {
        return _this.enqueue(task);
      });
    }
  }, {
    key: "cancelTasks",
    value: function cancelTasks(tasksToCancel) {
      this._queueStack = this._queueStack.map(function (queue) {
        return _objectSpread(_objectSpread({}, queue), {}, {
          tasks: queue.tasks.filter(function (task) {
            return tasksToCancel.indexOf(task) === -1;
          })
        });
      }).filter(function (queue, idx) {
        return queue.tasks.length > 0 || idx === 0;
      });
    }
  }, {
    key: "hasTasksToProcess",
    value: function hasTasksToProcess() {
      return this._getCurrentQueue().length > 0;
    }
  }, {
    key: "processNext",
    value: function processNext() {
      var queue = this._getCurrentQueue();
      if (queue.length) {
        var task = queue.shift();
        try {
          if (typeof task === 'object' && task.gen) {
            DEBUG && infoLog('TaskQueue: genPromise for task ' + task.name);
            this._genPromise(task);
          } else if (typeof task === 'object' && task.run) {
            DEBUG && infoLog('TaskQueue: run task ' + task.name);
            task.run();
          } else {
            invariant(typeof task === 'function', 'Expected Function, SimpleTask, or PromiseTask, but got:\n' + JSON.stringify(task, null, 2));
            DEBUG && infoLog('TaskQueue: run anonymous task');
            task();
          }
        } catch (e) {
          e.message = 'TaskQueue: Error with task ' + (task.name || '') + ': ' + e.message;
          throw e;
        }
      }
    }
  }, {
    key: "_getCurrentQueue",
    value: function _getCurrentQueue() {
      var stackIdx = this._queueStack.length - 1;
      var queue = this._queueStack[stackIdx];
      if (queue.popable && queue.tasks.length === 0 && this._queueStack.length > 1) {
        this._queueStack.pop();
        DEBUG && infoLog('TaskQueue: popped queue: ', {
          stackIdx: stackIdx,
          queueStackSize: this._queueStack.length
        });
        return this._getCurrentQueue();
      } else {
        return queue.tasks;
      }
    }
  }, {
    key: "_genPromise",
    value: function _genPromise(task) {
      var _this2 = this;
      this._queueStack.push({
        tasks: [],
        popable: false
      });
      var stackIdx = this._queueStack.length - 1;
      var stackItem = this._queueStack[stackIdx];
      DEBUG && infoLog('TaskQueue: push new queue: ', {
        stackIdx: stackIdx
      });
      DEBUG && infoLog('TaskQueue: exec gen task ' + task.name);
      task.gen().then(function () {
        DEBUG && infoLog('TaskQueue: onThen for gen task ' + task.name, {
          stackIdx: stackIdx,
          queueStackSize: _this2._queueStack.length
        });
        stackItem.popable = true;
        _this2.hasTasksToProcess() && _this2._onMoreTasks();
      }).catch(function (ex) {
        setTimeout(function () {
          ex.message = `TaskQueue: Error resolving Promise in task ${task.name}: ${ex.message}`;
          throw ex;
        }, 0);
      });
    }
  }]);
}();
module.exports = TaskQueue;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9kZWZpbmVQcm9wZXJ0eTIiLCJfY2xhc3NDYWxsQ2hlY2syIiwiX2NyZWF0ZUNsYXNzMiIsIm93bktleXMiLCJlIiwiciIsInQiLCJPYmplY3QiLCJrZXlzIiwiZ2V0T3duUHJvcGVydHlTeW1ib2xzIiwibyIsImZpbHRlciIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJwdXNoIiwiYXBwbHkiLCJfb2JqZWN0U3ByZWFkIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiZm9yRWFjaCIsImRlZmF1bHQiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzIiwiZGVmaW5lUHJvcGVydGllcyIsImRlZmluZVByb3BlcnR5IiwiaW5mb0xvZyIsImludmFyaWFudCIsIkRFQlVHIiwiVGFza1F1ZXVlIiwiX3JlZiIsIm9uTW9yZVRhc2tzIiwiX29uTW9yZVRhc2tzIiwiX3F1ZXVlU3RhY2siLCJ0YXNrcyIsInBvcGFibGUiLCJrZXkiLCJ2YWx1ZSIsImVucXVldWUiLCJ0YXNrIiwiX2dldEN1cnJlbnRRdWV1ZSIsImVucXVldWVUYXNrcyIsIl90aGlzIiwiY2FuY2VsVGFza3MiLCJ0YXNrc1RvQ2FuY2VsIiwibWFwIiwicXVldWUiLCJpbmRleE9mIiwiaWR4IiwiaGFzVGFza3NUb1Byb2Nlc3MiLCJwcm9jZXNzTmV4dCIsInNoaWZ0IiwiZ2VuIiwibmFtZSIsIl9nZW5Qcm9taXNlIiwicnVuIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1lc3NhZ2UiLCJzdGFja0lkeCIsInBvcCIsInF1ZXVlU3RhY2tTaXplIiwiX3RoaXMyIiwic3RhY2tJdGVtIiwidGhlbiIsImNhdGNoIiwiZXgiLCJzZXRUaW1lb3V0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIlRhc2tRdWV1ZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgTWV0YSBQbGF0Zm9ybXMsIEluYy4gYW5kIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZvcm1hdFxuICogQGZsb3cgc3RyaWN0XG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBpbmZvTG9nID0gcmVxdWlyZSgnLi4vVXRpbGl0aWVzL2luZm9Mb2cnKTtcbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ludmFyaWFudCcpO1xuXG50eXBlIFNpbXBsZVRhc2sgPSB7XG4gIG5hbWU6IHN0cmluZyxcbiAgcnVuOiAoKSA9PiB2b2lkLFxufTtcbnR5cGUgUHJvbWlzZVRhc2sgPSB7XG4gIG5hbWU6IHN0cmluZyxcbiAgZ2VuOiAoKSA9PiBQcm9taXNlPHZvaWQ+LFxufTtcbmV4cG9ydCB0eXBlIFRhc2sgPSBTaW1wbGVUYXNrIHwgUHJvbWlzZVRhc2sgfCAoKCkgPT4gdm9pZCk7XG5cbmNvbnN0IERFQlVHOiBmYWxzZSA9IGZhbHNlO1xuXG4vKipcbiAqIFRhc2tRdWV1ZSAtIEEgc3lzdGVtIGZvciBxdWV1ZWluZyBhbmQgZXhlY3V0aW5nIGEgbWl4IG9mIHNpbXBsZSBjYWxsYmFja3MgYW5kXG4gKiB0cmVlcyBvZiBkZXBlbmRlbnQgdGFza3MgYmFzZWQgb24gUHJvbWlzZXMuIE5vIHRhc2tzIGFyZSBleGVjdXRlZCB1bmxlc3NcbiAqIGBwcm9jZXNzTmV4dGAgaXMgY2FsbGVkLlxuICpcbiAqIGBlbnF1ZXVlYCB0YWtlcyBhIFRhc2sgb2JqZWN0IHdpdGggZWl0aGVyIGEgc2ltcGxlIGBydW5gIGNhbGxiYWNrLCBvciBhXG4gKiBgZ2VuYCBmdW5jdGlvbiB0aGF0IHJldHVybnMgYSBgUHJvbWlzZWAgYW5kIHB1dHMgaXQgaW4gdGhlIHF1ZXVlLiAgSWYgYSBnZW5cbiAqIGZ1bmN0aW9uIGlzIHN1cHBsaWVkLCB0aGVuIHRoZSBwcm9taXNlIGl0IHJldHVybnMgd2lsbCBibG9jayBleGVjdXRpb24gb2ZcbiAqIHRhc2tzIGFscmVhZHkgaW4gdGhlIHF1ZXVlIHVudGlsIGl0IHJlc29sdmVzLiBUaGlzIGNhbiBiZSB1c2VkIHRvIG1ha2Ugc3VyZVxuICogdGhlIGZpcnN0IHRhc2sgaXMgZnVsbHkgcmVzb2x2ZWQgKGluY2x1ZGluZyBhc3luY2hyb25vdXMgZGVwZW5kZW5jaWVzIHRoYXRcbiAqIGFsc28gc2NoZWR1bGUgbW9yZSB0YXNrcyB2aWEgYGVucXVldWVgKSBiZWZvcmUgc3RhcnRpbmcgb24gdGhlIG5leHQgdGFzay5cbiAqIFRoZSBgb25Nb3JlVGFza3NgIGNvbnN0cnVjdG9yIGFyZ3VtZW50IGlzIHVzZWQgdG8gaW5mb3JtIHRoZSBvd25lciB0aGF0IGFuXG4gKiBhc3luYyB0YXNrIGhhcyByZXNvbHZlZCBhbmQgdGhhdCB0aGUgcXVldWUgc2hvdWxkIGJlIHByb2Nlc3NlZCBhZ2Fpbi5cbiAqXG4gKiBOb3RlOiBUYXNrcyBhcmUgb25seSBhY3R1YWxseSBleGVjdXRlZCB3aXRoIGV4cGxpY2l0IGNhbGxzIHRvIGBwcm9jZXNzTmV4dGAuXG4gKi9cbmNsYXNzIFRhc2tRdWV1ZSB7XG4gIC8qKlxuICAgKiBUYXNrUXVldWUgaW5zdGFuY2VzIGFyZSBzZWxmIGNvbnRhaW5lZCBhbmQgaW5kZXBlbmRlbnQsIHNvIG11bHRpcGxlIHRhc2tzXG4gICAqIG9mIHZhcnlpbmcgc2VtYW50aWNzIGFuZCBwcmlvcml0eSBjYW4gb3BlcmF0ZSB0b2dldGhlci5cbiAgICpcbiAgICogYG9uTW9yZVRhc2tzYCBpcyBpbnZva2VkIHdoZW4gYFByb21pc2VUYXNrYHMgcmVzb2x2ZSBpZiB0aGVyZSBhcmUgbW9yZVxuICAgKiB0YXNrcyB0byBwcm9jZXNzLlxuICAgKi9cbiAgY29uc3RydWN0b3Ioe29uTW9yZVRhc2tzfToge29uTW9yZVRhc2tzOiAoKSA9PiB2b2lkLCAuLi59KSB7XG4gICAgdGhpcy5fb25Nb3JlVGFza3MgPSBvbk1vcmVUYXNrcztcbiAgICB0aGlzLl9xdWV1ZVN0YWNrID0gW3t0YXNrczogW10sIHBvcGFibGU6IGZhbHNlfV07XG4gIH1cblxuICAvKipcbiAgICogQWRkIGEgdGFzayB0byB0aGUgcXVldWUuICBJdCBpcyByZWNvbW1lbmRlZCB0byBuYW1lIHlvdXIgdGFza3MgZm9yIGVhc2llclxuICAgKiBhc3luYyBkZWJ1Z2dpbmcuIFRhc2tzIHdpbGwgbm90IGJlIGV4ZWN1dGVkIHVudGlsIGBwcm9jZXNzTmV4dGAgaXMgY2FsbGVkXG4gICAqIGV4cGxpY2l0bHkuXG4gICAqL1xuICBlbnF1ZXVlKHRhc2s6IFRhc2spOiB2b2lkIHtcbiAgICB0aGlzLl9nZXRDdXJyZW50UXVldWUoKS5wdXNoKHRhc2spO1xuICB9XG5cbiAgZW5xdWV1ZVRhc2tzKHRhc2tzOiBBcnJheTxUYXNrPik6IHZvaWQge1xuICAgIHRhc2tzLmZvckVhY2godGFzayA9PiB0aGlzLmVucXVldWUodGFzaykpO1xuICB9XG5cbiAgY2FuY2VsVGFza3ModGFza3NUb0NhbmNlbDogQXJyYXk8VGFzaz4pOiB2b2lkIHtcbiAgICAvLyBzZWFyY2ggdGhyb3VnaCBhbGwgdGFza3MgYW5kIHJlbW92ZSB0aGVtLlxuICAgIHRoaXMuX3F1ZXVlU3RhY2sgPSB0aGlzLl9xdWV1ZVN0YWNrXG4gICAgICAubWFwKHF1ZXVlID0+ICh7XG4gICAgICAgIC4uLnF1ZXVlLFxuICAgICAgICB0YXNrczogcXVldWUudGFza3MuZmlsdGVyKHRhc2sgPT4gdGFza3NUb0NhbmNlbC5pbmRleE9mKHRhc2spID09PSAtMSksXG4gICAgICB9KSlcbiAgICAgIC5maWx0ZXIoKHF1ZXVlLCBpZHgpID0+IHF1ZXVlLnRhc2tzLmxlbmd0aCA+IDAgfHwgaWR4ID09PSAwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayB0byBzZWUgaWYgYHByb2Nlc3NOZXh0YCBzaG91bGQgYmUgY2FsbGVkLlxuICAgKlxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyB0cnVlIGlmIHRoZXJlIGFyZSB0YXNrcyB0aGF0IGFyZSByZWFkeSB0byBiZVxuICAgKiBwcm9jZXNzZWQgd2l0aCBgcHJvY2Vzc05leHRgLCBvciByZXR1cm5zIGZhbHNlIGlmIHRoZXJlIGFyZSBubyBtb3JlIHRhc2tzXG4gICAqIHRvIGJlIHByb2Nlc3NlZCByaWdodCBub3csIGFsdGhvdWdoIHRoZXJlIG1heSBiZSB0YXNrcyBpbiB0aGUgcXVldWUgdGhhdFxuICAgKiBhcmUgYmxvY2tlZCBieSBlYXJsaWVyIGBQcm9taXNlVGFza2BzIHRoYXQgaGF2ZW4ndCByZXNvbHZlZCB5ZXQuXG4gICAqIGBvbk1vcmVUYXNrc2Agd2lsbCBiZSBjYWxsZWQgYWZ0ZXIgZWFjaCBgUHJvbWlzZVRhc2tgIHJlc29sdmVzIGlmIHRoZXJlIGFyZVxuICAgKiB0YXNrcyByZWFkeSB0byBydW4gYXQgdGhhdCBwb2ludC5cbiAgICovXG4gIGhhc1Rhc2tzVG9Qcm9jZXNzKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9nZXRDdXJyZW50UXVldWUoKS5sZW5ndGggPiAwO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGVzIHRoZSBuZXh0IHRhc2sgaW4gdGhlIHF1ZXVlLlxuICAgKi9cbiAgcHJvY2Vzc05leHQoKTogdm9pZCB7XG4gICAgY29uc3QgcXVldWUgPSB0aGlzLl9nZXRDdXJyZW50UXVldWUoKTtcbiAgICBpZiAocXVldWUubGVuZ3RoKSB7XG4gICAgICBjb25zdCB0YXNrID0gcXVldWUuc2hpZnQoKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmICh0eXBlb2YgdGFzayA9PT0gJ29iamVjdCcgJiYgdGFzay5nZW4pIHtcbiAgICAgICAgICBERUJVRyAmJiBpbmZvTG9nKCdUYXNrUXVldWU6IGdlblByb21pc2UgZm9yIHRhc2sgJyArIHRhc2submFtZSk7XG4gICAgICAgICAgdGhpcy5fZ2VuUHJvbWlzZSh0YXNrKTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdGFzayA9PT0gJ29iamVjdCcgJiYgdGFzay5ydW4pIHtcbiAgICAgICAgICBERUJVRyAmJiBpbmZvTG9nKCdUYXNrUXVldWU6IHJ1biB0YXNrICcgKyB0YXNrLm5hbWUpO1xuICAgICAgICAgIHRhc2sucnVuKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaW52YXJpYW50KFxuICAgICAgICAgICAgdHlwZW9mIHRhc2sgPT09ICdmdW5jdGlvbicsXG4gICAgICAgICAgICAnRXhwZWN0ZWQgRnVuY3Rpb24sIFNpbXBsZVRhc2ssIG9yIFByb21pc2VUYXNrLCBidXQgZ290OlxcbicgK1xuICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh0YXNrLCBudWxsLCAyKSxcbiAgICAgICAgICApO1xuICAgICAgICAgIERFQlVHICYmIGluZm9Mb2coJ1Rhc2tRdWV1ZTogcnVuIGFub255bW91cyB0YXNrJyk7XG4gICAgICAgICAgdGFzaygpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGUubWVzc2FnZSA9XG4gICAgICAgICAgJ1Rhc2tRdWV1ZTogRXJyb3Igd2l0aCB0YXNrICcgKyAodGFzay5uYW1lIHx8ICcnKSArICc6ICcgKyBlLm1lc3NhZ2U7XG4gICAgICAgIHRocm93IGU7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgX3F1ZXVlU3RhY2s6IEFycmF5PHtcbiAgICB0YXNrczogQXJyYXk8VGFzaz4sXG4gICAgcG9wYWJsZTogYm9vbGVhbixcbiAgICAuLi5cbiAgfT47XG4gIF9vbk1vcmVUYXNrczogKCkgPT4gdm9pZDtcblxuICBfZ2V0Q3VycmVudFF1ZXVlKCk6IEFycmF5PFRhc2s+IHtcbiAgICBjb25zdCBzdGFja0lkeCA9IHRoaXMuX3F1ZXVlU3RhY2subGVuZ3RoIC0gMTtcbiAgICBjb25zdCBxdWV1ZSA9IHRoaXMuX3F1ZXVlU3RhY2tbc3RhY2tJZHhdO1xuICAgIGlmIChcbiAgICAgIHF1ZXVlLnBvcGFibGUgJiZcbiAgICAgIHF1ZXVlLnRhc2tzLmxlbmd0aCA9PT0gMCAmJlxuICAgICAgdGhpcy5fcXVldWVTdGFjay5sZW5ndGggPiAxXG4gICAgKSB7XG4gICAgICB0aGlzLl9xdWV1ZVN0YWNrLnBvcCgpO1xuICAgICAgREVCVUcgJiZcbiAgICAgICAgaW5mb0xvZygnVGFza1F1ZXVlOiBwb3BwZWQgcXVldWU6ICcsIHtcbiAgICAgICAgICBzdGFja0lkeCxcbiAgICAgICAgICBxdWV1ZVN0YWNrU2l6ZTogdGhpcy5fcXVldWVTdGFjay5sZW5ndGgsXG4gICAgICAgIH0pO1xuICAgICAgcmV0dXJuIHRoaXMuX2dldEN1cnJlbnRRdWV1ZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gcXVldWUudGFza3M7XG4gICAgfVxuICB9XG5cbiAgX2dlblByb21pc2UodGFzazogUHJvbWlzZVRhc2spIHtcbiAgICAvLyBFYWNoIGFzeW5jIHRhc2sgcHVzaGVzIGl0J3Mgb3duIHF1ZXVlIG9udG8gdGhlIHF1ZXVlIHN0YWNrLiBUaGlzXG4gICAgLy8gZWZmZWN0aXZlbHkgZGVmZXJzIGV4ZWN1dGlvbiBvZiBwcmV2aW91c2x5IHF1ZXVlZCB0YXNrcyB1bnRpbCB0aGUgcHJvbWlzZVxuICAgIC8vIHJlc29sdmVzLCBhdCB3aGljaCBwb2ludCB3ZSBhbGxvdyB0aGUgbmV3IHF1ZXVlIHRvIGJlIHBvcHBlZCwgd2hpY2hcbiAgICAvLyBoYXBwZW5zIG9uY2UgaXQgaXMgZnVsbHkgcHJvY2Vzc2VkLlxuICAgIHRoaXMuX3F1ZXVlU3RhY2sucHVzaCh7dGFza3M6IFtdLCBwb3BhYmxlOiBmYWxzZX0pO1xuICAgIGNvbnN0IHN0YWNrSWR4ID0gdGhpcy5fcXVldWVTdGFjay5sZW5ndGggLSAxO1xuICAgIGNvbnN0IHN0YWNrSXRlbSA9IHRoaXMuX3F1ZXVlU3RhY2tbc3RhY2tJZHhdO1xuICAgIERFQlVHICYmIGluZm9Mb2coJ1Rhc2tRdWV1ZTogcHVzaCBuZXcgcXVldWU6ICcsIHtzdGFja0lkeH0pO1xuICAgIERFQlVHICYmIGluZm9Mb2coJ1Rhc2tRdWV1ZTogZXhlYyBnZW4gdGFzayAnICsgdGFzay5uYW1lKTtcbiAgICB0YXNrXG4gICAgICAuZ2VuKClcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgREVCVUcgJiZcbiAgICAgICAgICBpbmZvTG9nKCdUYXNrUXVldWU6IG9uVGhlbiBmb3IgZ2VuIHRhc2sgJyArIHRhc2submFtZSwge1xuICAgICAgICAgICAgc3RhY2tJZHgsXG4gICAgICAgICAgICBxdWV1ZVN0YWNrU2l6ZTogdGhpcy5fcXVldWVTdGFjay5sZW5ndGgsXG4gICAgICAgICAgfSk7XG4gICAgICAgIHN0YWNrSXRlbS5wb3BhYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5oYXNUYXNrc1RvUHJvY2VzcygpICYmIHRoaXMuX29uTW9yZVRhc2tzKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGV4ID0+IHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgZXgubWVzc2FnZSA9IGBUYXNrUXVldWU6IEVycm9yIHJlc29sdmluZyBQcm9taXNlIGluIHRhc2sgJHt0YXNrLm5hbWV9OiAke2V4Lm1lc3NhZ2V9YDtcbiAgICAgICAgICB0aHJvdyBleDtcbiAgICAgICAgfSwgMCk7XG4gICAgICB9KTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFRhc2tRdWV1ZTtcbiJdLCJtYXBwaW5ncyI6IkFBVUEsWUFBWTs7QUFBQyxJQUFBQSxzQkFBQSxHQUFBQyxPQUFBO0FBQUEsSUFBQUMsZ0JBQUEsR0FBQUYsc0JBQUEsQ0FBQUMsT0FBQTtBQUFBLElBQUFFLGdCQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUE7QUFBQSxJQUFBRyxhQUFBLEdBQUFKLHNCQUFBLENBQUFDLE9BQUE7QUFBQSxTQUFBSSxRQUFBQyxDQUFBLEVBQUFDLENBQUEsUUFBQUMsQ0FBQSxHQUFBQyxNQUFBLENBQUFDLElBQUEsQ0FBQUosQ0FBQSxPQUFBRyxNQUFBLENBQUFFLHFCQUFBLFFBQUFDLENBQUEsR0FBQUgsTUFBQSxDQUFBRSxxQkFBQSxD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