4ac77f64451dbb5f790f34245a00601c
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.chatService = void 0;
exports.sendVoiceNoteNative = sendVoiceNoteNative;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _core = require("@pawfectmatch/core");
var _api = require("./api");
var FileSystem = _interopRequireWildcard(require("expo-file-system"));
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function _interopRequireWildcard(e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (var _t in e) "default" !== _t && {}.hasOwnProperty.call(e, _t) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, _t)) && (i.get || i.set) ? o(f, _t, i) : f[_t] = e[_t]); return f; })(e, t); }
var ChatService = function () {
  function ChatService() {
    (0, _classCallCheck2.default)(this, ChatService);
  }
  return (0, _createClass2.default)(ChatService, [{
    key: "sendReaction",
    value: (function () {
      var _sendReaction = (0, _asyncToGenerator2.default)(function* (matchId, messageId, reaction) {
        try {
          var response = yield (0, _api.request)("/chat/reactions", {
            method: "POST",
            body: {
              matchId: matchId,
              messageId: messageId,
              reaction: reaction
            }
          });
          _core.logger.info("Reaction sent successfully", {
            matchId: matchId,
            messageId: messageId,
            reaction: reaction
          });
          return response;
        } catch (error) {
          _core.logger.error("Failed to send reaction", {
            error: error,
            matchId: matchId,
            messageId: messageId,
            reaction: reaction
          });
          throw error;
        }
      });
      function sendReaction(_x, _x2, _x3) {
        return _sendReaction.apply(this, arguments);
      }
      return sendReaction;
    }())
  }, {
    key: "sendAttachment",
    value: (function () {
      var _sendAttachment = (0, _asyncToGenerator2.default)(function* (params) {
        try {
          var formData = new FormData();
          formData.append("file", params.file);
          formData.append("matchId", params.matchId);
          formData.append("type", params.attachmentType);
          if (params.name) {
            formData.append("name", params.name);
          }
          var response = yield (0, _api.request)("/chat/attachments", {
            method: "POST",
            body: formData,
            headers: {}
          });
          _core.logger.info("Attachment sent successfully", {
            params: params
          });
          return response;
        } catch (error) {
          _core.logger.error("Failed to send attachment", {
            error: error,
            params: params
          });
          throw error;
        }
      });
      function sendAttachment(_x4) {
        return _sendAttachment.apply(this, arguments);
      }
      return sendAttachment;
    }())
  }, {
    key: "sendVoiceNote",
    value: function () {
      var _sendVoiceNote = (0, _asyncToGenerator2.default)(function* (matchIdOrParams, file, duration) {
        try {
          var formData;
          var _matchId;
          var voiceDuration;
          if (typeof matchIdOrParams === "string") {
            _matchId = matchIdOrParams;
            if (file instanceof FormData) {
              formData = file;
              formData.append("matchId", _matchId);
            } else if (file instanceof Blob) {
              formData = new FormData();
              var audioFile = new File([file], "voice-note.webm", {
                type: "audio/webm"
              });
              formData.append("audioBlob", audioFile);
              formData.append("matchId", _matchId);
            } else {
              throw new Error("Invalid file type");
            }
            voiceDuration = duration || 0;
          } else {
            var _params = matchIdOrParams;
            _matchId = _params.matchId;
            formData = new FormData();
            var _audioFile = new File([_params.audioBlob], "voice-note.m4a", {
              type: "audio/m4a"
            });
            formData.append("audioBlob", _audioFile);
            formData.append("matchId", _matchId);
            formData.append("duration", String(_params.duration));
            voiceDuration = _params.duration;
          }
          var response = yield (0, _api.request)("/api/chat/voice", {
            method: "POST",
            body: formData,
            headers: {}
          });
          _core.logger.info("Voice note sent successfully", {
            matchId: _matchId,
            duration: voiceDuration
          });
          if (typeof matchIdOrParams !== "string") {
            return response;
          }
        } catch (error) {
          _core.logger.error("Failed to send voice note", {
            error: error,
            matchIdOrParams: matchIdOrParams
          });
          throw error;
        }
      });
      function sendVoiceNote(_x5, _x6, _x7) {
        return _sendVoiceNote.apply(this, arguments);
      }
      return sendVoiceNote;
    }()
  }]);
}();
var chatService = exports.chatService = new ChatService();
function sendVoiceNoteNative(_x8, _x9) {
  return _sendVoiceNoteNative.apply(this, arguments);
}
function _sendVoiceNoteNative() {
  _sendVoiceNoteNative = (0, _asyncToGenerator2.default)(function* (matchId, p) {
    var presign = yield (0, _api.request)("/api/chat/voice/presign", {
      method: "POST",
      body: {
        contentType: "audio/webm"
      }
    });
    var url = presign.url,
      key = presign.key;
    yield FileSystem.uploadAsync(url, p.fileUri, {
      httpMethod: "PUT",
      headers: {
        "Content-Type": "audio/webm"
      },
      uploadType: FileSystem.FileSystemUploadType.BINARY_CONTENT
    });
    yield (0, _api.request)(`/api/chat/${matchId}/voice-note`, {
      method: "POST",
      body: {
        key: key,
        duration: p.duration,
        waveform: []
      }
    });
  });
  return _sendVoiceNoteNative.apply(this, arguments);
}
Object.assign(chatService, {
  sendVoiceNoteNative: sendVoiceNoteNative
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfY29yZSIsInJlcXVpcmUiLCJfYXBpIiwiRmlsZVN5c3RlbSIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwiZSIsInQiLCJXZWFrTWFwIiwiciIsIm4iLCJfX2VzTW9kdWxlIiwibyIsImkiLCJmIiwiX19wcm90b19fIiwiZGVmYXVsdCIsImhhcyIsImdldCIsInNldCIsIl90IiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJDaGF0U2VydmljZSIsIl9jbGFzc0NhbGxDaGVjazIiLCJfY3JlYXRlQ2xhc3MyIiwia2V5IiwidmFsdWUiLCJfc2VuZFJlYWN0aW9uIiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwibWF0Y2hJZCIsIm1lc3NhZ2VJZCIsInJlYWN0aW9uIiwicmVzcG9uc2UiLCJyZXF1ZXN0IiwibWV0aG9kIiwiYm9keSIsImxvZ2dlciIsImluZm8iLCJlcnJvciIsInNlbmRSZWFjdGlvbiIsIl94IiwiX3gyIiwiX3gzIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJfc2VuZEF0dGFjaG1lbnQiLCJwYXJhbXMiLCJmb3JtRGF0YSIsIkZvcm1EYXRhIiwiYXBwZW5kIiwiZmlsZSIsImF0dGFjaG1lbnRUeXBlIiwibmFtZSIsImhlYWRlcnMiLCJzZW5kQXR0YWNobWVudCIsIl94NCIsIl9zZW5kVm9pY2VOb3RlIiwibWF0Y2hJZE9yUGFyYW1zIiwiZHVyYXRpb24iLCJ2b2ljZUR1cmF0aW9uIiwiQmxvYiIsImF1ZGlvRmlsZSIsIkZpbGUiLCJ0eXBlIiwiRXJyb3IiLCJhdWRpb0Jsb2IiLCJTdHJpbmciLCJzZW5kVm9pY2VOb3RlIiwiX3g1IiwiX3g2IiwiX3g3IiwiY2hhdFNlcnZpY2UiLCJleHBvcnRzIiwic2VuZFZvaWNlTm90ZU5hdGl2ZSIsIl94OCIsIl94OSIsIl9zZW5kVm9pY2VOb3RlTmF0aXZlIiwicCIsInByZXNpZ24iLCJjb250ZW50VHlwZSIsInVybCIsInVwbG9hZEFzeW5jIiwiZmlsZVVyaSIsImh0dHBNZXRob2QiLCJ1cGxvYWRUeXBlIiwiRmlsZVN5c3RlbVVwbG9hZFR5cGUiLCJCSU5BUllfQ09OVEVOVCIsIndhdmVmb3JtIiwiYXNzaWduIl0sInNvdXJjZXMiOlsiY2hhdFNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDaGF0IFNlcnZpY2UgZm9yIFBhd2ZlY3RNYXRjaCBNb2JpbGVcbiAqIEhhbmRsZXMgY2hhdCBmZWF0dXJlczogcmVhY3Rpb25zLCBhdHRhY2htZW50cywgdm9pY2Ugbm90ZXNcbiAqL1xuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwiQHBhd2ZlY3RtYXRjaC9jb3JlXCI7XG5pbXBvcnQgdHlwZSB7IE1lc3NhZ2UgfSBmcm9tIFwiQHBhd2ZlY3RtYXRjaC9jb3JlXCI7XG5pbXBvcnQgeyByZXF1ZXN0IH0gZnJvbSBcIi4vYXBpXCI7XG5pbXBvcnQgKiBhcyBGaWxlU3lzdGVtIGZyb20gXCJleHBvLWZpbGUtc3lzdGVtXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2hhdFJlYWN0aW9uIHtcbiAgZW1vamk6IHN0cmluZztcbiAgdXNlcklkOiBzdHJpbmc7XG4gIHRpbWVzdGFtcDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1lc3NhZ2VXaXRoUmVhY3Rpb25zIGV4dGVuZHMgTWVzc2FnZSB7XG4gIHJlYWN0aW9ucz86IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2hhdEF0dGFjaG1lbnQge1xuICB0eXBlOiBcImltYWdlXCIgfCBcInZpZGVvXCIgfCBcImZpbGVcIjtcbiAgdXJsOiBzdHJpbmc7XG4gIG5hbWU/OiBzdHJpbmc7XG4gIHNpemU/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVm9pY2VOb3RlIHtcbiAgdXJsOiBzdHJpbmc7XG4gIGR1cmF0aW9uOiBudW1iZXI7XG4gIHdhdmVmb3JtPzogbnVtYmVyW107XG59XG5cbmludGVyZmFjZSBTZW5kUmVhY3Rpb25QYXJhbXMge1xuICBtYXRjaElkOiBzdHJpbmc7XG4gIG1lc3NhZ2VJZDogc3RyaW5nO1xuICByZWFjdGlvbjogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgU2VuZEF0dGFjaG1lbnRQYXJhbXMge1xuICBtYXRjaElkOiBzdHJpbmc7XG4gIGF0dGFjaG1lbnRUeXBlOiBcImltYWdlXCIgfCBcInZpZGVvXCIgfCBcImZpbGVcIjtcbiAgZmlsZTogRmlsZSB8IEJsb2I7XG4gIG5hbWU/OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBTZW5kVm9pY2VOb3RlUGFyYW1zIHtcbiAgbWF0Y2hJZDogc3RyaW5nO1xuICBhdWRpb0Jsb2I6IEJsb2I7XG4gIGR1cmF0aW9uOiBudW1iZXI7XG59XG5cbi8qKlxuICogQ2hhdCBTZXJ2aWNlIGZvciByZWFjdGlvbnMsIGF0dGFjaG1lbnRzLCBhbmQgdm9pY2Ugbm90ZXNcbiAqL1xuY2xhc3MgQ2hhdFNlcnZpY2Uge1xuICAvKipcbiAgICogU2VuZCBhIHJlYWN0aW9uIHRvIGEgbWVzc2FnZVxuICAgKi9cbiAgYXN5bmMgc2VuZFJlYWN0aW9uKFxuICAgIG1hdGNoSWQ6IHN0cmluZyxcbiAgICBtZXNzYWdlSWQ6IHN0cmluZyxcbiAgICByZWFjdGlvbjogc3RyaW5nXG4gICk6IFByb21pc2U8e1xuICAgIHN1Y2Nlc3M6IGJvb2xlYW47XG4gICAgbWVzc2FnZUlkOiBzdHJpbmc7XG4gICAgcmVhY3Rpb25zOiBDaGF0UmVhY3Rpb25bXTtcbiAgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3Q8e1xuICAgICAgICBzdWNjZXNzOiBib29sZWFuO1xuICAgICAgICBtZXNzYWdlSWQ6IHN0cmluZztcbiAgICAgICAgcmVhY3Rpb25zOiBDaGF0UmVhY3Rpb25bXTtcbiAgICAgIH0+KFwiL2NoYXQvcmVhY3Rpb25zXCIsIHtcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgYm9keToge1xuICAgICAgICAgIG1hdGNoSWQsXG4gICAgICAgICAgbWVzc2FnZUlkLFxuICAgICAgICAgIHJlYWN0aW9uLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGxvZ2dlci5pbmZvKFwiUmVhY3Rpb24gc2VudCBzdWNjZXNzZnVsbHlcIiwgeyBtYXRjaElkLCBtZXNzYWdlSWQsIHJlYWN0aW9uIH0pO1xuXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihcIkZhaWxlZCB0byBzZW5kIHJlYWN0aW9uXCIsIHsgZXJyb3IsIG1hdGNoSWQsIG1lc3NhZ2VJZCwgcmVhY3Rpb24gfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBhbiBhdHRhY2htZW50IHRvIGEgbWF0Y2hcbiAgICovXG4gIGFzeW5jIHNlbmRBdHRhY2htZW50KHBhcmFtczogU2VuZEF0dGFjaG1lbnRQYXJhbXMpOiBQcm9taXNlPHtcbiAgICBzdWNjZXNzOiBib29sZWFuO1xuICAgIHVybDogc3RyaW5nO1xuICAgIHR5cGU6IHN0cmluZztcbiAgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgZm9ybURhdGEuYXBwZW5kKFwiZmlsZVwiLCBwYXJhbXMuZmlsZSk7XG4gICAgICBmb3JtRGF0YS5hcHBlbmQoXCJtYXRjaElkXCIsIHBhcmFtcy5tYXRjaElkKTtcbiAgICAgIGZvcm1EYXRhLmFwcGVuZChcInR5cGVcIiwgcGFyYW1zLmF0dGFjaG1lbnRUeXBlKTtcbiAgICAgIGlmIChwYXJhbXMubmFtZSkge1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoXCJuYW1lXCIsIHBhcmFtcy5uYW1lKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0PHtcbiAgICAgICAgc3VjY2VzczogYm9vbGVhbjtcbiAgICAgICAgdXJsOiBzdHJpbmc7XG4gICAgICAgIHR5cGU6IHN0cmluZztcbiAgICAgIH0+KFwiL2NoYXQvYXR0YWNobWVudHNcIiwge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBib2R5OiBmb3JtRGF0YSxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIC8vIERvbid0IHNldCBDb250ZW50LVR5cGUgLSBGb3JtRGF0YSBzZXRzIGl0IGF1dG9tYXRpY2FsbHlcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBsb2dnZXIuaW5mbyhcIkF0dGFjaG1lbnQgc2VudCBzdWNjZXNzZnVsbHlcIiwgeyBwYXJhbXMgfSk7XG5cbiAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKFwiRmFpbGVkIHRvIHNlbmQgYXR0YWNobWVudFwiLCB7IGVycm9yLCBwYXJhbXMgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBhIHZvaWNlIG5vdGVcbiAgICogU3VwcG9ydHMgYm90aCBGb3JtRGF0YSAobmF0aXZlKSBhbmQgQmxvYiAod2ViKVxuICAgKi9cbiAgYXN5bmMgc2VuZFZvaWNlTm90ZShcbiAgICBtYXRjaElkOiBzdHJpbmcsXG4gICAgZmlsZTogRm9ybURhdGEgfCBCbG9iLFxuICAgIGR1cmF0aW9uPzogbnVtYmVyXG4gICk6IFByb21pc2U8dm9pZD47XG4gIFxuICAvKipcbiAgICogU2VuZCBhIHZvaWNlIG5vdGUgKGxlZ2FjeSBzaWduYXR1cmUpXG4gICAqL1xuICBhc3luYyBzZW5kVm9pY2VOb3RlKHBhcmFtczogU2VuZFZvaWNlTm90ZVBhcmFtcyk6IFByb21pc2U8e1xuICAgIHN1Y2Nlc3M6IGJvb2xlYW47XG4gICAgdXJsOiBzdHJpbmc7XG4gICAgZHVyYXRpb246IG51bWJlcjtcbiAgfT47XG4gIFxuICBhc3luYyBzZW5kVm9pY2VOb3RlKFxuICAgIG1hdGNoSWRPclBhcmFtczogc3RyaW5nIHwgU2VuZFZvaWNlTm90ZVBhcmFtcyxcbiAgICBmaWxlPzogRm9ybURhdGEgfCBCbG9iLFxuICAgIGR1cmF0aW9uPzogbnVtYmVyXG4gICk6IFByb21pc2U8dm9pZCB8IHtcbiAgICBzdWNjZXNzOiBib29sZWFuO1xuICAgIHVybDogc3RyaW5nO1xuICAgIGR1cmF0aW9uOiBudW1iZXI7XG4gIH0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gSGFuZGxlIGJvdGggc2lnbmF0dXJlc1xuICAgICAgbGV0IGZvcm1EYXRhOiBGb3JtRGF0YTtcbiAgICAgIGxldCBtYXRjaElkOiBzdHJpbmc7XG4gICAgICBsZXQgdm9pY2VEdXJhdGlvbjogbnVtYmVyO1xuICAgICAgXG4gICAgICBpZiAodHlwZW9mIG1hdGNoSWRPclBhcmFtcyA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAvLyBOZXcgc2lnbmF0dXJlOiBzZW5kVm9pY2VOb3RlKG1hdGNoSWQsIGZpbGUsIGR1cmF0aW9uPylcbiAgICAgICAgbWF0Y2hJZCA9IG1hdGNoSWRPclBhcmFtcztcbiAgICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBGb3JtRGF0YSkge1xuICAgICAgICAgIC8vIE5hdGl2ZTogRm9ybURhdGEgYWxyZWFkeSBoYXMgdGhlIGZpbGUgd3JhcHBlZFxuICAgICAgICAgIGZvcm1EYXRhID0gZmlsZTtcbiAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoXCJtYXRjaElkXCIsIG1hdGNoSWQpO1xuICAgICAgICB9IGVsc2UgaWYgKGZpbGUgaW5zdGFuY2VvZiBCbG9iKSB7XG4gICAgICAgICAgLy8gV2ViOiB3cmFwIEJsb2IgaW4gRm9ybURhdGFcbiAgICAgICAgICBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICAgIGNvbnN0IGF1ZGlvRmlsZSA9IG5ldyBGaWxlKFtmaWxlXSwgXCJ2b2ljZS1ub3RlLndlYm1cIiwge1xuICAgICAgICAgICAgdHlwZTogXCJhdWRpby93ZWJtXCIsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwiYXVkaW9CbG9iXCIsIGF1ZGlvRmlsZSk7XG4gICAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwibWF0Y2hJZFwiLCBtYXRjaElkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGZpbGUgdHlwZVwiKTtcbiAgICAgICAgfVxuICAgICAgICB2b2ljZUR1cmF0aW9uID0gZHVyYXRpb24gfHwgMDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIExlZ2FjeSBzaWduYXR1cmU6IHNlbmRWb2ljZU5vdGUoeyBtYXRjaElkLCBhdWRpb0Jsb2IsIGR1cmF0aW9uIH0pXG4gICAgICAgIGNvbnN0IHBhcmFtcyA9IG1hdGNoSWRPclBhcmFtcztcbiAgICAgICAgbWF0Y2hJZCA9IHBhcmFtcy5tYXRjaElkO1xuICAgICAgICBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICBjb25zdCBhdWRpb0ZpbGUgPSBuZXcgRmlsZShbcGFyYW1zLmF1ZGlvQmxvYl0sIFwidm9pY2Utbm90ZS5tNGFcIiwge1xuICAgICAgICAgIHR5cGU6IFwiYXVkaW8vbTRhXCIsXG4gICAgICAgIH0pO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoXCJhdWRpb0Jsb2JcIiwgYXVkaW9GaWxlKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwibWF0Y2hJZFwiLCBtYXRjaElkKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwiZHVyYXRpb25cIiwgU3RyaW5nKHBhcmFtcy5kdXJhdGlvbikpO1xuICAgICAgICB2b2ljZUR1cmF0aW9uID0gcGFyYW1zLmR1cmF0aW9uO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3Q8e1xuICAgICAgICBzdWNjZXNzOiBib29sZWFuO1xuICAgICAgICB1cmw6IHN0cmluZztcbiAgICAgICAgZHVyYXRpb246IG51bWJlcjtcbiAgICAgIH0+KFwiL2FwaS9jaGF0L3ZvaWNlXCIsIHtcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgYm9keTogZm9ybURhdGEsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAvLyBEb24ndCBzZXQgQ29udGVudC1UeXBlIC0gRm9ybURhdGEgc2V0cyBpdCBhdXRvbWF0aWNhbGx5XG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgbG9nZ2VyLmluZm8oXCJWb2ljZSBub3RlIHNlbnQgc3VjY2Vzc2Z1bGx5XCIsIHsgbWF0Y2hJZCwgZHVyYXRpb246IHZvaWNlRHVyYXRpb24gfSk7XG4gICAgICBcbiAgICAgIC8vIFJldHVybiByZXN1bHQgZm9yIGxlZ2FjeSBzaWduYXR1cmVcbiAgICAgIGlmICh0eXBlb2YgbWF0Y2hJZE9yUGFyYW1zICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKFwiRmFpbGVkIHRvIHNlbmQgdm9pY2Ugbm90ZVwiLCB7IGVycm9yLCBtYXRjaElkT3JQYXJhbXMgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IGNoYXRTZXJ2aWNlID0gbmV3IENoYXRTZXJ2aWNlKCk7XG5cbi8vIE5hdGl2ZSB2b2ljZSBub3RlIHVwbG9hZCBoZWxwZXJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZW5kVm9pY2VOb3RlTmF0aXZlKG1hdGNoSWQ6IHN0cmluZywgcDogeyBmaWxlVXJpOiBzdHJpbmc7IGR1cmF0aW9uOiBudW1iZXIgfSkge1xuICAvLyBwcmVzaWduXG4gIGNvbnN0IHByZXNpZ24gPSBhd2FpdCByZXF1ZXN0PHsgdXJsOiBzdHJpbmc7IGtleTogc3RyaW5nIH0+KFwiL2FwaS9jaGF0L3ZvaWNlL3ByZXNpZ25cIiwge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgYm9keTogeyBjb250ZW50VHlwZTogXCJhdWRpby93ZWJtXCIgfSxcbiAgfSk7XG4gIGNvbnN0IHsgdXJsLCBrZXkgfSA9IHByZXNpZ247XG5cbiAgLy8gUFVUIHRvIFMzXG4gIGF3YWl0IEZpbGVTeXN0ZW0udXBsb2FkQXN5bmModXJsLCBwLmZpbGVVcmksIHtcbiAgICBodHRwTWV0aG9kOiBcIlBVVFwiLFxuICAgIGhlYWRlcnM6IHsgXCJDb250ZW50LVR5cGVcIjogXCJhdWRpby93ZWJtXCIgfSxcbiAgICB1cGxvYWRUeXBlOiBGaWxlU3lzdGVtLkZpbGVTeXN0ZW1VcGxvYWRUeXBlLkJJTkFSWV9DT05URU5ULFxuICB9KTtcblxuICAvLyByZWdpc3RlciBtZXNzYWdlXG4gIGF3YWl0IHJlcXVlc3QoYC9hcGkvY2hhdC8ke21hdGNoSWR9L3ZvaWNlLW5vdGVgLCB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICBib2R5OiB7IGtleSwgZHVyYXRpb246IHAuZHVyYXRpb24sIHdhdmVmb3JtOiBbXSB9LFxuICB9KTtcbn1cblxuLy8gRXh0ZW5kZWQgQ2hhdFNlcnZpY2UgaW50ZXJmYWNlIHdpdGggbmF0aXZlIG1ldGhvZHNcbmludGVyZmFjZSBDaGF0U2VydmljZVdpdGhOYXRpdmUgZXh0ZW5kcyBDaGF0U2VydmljZSB7XG4gIHNlbmRWb2ljZU5vdGVOYXRpdmU6IHR5cGVvZiBzZW5kVm9pY2VOb3RlTmF0aXZlO1xufVxuXG4vLyBJbmplY3QgdG8gY2hhdFNlcnZpY2Ugd2l0aCBwcm9wZXIgdHlwZVxuT2JqZWN0LmFzc2lnbihjaGF0U2VydmljZSwgeyBzZW5kVm9pY2VOb3RlTmF0aXZlIH0pO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUtBLElBQUFBLEtBQUEsR0FBQUMsT0FBQTtBQUVBLElBQUFDLElBQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLFVBQUEsR0FBQUMsdUJBQUEsQ0FBQUgsT0FBQTtBQUErQyxTQUFBRyx3QkFBQUMsQ0FBQSxFQUFBQyxDQUFBLDZCQUFBQyxPQUFBLE1BQUFDLENB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