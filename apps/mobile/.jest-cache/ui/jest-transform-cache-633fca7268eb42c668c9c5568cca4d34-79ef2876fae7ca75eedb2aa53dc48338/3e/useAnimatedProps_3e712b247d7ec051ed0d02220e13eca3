dd367a66fcaa68e2bddc8b92538789b3
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = useAnimatedProps;
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _ReactFabricPublicInstanceUtils = require("../Renderer/public/ReactFabricPublicInstanceUtils");
var _useRefEffect = _interopRequireDefault(require("../Utilities/useRefEffect"));
var _AnimatedEvent = require("./AnimatedEvent");
var _NativeAnimatedHelper = _interopRequireDefault(require("./NativeAnimatedHelper"));
var _AnimatedProps = _interopRequireDefault(require("./nodes/AnimatedProps"));
var _react = require("react");
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function useAnimatedProps(props) {
  var _useReducer = (0, _react.useReducer)(function (count) {
      return count + 1;
    }, 0),
    _useReducer2 = (0, _slicedToArray2.default)(_useReducer, 2),
    scheduleUpdate = _useReducer2[1];
  var onUpdateRef = (0, _react.useRef)(null);
  var node = (0, _react.useMemo)(function () {
    return new _AnimatedProps.default(props, function () {
      return onUpdateRef.current == null ? void 0 : onUpdateRef.current();
    });
  }, [props]);
  useAnimatedPropsLifecycle(node);
  var refEffect = (0, _react.useCallback)(function (instance) {
    node.setNativeView(instance);
    onUpdateRef.current = function () {
      if (process.env.NODE_ENV === 'test' || typeof instance !== 'object' || typeof (instance == null ? void 0 : instance.setNativeProps) !== 'function' || isFabricInstance(instance)) {
        scheduleUpdate();
      } else if (!node.__isNative) {
        instance.setNativeProps(node.__getAnimatedValue());
      } else {
        throw new Error('Attempting to run JS driven animation on animated node ' + 'that has been moved to "native" earlier by starting an ' + 'animation with `useNativeDriver: true`');
      }
    };
    var target = getEventTarget(instance);
    var events = [];
    for (var propName in props) {
      var propValue = props[propName];
      if (propValue instanceof _AnimatedEvent.AnimatedEvent && propValue.__isNative) {
        propValue.__attach(target, propName);
        events.push([propName, propValue]);
      }
    }
    return function () {
      onUpdateRef.current = null;
      for (var _ref of events) {
        var _ref2 = (0, _slicedToArray2.default)(_ref, 2);
        var _propName = _ref2[0];
        var _propValue = _ref2[1];
        _propValue.__detach(target, _propName);
      }
    };
  }, [props, node]);
  var callbackRef = (0, _useRefEffect.default)(refEffect);
  return [reduceAnimatedProps(node), callbackRef];
}
function reduceAnimatedProps(node) {
  return _objectSpread(_objectSpread({}, node.__getValue()), {}, {
    collapsable: false
  });
}
function useAnimatedPropsLifecycle(node) {
  var prevNodeRef = (0, _react.useRef)(null);
  var isUnmountingRef = (0, _react.useRef)(false);
  (0, _react.useEffect)(function () {
    _NativeAnimatedHelper.default.API.flushQueue();
  });
  (0, _react.useLayoutEffect)(function () {
    isUnmountingRef.current = false;
    return function () {
      isUnmountingRef.current = true;
    };
  }, []);
  (0, _react.useLayoutEffect)(function () {
    node.__attach();
    if (prevNodeRef.current != null) {
      var prevNode = prevNodeRef.current;
      prevNode.__restoreDefaultValues();
      prevNode.__detach();
      prevNodeRef.current = null;
    }
    return function () {
      if (isUnmountingRef.current) {
        node.__detach();
      } else {
        prevNodeRef.current = node;
      }
    };
  }, [node]);
}
function getEventTarget(instance) {
  return typeof instance === 'object' && typeof (instance == null ? void 0 : instance.getScrollableNode) === 'function' ? instance.getScrollableNode() : instance;
}
function isFabricInstance(instance) {
  var _instance$getScrollRe;
  return (0, _ReactFabricPublicInstanceUtils.isPublicInstance)(instance) || (0, _ReactFabricPublicInstanceUtils.isPublicInstance)(instance == null ? void 0 : instance.getNativeScrollRef == null ? void 0 : instance.getNativeScrollRef()) || (0, _ReactFabricPublicInstanceUtils.isPublicInstance)(instance == null ? void 0 : instance.getScrollResponder == null ? void 0 : (_instance$getScrollRe = instance.getScrollResponder()) == null ? void 0 : _instance$getScrollRe.getNativeScrollRef == null ? void 0 : _instance$getScrollRe.getNativeScrollRef());
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiZGVmYXVsdCIsInVzZUFuaW1hdGVkUHJvcHMiLCJfZGVmaW5lUHJvcGVydHkyIiwiX3NsaWNlZFRvQXJyYXkyIiwiX1JlYWN0RmFicmljUHVibGljSW5zdGFuY2VVdGlscyIsIl91c2VSZWZFZmZlY3QiLCJfQW5pbWF0ZWRFdmVudCIsIl9OYXRpdmVBbmltYXRlZEhlbHBlciIsIl9BbmltYXRlZFByb3BzIiwiX3JlYWN0Iiwib3duS2V5cyIsImUiLCJyIiwidCIsImtleXMiLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJvIiwiZmlsdGVyIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsInB1c2giLCJhcHBseSIsIl9vYmplY3RTcHJlYWQiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJmb3JFYWNoIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyIsImRlZmluZVByb3BlcnRpZXMiLCJwcm9wcyIsIl91c2VSZWR1Y2VyIiwidXNlUmVkdWNlciIsImNvdW50IiwiX3VzZVJlZHVjZXIyIiwic2NoZWR1bGVVcGRhdGUiLCJvblVwZGF0ZVJlZiIsInVzZVJlZiIsIm5vZGUiLCJ1c2VNZW1vIiwiQW5pbWF0ZWRQcm9wcyIsImN1cnJlbnQiLCJ1c2VBbmltYXRlZFByb3BzTGlmZWN5Y2xlIiwicmVmRWZmZWN0IiwidXNlQ2FsbGJhY2siLCJpbnN0YW5jZSIsInNldE5hdGl2ZVZpZXciLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJzZXROYXRpdmVQcm9wcyIsImlzRmFicmljSW5zdGFuY2UiLCJfX2lzTmF0aXZlIiwiX19nZXRBbmltYXRlZFZhbHVlIiwiRXJyb3IiLCJ0YXJnZXQiLCJnZXRFdmVudFRhcmdldCIsImV2ZW50cyIsInByb3BOYW1lIiwicHJvcFZhbHVlIiwiQW5pbWF0ZWRFdmVudCIsIl9fYXR0YWNoIiwiX3JlZiIsIl9yZWYyIiwiX19kZXRhY2giLCJjYWxsYmFja1JlZiIsInVzZVJlZkVmZmVjdCIsInJlZHVjZUFuaW1hdGVkUHJvcHMiLCJfX2dldFZhbHVlIiwiY29sbGFwc2FibGUiLCJwcmV2Tm9kZVJlZiIsImlzVW5tb3VudGluZ1JlZiIsInVzZUVmZmVjdCIsIk5hdGl2ZUFuaW1hdGVkSGVscGVyIiwiQVBJIiwiZmx1c2hRdWV1ZSIsInVzZUxheW91dEVmZmVjdCIsInByZXZOb2RlIiwiX19yZXN0b3JlRGVmYXVsdFZhbHVlcyIsImdldFNjcm9sbGFibGVOb2RlIiwiX2luc3RhbmNlJGdldFNjcm9sbFJlIiwiaXNGYWJyaWNQdWJsaWNJbnN0YW5jZSIsImdldE5hdGl2ZVNjcm9sbFJlZiIsImdldFNjcm9sbFJlc3BvbmRlciJdLCJzb3VyY2VzIjpbInVzZUFuaW1hdGVkUHJvcHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIE1ldGEgUGxhdGZvcm1zLCBJbmMuIGFuZCBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmbG93IHN0cmljdC1sb2NhbFxuICogQGZvcm1hdFxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHtpc1B1YmxpY0luc3RhbmNlIGFzIGlzRmFicmljUHVibGljSW5zdGFuY2V9IGZyb20gJy4uL1JlbmRlcmVyL3B1YmxpYy9SZWFjdEZhYnJpY1B1YmxpY0luc3RhbmNlVXRpbHMnO1xuaW1wb3J0IHVzZVJlZkVmZmVjdCBmcm9tICcuLi9VdGlsaXRpZXMvdXNlUmVmRWZmZWN0JztcbmltcG9ydCB7QW5pbWF0ZWRFdmVudH0gZnJvbSAnLi9BbmltYXRlZEV2ZW50JztcbmltcG9ydCBOYXRpdmVBbmltYXRlZEhlbHBlciBmcm9tICcuL05hdGl2ZUFuaW1hdGVkSGVscGVyJztcbmltcG9ydCBBbmltYXRlZFByb3BzIGZyb20gJy4vbm9kZXMvQW5pbWF0ZWRQcm9wcyc7XG5pbXBvcnQge1xuICB1c2VDYWxsYmFjayxcbiAgdXNlRWZmZWN0LFxuICB1c2VMYXlvdXRFZmZlY3QsXG4gIHVzZU1lbW8sXG4gIHVzZVJlZHVjZXIsXG4gIHVzZVJlZixcbn0gZnJvbSAncmVhY3QnO1xuXG50eXBlIFJlZHVjZWRQcm9wczxUUHJvcHM+ID0ge1xuICAuLi5UUHJvcHMsXG4gIGNvbGxhcHNhYmxlOiBib29sZWFuLFxuICAuLi5cbn07XG50eXBlIENhbGxiYWNrUmVmPFQ+ID0gVCA9PiBtaXhlZDtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gdXNlQW5pbWF0ZWRQcm9wczxUUHJvcHM6IHsuLi59LCBUSW5zdGFuY2U+KFxuICBwcm9wczogVFByb3BzLFxuKTogW1JlZHVjZWRQcm9wczxUUHJvcHM+LCBDYWxsYmFja1JlZjxUSW5zdGFuY2UgfCBudWxsPl0ge1xuICBjb25zdCBbLCBzY2hlZHVsZVVwZGF0ZV0gPSB1c2VSZWR1Y2VyPG51bWJlciwgdm9pZD4oY291bnQgPT4gY291bnQgKyAxLCAwKTtcbiAgY29uc3Qgb25VcGRhdGVSZWYgPSB1c2VSZWY8PygpID0+IHZvaWQ+KG51bGwpO1xuXG4gIC8vIFRPRE86IE9ubHkgaW52YWxpZGF0ZSBgbm9kZWAgaWYgYW5pbWF0ZWQgcHJvcHMgb3IgYHN0eWxlYCBjaGFuZ2UuIEluIHRoZVxuICAvLyBwcmV2aW91cyBpbXBsZW1lbnRhdGlvbiwgd2UgcGVybWl0dGVkIGBzdHlsZWAgdG8gb3ZlcnJpZGUgcHJvcHMgd2l0aCB0aGVcbiAgLy8gc2FtZSBuYW1lIHByb3BlcnR5IG5hbWUgYXMgc3R5bGVzLCBzbyB3ZSBjYW4gcHJvYmFibHkgY29udGludWUgZG9pbmcgdGhhdC5cbiAgLy8gVGhlIG9yZGVyaW5nIG9mIG90aGVyIHByb3BzICpzaG91bGQqIG5vdCBtYXR0ZXIuXG4gIGNvbnN0IG5vZGUgPSB1c2VNZW1vKFxuICAgICgpID0+IG5ldyBBbmltYXRlZFByb3BzKHByb3BzLCAoKSA9PiBvblVwZGF0ZVJlZi5jdXJyZW50Py4oKSksXG4gICAgW3Byb3BzXSxcbiAgKTtcbiAgdXNlQW5pbWF0ZWRQcm9wc0xpZmVjeWNsZShub2RlKTtcblxuICAvLyBUT0RPOiBUaGlzIFwiZWZmZWN0XCIgZG9lcyB0aHJlZSB0aGluZ3M6XG4gIC8vXG4gIC8vICAgMSkgQ2FsbCBgc2V0TmF0aXZlVmlld2AuXG4gIC8vICAgMikgVXBkYXRlIGBvblVwZGF0ZVJlZmAuXG4gIC8vICAgMykgVXBkYXRlIGxpc3RlbmVycyBmb3IgYEFuaW1hdGVkRXZlbnRgIHByb3BzLlxuICAvL1xuICAvLyBJZGVhbGx5LCBlYWNoIG9mIHRoZXNlIHdvdWxkIGJlIHNlcGFyYXRlIFwiZWZmZWN0c1wiIHNvIHRoYXQgdGhleSBhcmUgbm90XG4gIC8vIHVubmVjZXNzYXJpbHkgcmUtcnVuIHdoZW4gaXJyZWxldmFudCBkZXBlbmRlbmNpZXMgY2hhbmdlLiBGb3IgZXhhbXBsZSwgd2VcbiAgLy8gc2hvdWxkIGJlIGFibGUgdG8gaG9pc3QgYWxsIGBBbmltYXRlZEV2ZW50YCBwcm9wcyBhbmQgb25seSBkbyAjMyBpZiBlaXRoZXJcbiAgLy8gdGhlIGBBbmltYXRlZEV2ZW50YCBwcm9wcyBjaGFuZ2Ugb3IgYGluc3RhbmNlYCBjaGFuZ2VzLlxuICAvL1xuICAvLyBCdXQgdGhlcmUgaXMgbm8gd2F5IHRvIHRyYW5zcGFyZW50bHkgY29tcG9zZSB0aHJlZSBzZXBhcmF0ZSBjYWxsYmFjayByZWZzLFxuICAvLyBzbyB3ZSBqdXN0IGNvbWJpbmUgdGhlbSBhbGwgaW50byBvbmUgZm9yIG5vdy5cbiAgY29uc3QgcmVmRWZmZWN0ID0gdXNlQ2FsbGJhY2soXG4gICAgKGluc3RhbmNlOiBUSW5zdGFuY2UpID0+IHtcbiAgICAgIC8vIE5PVEU6IFRoaXMgbWF5IGJlIGNhbGxlZCBtb3JlIG9mdGVuIHRoYW4gbmVjZXNzYXJ5IChlLmcuIHdoZW4gYHByb3BzYFxuICAgICAgLy8gY2hhbmdlcyksIGJ1dCBgc2V0TmF0aXZlVmlld2AgYWxyZWFkeSBvcHRpbWl6ZXMgZm9yIHRoYXQuXG4gICAgICBub2RlLnNldE5hdGl2ZVZpZXcoaW5zdGFuY2UpO1xuXG4gICAgICAvLyBOT1RFOiBUaGlzIGNhbGxiYWNrIGlzIG9ubHkgdXNlZCBieSB0aGUgSmF2YVNjcmlwdCBhbmltYXRpb24gZHJpdmVyLlxuICAgICAgb25VcGRhdGVSZWYuY3VycmVudCA9ICgpID0+IHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAndGVzdCcgfHxcbiAgICAgICAgICB0eXBlb2YgaW5zdGFuY2UgIT09ICdvYmplY3QnIHx8XG4gICAgICAgICAgdHlwZW9mIGluc3RhbmNlPy5zZXROYXRpdmVQcm9wcyAhPT0gJ2Z1bmN0aW9uJyB8fFxuICAgICAgICAgIGlzRmFicmljSW5zdGFuY2UoaW5zdGFuY2UpXG4gICAgICAgICkge1xuICAgICAgICAgIC8vIFNjaGVkdWxlIGFuIHVwZGF0ZSBmb3IgdGhpcyBjb21wb25lbnQgdG8gdXBkYXRlIGByZWR1Y2VkUHJvcHNgLFxuICAgICAgICAgIC8vIGJ1dCBkbyBub3QgY29tcHV0ZSBpdCBpbW1lZGlhdGVseS4gSWYgYSBwYXJlbnQgYWxzbyB1cGRhdGVkLCB3ZVxuICAgICAgICAgIC8vIG5lZWQgdG8gbWVyZ2UgdGhvc2UgbmV3IHByb3BzIGluIGJlZm9yZSB1cGRhdGluZy5cbiAgICAgICAgICBzY2hlZHVsZVVwZGF0ZSgpO1xuICAgICAgICB9IGVsc2UgaWYgKCFub2RlLl9faXNOYXRpdmUpIHtcbiAgICAgICAgICAvLyAkRmxvd0lnbm9yZVtub3QtYS1mdW5jdGlvbl0gLSBBc3N1bWUgaXQncyBzdGlsbCBhIGZ1bmN0aW9uLlxuICAgICAgICAgIC8vICRGbG93Rml4TWVbaW5jb21wYXRpYmxlLXVzZV1cbiAgICAgICAgICBpbnN0YW5jZS5zZXROYXRpdmVQcm9wcyhub2RlLl9fZ2V0QW5pbWF0ZWRWYWx1ZSgpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAnQXR0ZW1wdGluZyB0byBydW4gSlMgZHJpdmVuIGFuaW1hdGlvbiBvbiBhbmltYXRlZCBub2RlICcgK1xuICAgICAgICAgICAgICAndGhhdCBoYXMgYmVlbiBtb3ZlZCB0byBcIm5hdGl2ZVwiIGVhcmxpZXIgYnkgc3RhcnRpbmcgYW4gJyArXG4gICAgICAgICAgICAgICdhbmltYXRpb24gd2l0aCBgdXNlTmF0aXZlRHJpdmVyOiB0cnVlYCcsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgY29uc3QgdGFyZ2V0ID0gZ2V0RXZlbnRUYXJnZXQoaW5zdGFuY2UpO1xuICAgICAgY29uc3QgZXZlbnRzID0gW107XG5cbiAgICAgIGZvciAoY29uc3QgcHJvcE5hbWUgaW4gcHJvcHMpIHtcbiAgICAgICAgY29uc3QgcHJvcFZhbHVlID0gcHJvcHNbcHJvcE5hbWVdO1xuICAgICAgICBpZiAocHJvcFZhbHVlIGluc3RhbmNlb2YgQW5pbWF0ZWRFdmVudCAmJiBwcm9wVmFsdWUuX19pc05hdGl2ZSkge1xuICAgICAgICAgIHByb3BWYWx1ZS5fX2F0dGFjaCh0YXJnZXQsIHByb3BOYW1lKTtcbiAgICAgICAgICBldmVudHMucHVzaChbcHJvcE5hbWUsIHByb3BWYWx1ZV0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgIG9uVXBkYXRlUmVmLmN1cnJlbnQgPSBudWxsO1xuXG4gICAgICAgIGZvciAoY29uc3QgW3Byb3BOYW1lLCBwcm9wVmFsdWVdIG9mIGV2ZW50cykge1xuICAgICAgICAgIHByb3BWYWx1ZS5fX2RldGFjaCh0YXJnZXQsIHByb3BOYW1lKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9LFxuICAgIFtwcm9wcywgbm9kZV0sXG4gICk7XG4gIGNvbnN0IGNhbGxiYWNrUmVmID0gdXNlUmVmRWZmZWN0PFRJbnN0YW5jZT4ocmVmRWZmZWN0KTtcblxuICByZXR1cm4gW3JlZHVjZUFuaW1hdGVkUHJvcHM8VFByb3BzPihub2RlKSwgY2FsbGJhY2tSZWZdO1xufVxuXG5mdW5jdGlvbiByZWR1Y2VBbmltYXRlZFByb3BzPFRQcm9wcz4oXG4gIG5vZGU6IEFuaW1hdGVkUHJvcHMsXG4pOiBSZWR1Y2VkUHJvcHM8VFByb3BzPiB7XG4gIC8vIEZvcmNlIGBjb2xsYXBzYWJsZWAgdG8gYmUgZmFsc2Ugc28gdGhhdCB0aGUgbmF0aXZlIHZpZXcgaXMgbm90IGZsYXR0ZW5lZC5cbiAgLy8gRmxhdHRlbmVkIHZpZXdzIGNhbm5vdCBiZSBhY2N1cmF0ZWx5IHJlZmVyZW5jZWQgYnkgdGhlIG5hdGl2ZSBkcml2ZXIuXG4gIHJldHVybiB7XG4gICAgLi4ubm9kZS5fX2dldFZhbHVlKCksXG4gICAgY29sbGFwc2FibGU6IGZhbHNlLFxuICB9O1xufVxuXG4vKipcbiAqIE1hbmFnZXMgdGhlIGxpZmVjeWNsZSBvZiB0aGUgc3VwcGxpZWQgYEFuaW1hdGVkUHJvcHNgIGJ5IGludm9raW5nIGBfX2F0dGFjaGBcbiAqIGFuZCBgX19kZXRhY2hgLiBIb3dldmVyLCB0aGlzIGlzIG1vcmUgY29tcGxpY2F0ZWQgYmVjYXVzZSBgQW5pbWF0ZWRQcm9wc2BcbiAqIHVzZXMgcmVmZXJlbmNlIGNvdW50aW5nIHRvIGRldGVybWluZSB3aGVuIHRvIHJlY3Vyc2l2ZWx5IGRldGFjaCBpdHMgY2hpbGRyZW5cbiAqIG5vZGVzLiBTbyBpbiBvcmRlciB0byBvcHRpbWl6ZSB0aGlzLCB3ZSBhdm9pZCBkZXRhY2hpbmcgdW50aWwgdGhlIG5leHQgYXR0YWNoXG4gKiB1bmxlc3Mgd2UgYXJlIHVubW91bnRpbmcuXG4gKi9cbmZ1bmN0aW9uIHVzZUFuaW1hdGVkUHJvcHNMaWZlY3ljbGUobm9kZTogQW5pbWF0ZWRQcm9wcyk6IHZvaWQge1xuICBjb25zdCBwcmV2Tm9kZVJlZiA9IHVzZVJlZjw/QW5pbWF0ZWRQcm9wcz4obnVsbCk7XG4gIGNvbnN0IGlzVW5tb3VudGluZ1JlZiA9IHVzZVJlZjxib29sZWFuPihmYWxzZSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAvLyBJdCBpcyBvayBmb3IgbXVsdGlwbGUgY29tcG9uZW50cyB0byBjYWxsIGBmbHVzaFF1ZXVlYCBiZWNhdXNlIGl0IG5vb3BzXG4gICAgLy8gaWYgdGhlIHF1ZXVlIGlzIGVtcHR5LiBXaGVuIG11bHRpcGxlIGFuaW1hdGVkIGNvbXBvbmVudHMgYXJlIG1vdW50ZWQgYXRcbiAgICAvLyB0aGUgc2FtZSB0aW1lLiBPbmx5IGZpcnN0IGNvbXBvbmVudCBmbHVzaGVzIHRoZSBxdWV1ZSBhbmQgdGhlIG90aGVycyB3aWxsIG5vb3AuXG4gICAgTmF0aXZlQW5pbWF0ZWRIZWxwZXIuQVBJLmZsdXNoUXVldWUoKTtcbiAgfSk7XG5cbiAgdXNlTGF5b3V0RWZmZWN0KCgpID0+IHtcbiAgICBpc1VubW91bnRpbmdSZWYuY3VycmVudCA9IGZhbHNlO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBpc1VubW91bnRpbmdSZWYuY3VycmVudCA9IHRydWU7XG4gICAgfTtcbiAgfSwgW10pO1xuXG4gIHVzZUxheW91dEVmZmVjdCgoKSA9PiB7XG4gICAgbm9kZS5fX2F0dGFjaCgpO1xuICAgIGlmIChwcmV2Tm9kZVJlZi5jdXJyZW50ICE9IG51bGwpIHtcbiAgICAgIGNvbnN0IHByZXZOb2RlID0gcHJldk5vZGVSZWYuY3VycmVudDtcbiAgICAgIC8vIFRPRE86IFN0b3AgcmVzdG9yaW5nIGRlZmF1bHQgdmFsdWVzICh1bmxlc3MgYHJlc2V0YCBpcyBjYWxsZWQpLlxuICAgICAgcHJldk5vZGUuX19yZXN0b3JlRGVmYXVsdFZhbHVlcygpO1xuICAgICAgcHJldk5vZGUuX19kZXRhY2goKTtcbiAgICAgIHByZXZOb2RlUmVmLmN1cnJlbnQgPSBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgaWYgKGlzVW5tb3VudGluZ1JlZi5jdXJyZW50KSB7XG4gICAgICAgIC8vIE5PVEU6IERvIG5vdCByZXN0b3JlIGRlZmF1bHQgdmFsdWVzIG9uIHVubW91bnQsIHNlZSBEMTgxOTc3MzUuXG4gICAgICAgIG5vZGUuX19kZXRhY2goKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHByZXZOb2RlUmVmLmN1cnJlbnQgPSBub2RlO1xuICAgICAgfVxuICAgIH07XG4gIH0sIFtub2RlXSk7XG59XG5cbmZ1bmN0aW9uIGdldEV2ZW50VGFyZ2V0PFRJbnN0YW5jZT4oaW5zdGFuY2U6IFRJbnN0YW5jZSk6IFRJbnN0YW5jZSB7XG4gIHJldHVybiB0eXBlb2YgaW5zdGFuY2UgPT09ICdvYmplY3QnICYmXG4gICAgdHlwZW9mIGluc3RhbmNlPy5nZXRTY3JvbGxhYmxlTm9kZSA9PT0gJ2Z1bmN0aW9uJ1xuICAgID8gLy8gJEZsb3dGaXhNZVtpbmNvbXBhdGlibGUtdXNlXSAtIExlZ2FjeSBpbnN0YW5jZSBhc3N1bXB0aW9ucy5cbiAgICAgIGluc3RhbmNlLmdldFNjcm9sbGFibGVOb2RlKClcbiAgICA6IGluc3RhbmNlO1xufVxuXG4vLyAkRmxvd0ZpeE1lW3VuY2xlYXItdHlwZV0gLSBMZWdhY3kgaW5zdGFuY2UgYXNzdW1wdGlvbnMuXG5mdW5jdGlvbiBpc0ZhYnJpY0luc3RhbmNlKGluc3RhbmNlOiBhbnkpOiBib29sZWFuIHtcbiAgcmV0dXJuIChcbiAgICBpc0ZhYnJpY1B1YmxpY0luc3RhbmNlKGluc3RhbmNlKSB8fFxuICAgIC8vIFNvbWUgY29tcG9uZW50cyBoYXZlIGEgc2V0TmF0aXZlUHJvcHMgZnVuY3Rpb24gYnV0IGFyZW4ndCBhIGhvc3QgY29tcG9uZW50XG4gICAgLy8gc3VjaCBhcyBsaXN0cyBsaWtlIEZsYXRMaXN0IGFuZCBTZWN0aW9uTGlzdC4gVGhlc2Ugc2hvdWxkIGFsc28gdXNlXG4gICAgLy8gZm9yY2VVcGRhdGUgaW4gRmFicmljIHNpbmNlIHNldE5hdGl2ZVByb3BzIGRvZXNuJ3QgZXhpc3Qgb24gdGhlIHVuZGVybHlpbmdcbiAgICAvLyBob3N0IGNvbXBvbmVudC4gVGhpcyBjcmF6eSBoYWNrIGlzIGVzc2VudGlhbGx5IHNwZWNpYWwgY2FzaW5nIHRob3NlIGxpc3RzIGFuZFxuICAgIC8vIFNjcm9sbFZpZXcgaXRzZWxmIHRvIHVzZSBmb3JjZVVwZGF0ZSBpbiBGYWJyaWMuXG4gICAgLy8gSWYgdGhlc2UgY29tcG9uZW50cyBlbmQgdXAgdXNpbmcgZm9yd2FyZFJlZiB0aGVuIHRoZXNlIGhhY2tzIGNhbiBnbyBhd2F5XG4gICAgLy8gYXMgaW5zdGFuY2Ugd291bGQgYWN0dWFsbHkgYmUgdGhlIHVuZGVybHlpbmcgaG9zdCBjb21wb25lbnQgYW5kIHRoZSBhYm92ZSBjaGVja1xuICAgIC8vIHdvdWxkIGJlIHN1ZmZpY2llbnQuXG4gICAgaXNGYWJyaWNQdWJsaWNJbnN0YW5jZShpbnN0YW5jZT8uZ2V0TmF0aXZlU2Nyb2xsUmVmPy4oKSkgfHxcbiAgICBpc0ZhYnJpY1B1YmxpY0luc3RhbmNlKFxuICAgICAgaW5zdGFuY2U/LmdldFNjcm9sbFJlc3BvbmRlcj8uKCk/LmdldE5hdGl2ZVNjcm9sbFJlZj8uKCksXG4gICAgKVxuICApO1xufVxuIl0sIm1hcHBpbmdzIjoiQUFVQSxZQUFZOztBQUFDLElBQUFBLHNCQUFBLEdBQUFDLE9BQUE7QUFBQUMsTUFBQSxDQUFBQyxjQUFBLENBQUFDLE9BQUE7RUFBQUMsS0FBQTtBQUFBO0FBQUFELE9BQUEsQ0FBQUUsT0FBQSxHQUFBQyxnQkFBQTtBQUFBLElBQUFDLGdCQUFBLEdBQUFSLHNCQUFBLENBQUFDLE9BQUE7QUFBQSxJQUFBUSxlQUFBLEdBQUFULHNCQUFBLENBQUFDLE9BQUE7QUFFYixJQUFBUywrQkFBQSxHQUFBVCxPQUFBO0FBQ0EsSUFBQVUsYUFBQSxHQUFBWCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQVcsY0FBQSxHQUFBWCxPQUFBO0FBQ0EsSUFBQVkscUJBQUEsR0FBQWIsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFhLGNBQUEsR0FBQWQs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