2027dd8687326f4717c7c5c4b38ee3df
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useAIBioScreen = void 0;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _native = require("@react-navigation/native");
var _react = require("react");
var ImagePicker = _interopRequireWildcard(require("expo-image-picker"));
var _reactNative = require("react-native");
var _core = require("@pawfectmatch/core");
var _api = require("../../services/api");
var _useAIBio2 = require("../domains/ai/useAIBio");
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function _interopRequireWildcard(e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (var _t in e) "default" !== _t && {}.hasOwnProperty.call(e, _t) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, _t)) && (i.get || i.set) ? o(f, _t, i) : f[_t] = e[_t]); return f; })(e, t); }
var TONES = [{
  id: "playful",
  label: "Playful",
  icon: "ðŸŽ¾",
  color: "#ff6b6b"
}, {
  id: "professional",
  label: "Professional",
  icon: "ðŸ’¼",
  color: "#4dabf7"
}, {
  id: "casual",
  label: "Casual",
  icon: "ðŸ˜Š",
  color: "#69db7c"
}, {
  id: "romantic",
  label: "Romantic",
  icon: "ðŸ’•",
  color: "#f783ac"
}, {
  id: "funny",
  label: "Funny",
  icon: "ðŸ˜„",
  color: "#ffd43b"
}];
var useAIBioScreen = exports.useAIBioScreen = function useAIBioScreen() {
  var navigation = (0, _native.useNavigation)();
  var _useAuthStore = (0, _core.useAuthStore)(),
    user = _useAuthStore.user;
  var _useAIBio = (0, _useAIBio2.useAIBio)(),
    generateAIBio = _useAIBio.generateBio,
    isGenerating = _useAIBio.isGenerating,
    lastGeneratedBio = _useAIBio.lastGeneratedBio,
    bioHistory = _useAIBio.bioHistory,
    addToHistory = _useAIBio.addToHistory,
    clearHistory = _useAIBio.clearHistory;
  var _useState = (0, _react.useState)(""),
    _useState2 = (0, _slicedToArray2.default)(_useState, 2),
    petName = _useState2[0],
    setPetName = _useState2[1];
  var _useState3 = (0, _react.useState)(""),
    _useState4 = (0, _slicedToArray2.default)(_useState3, 2),
    petBreed = _useState4[0],
    setPetBreed = _useState4[1];
  var _useState5 = (0, _react.useState)(""),
    _useState6 = (0, _slicedToArray2.default)(_useState5, 2),
    petAge = _useState6[0],
    setPetAge = _useState6[1];
  var _useState7 = (0, _react.useState)(""),
    _useState8 = (0, _slicedToArray2.default)(_useState7, 2),
    petPersonality = _useState8[0],
    setPetPersonality = _useState8[1];
  var _useState9 = (0, _react.useState)("playful"),
    _useState0 = (0, _slicedToArray2.default)(_useState9, 2),
    selectedTone = _useState0[0],
    setSelectedTone = _useState0[1];
  var _useState1 = (0, _react.useState)(null),
    _useState10 = (0, _slicedToArray2.default)(_useState1, 2),
    selectedPhoto = _useState10[0],
    setSelectedPhoto = _useState10[1];
  var pickImage = function () {
    var _ref = (0, _asyncToGenerator2.default)(function* () {
      var _yield$ImagePicker$re = yield ImagePicker.requestMediaLibraryPermissionsAsync(),
        status = _yield$ImagePicker$re.status;
      if (status !== "granted") {
        _reactNative.Alert.alert("Permission needed", "We need camera roll permissions to analyze your pet photo");
        return;
      }
      var result = yield ImagePicker.launchImageLibraryAsync({
        mediaTypes: ImagePicker.MediaTypeOptions.Images,
        allowsEditing: true,
        aspect: [1, 1],
        quality: 0.8
      });
      if (!result.canceled && result.assets && result.assets[0]) {
        setSelectedPhoto(result.assets[0].uri);
      }
    });
    return function pickImage() {
      return _ref.apply(this, arguments);
    };
  }();
  var generateBio = function () {
    var _ref2 = (0, _asyncToGenerator2.default)(function* () {
      if (!petName.trim()) {
        _reactNative.Alert.alert("Missing Information", "Please enter your pet's name");
        return;
      }
      try {
        var params = {
          petName: petName.trim(),
          keywords: petPersonality.trim().split(",").map(function (p) {
            return p.trim();
          }).filter(function (p) {
            return p.length > 0;
          }),
          tone: selectedTone,
          length: "medium",
          petType: "dog",
          age: parseInt(petAge.trim()) || 1,
          breed: petBreed.trim()
        };
        yield generateAIBio(params);
      } catch (error) {
        _core.logger.error("Bio generation failed", {
          error: error
        });
      }
    });
    return function generateBio() {
      return _ref2.apply(this, arguments);
    };
  }();
  var saveBio = function () {
    var _ref3 = (0, _asyncToGenerator2.default)(function* () {
      if (!lastGeneratedBio) return;
      try {
        if (user != null && user._id && lastGeneratedBio) {
          var _userPets$;
          var userPets = yield _api.api.getUserPets();
          if (userPets && userPets.length > 0 && (_userPets$ = userPets[0]) != null && _userPets$._id) {
            yield _api.api.updatePet(userPets[0]._id, {
              description: lastGeneratedBio.bio
            });
            _reactNative.Alert.alert("Success", "Pet profile updated successfully!");
            navigation.goBack();
          } else {
            _reactNative.Alert.alert("Saved Locally", "Bio has been saved to your device");
          }
        } else {
          _reactNative.Alert.alert("Saved Locally", "Bio has been saved to your device");
        }
      } catch (error) {
        _reactNative.Alert.alert("Saved Locally", "Bio has been saved to your device");
      }
    });
    return function saveBio() {
      return _ref3.apply(this, arguments);
    };
  }();
  var handleGoBack = function handleGoBack() {
    navigation.goBack();
  };
  var clearForm = function clearForm() {
    setPetName("");
    setPetBreed("");
    setPetAge("");
    setPetPersonality("");
    setSelectedTone("playful");
    setSelectedPhoto(null);
    clearHistory();
  };
  return {
    petName: petName,
    setPetName: setPetName,
    petBreed: petBreed,
    setPetBreed: setPetBreed,
    petAge: petAge,
    setPetAge: setPetAge,
    petPersonality: petPersonality,
    setPetPersonality: setPetPersonality,
    selectedTone: selectedTone,
    setSelectedTone: setSelectedTone,
    selectedPhoto: selectedPhoto,
    setSelectedPhoto: setSelectedPhoto,
    isGenerating: isGenerating,
    generatedBio: lastGeneratedBio,
    bioHistory: bioHistory,
    tones: TONES,
    pickImage: pickImage,
    generateBio: generateBio,
    saveBio: saveBio,
    handleGoBack: handleGoBack,
    clearForm: clearForm
  };
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbmF0aXZlIiwicmVxdWlyZSIsIl9yZWFjdCIsIkltYWdlUGlja2VyIiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJfcmVhY3ROYXRpdmUiLCJfY29yZSIsIl9hcGkiLCJfdXNlQUlCaW8yIiwiZSIsInQiLCJXZWFrTWFwIiwiciIsIm4iLCJfX2VzTW9kdWxlIiwibyIsImkiLCJmIiwiX19wcm90b19fIiwiZGVmYXVsdCIsImhhcyIsImdldCIsInNldCIsIl90IiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJUT05FUyIsImlkIiwibGFiZWwiLCJpY29uIiwiY29sb3IiLCJ1c2VBSUJpb1NjcmVlbiIsImV4cG9ydHMiLCJuYXZpZ2F0aW9uIiwidXNlTmF2aWdhdGlvbiIsIl91c2VBdXRoU3RvcmUiLCJ1c2VBdXRoU3RvcmUiLCJ1c2VyIiwiX3VzZUFJQmlvIiwidXNlQUlCaW8iLCJnZW5lcmF0ZUFJQmlvIiwiZ2VuZXJhdGVCaW8iLCJpc0dlbmVyYXRpbmciLCJsYXN0R2VuZXJhdGVkQmlvIiwiYmlvSGlzdG9yeSIsImFkZFRvSGlzdG9yeSIsImNsZWFySGlzdG9yeSIsIl91c2VTdGF0ZSIsInVzZVN0YXRlIiwiX3VzZVN0YXRlMiIsIl9zbGljZWRUb0FycmF5MiIsInBldE5hbWUiLCJzZXRQZXROYW1lIiwiX3VzZVN0YXRlMyIsIl91c2VTdGF0ZTQiLCJwZXRCcmVlZCIsInNldFBldEJyZWVkIiwiX3VzZVN0YXRlNSIsIl91c2VTdGF0ZTYiLCJwZXRBZ2UiLCJzZXRQZXRBZ2UiLCJfdXNlU3RhdGU3IiwiX3VzZVN0YXRlOCIsInBldFBlcnNvbmFsaXR5Iiwic2V0UGV0UGVyc29uYWxpdHkiLCJfdXNlU3RhdGU5IiwiX3VzZVN0YXRlMCIsInNlbGVjdGVkVG9uZSIsInNldFNlbGVjdGVkVG9uZSIsIl91c2VTdGF0ZTEiLCJfdXNlU3RhdGUxMCIsInNlbGVjdGVkUGhvdG8iLCJzZXRTZWxlY3RlZFBob3RvIiwicGlja0ltYWdlIiwiX3JlZiIsIl9hc3luY1RvR2VuZXJhdG9yMiIsIl95aWVsZCRJbWFnZVBpY2tlciRyZSIsInJlcXVlc3RNZWRpYUxpYnJhcnlQZXJtaXNzaW9uc0FzeW5jIiwic3RhdHVzIiwiQWxlcnQiLCJhbGVydCIsInJlc3VsdCIsImxhdW5jaEltYWdlTGlicmFyeUFzeW5jIiwibWVkaWFUeXBlcyIsIk1lZGlhVHlwZU9wdGlvbnMiLCJJbWFnZXMiLCJhbGxvd3NFZGl0aW5nIiwiYXNwZWN0IiwicXVhbGl0eSIsImNhbmNlbGVkIiwiYXNzZXRzIiwidXJpIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJfcmVmMiIsInRyaW0iLCJwYXJhbXMiLCJrZXl3b3JkcyIsInNwbGl0IiwibWFwIiwicCIsImZpbHRlciIsImxlbmd0aCIsInRvbmUiLCJwZXRUeXBlIiwiYWdlIiwicGFyc2VJbnQiLCJicmVlZCIsImVycm9yIiwibG9nZ2VyIiwic2F2ZUJpbyIsIl9yZWYzIiwiX2lkIiwiX3VzZXJQZXRzJCIsInVzZXJQZXRzIiwiYXBpIiwiZ2V0VXNlclBldHMiLCJ1cGRhdGVQZXQiLCJkZXNjcmlwdGlvbiIsImJpbyIsImdvQmFjayIsImhhbmRsZUdvQmFjayIsImNsZWFyRm9ybSIsImdlbmVyYXRlZEJpbyIsInRvbmVzIl0sInNvdXJjZXMiOlsidXNlQUlCaW9TY3JlZW4udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiB1c2VBSUJpb1NjcmVlbiBIb29rXG4gKiBNYW5hZ2VzIEFJIEJpbyBHZW5lcmF0b3Igc2NyZWVuIHN0YXRlIGFuZCBpbnRlcmFjdGlvbnNcbiAqL1xuaW1wb3J0IHsgdXNlTmF2aWdhdGlvbiB9IGZyb20gXCJAcmVhY3QtbmF2aWdhdGlvbi9uYXRpdmVcIjtcbmltcG9ydCB7IHVzZVN0YXRlIH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgKiBhcyBJbWFnZVBpY2tlciBmcm9tIFwiZXhwby1pbWFnZS1waWNrZXJcIjtcbmltcG9ydCB7IEFsZXJ0IH0gZnJvbSBcInJlYWN0LW5hdGl2ZVwiO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIkBwYXdmZWN0bWF0Y2gvY29yZVwiO1xuaW1wb3J0IHsgdXNlQXV0aFN0b3JlIH0gZnJvbSBcIkBwYXdmZWN0bWF0Y2gvY29yZVwiO1xuaW1wb3J0IHsgYXBpIH0gZnJvbSBcIi4uLy4uL3NlcnZpY2VzL2FwaVwiO1xuaW1wb3J0IHsgdXNlQUlCaW8gfSBmcm9tIFwiLi4vZG9tYWlucy9haS91c2VBSUJpb1wiO1xuXG5pbnRlcmZhY2UgVXNlQUlCaW9TY3JlZW5SZXR1cm4ge1xuICAvLyBGb3JtIHN0YXRlXG4gIHBldE5hbWU6IHN0cmluZztcbiAgc2V0UGV0TmFtZTogKG5hbWU6IHN0cmluZykgPT4gdm9pZDtcbiAgcGV0QnJlZWQ6IHN0cmluZztcbiAgc2V0UGV0QnJlZWQ6IChicmVlZDogc3RyaW5nKSA9PiB2b2lkO1xuICBwZXRBZ2U6IHN0cmluZztcbiAgc2V0UGV0QWdlOiAoYWdlOiBzdHJpbmcpID0+IHZvaWQ7XG4gIHBldFBlcnNvbmFsaXR5OiBzdHJpbmc7XG4gIHNldFBldFBlcnNvbmFsaXR5OiAocGVyc29uYWxpdHk6IHN0cmluZykgPT4gdm9pZDtcbiAgc2VsZWN0ZWRUb25lOiBzdHJpbmc7XG4gIHNldFNlbGVjdGVkVG9uZTogKHRvbmU6IHN0cmluZykgPT4gdm9pZDtcbiAgc2VsZWN0ZWRQaG90bzogc3RyaW5nIHwgbnVsbDtcbiAgc2V0U2VsZWN0ZWRQaG90bzogKHBob3RvOiBzdHJpbmcgfCBudWxsKSA9PiB2b2lkO1xuXG4gIC8vIFVJIHN0YXRlXG4gIGlzR2VuZXJhdGluZzogYm9vbGVhbjtcbiAgZ2VuZXJhdGVkQmlvOiBhbnkgfCBudWxsO1xuICBiaW9IaXN0b3J5OiBhbnlbXTtcbiAgdG9uZXM6IEFycmF5PHsgaWQ6IHN0cmluZzsgbGFiZWw6IHN0cmluZzsgaWNvbjogc3RyaW5nOyBjb2xvcjogc3RyaW5nIH0+O1xuXG4gIC8vIEFjdGlvbnNcbiAgcGlja0ltYWdlOiAoKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBnZW5lcmF0ZUJpbzogKCkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgc2F2ZUJpbzogKCkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgaGFuZGxlR29CYWNrOiAoKSA9PiB2b2lkO1xuICBjbGVhckZvcm06ICgpID0+IHZvaWQ7XG59XG5cbmNvbnN0IFRPTkVTID0gW1xuICB7IGlkOiBcInBsYXlmdWxcIiwgbGFiZWw6IFwiUGxheWZ1bFwiLCBpY29uOiBcIvCfjr5cIiwgY29sb3I6IFwiI2ZmNmI2YlwiIH0sXG4gIHsgaWQ6IFwicHJvZmVzc2lvbmFsXCIsIGxhYmVsOiBcIlByb2Zlc3Npb25hbFwiLCBpY29uOiBcIvCfkrxcIiwgY29sb3I6IFwiIzRkYWJmN1wiIH0sXG4gIHsgaWQ6IFwiY2FzdWFsXCIsIGxhYmVsOiBcIkNhc3VhbFwiLCBpY29uOiBcIvCfmIpcIiwgY29sb3I6IFwiIzY5ZGI3Y1wiIH0sXG4gIHsgaWQ6IFwicm9tYW50aWNcIiwgbGFiZWw6IFwiUm9tYW50aWNcIiwgaWNvbjogXCLwn5KVXCIsIGNvbG9yOiBcIiNmNzgzYWNcIiB9LFxuICB7IGlkOiBcImZ1bm55XCIsIGxhYmVsOiBcIkZ1bm55XCIsIGljb246IFwi8J+YhFwiLCBjb2xvcjogXCIjZmZkNDNiXCIgfSxcbl07XG5cbmV4cG9ydCBjb25zdCB1c2VBSUJpb1NjcmVlbiA9ICgpOiBVc2VBSUJpb1NjcmVlblJldHVybiA9PiB7XG4gIGNvbnN0IG5hdmlnYXRpb24gPSB1c2VOYXZpZ2F0aW9uKCk7XG4gIGNvbnN0IHsgdXNlciB9ID0gdXNlQXV0aFN0b3JlKCk7XG4gIGNvbnN0IHtcbiAgICBnZW5lcmF0ZUJpbzogZ2VuZXJhdGVBSUJpbyxcbiAgICBpc0dlbmVyYXRpbmcsXG4gICAgbGFzdEdlbmVyYXRlZEJpbyxcbiAgICBiaW9IaXN0b3J5LFxuICAgIGFkZFRvSGlzdG9yeSxcbiAgICBjbGVhckhpc3RvcnksXG4gIH0gPSB1c2VBSUJpbygpO1xuXG4gIC8vIEZvcm0gc3RhdGVcbiAgY29uc3QgW3BldE5hbWUsIHNldFBldE5hbWVdID0gdXNlU3RhdGUoXCJcIik7XG4gIGNvbnN0IFtwZXRCcmVlZCwgc2V0UGV0QnJlZWRdID0gdXNlU3RhdGUoXCJcIik7XG4gIGNvbnN0IFtwZXRBZ2UsIHNldFBldEFnZV0gPSB1c2VTdGF0ZShcIlwiKTtcbiAgY29uc3QgW3BldFBlcnNvbmFsaXR5LCBzZXRQZXRQZXJzb25hbGl0eV0gPSB1c2VTdGF0ZShcIlwiKTtcbiAgY29uc3QgW3NlbGVjdGVkVG9uZSwgc2V0U2VsZWN0ZWRUb25lXSA9IHVzZVN0YXRlKFwicGxheWZ1bFwiKTtcbiAgY29uc3QgW3NlbGVjdGVkUGhvdG8sIHNldFNlbGVjdGVkUGhvdG9dID0gdXNlU3RhdGU8c3RyaW5nIHwgbnVsbD4obnVsbCk7XG5cbiAgY29uc3QgcGlja0ltYWdlID0gYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHsgc3RhdHVzIH0gPSBhd2FpdCBJbWFnZVBpY2tlci5yZXF1ZXN0TWVkaWFMaWJyYXJ5UGVybWlzc2lvbnNBc3luYygpO1xuICAgIGlmIChzdGF0dXMgIT09IFwiZ3JhbnRlZFwiKSB7XG4gICAgICBBbGVydC5hbGVydChcbiAgICAgICAgXCJQZXJtaXNzaW9uIG5lZWRlZFwiLFxuICAgICAgICBcIldlIG5lZWQgY2FtZXJhIHJvbGwgcGVybWlzc2lvbnMgdG8gYW5hbHl6ZSB5b3VyIHBldCBwaG90b1wiLFxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBJbWFnZVBpY2tlci5sYXVuY2hJbWFnZUxpYnJhcnlBc3luYyh7XG4gICAgICBtZWRpYVR5cGVzOiBJbWFnZVBpY2tlci5NZWRpYVR5cGVPcHRpb25zLkltYWdlcyxcbiAgICAgIGFsbG93c0VkaXRpbmc6IHRydWUsXG4gICAgICBhc3BlY3Q6IFsxLCAxXSxcbiAgICAgIHF1YWxpdHk6IDAuOCxcbiAgICB9KTtcblxuICAgIGlmICghcmVzdWx0LmNhbmNlbGVkICYmIHJlc3VsdC5hc3NldHMgJiYgcmVzdWx0LmFzc2V0c1swXSkge1xuICAgICAgc2V0U2VsZWN0ZWRQaG90byhyZXN1bHQuYXNzZXRzWzBdLnVyaSk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGdlbmVyYXRlQmlvID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmICghcGV0TmFtZS50cmltKCkpIHtcbiAgICAgIEFsZXJ0LmFsZXJ0KFwiTWlzc2luZyBJbmZvcm1hdGlvblwiLCBcIlBsZWFzZSBlbnRlciB5b3VyIHBldCdzIG5hbWVcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgcGV0TmFtZTogcGV0TmFtZS50cmltKCksXG4gICAgICAgIGtleXdvcmRzOiBwZXRQZXJzb25hbGl0eVxuICAgICAgICAgIC50cmltKClcbiAgICAgICAgICAuc3BsaXQoXCIsXCIpXG4gICAgICAgICAgLm1hcCgocCkgPT4gcC50cmltKCkpXG4gICAgICAgICAgLmZpbHRlcigocCkgPT4gcC5sZW5ndGggPiAwKSxcbiAgICAgICAgdG9uZTogc2VsZWN0ZWRUb25lIGFzXG4gICAgICAgICAgfCBcInBsYXlmdWxcIlxuICAgICAgICAgIHwgXCJwcm9mZXNzaW9uYWxcIlxuICAgICAgICAgIHwgXCJjYXN1YWxcIlxuICAgICAgICAgIHwgXCJyb21hbnRpY1wiXG4gICAgICAgICAgfCBcImZ1bm55XCIsXG4gICAgICAgIGxlbmd0aDogXCJtZWRpdW1cIiBhcyBjb25zdCxcbiAgICAgICAgcGV0VHlwZTogXCJkb2dcIiBhcyBjb25zdCwgLy8gQ291bGQgYmUgbWFkZSBkeW5hbWljXG4gICAgICAgIGFnZTogcGFyc2VJbnQocGV0QWdlLnRyaW0oKSkgfHwgMSxcbiAgICAgICAgYnJlZWQ6IHBldEJyZWVkLnRyaW0oKSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGdlbmVyYXRlQUlCaW8ocGFyYW1zKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKFwiQmlvIGdlbmVyYXRpb24gZmFpbGVkXCIsIHsgZXJyb3IgfSk7XG4gICAgICAvLyBFcnJvciBoYW5kbGluZyBpcyBkb25lIGluIHRoZSB1c2VBSUJpbyBob29rXG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHNhdmVCaW8gPSBhc3luYyAoKSA9PiB7XG4gICAgaWYgKCFsYXN0R2VuZXJhdGVkQmlvKSByZXR1cm47XG5cbiAgICB0cnkge1xuICAgICAgLy8gVXBkYXRlIHBldCBwcm9maWxlIHdpdGggZ2VuZXJhdGVkIGJpb1xuICAgICAgaWYgKHVzZXI/Ll9pZCAmJiBsYXN0R2VuZXJhdGVkQmlvKSB7XG4gICAgICAgIC8vIEFzc3VtaW5nIHdlIGhhdmUgYSBwZXRJZCBmcm9tIHJvdXRlIHBhcmFtcyBvciB1c2VyJ3MgZmlyc3QgcGV0XG4gICAgICAgIGNvbnN0IHVzZXJQZXRzID0gYXdhaXQgYXBpLmdldFVzZXJQZXRzKCk7XG4gICAgICAgIGlmICh1c2VyUGV0cyAmJiB1c2VyUGV0cy5sZW5ndGggPiAwICYmIHVzZXJQZXRzWzBdPy5faWQpIHtcbiAgICAgICAgICBhd2FpdCBhcGkudXBkYXRlUGV0KHVzZXJQZXRzWzBdLl9pZCwge1xuICAgICAgICAgICAgZGVzY3JpcHRpb246IGxhc3RHZW5lcmF0ZWRCaW8uYmlvLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgQWxlcnQuYWxlcnQoXCJTdWNjZXNzXCIsIFwiUGV0IHByb2ZpbGUgdXBkYXRlZCBzdWNjZXNzZnVsbHkhXCIpO1xuICAgICAgICAgIG5hdmlnYXRpb24uZ29CYWNrKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgQWxlcnQuYWxlcnQoXCJTYXZlZCBMb2NhbGx5XCIsIFwiQmlvIGhhcyBiZWVuIHNhdmVkIHRvIHlvdXIgZGV2aWNlXCIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBBbGVydC5hbGVydChcIlNhdmVkIExvY2FsbHlcIiwgXCJCaW8gaGFzIGJlZW4gc2F2ZWQgdG8geW91ciBkZXZpY2VcIik7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIEFsZXJ0LmFsZXJ0KFwiU2F2ZWQgTG9jYWxseVwiLCBcIkJpbyBoYXMgYmVlbiBzYXZlZCB0byB5b3VyIGRldmljZVwiKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgaGFuZGxlR29CYWNrID0gKCkgPT4ge1xuICAgIG5hdmlnYXRpb24uZ29CYWNrKCk7XG4gIH07XG5cbiAgY29uc3QgY2xlYXJGb3JtID0gKCkgPT4ge1xuICAgIHNldFBldE5hbWUoXCJcIik7XG4gICAgc2V0UGV0QnJlZWQoXCJcIik7XG4gICAgc2V0UGV0QWdlKFwiXCIpO1xuICAgIHNldFBldFBlcnNvbmFsaXR5KFwiXCIpO1xuICAgIHNldFNlbGVjdGVkVG9uZShcInBsYXlmdWxcIik7XG4gICAgc2V0U2VsZWN0ZWRQaG90byhudWxsKTtcbiAgICBjbGVhckhpc3RvcnkoKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIC8vIEZvcm0gc3RhdGVcbiAgICBwZXROYW1lLFxuICAgIHNldFBldE5hbWUsXG4gICAgcGV0QnJlZWQsXG4gICAgc2V0UGV0QnJlZWQsXG4gICAgcGV0QWdlLFxuICAgIHNldFBldEFnZSxcbiAgICBwZXRQZXJzb25hbGl0eSxcbiAgICBzZXRQZXRQZXJzb25hbGl0eSxcbiAgICBzZWxlY3RlZFRvbmUsXG4gICAgc2V0U2VsZWN0ZWRUb25lLFxuICAgIHNlbGVjdGVkUGhvdG8sXG4gICAgc2V0U2VsZWN0ZWRQaG90byxcblxuICAgIC8vIFVJIHN0YXRlXG4gICAgaXNHZW5lcmF0aW5nLFxuICAgIGdlbmVyYXRlZEJpbzogbGFzdEdlbmVyYXRlZEJpbyxcbiAgICBiaW9IaXN0b3J5LFxuICAgIHRvbmVzOiBUT05FUyxcblxuICAgIC8vIEFjdGlvbnNcbiAgICBwaWNrSW1hZ2UsXG4gICAgZ2VuZXJhdGVCaW8sXG4gICAgc2F2ZUJpbyxcbiAgICBoYW5kbGVHb0JhY2ssXG4gICAgY2xlYXJGb3JtLFxuICB9O1xufTtc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