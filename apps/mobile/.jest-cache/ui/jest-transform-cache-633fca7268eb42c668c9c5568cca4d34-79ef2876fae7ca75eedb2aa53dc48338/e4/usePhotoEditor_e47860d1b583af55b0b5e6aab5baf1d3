e47be0dd15605adca5fe8655d7eac021
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.DEFAULT_ADJUSTMENTS = void 0;
exports.usePhotoEditor = usePhotoEditor;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _react = require("react");
var ImageManipulator = _interopRequireWildcard(require("expo-image-manipulator"));
var _reactNative = require("react-native");
var _core = require("@pawfectmatch/core");
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function _interopRequireWildcard(e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (var _t in e) "default" !== _t && {}.hasOwnProperty.call(e, _t) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, _t)) && (i.get || i.set) ? o(f, _t, i) : f[_t] = e[_t]); return f; })(e, t); }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
var DEFAULT_ADJUSTMENTS = exports.DEFAULT_ADJUSTMENTS = {
  brightness: 100,
  contrast: 100,
  saturation: 100,
  warmth: 0,
  blur: 0,
  sharpen: 0
};
function usePhotoEditor(initialUri) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  var _options$maxWidth = options.maxWidth,
    maxWidth = _options$maxWidth === void 0 ? 1920 : _options$maxWidth,
    _options$maxHeight = options.maxHeight,
    maxHeight = _options$maxHeight === void 0 ? 1920 : _options$maxHeight,
    _options$quality = options.quality,
    quality = _options$quality === void 0 ? 0.9 : _options$quality;
  var _useState = (0, _react.useState)(initialUri),
    _useState2 = (0, _slicedToArray2.default)(_useState, 2),
    uri = _useState2[0],
    setUri = _useState2[1];
  var _useState3 = (0, _react.useState)(false),
    _useState4 = (0, _slicedToArray2.default)(_useState3, 2),
    isLoading = _useState4[0],
    setIsLoading = _useState4[1];
  var _useState5 = (0, _react.useState)(DEFAULT_ADJUSTMENTS),
    _useState6 = (0, _slicedToArray2.default)(_useState5, 2),
    adjustments = _useState6[0],
    setAdjustments = _useState6[1];
  var _useState7 = (0, _react.useState)(0),
    _useState8 = (0, _slicedToArray2.default)(_useState7, 2),
    rotation = _useState8[0],
    setRotation = _useState8[1];
  var _useState9 = (0, _react.useState)(false),
    _useState0 = (0, _slicedToArray2.default)(_useState9, 2),
    flipHorizontal = _useState0[0],
    setFlipHorizontal = _useState0[1];
  var _useState1 = (0, _react.useState)(false),
    _useState10 = (0, _slicedToArray2.default)(_useState1, 2),
    flipVertical = _useState10[0],
    setFlipVertical = _useState10[1];
  var manipulationHistoryRef = (0, _react.useRef)([initialUri]);
  var updateAdjustment = (0, _react.useCallback)(function (key, value) {
    setAdjustments(function (prev) {
      return _objectSpread(_objectSpread({}, prev), {}, (0, _defineProperty2.default)({}, key, value));
    });
  }, []);
  var rotateLeft = (0, _react.useCallback)(function () {
    setRotation(function (prev) {
      var newRotation = (prev - 90) % 360;
      return newRotation < 0 ? 360 + newRotation : newRotation;
    });
  }, []);
  var rotateRight = (0, _react.useCallback)(function () {
    setRotation(function (prev) {
      return (prev + 90) % 360;
    });
  }, []);
  var applyFilter = (0, _react.useCallback)(function (filter) {
    setAdjustments(function (prev) {
      return _objectSpread(_objectSpread({}, prev), filter);
    });
  }, []);
  var resetAdjustments = (0, _react.useCallback)(function () {
    setAdjustments(DEFAULT_ADJUSTMENTS);
    setRotation(0);
    setFlipHorizontal(false);
    setFlipVertical(false);
    setUri(initialUri);
    manipulationHistoryRef.current = [initialUri];
  }, [initialUri]);
  var saveImage = (0, _react.useCallback)((0, _asyncToGenerator2.default)(function* () {
    setIsLoading(true);
    try {
      var actions = [];
      if (rotation !== 0) {
        actions.push({
          rotate: rotation
        });
      }
      if (flipHorizontal) {
        actions.push({
          flip: ImageManipulator.FlipType.Horizontal
        });
      }
      if (flipVertical) {
        actions.push({
          flip: ImageManipulator.FlipType.Vertical
        });
      }
      actions.push({
        resize: {
          width: maxWidth,
          height: maxHeight
        }
      });
      var result;
      if (actions.length > 0) {
        result = yield ImageManipulator.manipulateAsync(uri, actions, {
          compress: quality,
          format: ImageManipulator.SaveFormat.JPEG
        });
      } else {
        result = yield ImageManipulator.manipulateAsync(uri, [], {
          compress: quality,
          format: ImageManipulator.SaveFormat.JPEG
        });
      }
      var adjustmentsParam = encodeURIComponent(JSON.stringify(adjustments));
      var finalUri = `${result.uri}?adjustments=${adjustmentsParam}`;
      manipulationHistoryRef.current.push(finalUri);
      _core.logger.info('Photo saved with adjustments', {
        finalUri: finalUri
      });
      return finalUri;
    } catch (error) {
      _core.logger.error('Photo save failed', {
        error: error
      });
      _reactNative.Alert.alert('Error', 'Failed to save image. Please try again.');
      return null;
    } finally {
      setIsLoading(false);
    }
  }), [uri, rotation, flipHorizontal, flipVertical, adjustments, maxWidth, maxHeight, quality]);
  return {
    uri: uri,
    isLoading: isLoading,
    adjustments: adjustments,
    rotation: rotation,
    flipHorizontal: flipHorizontal,
    flipVertical: flipVertical,
    updateAdjustment: updateAdjustment,
    setRotation: setRotation,
    setFlipHorizontal: setFlipHorizontal,
    setFlipVertical: setFlipVertical,
    applyFilter: applyFilter,
    resetAdjustments: resetAdjustments,
    saveImage: saveImage,
    rotateLeft: rotateLeft,
    rotateRight: rotateRight
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwiSW1hZ2VNYW5pcHVsYXRvciIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwiX3JlYWN0TmF0aXZlIiwiX2NvcmUiLCJlIiwidCIsIldlYWtNYXAiLCJyIiwibiIsIl9fZXNNb2R1bGUiLCJvIiwiaSIsImYiLCJfX3Byb3RvX18iLCJkZWZhdWx0IiwiaGFzIiwiZ2V0Iiwic2V0IiwiX3QiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsIm93bktleXMiLCJrZXlzIiwiZ2V0T3duUHJvcGVydHlTeW1ib2xzIiwiZmlsdGVyIiwiZW51bWVyYWJsZSIsInB1c2giLCJhcHBseSIsIl9vYmplY3RTcHJlYWQiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJmb3JFYWNoIiwiX2RlZmluZVByb3BlcnR5MiIsImdldE93blByb3BlcnR5RGVzY3JpcHRvcnMiLCJkZWZpbmVQcm9wZXJ0aWVzIiwiREVGQVVMVF9BREpVU1RNRU5UUyIsImV4cG9ydHMiLCJicmlnaHRuZXNzIiwiY29udHJhc3QiLCJzYXR1cmF0aW9uIiwid2FybXRoIiwiYmx1ciIsInNoYXJwZW4iLCJ1c2VQaG90b0VkaXRvciIsImluaXRpYWxVcmkiLCJvcHRpb25zIiwidW5kZWZpbmVkIiwiX29wdGlvbnMkbWF4V2lkdGgiLCJtYXhXaWR0aCIsIl9vcHRpb25zJG1heEhlaWdodCIsIm1heEhlaWdodCIsIl9vcHRpb25zJHF1YWxpdHkiLCJxdWFsaXR5IiwiX3VzZVN0YXRlIiwidXNlU3RhdGUiLCJfdXNlU3RhdGUyIiwiX3NsaWNlZFRvQXJyYXkyIiwidXJpIiwic2V0VXJpIiwiX3VzZVN0YXRlMyIsIl91c2VTdGF0ZTQiLCJpc0xvYWRpbmciLCJzZXRJc0xvYWRpbmciLCJfdXNlU3RhdGU1IiwiX3VzZVN0YXRlNiIsImFkanVzdG1lbnRzIiwic2V0QWRqdXN0bWVudHMiLCJfdXNlU3RhdGU3IiwiX3VzZVN0YXRlOCIsInJvdGF0aW9uIiwic2V0Um90YXRpb24iLCJfdXNlU3RhdGU5IiwiX3VzZVN0YXRlMCIsImZsaXBIb3Jpem9udGFsIiwic2V0RmxpcEhvcml6b250YWwiLCJfdXNlU3RhdGUxIiwiX3VzZVN0YXRlMTAiLCJmbGlwVmVydGljYWwiLCJzZXRGbGlwVmVydGljYWwiLCJtYW5pcHVsYXRpb25IaXN0b3J5UmVmIiwidXNlUmVmIiwidXBkYXRlQWRqdXN0bWVudCIsInVzZUNhbGxiYWNrIiwia2V5IiwidmFsdWUiLCJwcmV2Iiwicm90YXRlTGVmdCIsIm5ld1JvdGF0aW9uIiwicm90YXRlUmlnaHQiLCJhcHBseUZpbHRlciIsInJlc2V0QWRqdXN0bWVudHMiLCJjdXJyZW50Iiwic2F2ZUltYWdlIiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwiYWN0aW9ucyIsInJvdGF0ZSIsImZsaXAiLCJGbGlwVHlwZSIsIkhvcml6b250YWwiLCJWZXJ0aWNhbCIsInJlc2l6ZSIsIndpZHRoIiwiaGVpZ2h0IiwicmVzdWx0IiwibWFuaXB1bGF0ZUFzeW5jIiwiY29tcHJlc3MiLCJmb3JtYXQiLCJTYXZlRm9ybWF0IiwiSlBFRyIsImFkanVzdG1lbnRzUGFyYW0iLCJlbmNvZGVVUklDb21wb25lbnQiLCJKU09OIiwic3RyaW5naWZ5IiwiZmluYWxVcmkiLCJsb2dnZXIiLCJpbmZvIiwiZXJyb3IiLCJBbGVydCIsImFsZXJ0Il0sInNvdXJjZXMiOlsidXNlUGhvdG9FZGl0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlU3RhdGUsIHVzZUNhbGxiYWNrLCB1c2VSZWYgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgKiBhcyBJbWFnZU1hbmlwdWxhdG9yIGZyb20gJ2V4cG8taW1hZ2UtbWFuaXB1bGF0b3InO1xuaW1wb3J0IHsgQWxlcnQgfSBmcm9tICdyZWFjdC1uYXRpdmUnO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnQHBhd2ZlY3RtYXRjaC9jb3JlJztcbmltcG9ydCB0eXBlIHsgUGhvdG9BZGp1c3RtZW50cyB9IGZyb20gJy4uL2NvbXBvbmVudHMvcGhvdG8vQWR2YW5jZWRQaG90b0VkaXRvcic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXNlUGhvdG9FZGl0b3JPcHRpb25zIHtcbiAgbWF4V2lkdGg/OiBudW1iZXI7XG4gIG1heEhlaWdodD86IG51bWJlcjtcbiAgcXVhbGl0eT86IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVc2VQaG90b0VkaXRvclJldHVybiB7XG4gIHVyaTogc3RyaW5nOyAvLyBvcmlnaW5hbCBVUkksIGZvciBlZGl0aW5nXG4gIGlzTG9hZGluZzogYm9vbGVhbjtcbiAgYWRqdXN0bWVudHM6IFBob3RvQWRqdXN0bWVudHM7XG4gIHJvdGF0aW9uOiBudW1iZXI7XG4gIGZsaXBIb3Jpem9udGFsOiBib29sZWFuO1xuICBmbGlwVmVydGljYWw6IGJvb2xlYW47XG4gIHVwZGF0ZUFkanVzdG1lbnQ6IChrZXk6IGtleW9mIFBob3RvQWRqdXN0bWVudHMsIHZhbHVlOiBudW1iZXIpID0+IHZvaWQ7XG4gIHNldFJvdGF0aW9uOiAoZGVncmVlczogbnVtYmVyKSA9PiB2b2lkO1xuICBzZXRGbGlwSG9yaXpvbnRhbDogKGZsaXA6IGJvb2xlYW4pID0+IHZvaWQ7XG4gIHNldEZsaXBWZXJ0aWNhbDogKGZsaXA6IGJvb2xlYW4pID0+IHZvaWQ7XG4gIGFwcGx5RmlsdGVyOiAoZmlsdGVyOiBQYXJ0aWFsPFBob3RvQWRqdXN0bWVudHM+KSA9PiB2b2lkO1xuICByZXNldEFkanVzdG1lbnRzOiAoKSA9PiB2b2lkO1xuICBzYXZlSW1hZ2U6ICgpID0+IFByb21pc2U8c3RyaW5nIHwgbnVsbD47XG4gIHJvdGF0ZUxlZnQ6ICgpID0+IHZvaWQ7XG4gIHJvdGF0ZVJpZ2h0OiAoKSA9PiB2b2lkO1xufVxuXG5leHBvcnQgY29uc3QgREVGQVVMVF9BREpVU1RNRU5UUzogUGhvdG9BZGp1c3RtZW50cyA9IHtcbiAgYnJpZ2h0bmVzczogMTAwLFxuICBjb250cmFzdDogMTAwLFxuICBzYXR1cmF0aW9uOiAxMDAsXG4gIHdhcm10aDogMCxcbiAgYmx1cjogMCxcbiAgc2hhcnBlbjogMCxcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiB1c2VQaG90b0VkaXRvcihcbiAgaW5pdGlhbFVyaTogc3RyaW5nLFxuICBvcHRpb25zOiBVc2VQaG90b0VkaXRvck9wdGlvbnMgPSB7fSxcbik6IFVzZVBob3RvRWRpdG9yUmV0dXJuIHtcbiAgY29uc3QgeyBtYXhXaWR0aCA9IDE5MjAsIG1heEhlaWdodCA9IDE5MjAsIHF1YWxpdHkgPSAwLjkgfSA9IG9wdGlvbnM7XG5cbiAgY29uc3QgW3VyaSwgc2V0VXJpXSA9IHVzZVN0YXRlKGluaXRpYWxVcmkpO1xuICBjb25zdCBbaXNMb2FkaW5nLCBzZXRJc0xvYWRpbmddID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCBbYWRqdXN0bWVudHMsIHNldEFkanVzdG1lbnRzXSA9IHVzZVN0YXRlPFBob3RvQWRqdXN0bWVudHM+KERFRkFVTFRfQURKVVNUTUVOVFMpO1xuICBjb25zdCBbcm90YXRpb24sIHNldFJvdGF0aW9uXSA9IHVzZVN0YXRlKDApO1xuICBjb25zdCBbZmxpcEhvcml6b250YWwsIHNldEZsaXBIb3Jpem9udGFsXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW2ZsaXBWZXJ0aWNhbCwgc2V0RmxpcFZlcnRpY2FsXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgbWFuaXB1bGF0aW9uSGlzdG9yeVJlZiA9IHVzZVJlZjxzdHJpbmdbXT4oW2luaXRpYWxVcmldKTtcblxuICBjb25zdCB1cGRhdGVBZGp1c3RtZW50ID0gdXNlQ2FsbGJhY2soXG4gICAgKGtleToga2V5b2YgUGhvdG9BZGp1c3RtZW50cywgdmFsdWU6IG51bWJlcikgPT4ge1xuICAgICAgc2V0QWRqdXN0bWVudHMoKHByZXYpID0+ICh7IC4uLnByZXYsIFtrZXldOiB2YWx1ZSB9KSk7XG4gICAgfSxcbiAgICBbXSxcbiAgKTtcblxuICBjb25zdCByb3RhdGVMZWZ0ID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHNldFJvdGF0aW9uKChwcmV2KSA9PiB7XG4gICAgICBjb25zdCBuZXdSb3RhdGlvbiA9IChwcmV2IC0gOTApICUgMzYwO1xuICAgICAgcmV0dXJuIG5ld1JvdGF0aW9uIDwgMCA/IDM2MCArIG5ld1JvdGF0aW9uIDogbmV3Um90YXRpb247XG4gICAgfSk7XG4gIH0sIFtdKTtcblxuICBjb25zdCByb3RhdGVSaWdodCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBzZXRSb3RhdGlvbigocHJldikgPT4gKHByZXYgKyA5MCkgJSAzNjApO1xuICB9LCBbXSk7XG5cbiAgY29uc3QgYXBwbHlGaWx0ZXIgPSB1c2VDYWxsYmFjaygoZmlsdGVyOiBQYXJ0aWFsPFBob3RvQWRqdXN0bWVudHM+KSA9PiB7XG4gICAgc2V0QWRqdXN0bWVudHMoKHByZXYpID0+ICh7IC4uLnByZXYsIC4uLmZpbHRlciB9KSk7XG4gIH0sIFtdKTtcblxuICBjb25zdCByZXNldEFkanVzdG1lbnRzID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHNldEFkanVzdG1lbnRzKERFRkFVTFRfQURKVVNUTUVOVFMpO1xuICAgIHNldFJvdGF0aW9uKDApO1xuICAgIHNldEZsaXBIb3Jpem9udGFsKGZhbHNlKTtcbiAgICBzZXRGbGlwVmVydGljYWwoZmFsc2UpO1xuICAgIHNldFVyaShpbml0aWFsVXJpKTtcbiAgICBtYW5pcHVsYXRpb25IaXN0b3J5UmVmLmN1cnJlbnQgPSBbaW5pdGlhbFVyaV07XG4gIH0sIFtpbml0aWFsVXJpXSk7XG5cbiAgY29uc3Qgc2F2ZUltYWdlID0gdXNlQ2FsbGJhY2soYXN5bmMgKCk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4gPT4ge1xuICAgIHNldElzTG9hZGluZyh0cnVlKTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYWN0aW9uczogSW1hZ2VNYW5pcHVsYXRvci5BY3Rpb25bXSA9IFtdO1xuXG4gICAgICAvLyBBcHBseSByb3RhdGlvblxuICAgICAgaWYgKHJvdGF0aW9uICE9PSAwKSB7XG4gICAgICAgIGFjdGlvbnMucHVzaCh7IHJvdGF0ZTogcm90YXRpb24gfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFwcGx5IGZsaXBzXG4gICAgICBpZiAoZmxpcEhvcml6b250YWwpIHtcbiAgICAgICAgYWN0aW9ucy5wdXNoKHsgZmxpcDogSW1hZ2VNYW5pcHVsYXRvci5GbGlwVHlwZS5Ib3Jpem9udGFsIH0pO1xuICAgICAgfVxuICAgICAgaWYgKGZsaXBWZXJ0aWNhbCkge1xuICAgICAgICBhY3Rpb25zLnB1c2goeyBmbGlwOiBJbWFnZU1hbmlwdWxhdG9yLkZsaXBUeXBlLlZlcnRpY2FsIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBBcHBseSByZXNpemUgaWYgbmVlZGVkXG4gICAgICBhY3Rpb25zLnB1c2goe1xuICAgICAgICByZXNpemU6IHsgd2lkdGg6IG1heFdpZHRoLCBoZWlnaHQ6IG1heEhlaWdodCB9LFxuICAgICAgfSk7XG5cbiAgICAgIGxldCByZXN1bHQ7XG4gICAgICBpZiAoYWN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJlc3VsdCA9IGF3YWl0IEltYWdlTWFuaXB1bGF0b3IubWFuaXB1bGF0ZUFzeW5jKFxuICAgICAgICAgIHVyaSxcbiAgICAgICAgICBhY3Rpb25zLFxuICAgICAgICAgIHsgY29tcHJlc3M6IHF1YWxpdHksIGZvcm1hdDogSW1hZ2VNYW5pcHVsYXRvci5TYXZlRm9ybWF0LkpQRUcgfSxcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3VsdCA9IGF3YWl0IEltYWdlTWFuaXB1bGF0b3IubWFuaXB1bGF0ZUFzeW5jKFxuICAgICAgICAgIHVyaSxcbiAgICAgICAgICBbXSxcbiAgICAgICAgICB7IGNvbXByZXNzOiBxdWFsaXR5LCBmb3JtYXQ6IEltYWdlTWFuaXB1bGF0b3IuU2F2ZUZvcm1hdC5KUEVHIH0sXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFwcGx5IGFkdmFuY2VkIGFkanVzdG1lbnRzIHVzaW5nIENsb3VkaW5hcnkgdHJhbnNmb3JtYXRpb25zXG4gICAgICAvLyBFbmNvZGUgYWRqdXN0bWVudHMgaW4gdGhlIFVSSSBmb3Igc2VydmVyLXNpZGUgcHJvY2Vzc2luZ1xuICAgICAgY29uc3QgYWRqdXN0bWVudHNQYXJhbSA9IGVuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeShhZGp1c3RtZW50cykpO1xuICAgICAgY29uc3QgZmluYWxVcmkgPSBgJHtyZXN1bHQudXJpfT9hZGp1c3RtZW50cz0ke2FkanVzdG1lbnRzUGFyYW19YDtcblxuICAgICAgbWFuaXB1bGF0aW9uSGlzdG9yeVJlZi5jdXJyZW50LnB1c2goZmluYWxVcmkpO1xuICAgICAgbG9nZ2VyLmluZm8oJ1Bob3RvIHNhdmVkIHdpdGggYWRqdXN0bWVudHMnLCB7IGZpbmFsVXJpIH0pO1xuXG4gICAgICByZXR1cm4gZmluYWxVcmk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignUGhvdG8gc2F2ZSBmYWlsZWQnLCB7IGVycm9yIH0pO1xuICAgICAgQWxlcnQuYWxlcnQoJ0Vycm9yJywgJ0ZhaWxlZCB0byBzYXZlIGltYWdlLiBQbGVhc2UgdHJ5IGFnYWluLicpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHNldElzTG9hZGluZyhmYWxzZSk7XG4gICAgfVxuICB9LCBbdXJpLCByb3RhdGlvbiwgZmxpcEhvcml6b250YWwsIGZsaXBWZXJ0aWNhbCwgYWRqdXN0bWVudHMsIG1heFdpZHRoLCBtYXhIZWlnaHQsIHF1YWxpdHldKTtcblxuICByZXR1cm4ge1xuICAgIHVyaSxcbiAgICBpc0xvYWRpbmcsXG4gICAgYWRqdXN0bWVudHMsXG4gICAgcm90YXRpb24sXG4gICAgZmxpcEhvcml6b250YWwsXG4gICAgZmxpcFZlcnRpY2FsLFxuICAgIHVwZGF0ZUFkanVzdG1lbnQsXG4gICAgc2V0Um90YXRpb24sXG4gICAgc2V0RmxpcEhvcml6b250YWwsXG4gICAgc2V0RmxpcFZlcnRpY2FsLFxuICAgIGFwcGx5RmlsdGVyLFxuICAgIHJlc2V0QWRqdXN0bWVudHMsXG4gICAgc2F2ZUltYWdlLFxuICAgIHJvdGF0ZUxlZnQsXG4gICAgcm90YXRlUmlnaHQsXG4gIH07XG59XG5cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQSxJQUFBQSxNQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxnQkFBQSxHQUFBQyx1QkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQUcsWUFBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksS0FBQSxHQUFBSixPQUFBO0FBQTRDLFNBQUFFLHdCQUFBRyxDQUFBLEVBQUFDLENBQUEsNkJBQUFDLE9BQUEsTUFBQUMsQ0FBQSxPQUFBRCxPQUFBLElBQUFFLENBQUEsT0FBQUYsT0FBQSxZQUFBTCx1QkFBQSxZQUFBQSx3QkFBQUcsQ0FBQSxFQUFBQyxDQUFBLFNBQUFBLENBQUEsSUFBQUQsQ0FBQSxJQUFBQSxDQUFBLENBQUFLLFVBQUEsU0FBQUwsQ0FBQSxNQUFBTSxDQUFBLEVBQUFDLENBQUEsRUFBQUMsQ0FBQSxLQUFBQyxTQUFBLFFBQUFDLE9BQUEsRUFBQVYsQ0FBQSxpQkFBQUEsQ0FBQSx1QkFBQUEsQ0FBQSx5QkFBQUEsQ0FBQSxTQUFBUSxDQUFBLE1BQUFGLENBQUEsR0FBQUwsQ0FBQSxHQUFBRyxDQUFBLEdBQUFELENBQUEsUUFBQUcsQ0FBQSxDQUFBSyxHQUFBLENBQUFYLENBQUEsVUFBQU0sQ0FBQSxDQUFBTSxHQUFBLENBQUFaLENBQUEsR0FBQU0sQ0FBQSxDQUFBTyxHQUFBLENBQUFiLENBQUEsRUFBQVEsQ0FBQSxjQUFBTSxFQUFBLElBQUFkLENBQUEsZ0JBQUFjLEVBQUEsT0FBQUMsY0FBQSxDQUFBQyxJQUFBLENBQUFoQixDQUFBLEVBQUFjLEVBQUEsT0FBQVAsQ0FBQSxJQUFBRCxDQUFBLEdBQUFXLE1BQUEsQ0FBQUMsY0FBQSxLQUFBRCxNQUFBLENBQUFFLHdCQUFBLENBQUFuQixDQUFB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