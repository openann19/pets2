{"version":3,"names":["_react","require","_reactNative","_core","_gdprService","_interopRequireDefault","useSettingsScreen","exports","_useAuthStore","useAuthStore","logout","user","_useState","useState","email","push","matches","messages","_useState2","_slicedToArray2","default","notifications","setNotifications","_useState3","maxDistance","ageRange","min","max","species","intents","_useState4","preferences","setPreferences","_useState5","isPending","daysRemaining","_useState6","deletionStatus","setDeletionStatus","useEffect","checkDeletionStatus","_ref","_asyncToGenerator2","status","gdprService","getAccountStatus","success","_status$daysRemaining","error","logger","apply","arguments","handleLogout","useCallback","Alert","alert","text","style","onPress","handleDeleteAccount","prompt","_onPress","password","response","deleteAccount","reason","message","_x","handleExportData","exportUserData","exportData","exportId","handleExportDataComplete"],"sources":["useSettingsScreen.ts"],"sourcesContent":["/**\n * useSettingsScreen Hook\n * Manages SettingsScreen state and business logic\n */\nimport { useCallback, useEffect, useState } from \"react\";\nimport { Alert } from \"react-native\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport { logger } from \"@pawfectmatch/core\";\nimport { useAuthStore } from \"@pawfectmatch/core\";\nimport gdprService from \"../../services/gdprService\";\n\ninterface Notifications {\n  email: boolean;\n  push: boolean;\n  matches: boolean;\n  messages: boolean;\n}\n\ninterface Preferences {\n  maxDistance: number;\n  ageRange: { min: number; max: number };\n  species: string[];\n  intents: string[];\n}\n\ninterface DeletionStatus {\n  isPending: boolean;\n  daysRemaining: number | null;\n}\n\ninterface UseSettingsScreenReturn {\n  notifications: Notifications;\n  preferences: Preferences;\n  deletionStatus: DeletionStatus;\n  setNotifications: (notifications: Notifications) => void;\n  setPreferences: (preferences: Preferences) => void;\n  handleLogout: () => void;\n  handleDeleteAccount: () => void;\n  handleExportData: () => Promise<void>;\n  handleExportDataComplete: () => void;\n}\n\nexport const useSettingsScreen = (): UseSettingsScreenReturn => {\n  const { logout, user } = useAuthStore();\n\n  const [notifications, setNotifications] = useState<Notifications>({\n    email: true,\n    push: true,\n    matches: true,\n    messages: true,\n  });\n\n  const [preferences, setPreferences] = useState<Preferences>({\n    maxDistance: 50,\n    ageRange: { min: 0, max: 30 },\n    species: [],\n    intents: [],\n  });\n\n  const [deletionStatus, setDeletionStatus] = useState<DeletionStatus>({\n    isPending: false,\n    daysRemaining: null,\n  });\n\n  // Check deletion status on mount\n  useEffect(() => {\n    const checkDeletionStatus = async () => {\n      try {\n        const status = await gdprService.getAccountStatus();\n        if (status.success && status.status === 'pending') {\n          setDeletionStatus({\n            isPending: true,\n            daysRemaining: status.daysRemaining ?? null,\n          });\n        } else {\n          setDeletionStatus({\n            isPending: false,\n            daysRemaining: null,\n          });\n        }\n      } catch (error) {\n        logger.error(\"Failed to check deletion status:\", { error });\n      }\n    };\n\n    void checkDeletionStatus();\n  }, []);\n\n  const handleLogout = useCallback(() => {\n    Alert.alert(\"Logout\", \"Are you sure you want to logout?\", [\n      { text: \"Cancel\", style: \"cancel\" },\n      {\n        text: \"Logout\",\n        style: \"destructive\",\n        onPress: () => {\n          logout();\n        },\n      },\n    ]);\n  }, [logout]);\n\n  const handleDeleteAccount = useCallback(() => {\n    // Password prompt for account deletion\n    Alert.prompt(\n      \"Delete Account\",\n      \"Enter your password to confirm account deletion.\\n\\nYour account will be deleted in 30 days unless you cancel.\",\n      [\n        { text: \"Cancel\", style: \"cancel\" },\n        {\n          text: \"Delete\",\n          style: \"destructive\",\n          onPress: async (password) => {\n            if (!password) {\n              Alert.alert(\"Error\", \"Password is required to delete your account.\");\n              return;\n            }\n            \n            try {\n              const response = await gdprService.deleteAccount({\n                password,\n                reason: \"User requested from settings\",\n              });\n              \n              if (response.success) {\n                setDeletionStatus({ \n                  isPending: true, \n                  daysRemaining: 30 \n                });\n                Alert.alert(\n                  \"Account Deletion Requested\",\n                  \"Your account will be deleted in 30 days. You can cancel this anytime from settings.\",\n                );\n              } else {\n                Alert.alert(\"Error\", response.message || \"Failed to delete account.\");\n              }\n            } catch (error) {\n              logger.error(\"Failed to request account deletion:\", { error });\n              Alert.alert(\"Error\", \"Failed to delete account. Please try again.\");\n            }\n          },\n        },\n      ],\n      \"secure-text\"\n    );\n  }, []);\n\n  const handleExportData = useCallback(async () => {\n    try {\n      const response = await gdprService.exportUserData();\n      \n      if (response.success && response.exportData) {\n        // In a real app, you would download or share the data\n        Alert.alert(\n          \"Data Export Ready\",\n          `Your data export is ready! Export ID: ${response.exportId}. You will receive an email when it's available for download.`\n        );\n      } else {\n        Alert.alert(\"Export Started\", response.message || \"Your data export is being prepared.\");\n      }\n    } catch (error) {\n      logger.error(\"Failed to export data:\", { error });\n      Alert.alert(\"Error\", \"Failed to export data. Please try again.\");\n    }\n  }, []);\n\n  const handleExportDataComplete = useCallback(() => {\n    Alert.alert(\"Export Complete\", \"Your data has been exported successfully.\");\n  }, []);\n\n  return {\n    notifications,\n    preferences,\n    deletionStatus,\n    setNotifications,\n    setPreferences,\n    handleLogout,\n    handleDeleteAccount,\n    handleExportData,\n    handleExportDataComplete,\n  };\n};\n"],"mappings":"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","ignoreList":[]}