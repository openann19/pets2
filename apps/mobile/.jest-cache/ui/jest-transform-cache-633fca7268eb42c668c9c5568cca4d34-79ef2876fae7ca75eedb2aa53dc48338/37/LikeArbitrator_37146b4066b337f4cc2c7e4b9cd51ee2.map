{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNative","_reactNativeGestureHandler","_reactNativeReanimated","Haptics","_DoubleTapLikePlus","_interopRequireDefault","_ReactionBarMagnetic","_jsxRuntime","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","_t2","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","_worklet_12977718807929_init_data","code","location","sourceMap","_worklet_10838375468706_init_data","_worklet_12830717888325_init_data","_worklet_3072899645029_init_data","_worklet_9151852408825_init_data","_worklet_5125055951239_init_data","LikeArbitrator","_ref","children","onLike","onUndo","onReact","triggerUndo","_ref$a11yLongPressLab","a11yLongPressLabel","_useState","useState","_useState2","_slicedToArray2","reactionsOpen","setReactionsOpen","lift","useSharedValue","liftStyle","useAnimatedStyle","_e","global","Error","_f","transform","translateY","value","_closure","__initData","__workletHash","__stackDetails","__version","closeReactions","useCallback","openReactions","handleDoubleTap","impactAsync","ImpactFeedbackStyle","Medium","catch","cleanup","handleSelectReaction","emoji","selectionAsync","longPress","useMemo","Gesture","LongPress","minDuration","maxDistance","hitSlop","top","bottom","left","right","onBegin","onStart","runOnJS","onFinalize","withSpring","damping","stiffness","singleTap","Tap","maxDuration","onEnd","ok","doubleTap","numberOfTaps","maxDelay","requireExternalGestureToFail","composed","Exclusive","Simultaneous","jsxs","View","style","styles","root","accessible","accessibilityLabel","jsx","GestureDetector","gesture","onDoubleTap","reactionOverlay","pointerEvents","onSelect","onCancel","StyleSheet","create","position","alignItems"],"sources":["LikeArbitrator.tsx"],"sourcesContent":["import React, { useCallback, useMemo, useState } from \"react\";\nimport { StyleSheet, View } from \"react-native\";\nimport { Gesture, GestureDetector } from \"react-native-gesture-handler\";\nimport Animated, {\n  runOnJS,\n  useSharedValue,\n  useAnimatedStyle,\n  withSpring,\n} from \"react-native-reanimated\";\nimport * as Haptics from \"expo-haptics\";\n\nimport DoubleTapLikePlus from \"./DoubleTapLikePlus\";\nimport ReactionBarMagnetic from \"../chat/ReactionBarMagnetic\";\n\n/**\n * Wraps content with:\n *  - Double tap to like (optimistic)\n *  - Long press to open reactions\n * Uses require-to-fail so a recognized long-press cancels double-tap.\n */\nexport interface LikeArbitratorProps {\n  children: React.ReactNode;\n  /** optimistic like toggle; return a cleanup function if you need cancel on undo */\n  onLike: () => void | (() => void);\n  /** fired if user undoes within the window or server rejects */\n  onUndo?: () => void;\n  /** fired when a reaction is chosen from the bar */\n  onReact?: (emoji: string) => void;\n  /** show undo pill for N ms (used by external UndoPill hook) */\n  triggerUndo?: () => void;\n  /** accessibility label for long-press */\n  a11yLongPressLabel?: string;\n}\n\nexport default function LikeArbitrator({\n  children,\n  onLike,\n  onUndo,\n  onReact,\n  triggerUndo,\n  a11yLongPressLabel = \"Open reactions\",\n}: LikeArbitratorProps) {\n  const [reactionsOpen, setReactionsOpen] = useState(false);\n\n  // small lift when long-press begins (visual affordance)\n  const lift = useSharedValue(0);\n  const liftStyle = useAnimatedStyle(() => ({\n    transform: [{ translateY: lift.value }],\n  }));\n\n  const closeReactions = useCallback(() => { setReactionsOpen(false); }, []);\n  const openReactions = useCallback(() => { setReactionsOpen(true); }, []);\n\n  const handleDoubleTap = useCallback(() => {\n    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium).catch(() => {});\n    const cleanup = onLike();\n    triggerUndo?.();\n    // if onLike returns a cleanup, store it in closure of Undo (handled in hook usage)\n    // nothing else needed here\n  }, [onLike, triggerUndo]);\n\n  const handleSelectReaction = useCallback(\n    (emoji: string) => {\n      Haptics.selectionAsync().catch(() => {});\n      onReact?.(emoji);\n      setReactionsOpen(false);\n    },\n    [onReact],\n  );\n\n  // --- GESTURES -------------------------------------------------------------\n\n  const longPress = useMemo(\n    () =>\n      Gesture.LongPress()\n        .minDuration(350)\n        .maxDistance(8)\n        .hitSlop({ top: 4, bottom: 4, left: 4, right: 4 })\n        .onBegin(() => {\n          lift.value = -4;\n        })\n        .onStart(() => {\n          runOnJS(openReactions)();\n        })\n        .onFinalize(() => {\n          lift.value = withSpring(0, { damping: 18, stiffness: 320 });\n        }),\n    [openReactions, lift],\n  );\n\n  const singleTap = Gesture.Tap()\n    .maxDuration(220)\n    .maxDistance(8)\n    .onEnd((_e, ok) => {\n      \"worklet\";\n      if (!ok) return;\n      // single taps just bounce the content a smidge for feedback (DoubleTapLikePlus already handles)\n    });\n\n  const doubleTap = Gesture.Tap()\n    .numberOfTaps(2)\n    .maxDelay(280)\n    .maxDuration(260)\n    .maxDistance(8)\n    // CRITICAL: if long-press recognizes, double-tap must fail\n    .requireExternalGestureToFail(longPress)\n    .onEnd((_e, ok) => {\n      \"worklet\";\n      if (!ok) return;\n      runOnJS(handleDoubleTap)();\n    });\n\n  // Exclusive: once one wins, the other cancels.\n  const composed = Gesture.Exclusive(\n    Gesture.Simultaneous(doubleTap, singleTap),\n    longPress,\n  );\n\n  return (\n    <View style={styles.root} accessible accessibilityLabel={a11yLongPressLabel}>\n      <GestureDetector gesture={composed}>\n        <Animated.View style={liftStyle}>\n          <DoubleTapLikePlus onDoubleTap={handleDoubleTap}>\n            {children}\n          </DoubleTapLikePlus>\n        </Animated.View>\n      </GestureDetector>\n\n      {reactionsOpen ? (\n        <View style={styles.reactionOverlay} pointerEvents=\"box-none\">\n          <ReactionBarMagnetic\n            onSelect={handleSelectReaction}\n            onCancel={closeReactions}\n          />\n        </View>\n      ) : null}\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  root: { position: \"relative\" },\n  reactionOverlay: {\n    position: \"absolute\",\n    left: 0,\n    right: 0,\n    bottom: 24,\n    alignItems: \"center\",\n  },\n});\n\n"],"mappings":"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","ignoreList":[]}