{"version":3,"names":["_getJestObj","mock","getItem","jest","fn","setItem","removeItem","_interopRequireDefault","require","_asyncToGenerator2","_reactNative","_usePersistedState","_asyncStorage","_require","mockAsyncStorage","AsyncStorage","describe","beforeEach","clearAllMocks","mockResolvedValue","it","default","initialValue","theme","language","_renderHook","renderHook","usePersistedState","key","result","act","Promise","resolve","setTimeout","expect","current","value","toEqual","storedValue","JSON","stringify","_renderHook2","toHaveBeenCalledWith","count","_renderHook3","newValue","setValue","consoleSpy","spyOn","console","mockImplementation","mockRejectedValue","Error","data","_renderHook4","toHaveBeenCalled","mockRestore","_renderHook5","firstSetValue","_renderHook6","result2","toBe"],"sources":["usePersistedState.test.ts"],"sourcesContent":["/**\n * @jest-environment jsdom\n */\nimport { renderHook, act } from \"@testing-library/react-native\";\nimport { usePersistedState } from \"../usePersistedState\";\n\n// Mock AsyncStorage\njest.mock(\"@react-native-async-storage/async-storage\", () => ({\n  getItem: jest.fn(),\n  setItem: jest.fn(),\n  removeItem: jest.fn(),\n}));\n\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\n\nconst mockAsyncStorage = AsyncStorage as jest.Mocked<typeof AsyncStorage>;\n\ndescribe(\"usePersistedState\", () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    mockAsyncStorage.getItem.mockResolvedValue(null);\n    mockAsyncStorage.setItem.mockResolvedValue();\n  });\n\n  it(\"should initialize with provided initial value when no stored value\", async () => {\n    const initialValue = { theme: \"light\", language: \"en\" };\n    const { result } = renderHook(() =>\n      usePersistedState({ key: \"test-key\", initialValue }),\n    );\n\n    // Wait for async initialization\n    await act(async () => {\n      await new Promise((resolve) => setTimeout(resolve, 0));\n    });\n\n    expect(result.current.value).toEqual(initialValue);\n  });\n\n  it(\"should load stored value from AsyncStorage\", async () => {\n    const storedValue = { theme: \"dark\", language: \"es\" };\n    mockAsyncStorage.getItem.mockResolvedValue(JSON.stringify(storedValue));\n\n    const { result } = renderHook(() =>\n      usePersistedState({\n        key: \"test-key\",\n        initialValue: { theme: \"light\", language: \"en\" },\n      }),\n    );\n\n    await act(async () => {\n      await new Promise((resolve) => setTimeout(resolve, 0));\n    });\n\n    expect(mockAsyncStorage.getItem).toHaveBeenCalledWith(\"test-key\");\n    expect(result.current.value).toEqual(storedValue);\n  });\n\n  it(\"should update stored value when setValue is called\", async () => {\n    const initialValue = { count: 0 };\n    const { result } = renderHook(() =>\n      usePersistedState({ key: \"counter\", initialValue }),\n    );\n\n    await act(async () => {\n      await new Promise((resolve) => setTimeout(resolve, 0));\n    });\n\n    const newValue = { count: 5 };\n    act(() => {\n      result.current.setValue(newValue);\n    });\n\n    expect(mockAsyncStorage.setItem).toHaveBeenCalledWith(\n      \"counter\",\n      JSON.stringify(newValue),\n    );\n    expect(result.current.value).toEqual(newValue);\n  });\n\n  it(\"should handle AsyncStorage errors gracefully\", async () => {\n    const consoleSpy = jest.spyOn(console, \"error\").mockImplementation();\n    mockAsyncStorage.getItem.mockRejectedValue(new Error(\"Storage error\"));\n\n    const initialValue = { data: \"fallback\" };\n    const { result } = renderHook(() =>\n      usePersistedState({ key: \"error-key\", initialValue }),\n    );\n\n    await act(async () => {\n      await new Promise((resolve) => setTimeout(resolve, 0));\n    });\n\n    expect(result.current.value).toEqual(initialValue);\n    expect(consoleSpy).toHaveBeenCalled();\n\n    consoleSpy.mockRestore();\n  });\n\n  it(\"should return stable function references\", async () => {\n    const { result } = renderHook(() =>\n      usePersistedState({ key: \"stable-test\", initialValue: {} }),\n    );\n\n    await act(async () => {\n      await new Promise((resolve) => setTimeout(resolve, 0));\n    });\n\n    const firstSetValue = result.current.setValue;\n\n    // Create new hook instance\n    const { result: result2 } = renderHook(() =>\n      usePersistedState({ key: \"stable-test-2\", initialValue: {} }),\n    );\n\n    await act(async () => {\n      await new Promise((resolve) => setTimeout(resolve, 0));\n    });\n\n    expect(result.current.setValue).toBe(firstSetValue);\n  });\n});\n"],"mappings":"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","ignoreList":[]}