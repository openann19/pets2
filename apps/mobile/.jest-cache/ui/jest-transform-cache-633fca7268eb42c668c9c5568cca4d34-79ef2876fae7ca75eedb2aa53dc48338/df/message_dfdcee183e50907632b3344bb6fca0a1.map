{"version":3,"names":["_interopRequireDefault","require","_defineProperty2","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","default","getOwnPropertyDescriptors","defineProperties","defineProperty","exports","value","toCoreMessage","toCoreMessages","legacy","_legacy$_id","_ref","_legacy$messageType","_legacy$attachments","_ref3","_ref4","_legacy$sentAt","_legacy$readBy","_legacy$isEdited","_legacy$isDeleted","messageId","_id","id","contentCandidate","content","text","message","find","trim","sender","undefined","_legacy$senderId","senderId","email","firstName","lastName","dateOfBirth","age","location","type","coordinates","preferences","maxDistance","ageRange","min","max","species","intents","notifications","matches","messages","premium","isActive","plan","features","unlimitedLikes","boostProfile","seeWhoLiked","advancedFilters","pets","analytics","totalSwipes","totalLikes","totalMatches","profileViews","lastActive","Date","toISOString","isEmailVerified","createdAt","updatedAt","_senderObj$name","_senderObj$_id","_senderObj$email","senderObj","senderName","name","nameParts","split","slice","join","avatar","rawType","messageType","isMessageType","normalizedType","toLowerCase","attachments","map","att","_att$fileName","_att$fileType","_ref2","_att$type","fileName","fileNameObj","resolvedFileType","fileType","url","sentAt","timestamp","readBy","editedAt","isEdited","isDeleted","legacyMessages"],"sources":["message.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.toCoreMessage = toCoreMessage;\nexports.toCoreMessages = toCoreMessages;\nfunction toCoreMessage(legacy) {\n    const messageId = legacy._id ?? legacy.id;\n    const contentCandidate = [legacy.content, legacy.text, legacy.message].find((value) => typeof value === 'string' && value.trim().length > 0);\n    const content = contentCandidate ?? '';\n    // Handle sender - could be string ID or object\n    let sender;\n    if (typeof legacy.sender === 'string' || legacy.sender === undefined) {\n        // Create minimal user object\n        const senderId = typeof legacy.sender === 'string' && legacy.sender.length > 0\n            ? legacy.sender\n            : legacy.senderId ?? messageId;\n        sender = {\n            _id: senderId,\n            id: senderId, // Alias for _id\n            email: '',\n            firstName: 'User',\n            lastName: '',\n            dateOfBirth: '',\n            age: 0,\n            location: {\n                type: 'Point',\n                coordinates: [0, 0],\n            },\n            preferences: {\n                maxDistance: 50,\n                ageRange: { min: 18, max: 100 },\n                species: [],\n                intents: [],\n                notifications: {\n                    email: true,\n                    push: true,\n                    matches: true,\n                    messages: true,\n                },\n            },\n            premium: {\n                isActive: false,\n                plan: 'basic',\n                features: {\n                    unlimitedLikes: false,\n                    boostProfile: false,\n                    seeWhoLiked: false,\n                    advancedFilters: false,\n                },\n            },\n            pets: [],\n            analytics: {\n                totalSwipes: 0,\n                totalLikes: 0,\n                totalMatches: 0,\n                profileViews: 0,\n                lastActive: new Date().toISOString(),\n            },\n            isEmailVerified: false,\n            isActive: true,\n            createdAt: new Date().toISOString(),\n            updatedAt: new Date().toISOString(),\n        };\n    }\n    else {\n        const senderObj = legacy.sender;\n        const senderName = senderObj.name ?? 'User';\n        const nameParts = senderName.split(' ');\n        const firstName = nameParts[0] != null && nameParts[0].trim() !== '' ? nameParts[0] : 'User';\n        const lastName = nameParts.slice(1).join(' ').trim();\n        sender = {\n            _id: senderObj._id ?? senderObj.id,\n            id: senderObj.id,\n            email: senderObj.email ?? '',\n            firstName,\n            lastName,\n            dateOfBirth: '',\n            age: 0,\n            ...(senderObj.avatar != null && senderObj.avatar.trim() !== '' ? { avatar: senderObj.avatar } : {}),\n            location: {\n                type: 'Point',\n                coordinates: [0, 0],\n            },\n            preferences: {\n                maxDistance: 50,\n                ageRange: { min: 18, max: 100 },\n                species: [],\n                intents: [],\n                notifications: {\n                    email: true,\n                    push: true,\n                    matches: true,\n                    messages: true,\n                },\n            },\n            premium: {\n                isActive: false,\n                plan: 'basic',\n                features: {\n                    unlimitedLikes: false,\n                    boostProfile: false,\n                    seeWhoLiked: false,\n                    advancedFilters: false,\n                },\n            },\n            pets: [],\n            analytics: {\n                totalSwipes: 0,\n                totalLikes: 0,\n                totalMatches: 0,\n                profileViews: 0,\n                lastActive: new Date().toISOString(),\n            },\n            isEmailVerified: false,\n            isActive: true,\n            createdAt: new Date().toISOString(),\n            updatedAt: new Date().toISOString(),\n        };\n    }\n    // Normalize message type\n    const rawType = legacy.messageType ?? legacy.type ?? 'text';\n    const isMessageType = (value) => {\n        return value === 'text' || value === 'image' || value === 'location' || value === 'system';\n    };\n    const normalizedType = rawType.toLowerCase();\n    const messageType = isMessageType(normalizedType) ? normalizedType : 'text';\n    // Convert attachments\n    const attachments = (legacy.attachments ?? []).map(att => {\n        const fileName = att.fileName?.trim();\n        const fileNameObj = fileName != null && fileName.length > 0 ? { fileName } : {};\n        const resolvedFileType = att.fileType ?? att.type;\n        return {\n            type: att.type ?? att.fileType ?? 'file',\n            url: att.url,\n            ...fileNameObj,\n            ...(resolvedFileType != null ? { fileType: resolvedFileType } : {}),\n        };\n    });\n    // Get timestamp\n    const sentAt = legacy.sentAt ?? legacy.timestamp ?? legacy.createdAt ?? new Date().toISOString();\n    return {\n        _id: messageId,\n        sender,\n        content,\n        messageType,\n        ...(attachments.length > 0 ? { attachments } : {}),\n        readBy: legacy.readBy ?? [],\n        sentAt,\n        ...(legacy.editedAt != null ? { editedAt: legacy.editedAt } : {}),\n        isEdited: legacy.isEdited ?? false,\n        isDeleted: legacy.isDeleted ?? false,\n    };\n}\n/**\n * Convert array of legacy messages to core Message types\n */\nfunction toCoreMessages(legacyMessages) {\n    return legacyMessages.map(toCoreMessage);\n}\n"],"mappings":"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","ignoreList":[]}