{"version":3,"names":["_react","require","_asyncStorage","_interopRequireDefault","_logger","useScrollPersistence","_ref","key","_ref$enabled","enabled","listRef","useRef","_useState","useState","_useState2","_slicedToArray2","default","initialOffset","setInitialOffset","didRestoreRef","useEffect","restore","_ref2","_asyncToGenerator2","saved","AsyncStorage","getItem","offset","Number","error","err","Error","String","logger","apply","arguments","current","requestAnimationFrame","_listRef$current","scrollToOffset","animated","handleScroll","useCallback","_ref3","setItem","_x","restoreScroll"],"sources":["useScrollPersistence.ts"],"sourcesContent":["import { useCallback, useEffect, useRef, useState } from \"react\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport type { FlatList } from \"react-native\";\nimport { logger } from \"../../services/logger\";\n\nexport interface UseScrollPersistenceOptions {\n  key: string;\n  enabled?: boolean;\n}\n\nexport interface UseScrollPersistenceReturn {\n  listRef: React.RefObject<FlatList<any>>;\n  initialOffset: number;\n  handleScroll: (offset: number) => Promise<void>;\n  restoreScroll: () => void;\n}\n\n/**\n * Hook for persisting scroll position to AsyncStorage\n *\n * @example\n * const { listRef, initialOffset, handleScroll, restoreScroll } = useScrollPersistence({\n *   key: 'matches_scroll',\n * });\n */\nexport function useScrollPersistence({\n  key,\n  enabled = true,\n}: UseScrollPersistenceOptions): UseScrollPersistenceReturn {\n  const listRef = useRef<FlatList<any>>(null);\n  const [initialOffset, setInitialOffset] = useState<number>(0);\n  const didRestoreRef = useRef(false);\n\n  // Restore scroll position on mount\n  useEffect(() => {\n    const restore = async () => {\n      if (!enabled) return;\n\n      try {\n        const saved = await AsyncStorage.getItem(key);\n        if (saved) {\n          const offset = Number(saved);\n          setInitialOffset(offset);\n        }\n      } catch (error: unknown) {\n        const err = error instanceof Error ? error : new Error(String(error));\n        logger.error('Failed to restore scroll position', { key, error: err });\n      }\n    };\n\n    void restore();\n  }, [key, enabled]);\n\n  // Scroll to initial position when data loads\n  useEffect(() => {\n    if (initialOffset > 0 && !didRestoreRef.current) {\n      requestAnimationFrame(() => {\n        listRef.current?.scrollToOffset({\n          offset: initialOffset,\n          animated: false,\n        });\n        didRestoreRef.current = true;\n      });\n    }\n  }, [initialOffset]);\n\n  const handleScroll = useCallback(\n    async (offset: number) => {\n      if (!enabled) return;\n\n      try {\n        await AsyncStorage.setItem(key, String(offset));\n      } catch (error: unknown) {\n        const err = error instanceof Error ? error : new Error(String(error));\n        logger.error('Failed to save scroll position', { key, error: err });\n      }\n    },\n    [key, enabled],\n  );\n\n  const restoreScroll = useCallback(() => {\n    didRestoreRef.current = false;\n    void handleScroll(0);\n  }, [handleScroll]);\n\n  return {\n    listRef,\n    initialOffset,\n    handleScroll,\n    restoreScroll,\n  };\n}\n"],"mappings":"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","ignoreList":[]}