ebb2c2558ada7d3ff4194f429b84e6e5
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useAIBioScreen = void 0;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _native = require("@react-navigation/native");
var _react = require("react");
var ImagePicker = _interopRequireWildcard(require("expo-image-picker"));
var _reactNative = require("react-native");
var _core = require("@pawfectmatch/core");
var _api = require("../../services/api");
var _useAIBio2 = require("../domains/ai/useAIBio");
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function _interopRequireWildcard(e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (var _t2 in e) "default" !== _t2 && {}.hasOwnProperty.call(e, _t2) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, _t2)) && (i.get || i.set) ? o(f, _t2, i) : f[_t2] = e[_t2]); return f; })(e, t); }
var TONES = [{
  id: "playful",
  label: "Playful",
  icon: "ðŸŽ¾",
  color: "#ff6b6b"
}, {
  id: "professional",
  label: "Professional",
  icon: "ðŸ’¼",
  color: "#4dabf7"
}, {
  id: "casual",
  label: "Casual",
  icon: "ðŸ˜Š",
  color: "#69db7c"
}, {
  id: "romantic",
  label: "Romantic",
  icon: "ðŸ’•",
  color: "#f783ac"
}, {
  id: "funny",
  label: "Funny",
  icon: "ðŸ˜„",
  color: "#ffd43b"
}];
var useAIBioScreen = exports.useAIBioScreen = function useAIBioScreen() {
  var navigation = (0, _native.useNavigation)();
  var _useAuthStore = (0, _core.useAuthStore)(),
    user = _useAuthStore.user;
  var _useAIBio = (0, _useAIBio2.useAIBio)(),
    generateAIBio = _useAIBio.generateBio,
    isGenerating = _useAIBio.isGenerating,
    lastGeneratedBio = _useAIBio.lastGeneratedBio,
    bioHistory = _useAIBio.bioHistory,
    addToHistory = _useAIBio.addToHistory,
    clearHistory = _useAIBio.clearHistory;
  var _useState = (0, _react.useState)(""),
    _useState2 = (0, _slicedToArray2.default)(_useState, 2),
    petName = _useState2[0],
    setPetName = _useState2[1];
  var _useState3 = (0, _react.useState)(""),
    _useState4 = (0, _slicedToArray2.default)(_useState3, 2),
    petBreed = _useState4[0],
    setPetBreed = _useState4[1];
  var _useState5 = (0, _react.useState)(""),
    _useState6 = (0, _slicedToArray2.default)(_useState5, 2),
    petAge = _useState6[0],
    setPetAge = _useState6[1];
  var _useState7 = (0, _react.useState)(""),
    _useState8 = (0, _slicedToArray2.default)(_useState7, 2),
    petPersonality = _useState8[0],
    setPetPersonality = _useState8[1];
  var _useState9 = (0, _react.useState)("playful"),
    _useState0 = (0, _slicedToArray2.default)(_useState9, 2),
    selectedTone = _useState0[0],
    setSelectedTone = _useState0[1];
  var _useState1 = (0, _react.useState)(null),
    _useState10 = (0, _slicedToArray2.default)(_useState1, 2),
    selectedPhoto = _useState10[0],
    setSelectedPhoto = _useState10[1];
  var pickImage = function () {
    var _ref = (0, _asyncToGenerator2.default)(function* () {
      var _yield$ImagePicker$re = yield ImagePicker.requestMediaLibraryPermissionsAsync(),
        status = _yield$ImagePicker$re.status;
      if (status !== "granted") {
        _reactNative.Alert.alert("Permission needed", "We need camera roll permissions to analyze your pet photo");
        return;
      }
      var result = yield ImagePicker.launchImageLibraryAsync({
        mediaTypes: ImagePicker.MediaTypeOptions.Images,
        allowsEditing: true,
        aspect: [1, 1],
        quality: 0.8
      });
      if (!result.canceled && result.assets && result.assets[0]) {
        setSelectedPhoto(result.assets[0].uri);
      }
    });
    return function pickImage() {
      return _ref.apply(this, arguments);
    };
  }();
  var generateBio = function () {
    var _ref2 = (0, _asyncToGenerator2.default)(function* () {
      if (!petName.trim()) {
        _reactNative.Alert.alert("Missing Information", "Please enter your pet's name");
        return;
      }
      try {
        var params = {
          petName: petName.trim(),
          keywords: petPersonality.trim().split(",").map(function (p) {
            return p.trim();
          }).filter(function (p) {
            return p.length > 0;
          }),
          tone: selectedTone,
          length: "medium",
          petType: "dog",
          age: parseInt(petAge.trim()) || 1,
          breed: petBreed.trim()
        };
        yield generateAIBio(params);
      } catch (error) {
        _core.logger.error("Bio generation failed", {
          error: error
        });
      }
    });
    return function generateBio() {
      return _ref2.apply(this, arguments);
    };
  }();
  var saveBio = function () {
    var _ref3 = (0, _asyncToGenerator2.default)(function* () {
      if (!lastGeneratedBio) return;
      try {
        if (user != null && user._id && lastGeneratedBio) {
          var _userPets$;
          var userPets = yield _api.api.getUserPets();
          if (userPets && userPets.length > 0 && (_userPets$ = userPets[0]) != null && _userPets$._id) {
            yield _api.api.updatePet(userPets[0]._id, {
              description: lastGeneratedBio.bio
            });
            _reactNative.Alert.alert("Success", "Pet profile updated successfully!");
            navigation.goBack();
          } else {
            _reactNative.Alert.alert("Saved Locally", "Bio has been saved to your device");
          }
        } else {
          _reactNative.Alert.alert("Saved Locally", "Bio has been saved to your device");
        }
      } catch (error) {
        _reactNative.Alert.alert("Saved Locally", "Bio has been saved to your device");
      }
    });
    return function saveBio() {
      return _ref3.apply(this, arguments);
    };
  }();
  var handleGoBack = function handleGoBack() {
    navigation.goBack();
  };
  var clearForm = function clearForm() {
    setPetName("");
    setPetBreed("");
    setPetAge("");
    setPetPersonality("");
    setSelectedTone("playful");
    setSelectedPhoto(null);
    clearHistory();
  };
  return {
    petName: petName,
    setPetName: setPetName,
    petBreed: petBreed,
    setPetBreed: setPetBreed,
    petAge: petAge,
    setPetAge: setPetAge,
    petPersonality: petPersonality,
    setPetPersonality: setPetPersonality,
    selectedTone: selectedTone,
    setSelectedTone: setSelectedTone,
    selectedPhoto: selectedPhoto,
    setSelectedPhoto: setSelectedPhoto,
    isGenerating: isGenerating,
    generatedBio: lastGeneratedBio,
    bioHistory: bioHistory,
    tones: TONES,
    pickImage: pickImage,
    generateBio: generateBio,
    saveBio: saveBio,
    handleGoBack: handleGoBack,
    clearForm: clearForm
  };
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbmF0aXZlIiwicmVxdWlyZSIsIl9yZWFjdCIsIkltYWdlUGlja2VyIiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJfcmVhY3ROYXRpdmUiLCJfY29yZSIsIl9hcGkiLCJfdXNlQUlCaW8yIiwiZSIsInQiLCJXZWFrTWFwIiwiciIsIm4iLCJfX2VzTW9kdWxlIiwibyIsImkiLCJmIiwiX19wcm90b19fIiwiZGVmYXVsdCIsImhhcyIsImdldCIsInNldCIsIl90MiIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiVE9ORVMiLCJpZCIsImxhYmVsIiwiaWNvbiIsImNvbG9yIiwidXNlQUlCaW9TY3JlZW4iLCJleHBvcnRzIiwibmF2aWdhdGlvbiIsInVzZU5hdmlnYXRpb24iLCJfdXNlQXV0aFN0b3JlIiwidXNlQXV0aFN0b3JlIiwidXNlciIsIl91c2VBSUJpbyIsInVzZUFJQmlvIiwiZ2VuZXJhdGVBSUJpbyIsImdlbmVyYXRlQmlvIiwiaXNHZW5lcmF0aW5nIiwibGFzdEdlbmVyYXRlZEJpbyIsImJpb0hpc3RvcnkiLCJhZGRUb0hpc3RvcnkiLCJjbGVhckhpc3RvcnkiLCJfdXNlU3RhdGUiLCJ1c2VTdGF0ZSIsIl91c2VTdGF0ZTIiLCJfc2xpY2VkVG9BcnJheTIiLCJwZXROYW1lIiwic2V0UGV0TmFtZSIsIl91c2VTdGF0ZTMiLCJfdXNlU3RhdGU0IiwicGV0QnJlZWQiLCJzZXRQZXRCcmVlZCIsIl91c2VTdGF0ZTUiLCJfdXNlU3RhdGU2IiwicGV0QWdlIiwic2V0UGV0QWdlIiwiX3VzZVN0YXRlNyIsIl91c2VTdGF0ZTgiLCJwZXRQZXJzb25hbGl0eSIsInNldFBldFBlcnNvbmFsaXR5IiwiX3VzZVN0YXRlOSIsIl91c2VTdGF0ZTAiLCJzZWxlY3RlZFRvbmUiLCJzZXRTZWxlY3RlZFRvbmUiLCJfdXNlU3RhdGUxIiwiX3VzZVN0YXRlMTAiLCJzZWxlY3RlZFBob3RvIiwic2V0U2VsZWN0ZWRQaG90byIsInBpY2tJbWFnZSIsIl9yZWYiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJfeWllbGQkSW1hZ2VQaWNrZXIkcmUiLCJyZXF1ZXN0TWVkaWFMaWJyYXJ5UGVybWlzc2lvbnNBc3luYyIsInN0YXR1cyIsIkFsZXJ0IiwiYWxlcnQiLCJyZXN1bHQiLCJsYXVuY2hJbWFnZUxpYnJhcnlBc3luYyIsIm1lZGlhVHlwZXMiLCJNZWRpYVR5cGVPcHRpb25zIiwiSW1hZ2VzIiwiYWxsb3dzRWRpdGluZyIsImFzcGVjdCIsInF1YWxpdHkiLCJjYW5jZWxlZCIsImFzc2V0cyIsInVyaSIsImFwcGx5IiwiYXJndW1lbnRzIiwiX3JlZjIiLCJ0cmltIiwicGFyYW1zIiwia2V5d29yZHMiLCJzcGxpdCIsIm1hcCIsInAiLCJmaWx0ZXIiLCJsZW5ndGgiLCJ0b25lIiwicGV0VHlwZSIsImFnZSIsInBhcnNlSW50IiwiYnJlZWQiLCJlcnJvciIsImxvZ2dlciIsInNhdmVCaW8iLCJfcmVmMyIsIl9pZCIsIl91c2VyUGV0cyQiLCJ1c2VyUGV0cyIsImFwaSIsImdldFVzZXJQZXRzIiwidXBkYXRlUGV0IiwiZGVzY3JpcHRpb24iLCJiaW8iLCJnb0JhY2siLCJoYW5kbGVHb0JhY2siLCJjbGVhckZvcm0iLCJnZW5lcmF0ZWRCaW8iLCJ0b25lcyJdLCJzb3VyY2VzIjpbInVzZUFJQmlvU2NyZWVuLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogdXNlQUlCaW9TY3JlZW4gSG9va1xuICogTWFuYWdlcyBBSSBCaW8gR2VuZXJhdG9yIHNjcmVlbiBzdGF0ZSBhbmQgaW50ZXJhY3Rpb25zXG4gKi9cbmltcG9ydCB7IHVzZU5hdmlnYXRpb24gfSBmcm9tIFwiQHJlYWN0LW5hdmlnYXRpb24vbmF0aXZlXCI7XG5pbXBvcnQgeyB1c2VTdGF0ZSB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0ICogYXMgSW1hZ2VQaWNrZXIgZnJvbSBcImV4cG8taW1hZ2UtcGlja2VyXCI7XG5pbXBvcnQgeyBBbGVydCB9IGZyb20gXCJyZWFjdC1uYXRpdmVcIjtcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gXCJAcGF3ZmVjdG1hdGNoL2NvcmVcIjtcbmltcG9ydCB7IHVzZUF1dGhTdG9yZSB9IGZyb20gXCJAcGF3ZmVjdG1hdGNoL2NvcmVcIjtcbmltcG9ydCB7IGFwaSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9hcGlcIjtcbmltcG9ydCB7IHVzZUFJQmlvIH0gZnJvbSBcIi4uL2RvbWFpbnMvYWkvdXNlQUlCaW9cIjtcblxuaW50ZXJmYWNlIFVzZUFJQmlvU2NyZWVuUmV0dXJuIHtcbiAgLy8gRm9ybSBzdGF0ZVxuICBwZXROYW1lOiBzdHJpbmc7XG4gIHNldFBldE5hbWU6IChuYW1lOiBzdHJpbmcpID0+IHZvaWQ7XG4gIHBldEJyZWVkOiBzdHJpbmc7XG4gIHNldFBldEJyZWVkOiAoYnJlZWQ6IHN0cmluZykgPT4gdm9pZDtcbiAgcGV0QWdlOiBzdHJpbmc7XG4gIHNldFBldEFnZTogKGFnZTogc3RyaW5nKSA9PiB2b2lkO1xuICBwZXRQZXJzb25hbGl0eTogc3RyaW5nO1xuICBzZXRQZXRQZXJzb25hbGl0eTogKHBlcnNvbmFsaXR5OiBzdHJpbmcpID0+IHZvaWQ7XG4gIHNlbGVjdGVkVG9uZTogc3RyaW5nO1xuICBzZXRTZWxlY3RlZFRvbmU6ICh0b25lOiBzdHJpbmcpID0+IHZvaWQ7XG4gIHNlbGVjdGVkUGhvdG86IHN0cmluZyB8IG51bGw7XG4gIHNldFNlbGVjdGVkUGhvdG86IChwaG90bzogc3RyaW5nIHwgbnVsbCkgPT4gdm9pZDtcblxuICAvLyBVSSBzdGF0ZVxuICBpc0dlbmVyYXRpbmc6IGJvb2xlYW47XG4gIGdlbmVyYXRlZEJpbzogYW55IHwgbnVsbDtcbiAgYmlvSGlzdG9yeTogYW55W107XG4gIHRvbmVzOiBBcnJheTx7IGlkOiBzdHJpbmc7IGxhYmVsOiBzdHJpbmc7IGljb246IHN0cmluZzsgY29sb3I6IHN0cmluZyB9PjtcblxuICAvLyBBY3Rpb25zXG4gIHBpY2tJbWFnZTogKCkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgZ2VuZXJhdGVCaW86ICgpID0+IFByb21pc2U8dm9pZD47XG4gIHNhdmVCaW86ICgpID0+IFByb21pc2U8dm9pZD47XG4gIGhhbmRsZUdvQmFjazogKCkgPT4gdm9pZDtcbiAgY2xlYXJGb3JtOiAoKSA9PiB2b2lkO1xufVxuXG5jb25zdCBUT05FUyA9IFtcbiAgeyBpZDogXCJwbGF5ZnVsXCIsIGxhYmVsOiBcIlBsYXlmdWxcIiwgaWNvbjogXCLwn46+XCIsIGNvbG9yOiBcIiNmZjZiNmJcIiB9LFxuICB7IGlkOiBcInByb2Zlc3Npb25hbFwiLCBsYWJlbDogXCJQcm9mZXNzaW9uYWxcIiwgaWNvbjogXCLwn5K8XCIsIGNvbG9yOiBcIiM0ZGFiZjdcIiB9LFxuICB7IGlkOiBcImNhc3VhbFwiLCBsYWJlbDogXCJDYXN1YWxcIiwgaWNvbjogXCLwn5iKXCIsIGNvbG9yOiBcIiM2OWRiN2NcIiB9LFxuICB7IGlkOiBcInJvbWFudGljXCIsIGxhYmVsOiBcIlJvbWFudGljXCIsIGljb246IFwi8J+SlVwiLCBjb2xvcjogXCIjZjc4M2FjXCIgfSxcbiAgeyBpZDogXCJmdW5ueVwiLCBsYWJlbDogXCJGdW5ueVwiLCBpY29uOiBcIvCfmIRcIiwgY29sb3I6IFwiI2ZmZDQzYlwiIH0sXG5dO1xuXG5leHBvcnQgY29uc3QgdXNlQUlCaW9TY3JlZW4gPSAoKTogVXNlQUlCaW9TY3JlZW5SZXR1cm4gPT4ge1xuICBjb25zdCBuYXZpZ2F0aW9uID0gdXNlTmF2aWdhdGlvbigpO1xuICBjb25zdCB7IHVzZXIgfSA9IHVzZUF1dGhTdG9yZSgpO1xuICBjb25zdCB7XG4gICAgZ2VuZXJhdGVCaW86IGdlbmVyYXRlQUlCaW8sXG4gICAgaXNHZW5lcmF0aW5nLFxuICAgIGxhc3RHZW5lcmF0ZWRCaW8sXG4gICAgYmlvSGlzdG9yeSxcbiAgICBhZGRUb0hpc3RvcnksXG4gICAgY2xlYXJIaXN0b3J5LFxuICB9ID0gdXNlQUlCaW8oKTtcblxuICAvLyBGb3JtIHN0YXRlXG4gIGNvbnN0IFtwZXROYW1lLCBzZXRQZXROYW1lXSA9IHVzZVN0YXRlKFwiXCIpO1xuICBjb25zdCBbcGV0QnJlZWQsIHNldFBldEJyZWVkXSA9IHVzZVN0YXRlKFwiXCIpO1xuICBjb25zdCBbcGV0QWdlLCBzZXRQZXRBZ2VdID0gdXNlU3RhdGUoXCJcIik7XG4gIGNvbnN0IFtwZXRQZXJzb25hbGl0eSwgc2V0UGV0UGVyc29uYWxpdHldID0gdXNlU3RhdGUoXCJcIik7XG4gIGNvbnN0IFtzZWxlY3RlZFRvbmUsIHNldFNlbGVjdGVkVG9uZV0gPSB1c2VTdGF0ZShcInBsYXlmdWxcIik7XG4gIGNvbnN0IFtzZWxlY3RlZFBob3RvLCBzZXRTZWxlY3RlZFBob3RvXSA9IHVzZVN0YXRlPHN0cmluZyB8IG51bGw+KG51bGwpO1xuXG4gIGNvbnN0IHBpY2tJbWFnZSA9IGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB7IHN0YXR1cyB9ID0gYXdhaXQgSW1hZ2VQaWNrZXIucmVxdWVzdE1lZGlhTGlicmFyeVBlcm1pc3Npb25zQXN5bmMoKTtcbiAgICBpZiAoc3RhdHVzICE9PSBcImdyYW50ZWRcIikge1xuICAgICAgQWxlcnQuYWxlcnQoXG4gICAgICAgIFwiUGVybWlzc2lvbiBuZWVkZWRcIixcbiAgICAgICAgXCJXZSBuZWVkIGNhbWVyYSByb2xsIHBlcm1pc3Npb25zIHRvIGFuYWx5emUgeW91ciBwZXQgcGhvdG9cIixcbiAgICAgICk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgSW1hZ2VQaWNrZXIubGF1bmNoSW1hZ2VMaWJyYXJ5QXN5bmMoe1xuICAgICAgbWVkaWFUeXBlczogSW1hZ2VQaWNrZXIuTWVkaWFUeXBlT3B0aW9ucy5JbWFnZXMsXG4gICAgICBhbGxvd3NFZGl0aW5nOiB0cnVlLFxuICAgICAgYXNwZWN0OiBbMSwgMV0sXG4gICAgICBxdWFsaXR5OiAwLjgsXG4gICAgfSk7XG5cbiAgICBpZiAoIXJlc3VsdC5jYW5jZWxlZCAmJiByZXN1bHQuYXNzZXRzICYmIHJlc3VsdC5hc3NldHNbMF0pIHtcbiAgICAgIHNldFNlbGVjdGVkUGhvdG8ocmVzdWx0LmFzc2V0c1swXS51cmkpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBnZW5lcmF0ZUJpbyA9IGFzeW5jICgpID0+IHtcbiAgICBpZiAoIXBldE5hbWUudHJpbSgpKSB7XG4gICAgICBBbGVydC5hbGVydChcIk1pc3NpbmcgSW5mb3JtYXRpb25cIiwgXCJQbGVhc2UgZW50ZXIgeW91ciBwZXQncyBuYW1lXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICAgIHBldE5hbWU6IHBldE5hbWUudHJpbSgpLFxuICAgICAgICBrZXl3b3JkczogcGV0UGVyc29uYWxpdHlcbiAgICAgICAgICAudHJpbSgpXG4gICAgICAgICAgLnNwbGl0KFwiLFwiKVxuICAgICAgICAgIC5tYXAoKHApID0+IHAudHJpbSgpKVxuICAgICAgICAgIC5maWx0ZXIoKHApID0+IHAubGVuZ3RoID4gMCksXG4gICAgICAgIHRvbmU6IHNlbGVjdGVkVG9uZSBhc1xuICAgICAgICAgIHwgXCJwbGF5ZnVsXCJcbiAgICAgICAgICB8IFwicHJvZmVzc2lvbmFsXCJcbiAgICAgICAgICB8IFwiY2FzdWFsXCJcbiAgICAgICAgICB8IFwicm9tYW50aWNcIlxuICAgICAgICAgIHwgXCJmdW5ueVwiLFxuICAgICAgICBsZW5ndGg6IFwibWVkaXVtXCIgYXMgY29uc3QsXG4gICAgICAgIHBldFR5cGU6IFwiZG9nXCIgYXMgY29uc3QsIC8vIENvdWxkIGJlIG1hZGUgZHluYW1pY1xuICAgICAgICBhZ2U6IHBhcnNlSW50KHBldEFnZS50cmltKCkpIHx8IDEsXG4gICAgICAgIGJyZWVkOiBwZXRCcmVlZC50cmltKCksXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBnZW5lcmF0ZUFJQmlvKHBhcmFtcyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihcIkJpbyBnZW5lcmF0aW9uIGZhaWxlZFwiLCB7IGVycm9yIH0pO1xuICAgICAgLy8gRXJyb3IgaGFuZGxpbmcgaXMgZG9uZSBpbiB0aGUgdXNlQUlCaW8gaG9va1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBzYXZlQmlvID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmICghbGFzdEdlbmVyYXRlZEJpbykgcmV0dXJuO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFVwZGF0ZSBwZXQgcHJvZmlsZSB3aXRoIGdlbmVyYXRlZCBiaW9cbiAgICAgIGlmICh1c2VyPy5faWQgJiYgbGFzdEdlbmVyYXRlZEJpbykge1xuICAgICAgICAvLyBBc3N1bWluZyB3ZSBoYXZlIGEgcGV0SWQgZnJvbSByb3V0ZSBwYXJhbXMgb3IgdXNlcidzIGZpcnN0IHBldFxuICAgICAgICBjb25zdCB1c2VyUGV0cyA9IGF3YWl0IGFwaS5nZXRVc2VyUGV0cygpO1xuICAgICAgICBpZiAodXNlclBldHMgJiYgdXNlclBldHMubGVuZ3RoID4gMCAmJiB1c2VyUGV0c1swXT8uX2lkKSB7XG4gICAgICAgICAgYXdhaXQgYXBpLnVwZGF0ZVBldCh1c2VyUGV0c1swXS5faWQsIHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBsYXN0R2VuZXJhdGVkQmlvLmJpbyxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIEFsZXJ0LmFsZXJ0KFwiU3VjY2Vzc1wiLCBcIlBldCBwcm9maWxlIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5IVwiKTtcbiAgICAgICAgICBuYXZpZ2F0aW9uLmdvQmFjaygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIEFsZXJ0LmFsZXJ0KFwiU2F2ZWQgTG9jYWxseVwiLCBcIkJpbyBoYXMgYmVlbiBzYXZlZCB0byB5b3VyIGRldmljZVwiKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgQWxlcnQuYWxlcnQoXCJTYXZlZCBMb2NhbGx5XCIsIFwiQmlvIGhhcyBiZWVuIHNhdmVkIHRvIHlvdXIgZGV2aWNlXCIpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBBbGVydC5hbGVydChcIlNhdmVkIExvY2FsbHlcIiwgXCJCaW8gaGFzIGJlZW4gc2F2ZWQgdG8geW91ciBkZXZpY2VcIik7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGhhbmRsZUdvQmFjayA9ICgpID0+IHtcbiAgICBuYXZpZ2F0aW9uLmdvQmFjaygpO1xuICB9O1xuXG4gIGNvbnN0IGNsZWFyRm9ybSA9ICgpID0+IHtcbiAgICBzZXRQZXROYW1lKFwiXCIpO1xuICAgIHNldFBldEJyZWVkKFwiXCIpO1xuICAgIHNldFBldEFnZShcIlwiKTtcbiAgICBzZXRQZXRQZXJzb25hbGl0eShcIlwiKTtcbiAgICBzZXRTZWxlY3RlZFRvbmUoXCJwbGF5ZnVsXCIpO1xuICAgIHNldFNlbGVjdGVkUGhvdG8obnVsbCk7XG4gICAgY2xlYXJIaXN0b3J5KCk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICAvLyBGb3JtIHN0YXRlXG4gICAgcGV0TmFtZSxcbiAgICBzZXRQZXROYW1lLFxuICAgIHBldEJyZWVkLFxuICAgIHNldFBldEJyZWVkLFxuICAgIHBldEFnZSxcbiAgICBzZXRQZXRBZ2UsXG4gICAgcGV0UGVyc29uYWxpdHksXG4gICAgc2V0UGV0UGVyc29uYWxpdHksXG4gICAgc2VsZWN0ZWRUb25lLFxuICAgIHNldFNlbGVjdGVkVG9uZSxcbiAgICBzZWxlY3RlZFBob3RvLFxuICAgIHNldFNlbGVjdGVkUGhvdG8sXG5cbiAgICAvLyBVSSBzdGF0ZVxuICAgIGlzR2VuZXJhdGluZyxcbiAgICBnZW5lcmF0ZWRCaW86IGxhc3RHZW5lcmF0ZWRCaW8sXG4gICAgYmlvSGlzdG9yeSxcbiAgICB0b25lczogVE9ORVMsXG5cbiAgICAvLyBBY3Rpb25zXG4gICAgcGlja0ltYWdlLFxuICAgIGdlbmVyYXRlQmlvLFxuICAgIHNhdmVCaW8sXG4gICAgaGFuZGxlR29CYWNrLFxuICAgIGNsZWFyRm9ybSxcbiAgfTtcbn07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