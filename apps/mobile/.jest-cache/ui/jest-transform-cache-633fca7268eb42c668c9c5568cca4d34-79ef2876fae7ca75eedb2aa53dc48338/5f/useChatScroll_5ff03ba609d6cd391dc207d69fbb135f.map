{"version":3,"names":["_react","require","_asyncStorage","_interopRequireDefault","_logger","useChatScroll","_ref","matchId","_ref$enabled","enabled","flatListRef","useRef","_useState","useState","_useState2","_slicedToArray2","default","initialOffset","setInitialOffset","didRestoreRef","useEffect","restore","_ref2","_asyncToGenerator2","saved","AsyncStorage","getItem","Number","error","err","Error","String","logger","apply","arguments","current","requestAnimationFrame","_flatListRef$current","scrollToOffset","offset","animated","writeTimer","handleScroll","_ref3","clearTimeout","setTimeout","setItem","catch","_x"],"sources":["useChatScroll.ts"],"sourcesContent":["import { useRef, useState, useEffect } from \"react\";\nimport type { FlatList } from \"react-native\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport { logger } from \"../../services/logger\";\n\nexport interface UseChatScrollOptions {\n  matchId: string;\n  enabled?: boolean;\n}\n\nexport interface UseChatScrollReturn {\n  flatListRef: React.RefObject<FlatList<any>>;\n  initialOffset: number;\n  handleScroll: (offset: number) => Promise<void>;\n}\n\n/**\n * Hook for managing chat scroll position persistence\n */\nexport function useChatScroll({\n  matchId,\n  enabled = true,\n}: UseChatScrollOptions): UseChatScrollReturn {\n  const flatListRef = useRef<FlatList<any>>(null);\n  const [initialOffset, setInitialOffset] = useState(0);\n  const didRestoreRef = useRef(false);\n\n  // Restore scroll position on mount\n  useEffect(() => {\n    const restore = async () => {\n      if (!enabled) return;\n\n      try {\n        const saved = await AsyncStorage.getItem(\n          `mobile_chat_scroll_${matchId}`,\n        );\n        if (saved) {\n          setInitialOffset(Number(saved));\n        }\n      } catch (error: unknown) {\n        const err = error instanceof Error ? error : new Error(String(error));\n        logger.error(\"Failed to restore scroll position for chat\", { matchId, error: err });\n      }\n    };\n\n    void restore();\n  }, [matchId, enabled]);\n\n  // Scroll to initial position when data loads\n  useEffect(() => {\n    if (initialOffset > 0 && !didRestoreRef.current) {\n      requestAnimationFrame(() => {\n        flatListRef.current?.scrollToOffset({\n          offset: initialOffset,\n          animated: false,\n        });\n        didRestoreRef.current = true;\n      });\n    }\n  }, [initialOffset]);\n\n  let writeTimer: ReturnType<typeof setTimeout> | undefined;\n  const handleScroll = async (offset: number) => {\n    if (!enabled) return;\n    if (writeTimer) clearTimeout(writeTimer);\n    writeTimer = setTimeout(() => {\n      AsyncStorage.setItem(`mobile_chat_scroll_${matchId}`, String(offset)).catch(() => {});\n    }, 250);\n  };\n\n  return {\n    flatListRef,\n    initialOffset,\n    handleScroll,\n  };\n}\n"],"mappings":"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","ignoreList":[]}