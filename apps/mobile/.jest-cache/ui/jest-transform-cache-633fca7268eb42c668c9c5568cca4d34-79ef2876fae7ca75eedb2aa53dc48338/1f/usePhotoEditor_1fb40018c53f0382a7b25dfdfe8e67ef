00223e82d66f15e460f0d337c1a9b85e
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.DEFAULT_ADJUSTMENTS = void 0;
exports.usePhotoEditor = usePhotoEditor;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _react = require("react");
var ImageManipulator = _interopRequireWildcard(require("expo-image-manipulator"));
var _reactNative = require("react-native");
var _core = require("@pawfectmatch/core");
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function _interopRequireWildcard(e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (var _t2 in e) "default" !== _t2 && {}.hasOwnProperty.call(e, _t2) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, _t2)) && (i.get || i.set) ? o(f, _t2, i) : f[_t2] = e[_t2]); return f; })(e, t); }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
var DEFAULT_ADJUSTMENTS = exports.DEFAULT_ADJUSTMENTS = {
  brightness: 100,
  contrast: 100,
  saturation: 100,
  warmth: 0,
  blur: 0,
  sharpen: 0
};
function usePhotoEditor(initialUri) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  var _options$maxWidth = options.maxWidth,
    maxWidth = _options$maxWidth === void 0 ? 1920 : _options$maxWidth,
    _options$maxHeight = options.maxHeight,
    maxHeight = _options$maxHeight === void 0 ? 1920 : _options$maxHeight,
    _options$quality = options.quality,
    quality = _options$quality === void 0 ? 0.9 : _options$quality;
  var _useState = (0, _react.useState)(initialUri),
    _useState2 = (0, _slicedToArray2.default)(_useState, 2),
    uri = _useState2[0],
    setUri = _useState2[1];
  var _useState3 = (0, _react.useState)(false),
    _useState4 = (0, _slicedToArray2.default)(_useState3, 2),
    isLoading = _useState4[0],
    setIsLoading = _useState4[1];
  var _useState5 = (0, _react.useState)(DEFAULT_ADJUSTMENTS),
    _useState6 = (0, _slicedToArray2.default)(_useState5, 2),
    adjustments = _useState6[0],
    setAdjustments = _useState6[1];
  var _useState7 = (0, _react.useState)(0),
    _useState8 = (0, _slicedToArray2.default)(_useState7, 2),
    rotation = _useState8[0],
    setRotation = _useState8[1];
  var _useState9 = (0, _react.useState)(false),
    _useState0 = (0, _slicedToArray2.default)(_useState9, 2),
    flipHorizontal = _useState0[0],
    setFlipHorizontal = _useState0[1];
  var _useState1 = (0, _react.useState)(false),
    _useState10 = (0, _slicedToArray2.default)(_useState1, 2),
    flipVertical = _useState10[0],
    setFlipVertical = _useState10[1];
  var manipulationHistoryRef = (0, _react.useRef)([initialUri]);
  var updateAdjustment = (0, _react.useCallback)(function (key, value) {
    setAdjustments(function (prev) {
      return _objectSpread(_objectSpread({}, prev), {}, (0, _defineProperty2.default)({}, key, value));
    });
  }, []);
  var rotateLeft = (0, _react.useCallback)(function () {
    setRotation(function (prev) {
      var newRotation = (prev - 90) % 360;
      return newRotation < 0 ? 360 + newRotation : newRotation;
    });
  }, []);
  var rotateRight = (0, _react.useCallback)(function () {
    setRotation(function (prev) {
      return (prev + 90) % 360;
    });
  }, []);
  var applyFilter = (0, _react.useCallback)(function (filter) {
    setAdjustments(function (prev) {
      return _objectSpread(_objectSpread({}, prev), filter);
    });
  }, []);
  var resetAdjustments = (0, _react.useCallback)(function () {
    setAdjustments(DEFAULT_ADJUSTMENTS);
    setRotation(0);
    setFlipHorizontal(false);
    setFlipVertical(false);
    setUri(initialUri);
    manipulationHistoryRef.current = [initialUri];
  }, [initialUri]);
  var saveImage = (0, _react.useCallback)((0, _asyncToGenerator2.default)(function* () {
    setIsLoading(true);
    try {
      var actions = [];
      if (rotation !== 0) {
        actions.push({
          rotate: rotation
        });
      }
      if (flipHorizontal) {
        actions.push({
          flip: ImageManipulator.FlipType.Horizontal
        });
      }
      if (flipVertical) {
        actions.push({
          flip: ImageManipulator.FlipType.Vertical
        });
      }
      actions.push({
        resize: {
          width: maxWidth,
          height: maxHeight
        }
      });
      var result;
      if (actions.length > 0) {
        result = yield ImageManipulator.manipulateAsync(uri, actions, {
          compress: quality,
          format: ImageManipulator.SaveFormat.JPEG
        });
      } else {
        result = yield ImageManipulator.manipulateAsync(uri, [], {
          compress: quality,
          format: ImageManipulator.SaveFormat.JPEG
        });
      }
      var adjustmentsParam = encodeURIComponent(JSON.stringify(adjustments));
      var finalUri = `${result.uri}?adjustments=${adjustmentsParam}`;
      manipulationHistoryRef.current.push(finalUri);
      _core.logger.info('Photo saved with adjustments', {
        finalUri: finalUri
      });
      return finalUri;
    } catch (error) {
      _core.logger.error('Photo save failed', {
        error: error
      });
      _reactNative.Alert.alert('Error', 'Failed to save image. Please try again.');
      return null;
    } finally {
      setIsLoading(false);
    }
  }), [uri, rotation, flipHorizontal, flipVertical, adjustments, maxWidth, maxHeight, quality]);
  return {
    uri: uri,
    isLoading: isLoading,
    adjustments: adjustments,
    rotation: rotation,
    flipHorizontal: flipHorizontal,
    flipVertical: flipVertical,
    updateAdjustment: updateAdjustment,
    setRotation: setRotation,
    setFlipHorizontal: setFlipHorizontal,
    setFlipVertical: setFlipVertical,
    applyFilter: applyFilter,
    resetAdjustments: resetAdjustments,
    saveImage: saveImage,
    rotateLeft: rotateLeft,
    rotateRight: rotateRight
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwiSW1hZ2VNYW5pcHVsYXRvciIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwiX3JlYWN0TmF0aXZlIiwiX2NvcmUiLCJlIiwidCIsIldlYWtNYXAiLCJyIiwibiIsIl9fZXNNb2R1bGUiLCJvIiwiaSIsImYiLCJfX3Byb3RvX18iLCJkZWZhdWx0IiwiaGFzIiwiZ2V0Iiwic2V0IiwiX3QyIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJvd25LZXlzIiwia2V5cyIsImdldE93blByb3BlcnR5U3ltYm9scyIsImZpbHRlciIsImVudW1lcmFibGUiLCJwdXNoIiwiYXBwbHkiLCJfb2JqZWN0U3ByZWFkIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiZm9yRWFjaCIsIl9kZWZpbmVQcm9wZXJ0eTIiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzIiwiZGVmaW5lUHJvcGVydGllcyIsIkRFRkFVTFRfQURKVVNUTUVOVFMiLCJleHBvcnRzIiwiYnJpZ2h0bmVzcyIsImNvbnRyYXN0Iiwic2F0dXJhdGlvbiIsIndhcm10aCIsImJsdXIiLCJzaGFycGVuIiwidXNlUGhvdG9FZGl0b3IiLCJpbml0aWFsVXJpIiwib3B0aW9ucyIsInVuZGVmaW5lZCIsIl9vcHRpb25zJG1heFdpZHRoIiwibWF4V2lkdGgiLCJfb3B0aW9ucyRtYXhIZWlnaHQiLCJtYXhIZWlnaHQiLCJfb3B0aW9ucyRxdWFsaXR5IiwicXVhbGl0eSIsIl91c2VTdGF0ZSIsInVzZVN0YXRlIiwiX3VzZVN0YXRlMiIsIl9zbGljZWRUb0FycmF5MiIsInVyaSIsInNldFVyaSIsIl91c2VTdGF0ZTMiLCJfdXNlU3RhdGU0IiwiaXNMb2FkaW5nIiwic2V0SXNMb2FkaW5nIiwiX3VzZVN0YXRlNSIsIl91c2VTdGF0ZTYiLCJhZGp1c3RtZW50cyIsInNldEFkanVzdG1lbnRzIiwiX3VzZVN0YXRlNyIsIl91c2VTdGF0ZTgiLCJyb3RhdGlvbiIsInNldFJvdGF0aW9uIiwiX3VzZVN0YXRlOSIsIl91c2VTdGF0ZTAiLCJmbGlwSG9yaXpvbnRhbCIsInNldEZsaXBIb3Jpem9udGFsIiwiX3VzZVN0YXRlMSIsIl91c2VTdGF0ZTEwIiwiZmxpcFZlcnRpY2FsIiwic2V0RmxpcFZlcnRpY2FsIiwibWFuaXB1bGF0aW9uSGlzdG9yeVJlZiIsInVzZVJlZiIsInVwZGF0ZUFkanVzdG1lbnQiLCJ1c2VDYWxsYmFjayIsImtleSIsInZhbHVlIiwicHJldiIsInJvdGF0ZUxlZnQiLCJuZXdSb3RhdGlvbiIsInJvdGF0ZVJpZ2h0IiwiYXBwbHlGaWx0ZXIiLCJyZXNldEFkanVzdG1lbnRzIiwiY3VycmVudCIsInNhdmVJbWFnZSIsIl9hc3luY1RvR2VuZXJhdG9yMiIsImFjdGlvbnMiLCJyb3RhdGUiLCJmbGlwIiwiRmxpcFR5cGUiLCJIb3Jpem9udGFsIiwiVmVydGljYWwiLCJyZXNpemUiLCJ3aWR0aCIsImhlaWdodCIsInJlc3VsdCIsIm1hbmlwdWxhdGVBc3luYyIsImNvbXByZXNzIiwiZm9ybWF0IiwiU2F2ZUZvcm1hdCIsIkpQRUciLCJhZGp1c3RtZW50c1BhcmFtIiwiZW5jb2RlVVJJQ29tcG9uZW50IiwiSlNPTiIsInN0cmluZ2lmeSIsImZpbmFsVXJpIiwibG9nZ2VyIiwiaW5mbyIsImVycm9yIiwiQWxlcnQiLCJhbGVydCJdLCJzb3VyY2VzIjpbInVzZVBob3RvRWRpdG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZVN0YXRlLCB1c2VDYWxsYmFjaywgdXNlUmVmIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0ICogYXMgSW1hZ2VNYW5pcHVsYXRvciBmcm9tICdleHBvLWltYWdlLW1hbmlwdWxhdG9yJztcbmltcG9ydCB7IEFsZXJ0IH0gZnJvbSAncmVhY3QtbmF0aXZlJztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJ0BwYXdmZWN0bWF0Y2gvY29yZSc7XG5pbXBvcnQgdHlwZSB7IFBob3RvQWRqdXN0bWVudHMgfSBmcm9tICcuLi9jb21wb25lbnRzL3Bob3RvL0FkdmFuY2VkUGhvdG9FZGl0b3InO1xuXG5leHBvcnQgaW50ZXJmYWNlIFVzZVBob3RvRWRpdG9yT3B0aW9ucyB7XG4gIG1heFdpZHRoPzogbnVtYmVyO1xuICBtYXhIZWlnaHQ/OiBudW1iZXI7XG4gIHF1YWxpdHk/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXNlUGhvdG9FZGl0b3JSZXR1cm4ge1xuICB1cmk6IHN0cmluZzsgLy8gb3JpZ2luYWwgVVJJLCBmb3IgZWRpdGluZ1xuICBpc0xvYWRpbmc6IGJvb2xlYW47XG4gIGFkanVzdG1lbnRzOiBQaG90b0FkanVzdG1lbnRzO1xuICByb3RhdGlvbjogbnVtYmVyO1xuICBmbGlwSG9yaXpvbnRhbDogYm9vbGVhbjtcbiAgZmxpcFZlcnRpY2FsOiBib29sZWFuO1xuICB1cGRhdGVBZGp1c3RtZW50OiAoa2V5OiBrZXlvZiBQaG90b0FkanVzdG1lbnRzLCB2YWx1ZTogbnVtYmVyKSA9PiB2b2lkO1xuICBzZXRSb3RhdGlvbjogKGRlZ3JlZXM6IG51bWJlcikgPT4gdm9pZDtcbiAgc2V0RmxpcEhvcml6b250YWw6IChmbGlwOiBib29sZWFuKSA9PiB2b2lkO1xuICBzZXRGbGlwVmVydGljYWw6IChmbGlwOiBib29sZWFuKSA9PiB2b2lkO1xuICBhcHBseUZpbHRlcjogKGZpbHRlcjogUGFydGlhbDxQaG90b0FkanVzdG1lbnRzPikgPT4gdm9pZDtcbiAgcmVzZXRBZGp1c3RtZW50czogKCkgPT4gdm9pZDtcbiAgc2F2ZUltYWdlOiAoKSA9PiBQcm9taXNlPHN0cmluZyB8IG51bGw+O1xuICByb3RhdGVMZWZ0OiAoKSA9PiB2b2lkO1xuICByb3RhdGVSaWdodDogKCkgPT4gdm9pZDtcbn1cblxuZXhwb3J0IGNvbnN0IERFRkFVTFRfQURKVVNUTUVOVFM6IFBob3RvQWRqdXN0bWVudHMgPSB7XG4gIGJyaWdodG5lc3M6IDEwMCxcbiAgY29udHJhc3Q6IDEwMCxcbiAgc2F0dXJhdGlvbjogMTAwLFxuICB3YXJtdGg6IDAsXG4gIGJsdXI6IDAsXG4gIHNoYXJwZW46IDAsXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gdXNlUGhvdG9FZGl0b3IoXG4gIGluaXRpYWxVcmk6IHN0cmluZyxcbiAgb3B0aW9uczogVXNlUGhvdG9FZGl0b3JPcHRpb25zID0ge30sXG4pOiBVc2VQaG90b0VkaXRvclJldHVybiB7XG4gIGNvbnN0IHsgbWF4V2lkdGggPSAxOTIwLCBtYXhIZWlnaHQgPSAxOTIwLCBxdWFsaXR5ID0gMC45IH0gPSBvcHRpb25zO1xuXG4gIGNvbnN0IFt1cmksIHNldFVyaV0gPSB1c2VTdGF0ZShpbml0aWFsVXJpKTtcbiAgY29uc3QgW2lzTG9hZGluZywgc2V0SXNMb2FkaW5nXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW2FkanVzdG1lbnRzLCBzZXRBZGp1c3RtZW50c10gPSB1c2VTdGF0ZTxQaG90b0FkanVzdG1lbnRzPihERUZBVUxUX0FESlVTVE1FTlRTKTtcbiAgY29uc3QgW3JvdGF0aW9uLCBzZXRSb3RhdGlvbl0gPSB1c2VTdGF0ZSgwKTtcbiAgY29uc3QgW2ZsaXBIb3Jpem9udGFsLCBzZXRGbGlwSG9yaXpvbnRhbF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFtmbGlwVmVydGljYWwsIHNldEZsaXBWZXJ0aWNhbF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IG1hbmlwdWxhdGlvbkhpc3RvcnlSZWYgPSB1c2VSZWY8c3RyaW5nW10+KFtpbml0aWFsVXJpXSk7XG5cbiAgY29uc3QgdXBkYXRlQWRqdXN0bWVudCA9IHVzZUNhbGxiYWNrKFxuICAgIChrZXk6IGtleW9mIFBob3RvQWRqdXN0bWVudHMsIHZhbHVlOiBudW1iZXIpID0+IHtcbiAgICAgIHNldEFkanVzdG1lbnRzKChwcmV2KSA9PiAoeyAuLi5wcmV2LCBba2V5XTogdmFsdWUgfSkpO1xuICAgIH0sXG4gICAgW10sXG4gICk7XG5cbiAgY29uc3Qgcm90YXRlTGVmdCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBzZXRSb3RhdGlvbigocHJldikgPT4ge1xuICAgICAgY29uc3QgbmV3Um90YXRpb24gPSAocHJldiAtIDkwKSAlIDM2MDtcbiAgICAgIHJldHVybiBuZXdSb3RhdGlvbiA8IDAgPyAzNjAgKyBuZXdSb3RhdGlvbiA6IG5ld1JvdGF0aW9uO1xuICAgIH0pO1xuICB9LCBbXSk7XG5cbiAgY29uc3Qgcm90YXRlUmlnaHQgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgc2V0Um90YXRpb24oKHByZXYpID0+IChwcmV2ICsgOTApICUgMzYwKTtcbiAgfSwgW10pO1xuXG4gIGNvbnN0IGFwcGx5RmlsdGVyID0gdXNlQ2FsbGJhY2soKGZpbHRlcjogUGFydGlhbDxQaG90b0FkanVzdG1lbnRzPikgPT4ge1xuICAgIHNldEFkanVzdG1lbnRzKChwcmV2KSA9PiAoeyAuLi5wcmV2LCAuLi5maWx0ZXIgfSkpO1xuICB9LCBbXSk7XG5cbiAgY29uc3QgcmVzZXRBZGp1c3RtZW50cyA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBzZXRBZGp1c3RtZW50cyhERUZBVUxUX0FESlVTVE1FTlRTKTtcbiAgICBzZXRSb3RhdGlvbigwKTtcbiAgICBzZXRGbGlwSG9yaXpvbnRhbChmYWxzZSk7XG4gICAgc2V0RmxpcFZlcnRpY2FsKGZhbHNlKTtcbiAgICBzZXRVcmkoaW5pdGlhbFVyaSk7XG4gICAgbWFuaXB1bGF0aW9uSGlzdG9yeVJlZi5jdXJyZW50ID0gW2luaXRpYWxVcmldO1xuICB9LCBbaW5pdGlhbFVyaV0pO1xuXG4gIGNvbnN0IHNhdmVJbWFnZSA9IHVzZUNhbGxiYWNrKGFzeW5jICgpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+ID0+IHtcbiAgICBzZXRJc0xvYWRpbmcodHJ1ZSk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGFjdGlvbnM6IEltYWdlTWFuaXB1bGF0b3IuQWN0aW9uW10gPSBbXTtcblxuICAgICAgLy8gQXBwbHkgcm90YXRpb25cbiAgICAgIGlmIChyb3RhdGlvbiAhPT0gMCkge1xuICAgICAgICBhY3Rpb25zLnB1c2goeyByb3RhdGU6IHJvdGF0aW9uIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBBcHBseSBmbGlwc1xuICAgICAgaWYgKGZsaXBIb3Jpem9udGFsKSB7XG4gICAgICAgIGFjdGlvbnMucHVzaCh7IGZsaXA6IEltYWdlTWFuaXB1bGF0b3IuRmxpcFR5cGUuSG9yaXpvbnRhbCB9KTtcbiAgICAgIH1cbiAgICAgIGlmIChmbGlwVmVydGljYWwpIHtcbiAgICAgICAgYWN0aW9ucy5wdXNoKHsgZmxpcDogSW1hZ2VNYW5pcHVsYXRvci5GbGlwVHlwZS5WZXJ0aWNhbCB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQXBwbHkgcmVzaXplIGlmIG5lZWRlZFxuICAgICAgYWN0aW9ucy5wdXNoKHtcbiAgICAgICAgcmVzaXplOiB7IHdpZHRoOiBtYXhXaWR0aCwgaGVpZ2h0OiBtYXhIZWlnaHQgfSxcbiAgICAgIH0pO1xuXG4gICAgICBsZXQgcmVzdWx0O1xuICAgICAgaWYgKGFjdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICByZXN1bHQgPSBhd2FpdCBJbWFnZU1hbmlwdWxhdG9yLm1hbmlwdWxhdGVBc3luYyhcbiAgICAgICAgICB1cmksXG4gICAgICAgICAgYWN0aW9ucyxcbiAgICAgICAgICB7IGNvbXByZXNzOiBxdWFsaXR5LCBmb3JtYXQ6IEltYWdlTWFuaXB1bGF0b3IuU2F2ZUZvcm1hdC5KUEVHIH0sXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXN1bHQgPSBhd2FpdCBJbWFnZU1hbmlwdWxhdG9yLm1hbmlwdWxhdGVBc3luYyhcbiAgICAgICAgICB1cmksXG4gICAgICAgICAgW10sXG4gICAgICAgICAgeyBjb21wcmVzczogcXVhbGl0eSwgZm9ybWF0OiBJbWFnZU1hbmlwdWxhdG9yLlNhdmVGb3JtYXQuSlBFRyB9LFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBBcHBseSBhZHZhbmNlZCBhZGp1c3RtZW50cyB1c2luZyBDbG91ZGluYXJ5IHRyYW5zZm9ybWF0aW9uc1xuICAgICAgLy8gRW5jb2RlIGFkanVzdG1lbnRzIGluIHRoZSBVUkkgZm9yIHNlcnZlci1zaWRlIHByb2Nlc3NpbmdcbiAgICAgIGNvbnN0IGFkanVzdG1lbnRzUGFyYW0gPSBlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkoYWRqdXN0bWVudHMpKTtcbiAgICAgIGNvbnN0IGZpbmFsVXJpID0gYCR7cmVzdWx0LnVyaX0/YWRqdXN0bWVudHM9JHthZGp1c3RtZW50c1BhcmFtfWA7XG5cbiAgICAgIG1hbmlwdWxhdGlvbkhpc3RvcnlSZWYuY3VycmVudC5wdXNoKGZpbmFsVXJpKTtcbiAgICAgIGxvZ2dlci5pbmZvKCdQaG90byBzYXZlZCB3aXRoIGFkanVzdG1lbnRzJywgeyBmaW5hbFVyaSB9KTtcblxuICAgICAgcmV0dXJuIGZpbmFsVXJpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ1Bob3RvIHNhdmUgZmFpbGVkJywgeyBlcnJvciB9KTtcbiAgICAgIEFsZXJ0LmFsZXJ0KCdFcnJvcicsICdGYWlsZWQgdG8gc2F2ZSBpbWFnZS4gUGxlYXNlIHRyeSBhZ2Fpbi4nKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBzZXRJc0xvYWRpbmcoZmFsc2UpO1xuICAgIH1cbiAgfSwgW3VyaSwgcm90YXRpb24sIGZsaXBIb3Jpem9udGFsLCBmbGlwVmVydGljYWwsIGFkanVzdG1lbnRzLCBtYXhXaWR0aCwgbWF4SGVpZ2h0LCBxdWFsaXR5XSk7XG5cbiAgcmV0dXJuIHtcbiAgICB1cmksXG4gICAgaXNMb2FkaW5nLFxuICAgIGFkanVzdG1lbnRzLFxuICAgIHJvdGF0aW9uLFxuICAgIGZsaXBIb3Jpem9udGFsLFxuICAgIGZsaXBWZXJ0aWNhbCxcbiAgICB1cGRhdGVBZGp1c3RtZW50LFxuICAgIHNldFJvdGF0aW9uLFxuICAgIHNldEZsaXBIb3Jpem9udGFsLFxuICAgIHNldEZsaXBWZXJ0aWNhbCxcbiAgICBhcHBseUZpbHRlcixcbiAgICByZXNldEFkanVzdG1lbnRzLFxuICAgIHNhdmVJbWFnZSxcbiAgICByb3RhdGVMZWZ0LFxuICAgIHJvdGF0ZVJpZ2h0LFxuICB9O1xufVxuXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUEsSUFBQUEsTUFBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsZ0JBQUEsR0FBQUMsdUJBQUEsQ0FBQUYsT0FBQTtBQUNBLElBQUFHLFlBQUEsR0FBQUgsT0FBQTtBQUNBLElBQUFJLEtBQUEsR0FBQUosT0FBQTtBQUE0QyxTQUFBRSx3QkFBQUcsQ0FBQSxFQUFBQyxDQUFBLDZCQUFBQyxPQUFBLE1BQUFDLENBQUEsT0FBQUQsT0FBQSxJQUFBRSxDQUFBLE9BQUFGLE9BQUEsWUFBQUwsdUJBQUEsWUFBQUEsd0JBQUFHLENBQUEsRUFBQUMsQ0FBQSxTQUFBQSxDQUFBLElBQUFELENBQUEsSUFBQUEsQ0FBQSxDQUFBSyxVQUFBLFNBQUFMLENBQUEsTUFBQU0sQ0FBQSxFQUFBQyxDQUFBLEVBQUFDLENBQUEsS0FBQUMsU0FBQSxRQUFBQyxPQUFBLEVBQUFWLENBQUEsaUJBQUFBLENBQUEsdUJBQUFBLENBQUEseUJBQUFBLENBQUEsU0FBQVEsQ0FBQSxNQUFBRixDQUFBLEdBQUFMLENBQUEsR0FBQUcsQ0FBQSxHQUFBRCxDQUFBLFFBQUFHLENBQUEsQ0FBQUssR0FBQSxDQUFBWCxDQUFBLFVBQUFNLENBQUEsQ0FBQU0sR0FBQSxDQUFBWixDQUFBLEdBQUFNLENBQUEsQ0FBQU8sR0FBQSxDQUFBYixDQUFBLEVBQUFRLENBQUEsY0FBQU0sR0FBQSxJQUFBZCxDQUFBLGdCQUFBYyxHQUFBLE9BQUFDLGNBQUEsQ0FBQUMsSUFBQSxDQUFBaEIsQ0FBQSxFQUFBYyxHQUFBLE9BQUFQLENBQUEsSUFBQUQsQ0FBQSxHQUFBVyxNQUFBLENBQUFDLGNBQUEsS0FBQUQsTUFBQSxDQUFBRSx3QkFBQSxDQUFBbkIsQ0FB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