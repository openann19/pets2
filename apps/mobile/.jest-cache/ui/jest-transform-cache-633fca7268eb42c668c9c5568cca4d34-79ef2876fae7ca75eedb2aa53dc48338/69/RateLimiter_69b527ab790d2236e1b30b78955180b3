b6d26060719483a8ab5c5d4e39995e4d
"use strict";
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.RateLimiter = void 0;
var RateLimiter = function () {
  function RateLimiter(config) {
    (0, _classCallCheck2.default)(this, RateLimiter);
    this.points = config.points;
    this.duration = config.duration;
    this.tokens = config.points;
    this.lastRefill = Date.now();
  }
  return (0, _createClass2.default)(RateLimiter, [{
    key: "tryConsume",
    value: function tryConsume() {
      var tokensToConsume = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
      this.refill();
      if (this.tokens >= tokensToConsume) {
        this.tokens -= tokensToConsume;
        return true;
      }
      return false;
    }
  }, {
    key: "refill",
    value: function refill() {
      var now = Date.now();
      var elapsed = (now - this.lastRefill) / 1000;
      if (elapsed >= this.duration) {
        this.tokens = this.points;
        this.lastRefill = now;
      } else {
        var tokensToAdd = Math.floor(elapsed / this.duration * this.points);
        this.tokens = Math.min(this.points, this.tokens + tokensToAdd);
        this.lastRefill = now;
      }
    }
  }, {
    key: "getRemainingTokens",
    value: function getRemainingTokens() {
      this.refill();
      return this.tokens;
    }
  }, {
    key: "getTimeUntilRefill",
    value: function getTimeUntilRefill() {
      var now = Date.now();
      var elapsed = (now - this.lastRefill) / 1000;
      var remaining = this.duration - elapsed;
      return Math.max(0, remaining);
    }
  }, {
    key: "reset",
    value: function reset() {
      this.tokens = this.points;
      this.lastRefill = Date.now();
    }
  }]);
}();
exports.RateLimiter = RateLimiter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9jbGFzc0NhbGxDaGVjazIiLCJfY3JlYXRlQ2xhc3MyIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJSYXRlTGltaXRlciIsImNvbmZpZyIsImRlZmF1bHQiLCJwb2ludHMiLCJkdXJhdGlvbiIsInRva2VucyIsImxhc3RSZWZpbGwiLCJEYXRlIiwibm93Iiwia2V5IiwidHJ5Q29uc3VtZSIsInRva2Vuc1RvQ29uc3VtZSIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsInJlZmlsbCIsImVsYXBzZWQiLCJ0b2tlbnNUb0FkZCIsIk1hdGgiLCJmbG9vciIsIm1pbiIsImdldFJlbWFpbmluZ1Rva2VucyIsImdldFRpbWVVbnRpbFJlZmlsbCIsInJlbWFpbmluZyIsIm1heCIsInJlc2V0Il0sInNvdXJjZXMiOlsiUmF0ZUxpbWl0ZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG4vKipcbiAqIFJhdGUgTGltaXRlclxuICogVG9rZW4gYnVja2V0IHJhdGUgbGltaXRpbmcgaW1wbGVtZW50YXRpb25cbiAqL1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5SYXRlTGltaXRlciA9IHZvaWQgMDtcbmNsYXNzIFJhdGVMaW1pdGVyIHtcbiAgICBwb2ludHM7XG4gICAgZHVyYXRpb247XG4gICAgdG9rZW5zO1xuICAgIGxhc3RSZWZpbGw7XG4gICAgY29uc3RydWN0b3IoY29uZmlnKSB7XG4gICAgICAgIHRoaXMucG9pbnRzID0gY29uZmlnLnBvaW50cztcbiAgICAgICAgdGhpcy5kdXJhdGlvbiA9IGNvbmZpZy5kdXJhdGlvbjtcbiAgICAgICAgdGhpcy50b2tlbnMgPSBjb25maWcucG9pbnRzO1xuICAgICAgICB0aGlzLmxhc3RSZWZpbGwgPSBEYXRlLm5vdygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUcnkgdG8gY29uc3VtZSB0b2tlbnNcbiAgICAgKiBAcGFyYW0gdG9rZW5zVG9Db25zdW1lIE51bWJlciBvZiB0b2tlbnMgdG8gY29uc3VtZSAoZGVmYXVsdDogMSlcbiAgICAgKiBAcmV0dXJucyB0cnVlIGlmIHRva2VucyB3ZXJlIGNvbnN1bWVkLCBmYWxzZSBpZiByYXRlIGxpbWl0IGV4Y2VlZGVkXG4gICAgICovXG4gICAgdHJ5Q29uc3VtZSh0b2tlbnNUb0NvbnN1bWUgPSAxKSB7XG4gICAgICAgIHRoaXMucmVmaWxsKCk7XG4gICAgICAgIGlmICh0aGlzLnRva2VucyA+PSB0b2tlbnNUb0NvbnN1bWUpIHtcbiAgICAgICAgICAgIHRoaXMudG9rZW5zIC09IHRva2Vuc1RvQ29uc3VtZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVmaWxsIHRva2VucyBiYXNlZCBvbiBlbGFwc2VkIHRpbWVcbiAgICAgKi9cbiAgICByZWZpbGwoKSB7XG4gICAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgICAgIGNvbnN0IGVsYXBzZWQgPSAobm93IC0gdGhpcy5sYXN0UmVmaWxsKSAvIDEwMDA7IC8vIENvbnZlcnQgdG8gc2Vjb25kc1xuICAgICAgICBpZiAoZWxhcHNlZCA+PSB0aGlzLmR1cmF0aW9uKSB7XG4gICAgICAgICAgICAvLyBGdWxsIHJlZmlsbFxuICAgICAgICAgICAgdGhpcy50b2tlbnMgPSB0aGlzLnBvaW50cztcbiAgICAgICAgICAgIHRoaXMubGFzdFJlZmlsbCA9IG5vdztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIFBhcnRpYWwgcmVmaWxsIGJhc2VkIG9uIGVsYXBzZWQgdGltZVxuICAgICAgICAgICAgY29uc3QgdG9rZW5zVG9BZGQgPSBNYXRoLmZsb29yKChlbGFwc2VkIC8gdGhpcy5kdXJhdGlvbikgKiB0aGlzLnBvaW50cyk7XG4gICAgICAgICAgICB0aGlzLnRva2VucyA9IE1hdGgubWluKHRoaXMucG9pbnRzLCB0aGlzLnRva2VucyArIHRva2Vuc1RvQWRkKTtcbiAgICAgICAgICAgIHRoaXMubGFzdFJlZmlsbCA9IG5vdztcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgcmVtYWluaW5nIHRva2Vuc1xuICAgICAqL1xuICAgIGdldFJlbWFpbmluZ1Rva2VucygpIHtcbiAgICAgICAgdGhpcy5yZWZpbGwoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9rZW5zO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgdGltZSB1bnRpbCBuZXh0IHJlZmlsbFxuICAgICAqL1xuICAgIGdldFRpbWVVbnRpbFJlZmlsbCgpIHtcbiAgICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgY29uc3QgZWxhcHNlZCA9IChub3cgLSB0aGlzLmxhc3RSZWZpbGwpIC8gMTAwMDtcbiAgICAgICAgY29uc3QgcmVtYWluaW5nID0gdGhpcy5kdXJhdGlvbiAtIGVsYXBzZWQ7XG4gICAgICAgIHJldHVybiBNYXRoLm1heCgwLCByZW1haW5pbmcpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXNldCByYXRlIGxpbWl0ZXJcbiAgICAgKi9cbiAgICByZXNldCgpIHtcbiAgICAgICAgdGhpcy50b2tlbnMgPSB0aGlzLnBvaW50cztcbiAgICAgICAgdGhpcy5sYXN0UmVmaWxsID0gRGF0ZS5ub3coKTtcbiAgICB9XG59XG5leHBvcnRzLlJhdGVMaW1pdGVyID0gUmF0ZUxpbWl0ZXI7XG4iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7QUFBQyxJQUFBQSxzQkFBQSxHQUFBQyxPQUFBO0FBQUEsSUFBQUMsZ0JBQUEsR0FBQUYsc0JBQUEsQ0FBQUMsT0FBQTtBQUFBLElBQUFFLGFBQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUtiRyxNQUFN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