{"version":3,"names":["_interopRequireDefault","require","_defineProperty2","_toConsumableArray2","_asyncToGenerator2","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","default","getOwnPropertyDescriptors","defineProperties","defineProperty","exports","value","useEventTracking","react_1","logger_1","env_1","eventQueue","useRef","flushTimeout","flushEvents","useCallback","current","events","_ref2","response","fetch","method","headers","getLocalStorageItem","body","JSON","stringify","ok","Error","logger","info","count","error","_eventQueue$current","unshift","trackEvent","_ref3","options","event","timestamp","Date","toISOString","clearTimeout","setTimeout","category","action","_x","trackPageView","_ref4","pageName","metadata","label","undefined","_x2","_x3","trackSwipe","_ref5","petId","_x4","_x5","trackMatch","_ref6","matchId","_x6","_x7","trackMessage","_ref7","messageLength","_x8","_x9","trackProfileView","_ref8","profileId","duration","_x0","_x1"],"sources":["useEventTracking.js"],"sourcesContent":["\"use strict\";\n/**\n * Event Tracking Hook\n * Tracks user events and interactions for analytics\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useEventTracking = useEventTracking;\nconst react_1 = require(\"react\");\nconst logger_1 = require(\"../utils/logger\");\nconst env_1 = require(\"../utils/env\");\n/**\n * Hook for tracking user events and interactions\n */\nfunction useEventTracking() {\n    const eventQueue = (0, react_1.useRef)([]);\n    const flushTimeout = (0, react_1.useRef)(null);\n    // Flush events to server\n    const flushEvents = (0, react_1.useCallback)(async () => {\n        if (eventQueue.current.length === 0)\n            return;\n        const events = [...eventQueue.current];\n        eventQueue.current = [];\n        try {\n            const response = await fetch('/api/analytics/events', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'Authorization': `Bearer ${(0, env_1.getLocalStorageItem)('accessToken') ?? ''}`,\n                },\n                body: JSON.stringify({ events }),\n            });\n            if (!response.ok) {\n                throw new Error('Failed to send analytics events');\n            }\n            logger_1.logger.info('Analytics events sent', { count: events.length });\n        }\n        catch (error) {\n            logger_1.logger.error('Failed to send analytics events', { error });\n            // Re-queue failed events\n            eventQueue.current.unshift(...events);\n        }\n    }, []);\n    // Track a generic event\n    const trackEvent = (0, react_1.useCallback)(async (options) => {\n        const event = {\n            ...options,\n            timestamp: new Date().toISOString(),\n        };\n        eventQueue.current.push(event);\n        // Debounce flush - send events in batches\n        if (flushTimeout.current) {\n            clearTimeout(flushTimeout.current);\n        }\n        flushTimeout.current = setTimeout(() => {\n            void flushEvents();\n        }, 2000); // Flush every 2 seconds\n        logger_1.logger.info('Event tracked', { category: options.category, action: options.action });\n    }, [flushEvents]);\n    // Track page view\n    const trackPageView = (0, react_1.useCallback)(async (pageName, metadata) => {\n        await trackEvent({\n            category: 'Navigation',\n            action: 'PageView',\n            label: pageName,\n            ...(metadata !== undefined && { metadata }),\n        });\n    }, [trackEvent]);\n    // Track swipe action\n    const trackSwipe = (0, react_1.useCallback)(async (action, petId) => {\n        await trackEvent({\n            category: 'Engagement',\n            action: `Swipe_${action}`,\n            label: petId,\n            value: action === 'superlike' ? 2 : action === 'like' ? 1 : 0,\n        });\n    }, [trackEvent]);\n    // Track match creation\n    const trackMatch = (0, react_1.useCallback)(async (matchId, petId) => {\n        await trackEvent({\n            category: 'Engagement',\n            action: 'Match_Created',\n            label: matchId,\n            metadata: { petId },\n        });\n    }, [trackEvent]);\n    // Track message sent\n    const trackMessage = (0, react_1.useCallback)(async (matchId, messageLength) => {\n        await trackEvent({\n            category: 'Communication',\n            action: 'Message_Sent',\n            label: matchId,\n            value: messageLength,\n        });\n    }, [trackEvent]);\n    // Track profile view\n    const trackProfileView = (0, react_1.useCallback)(async (profileId, duration) => {\n        await trackEvent({\n            category: 'Engagement',\n            action: 'Profile_View',\n            label: profileId,\n            ...(duration !== undefined && { value: duration }),\n        });\n    }, [trackEvent]);\n    return {\n        trackEvent,\n        trackPageView,\n        trackSwipe,\n        trackMatch,\n        trackMessage,\n        trackProfileView,\n    };\n}\n"],"mappings":"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","ignoreList":[]}