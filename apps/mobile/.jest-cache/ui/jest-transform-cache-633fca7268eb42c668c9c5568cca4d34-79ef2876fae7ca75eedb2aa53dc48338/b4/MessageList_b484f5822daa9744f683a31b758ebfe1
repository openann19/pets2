d3c536ff9b0537bac77d6838eafdf48b
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.MessageList = MessageList;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _react = _interopRequireWildcard(require("react"));
var _reactNative = require("react-native");
var _MessageItem = require("./MessageItem");
var _TypingIndicator = require("./TypingIndicator");
var _chatService = require("../../services/chatService");
var _api = require("../../services/api");
var _jsxRuntime = require("react/jsx-runtime");
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function _interopRequireWildcard(e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (var _t in e) "default" !== _t && {}.hasOwnProperty.call(e, _t) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, _t)) && (i.get || i.set) ? o(f, _t, i) : f[_t] = e[_t]); return f; })(e, t); }
var Spacing = {
  xs: 4,
  sm: 8,
  md: 16,
  lg: 24,
  xl: 32
};
function MessageList(_ref) {
  var messages = _ref.messages,
    typingUsers = _ref.typingUsers,
    isOnline = _ref.isOnline,
    currentUserId = _ref.currentUserId,
    matchId = _ref.matchId,
    onMessagePress = _ref.onMessagePress,
    onMessageLongPress = _ref.onMessageLongPress,
    onRetryMessage = _ref.onRetryMessage,
    flatListRef = _ref.flatListRef,
    onScroll = _ref.onScroll;
  var _useState = (0, _react.useState)(null),
    _useState2 = (0, _slicedToArray2.default)(_useState, 2),
    replyTarget = _useState2[0],
    setReplyTarget = _useState2[1];
  var handleReply = (0, _react.useCallback)(function (message) {
    setReplyTarget(message);
  }, []);
  var handleCopy = (0, _react.useCallback)(function (message) {
    _reactNative.Clipboard.setString(message.content);
  }, []);
  var handleReact = (0, _react.useCallback)(function () {
    var _ref2 = (0, _asyncToGenerator2.default)(function* (message) {
      _reactNative.Alert.alert("Add Reaction", "Choose a reaction", [{
        text: "ðŸ‘ Like",
        onPress: function onPress() {
          return _chatService.chatService.sendReaction(matchId, message._id, "like");
        }
      }, {
        text: "â¤ï¸ Love",
        onPress: function onPress() {
          return _chatService.chatService.sendReaction(matchId, message._id, "love");
        }
      }, {
        text: "ðŸ˜‚ Laugh",
        onPress: function onPress() {
          return _chatService.chatService.sendReaction(matchId, message._id, "laugh");
        }
      }, {
        text: "Cancel",
        style: "cancel"
      }]);
    });
    return function (_x) {
      return _ref2.apply(this, arguments);
    };
  }(), [matchId]);
  var handleDelete = (0, _react.useCallback)(function () {
    var _ref3 = (0, _asyncToGenerator2.default)(function* (message) {
      _reactNative.Alert.alert("Delete Message", "Are you sure you want to delete this message?", [{
        text: "Cancel",
        style: "cancel"
      }, {
        text: "Delete",
        style: "destructive",
        onPress: function () {
          var _onPress = (0, _asyncToGenerator2.default)(function* () {
            try {
              yield _api.matchesAPI.deleteMessage(matchId, message._id);
            } catch (error) {
              _reactNative.Alert.alert("Error", "Failed to delete message");
            }
          });
          function onPress() {
            return _onPress.apply(this, arguments);
          }
          return onPress;
        }()
      }]);
    });
    return function (_x2) {
      return _ref3.apply(this, arguments);
    };
  }(), [matchId]);
  var handleShowReadBy = (0, _react.useCallback)(function (message) {
    _reactNative.Alert.alert("Read by", `Message was read by ${message.read ? "recipient" : "no one yet"}`);
  }, []);
  var renderMessage = (0, _react.useCallback)(function (_ref4) {
    var item = _ref4.item,
      index = _ref4.index;
    var isOwnMessage = item.senderId === currentUserId || item.senderId === "me";
    return (0, _jsxRuntime.jsx)(_reactNative.View, {
      children: (0, _jsxRuntime.jsx)(_MessageItem.MessageItem, {
        message: item,
        index: index,
        messages: messages,
        isOnline: isOnline,
        onPress: onMessagePress,
        onLongPress: onMessageLongPress,
        onRetry: onRetryMessage
      })
    });
  }, [messages, isOnline, currentUserId, onMessagePress, onMessageLongPress, onRetryMessage]);
  var renderTypingIndicator = (0, _react.useCallback)(function () {
    return (0, _jsxRuntime.jsx)(_TypingIndicator.TypingIndicator, {
      typingUsers: typingUsers
    });
  }, [typingUsers]);
  var keyExtractor = (0, _react.useCallback)(function (item) {
    return item._id;
  }, []);
  var getItemLayout = (0, _react.useCallback)(function (data, index) {
    var message = data == null ? void 0 : data[index];
    var estimatedHeight = 80;
    if (message) {
      if (message.content.length > 100) estimatedHeight += 20;
      if (message.replyTo) estimatedHeight += 40;
      if (message.audioUrl || message.type === 'image') estimatedHeight += 120;
    }
    return {
      length: estimatedHeight,
      offset: estimatedHeight * index,
      index: index
    };
  }, []);
  return (0, _jsxRuntime.jsx)(_reactNative.View, {
    style: styles.container,
    children: (0, _jsxRuntime.jsx)(_reactNative.FlatList, {
      ref: flatListRef,
      data: messages,
      renderItem: renderMessage,
      keyExtractor: keyExtractor,
      showsVerticalScrollIndicator: false,
      contentContainerStyle: styles.contentContainer,
      onScroll: onScroll,
      scrollEventThrottle: 100,
      initialNumToRender: 20,
      windowSize: 10,
      maxToRenderPerBatch: 10,
      updateCellsBatchingPeriod: 50,
      removeClippedSubviews: true,
      getItemLayout: getItemLayout,
      ListFooterComponent: renderTypingIndicator
    })
  });
}
var styles = _reactNative.StyleSheet.create({
  container: {
    flex: 1
  },
  contentContainer: {
    paddingHorizontal: Spacing.md,
    paddingVertical: Spacing.sm,
    paddingBottom: Spacing.lg
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsInJlcXVpcmUiLCJfcmVhY3ROYXRpdmUiLCJfTWVzc2FnZUl0ZW0iLCJfVHlwaW5nSW5kaWNhdG9yIiwiX2NoYXRTZXJ2aWNlIiwiX2FwaSIsIl9qc3hSdW50aW1lIiwiZSIsInQiLCJXZWFrTWFwIiwiciIsIm4iLCJfX2VzTW9kdWxlIiwibyIsImkiLCJmIiwiX19wcm90b19fIiwiZGVmYXVsdCIsImhhcyIsImdldCIsInNldCIsIl90IiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJTcGFjaW5nIiwieHMiLCJzbSIsIm1kIiwibGciLCJ4bCIsIk1lc3NhZ2VMaXN0IiwiX3JlZiIsIm1lc3NhZ2VzIiwidHlwaW5nVXNlcnMiLCJpc09ubGluZSIsImN1cnJlbnRVc2VySWQiLCJtYXRjaElkIiwib25NZXNzYWdlUHJlc3MiLCJvbk1lc3NhZ2VMb25nUHJlc3MiLCJvblJldHJ5TWVzc2FnZSIsImZsYXRMaXN0UmVmIiwib25TY3JvbGwiLCJfdXNlU3RhdGUiLCJ1c2VTdGF0ZSIsIl91c2VTdGF0ZTIiLCJfc2xpY2VkVG9BcnJheTIiLCJyZXBseVRhcmdldCIsInNldFJlcGx5VGFyZ2V0IiwiaGFuZGxlUmVwbHkiLCJ1c2VDYWxsYmFjayIsIm1lc3NhZ2UiLCJoYW5kbGVDb3B5IiwiQ2xpcGJvYXJkIiwic2V0U3RyaW5nIiwiY29udGVudCIsImhhbmRsZVJlYWN0IiwiX3JlZjIiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJBbGVydCIsImFsZXJ0IiwidGV4dCIsIm9uUHJlc3MiLCJjaGF0U2VydmljZSIsInNlbmRSZWFjdGlvbiIsIl9pZCIsInN0eWxlIiwiX3giLCJhcHBseSIsImFyZ3VtZW50cyIsImhhbmRsZURlbGV0ZSIsIl9yZWYzIiwiX29uUHJlc3MiLCJtYXRjaGVzQVBJIiwiZGVsZXRlTWVzc2FnZSIsImVycm9yIiwiX3gyIiwiaGFuZGxlU2hvd1JlYWRCeSIsInJlYWQiLCJyZW5kZXJNZXNzYWdlIiwiX3JlZjQiLCJpdGVtIiwiaW5kZXgiLCJpc093bk1lc3NhZ2UiLCJzZW5kZXJJZCIsImpzeCIsIlZpZXciLCJjaGlsZHJlbiIsIk1lc3NhZ2VJdGVtIiwib25Mb25nUHJlc3MiLCJvblJldHJ5IiwicmVuZGVyVHlwaW5nSW5kaWNhdG9yIiwiVHlwaW5nSW5kaWNhdG9yIiwia2V5RXh0cmFjdG9yIiwiZ2V0SXRlbUxheW91dCIsImRhdGEiLCJlc3RpbWF0ZWRIZWlnaHQiLCJsZW5ndGgiLCJyZXBseVRvIiwiYXVkaW9VcmwiLCJ0eXBlIiwib2Zmc2V0Iiwic3R5bGVzIiwiY29udGFpbmVyIiwiRmxhdExpc3QiLCJyZWYiLCJyZW5kZXJJdGVtIiwic2hvd3NWZXJ0aWNhbFNjcm9sbEluZGljYXRvciIsImNvbnRlbnRDb250YWluZXJTdHlsZSIsImNvbnRlbnRDb250YWluZXIiLCJzY3JvbGxFdmVudFRocm90dGxlIiwiaW5pdGlhbE51bVRvUmVuZGVyIiwid2luZG93U2l6ZSIsIm1heFRvUmVuZGVyUGVyQmF0Y2giLCJ1cGRhdGVDZWxsc0JhdGNoaW5nUGVyaW9kIiwicmVtb3ZlQ2xpcHBlZFN1YnZpZXdzIiwiTGlzdEZvb3RlckNvbXBvbmVudCIsIlN0eWxlU2hlZXQiLCJjcmVhdGUiLCJmbGV4IiwicGFkZGluZ0hvcml6b250YWwiLCJwYWRkaW5nVmVydGljYWwiLCJwYWRkaW5nQm90dG9tIl0sInNvdXJjZXMiOlsiTWVzc2FnZUxpc3QudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyB1c2VDYWxsYmFjaywgdXNlU3RhdGUgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7XG4gIEZsYXRMaXN0LFxuICBWaWV3LFxuICBTdHlsZVNoZWV0LFxuICBDbGlwYm9hcmQsXG4gIEFsZXJ0LFxuICB0eXBlIE5hdGl2ZVN5bnRoZXRpY0V2ZW50LFxuICB0eXBlIE5hdGl2ZVNjcm9sbEV2ZW50LFxufSBmcm9tIFwicmVhY3QtbmF0aXZlXCI7XG5pbXBvcnQgdHlwZSB7IE1lc3NhZ2UgfSBmcm9tIFwiLi4vLi4vaG9va3MvdXNlQ2hhdERhdGFcIjtcbmltcG9ydCB7IE1lc3NhZ2VJdGVtIH0gZnJvbSBcIi4vTWVzc2FnZUl0ZW1cIjtcbmltcG9ydCB7IE1lc3NhZ2VCdWJibGVFbmhhbmNlZCB9IGZyb20gXCIuL01lc3NhZ2VCdWJibGVFbmhhbmNlZFwiO1xuaW1wb3J0IHsgVHlwaW5nSW5kaWNhdG9yIH0gZnJvbSBcIi4vVHlwaW5nSW5kaWNhdG9yXCI7XG5pbXBvcnQgeyBjaGF0U2VydmljZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9jaGF0U2VydmljZVwiO1xuaW1wb3J0IHsgbWF0Y2hlc0FQSSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9hcGlcIjtcblxuY29uc3QgU3BhY2luZyA9IHtcbiAgeHM6IDQsXG4gIHNtOiA4LFxuICBtZDogMTYsXG4gIGxnOiAyNCxcbiAgeGw6IDMyLFxufTtcblxuaW50ZXJmYWNlIE1lc3NhZ2VMaXN0UHJvcHMge1xuICBtZXNzYWdlczogTWVzc2FnZVtdO1xuICB0eXBpbmdVc2Vyczogc3RyaW5nW107XG4gIGlzT25saW5lOiBib29sZWFuO1xuICBjdXJyZW50VXNlcklkOiBzdHJpbmc7XG4gIG1hdGNoSWQ6IHN0cmluZztcbiAgb25NZXNzYWdlUHJlc3M/OiAobWVzc2FnZTogTWVzc2FnZSkgPT4gdm9pZDtcbiAgb25NZXNzYWdlTG9uZ1ByZXNzPzogKG1lc3NhZ2U6IE1lc3NhZ2UpID0+IHZvaWQ7XG4gIG9uUmV0cnlNZXNzYWdlPzogKG1lc3NhZ2VJZDogc3RyaW5nKSA9PiB2b2lkO1xuICBmbGF0TGlzdFJlZj86IFJlYWN0LlJlZk9iamVjdDxGbGF0TGlzdDxNZXNzYWdlPj47XG4gIG9uU2Nyb2xsPzogKGV2ZW50OiBOYXRpdmVTeW50aGV0aWNFdmVudDxOYXRpdmVTY3JvbGxFdmVudD4pID0+IHZvaWQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBNZXNzYWdlTGlzdCh7XG4gIG1lc3NhZ2VzLFxuICB0eXBpbmdVc2VycyxcbiAgaXNPbmxpbmUsXG4gIGN1cnJlbnRVc2VySWQsXG4gIG1hdGNoSWQsXG4gIG9uTWVzc2FnZVByZXNzLFxuICBvbk1lc3NhZ2VMb25nUHJlc3MsXG4gIG9uUmV0cnlNZXNzYWdlLFxuICBmbGF0TGlzdFJlZixcbiAgb25TY3JvbGwsXG59OiBNZXNzYWdlTGlzdFByb3BzKTogUmVhY3QuSlNYLkVsZW1lbnQge1xuICBjb25zdCBbcmVwbHlUYXJnZXQsIHNldFJlcGx5VGFyZ2V0XSA9IHVzZVN0YXRlPE1lc3NhZ2UgfCBudWxsPihudWxsKTtcbiAgXG4gIC8vIEFjdGlvbiBoYW5kbGVycyBmb3IgZW5oYW5jZWQgYnViYmxlXG4gIGNvbnN0IGhhbmRsZVJlcGx5ID0gdXNlQ2FsbGJhY2soKG1lc3NhZ2U6IE1lc3NhZ2UpID0+IHtcbiAgICBzZXRSZXBseVRhcmdldChtZXNzYWdlKTtcbiAgfSwgW10pO1xuICBcbiAgY29uc3QgaGFuZGxlQ29weSA9IHVzZUNhbGxiYWNrKChtZXNzYWdlOiBNZXNzYWdlKSA9PiB7XG4gICAgQ2xpcGJvYXJkLnNldFN0cmluZyhtZXNzYWdlLmNvbnRlbnQpO1xuICB9LCBbXSk7XG4gIFxuICBjb25zdCBoYW5kbGVSZWFjdCA9IHVzZUNhbGxiYWNrKGFzeW5jIChtZXNzYWdlOiBNZXNzYWdlKSA9PiB7XG4gICAgLy8gT3BlbiByZWFjdGlvbiBwaWNrZXJcbiAgICBBbGVydC5hbGVydChcIkFkZCBSZWFjdGlvblwiLCBcIkNob29zZSBhIHJlYWN0aW9uXCIsIFtcbiAgICAgIHsgdGV4dDogXCLwn5GNIExpa2VcIiwgb25QcmVzczogKCkgPT4gY2hhdFNlcnZpY2Uuc2VuZFJlYWN0aW9uKG1hdGNoSWQsIG1lc3NhZ2UuX2lkLCBcImxpa2VcIikgfSxcbiAgICAgIHsgdGV4dDogXCLinaTvuI8gTG92ZVwiLCBvblByZXNzOiAoKSA9PiBjaGF0U2VydmljZS5zZW5kUmVhY3Rpb24obWF0Y2hJZCwgbWVzc2FnZS5faWQsIFwibG92ZVwiKSB9LFxuICAgICAgeyB0ZXh0OiBcIvCfmIIgTGF1Z2hcIiwgb25QcmVzczogKCkgPT4gY2hhdFNlcnZpY2Uuc2VuZFJlYWN0aW9uKG1hdGNoSWQsIG1lc3NhZ2UuX2lkLCBcImxhdWdoXCIpIH0sXG4gICAgICB7IHRleHQ6IFwiQ2FuY2VsXCIsIHN0eWxlOiBcImNhbmNlbFwiIH0sXG4gICAgXSk7XG4gIH0sIFttYXRjaElkXSk7XG4gIFxuICBjb25zdCBoYW5kbGVEZWxldGUgPSB1c2VDYWxsYmFjayhhc3luYyAobWVzc2FnZTogTWVzc2FnZSkgPT4ge1xuICAgIEFsZXJ0LmFsZXJ0KFxuICAgICAgXCJEZWxldGUgTWVzc2FnZVwiLFxuICAgICAgXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgbWVzc2FnZT9cIixcbiAgICAgIFtcbiAgICAgICAgeyB0ZXh0OiBcIkNhbmNlbFwiLCBzdHlsZTogXCJjYW5jZWxcIiB9LFxuICAgICAgICB7IFxuICAgICAgICAgIHRleHQ6IFwiRGVsZXRlXCIsIFxuICAgICAgICAgIHN0eWxlOiBcImRlc3RydWN0aXZlXCIsXG4gICAgICAgICAgb25QcmVzczogYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgYXdhaXQgbWF0Y2hlc0FQSS5kZWxldGVNZXNzYWdlKG1hdGNoSWQsIG1lc3NhZ2UuX2lkKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgIEFsZXJ0LmFsZXJ0KFwiRXJyb3JcIiwgXCJGYWlsZWQgdG8gZGVsZXRlIG1lc3NhZ2VcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgXVxuICAgICk7XG4gIH0sIFttYXRjaElkXSk7XG4gIFxuICBjb25zdCBoYW5kbGVTaG93UmVhZEJ5ID0gdXNlQ2FsbGJhY2soKG1lc3NhZ2U6IE1lc3NhZ2UpID0+IHtcbiAgICBBbGVydC5hbGVydChcIlJlYWQgYnlcIiwgYE1lc3NhZ2Ugd2FzIHJlYWQgYnkgJHttZXNzYWdlLnJlYWQgPyBcInJlY2lwaWVudFwiIDogXCJubyBvbmUgeWV0XCJ9YCk7XG4gIH0sIFtdKTtcblxuICBjb25zdCByZW5kZXJNZXNzYWdlID0gdXNlQ2FsbGJhY2soXG4gICAgKHsgaXRlbSwgaW5kZXggfTogeyBpdGVtOiBNZXNzYWdlOyBpbmRleDogbnVtYmVyIH0pID0+IHtcbiAgICAgIGNvbnN0IGlzT3duTWVzc2FnZSA9IGl0ZW0uc2VuZGVySWQgPT09IGN1cnJlbnRVc2VySWQgfHwgaXRlbS5zZW5kZXJJZCA9PT0gXCJtZVwiO1xuICAgICAgXG4gICAgICAvLyBVc2UgZW5oYW5jZWQgYnViYmxlIHdoZW4gaW4gcHJvZHVjdGlvbi1yZWFkeSBtb2RlXG4gICAgICAvLyBGb3Igbm93LCBrZWVwIHVzaW5nIE1lc3NhZ2VJdGVtIGZvciBjb21wYXRpYmlsaXR5XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8Vmlldz5cbiAgICAgICAgICA8TWVzc2FnZUl0ZW1cbiAgICAgICAgICAgIG1lc3NhZ2U9e2l0ZW19XG4gICAgICAgICAgICBpbmRleD17aW5kZXh9XG4gICAgICAgICAgICBtZXNzYWdlcz17bWVzc2FnZXN9XG4gICAgICAgICAgICBpc09ubGluZT17aXNPbmxpbmV9XG4gICAgICAgICAgICBvblByZXNzPXtvbk1lc3NhZ2VQcmVzc31cbiAgICAgICAgICAgIG9uTG9uZ1ByZXNzPXtvbk1lc3NhZ2VMb25nUHJlc3N9XG4gICAgICAgICAgICBvblJldHJ5PXtvblJldHJ5TWVzc2FnZX1cbiAgICAgICAgICAvPlxuICAgICAgICA8L1ZpZXc+XG4gICAgICApO1xuICAgIH0sXG4gICAgW21lc3NhZ2VzLCBpc09ubGluZSwgY3VycmVudFVzZXJJZCwgb25NZXNzYWdlUHJlc3MsIG9uTWVzc2FnZUxvbmdQcmVzcywgb25SZXRyeU1lc3NhZ2VdLFxuICApO1xuXG4gIGNvbnN0IHJlbmRlclR5cGluZ0luZGljYXRvciA9IHVzZUNhbGxiYWNrKFxuICAgICgpID0+IDxUeXBpbmdJbmRpY2F0b3IgdHlwaW5nVXNlcnM9e3R5cGluZ1VzZXJzfSAvPixcbiAgICBbdHlwaW5nVXNlcnNdLFxuICApO1xuXG4gIGNvbnN0IGtleUV4dHJhY3RvciA9IHVzZUNhbGxiYWNrKChpdGVtOiBNZXNzYWdlKSA9PiBpdGVtLl9pZCwgW10pO1xuXG4gIGNvbnN0IGdldEl0ZW1MYXlvdXQgPSB1c2VDYWxsYmFjayhcbiAgICAoZGF0YTogQXJyYXlMaWtlPE1lc3NhZ2U+IHwgbnVsbCB8IHVuZGVmaW5lZCwgaW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgLy8gRHluYW1pYyBoZWlnaHQgY2FsY3VsYXRpb24gYmFzZWQgb24gbWVzc2FnZSBjb250ZW50XG4gICAgICBjb25zdCBtZXNzYWdlID0gZGF0YT8uW2luZGV4XTtcbiAgICAgIGxldCBlc3RpbWF0ZWRIZWlnaHQgPSA4MDtcbiAgICAgIFxuICAgICAgaWYgKG1lc3NhZ2UpIHtcbiAgICAgICAgLy8gQWNjb3VudCBmb3IgbWVzc2FnZSBjb250ZW50XG4gICAgICAgIGlmIChtZXNzYWdlLmNvbnRlbnQubGVuZ3RoID4gMTAwKSBlc3RpbWF0ZWRIZWlnaHQgKz0gMjA7XG4gICAgICAgIFxuICAgICAgICAvLyBBY2NvdW50IGZvciByZXBseSB0byBtZXNzYWdlXG4gICAgICAgIGlmIChtZXNzYWdlLnJlcGx5VG8pIGVzdGltYXRlZEhlaWdodCArPSA0MDtcbiAgICAgICAgXG4gICAgICAgIC8vIEFjY291bnQgZm9yIGF0dGFjaG1lbnRcbiAgICAgICAgaWYgKG1lc3NhZ2UuYXVkaW9VcmwgfHwgbWVzc2FnZS50eXBlID09PSAnaW1hZ2UnKSBlc3RpbWF0ZWRIZWlnaHQgKz0gMTIwO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBsZW5ndGg6IGVzdGltYXRlZEhlaWdodCxcbiAgICAgICAgb2Zmc2V0OiBlc3RpbWF0ZWRIZWlnaHQgKiBpbmRleCxcbiAgICAgICAgaW5kZXgsXG4gICAgICB9O1xuICAgIH0sXG4gICAgW10sXG4gICk7XG5cbiAgcmV0dXJuIChcbiAgICA8VmlldyBzdHlsZT17c3R5bGVzLmNvbnRhaW5lcn0+XG4gICAgICA8RmxhdExpc3Q8TWVzc2FnZT5cbiAgICAgICAgcmVmPXtmbGF0TGlzdFJlZn1cbiAgICAgICAgZGF0YT17bWVzc2FnZXN9XG4gICAgICAgIHJlbmRlckl0ZW09e3JlbmRlck1lc3NhZ2V9XG4gICAgICAgIGtleUV4dHJhY3Rvcj17a2V5RXh0cmFjdG9yfVxuICAgICAgICBzaG93c1ZlcnRpY2FsU2Nyb2xsSW5kaWNhdG9yPXtmYWxzZX1cbiAgICAgICAgY29udGVudENvbnRhaW5lclN0eWxlPXtzdHlsZXMuY29udGVudENvbnRhaW5lcn1cbiAgICAgICAgb25TY3JvbGw9e29uU2Nyb2xsfVxuICAgICAgICBzY3JvbGxFdmVudFRocm90dGxlPXsxMDB9XG4gICAgICAgIGluaXRpYWxOdW1Ub1JlbmRlcj17MjB9XG4gICAgICAgIHdpbmRvd1NpemU9ezEwfVxuICAgICAgICBtYXhUb1JlbmRlclBlckJhdGNoPXsxMH1cbiAgICAgICAgdXBkYXRlQ2VsbHNCYXRjaGluZ1BlcmlvZD17NTB9XG4gICAgICAgIHJlbW92ZUNsaXBwZWRTdWJ2aWV3cz17dHJ1ZX1cbiAgICAgICAgZ2V0SXRlbUxheW91dD17Z2V0SXRlbUxheW91dH1cbiAgICAgICAgTGlzdEZvb3RlckNvbXBvbmVudD17cmVuZGVyVHlwaW5nSW5kaWNhdG9yfVxuICAgICAgLz5cbiAgICA8L1ZpZXc+XG4gICk7XG59XG5cbmNvbnN0IHN0eWxlcyA9IFN0eWxlU2hlZXQuY3JlYXRlKHtcbiAgY29udGFpbmVyOiB7XG4gICAgZmxleDogMSxcbiAgfSxcbiAgY29udGVudENvbnRhaW5lcjoge1xuICAgIHBhZGRpbmdIb3Jpem9udGFsOiBTcGFjaW5nLm1kLFxuICAgIHBhZGRpbmdWZXJ0aWNhbDogU3BhY2luZy5zbSxcbiAgICBwYWRkaW5nQm90dG9tOiBTcGFjaW5nLmxnLFxuICB9LFxufSk7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLElBQUFBLE1BQUEsR0FBQUMsdUJBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLFlBQUEsR0FBQUQsT0FBQTtBQVVBLElBQUFFLFlBQUEsR0FBQUYsT0FBQTtBQUVBLElBQUFHLGdCQUFBLEdBQUFILE9BQUE7QUFDQSxJQUFBSSxZQUFBLEdBQUFKLE9BQUE7QUFDQSxJQUFBSyxJQUFBLEdBQUFMLE9BQUE7QUFBZ0QsSUFBQU0sV0FBQSxHQUFBTixPQUFBO0FBQUEsU0FBQUQsd0JBQUFRLENBQUEsRUFBQUMsQ0FBQSw2QkFBQUMsT0FBQSxNQUFBQyxDQUFBLE9BQUFELE9BQUEsSUFBQUUsQ0FBQSxPQUFBRixPQUFBLFlBQUFWLHVCQUFBLFlBQUFBLHdCQUFBUSxDQUFBLEVBQUFDLENBQUEsU0FBQUEsQ0FBQSxJQUFBRCxDQUFBLElBQUFBLENBQUEsQ0FBQUssVUFBQSxTQUFBTCxDQUFBLE1BQUFNLENBQUEsRUFBQUMsQ0FBQSxFQUFBQyxDQUFBLEtBQUFDLFNBQUEsUUFBQUMsT0FBQSxFQUFBVixDQUFBLGlCQUFBQSxDQUFBLHVCQUFBQSxDQUFBLHlCQUFBQSxDQUFBLFNBQUFRLENBQUEsTUFBQUYsQ0FBQSxHQUFBTCxDQUFBLEdBQUFHLENBQUEsR0FBQUQsQ0FBQSxRQUFBRyxDQUFBLENBQUFLLEdBQUEsQ0FBQVgsQ0FBQSxVQUFBTSxDQUFBLENBQUFNLEdBQUEsQ0FBQVosQ0FBQSxHQUFBTSxDQUFBLENBQUFPLEdBQUEsQ0FBQWIsQ0FBQSxFQUFBUSxDQUFBLGNBQUFNLEVBQUEsSUFBQWQsQ0FBQSxnQkFBQWMsRUFBQSxPQUFBQyxjQUFBLENBQUFDLElBQUEsQ0FBQWhCLENBQUEsRUFBQWMsRUFBQSxPQUFBUCxDQUFBLElBQUFELENBQUEsR0FBQVcsTUFBQSxDQUFBQyxjQUFBLEtBQUFELE1BQUEsQ0FBQUUsd0JBQUEsQ0FBQW5CLENBQUEsRUFBQWMsRUFBQSxPQUFBUCxDQUFBLENBQUFLLEdBQUEsSUFBQUwsQ0FBQSxDQUFBTSxHQUFBLElBQUFQLENBQUEsQ0FBQUUsQ0FBQSxFQUFBTSxFQUFBLEVBQUFQLENBQUEsSUFBQUMsQ0FBQSxDQUFBTSxFQUFBLElBQUFkLENBQUEsQ0FBQWMsRUFBQSxXQUFBTixDQUFBLEtBQUFSLENBQUEsRUFBQUMsQ0FBQTtBQUVoRCxJQUFNbUIsT0FBTyxHQUFHO0VBQ2RDLEVBQUUsRUFBRSxDQUFDO0VBQ0xDLEVBQUUsRUFBRSxDQUFDO0VBQ0xDLEVBQUUsRUFBRSxFQUFFO0VBQ05DLEVBQUUsRUFBRSxFQUFFO0VBQ05DLEVBQUUsRUFBRTtBQUNOLENBQUM7QUFlTSxTQUFTQyxXQUFXQSxDQUFBQyxJQUFBLEVBV2E7RUFBQSxJQVZ0Q0MsUUFBUSxHQUFBRCxJQUFBLENBQVJDLFFBQVE7SUFDUkMsV0FBVyxHQUFBRixJQUFBLENBQVhFLFdBQVc7SUFDWEMsUUFBUSxHQUFBSCxJQUFBLENBQVJHLFFBQVE7SUFDUkMsYUFBYSxHQUFBSixJQUFBLENBQWJJLGFBQWE7SUFDYkMsT0FBTyxHQUFBTCxJQUFBLENBQVBLLE9BQU87SUFDUEMsY0FBYyxHQUFBTixJQUFBLENBQWRNLGNBQWM7SUFDZEMsa0JBQWtCLEdBQUFQLElBQUEsQ0FBbEJPLGtCQUFrQjtJQUNsQkMsY0FBYyxHQUFBUixJQUFBLENBQWRRLGNBQWM7SUFDZEMsV0FBVyxHQUFBVCxJQUFBLENBQVhTLFdBQVc7SUFDWEMsUUFBUSxHQUFBVixJQUFBLENBQVJVLFFBQVE7RUFFUixJQUFBQyxTQUFBLEdBQXNDLElBQUFDLGVBQVEsRUFBaUIsSUFBSSxDQUFDO0lBQUFDLFVBQUEsT0FBQUMsZUFBQSxDQUFBL0IsT0FBQSxFQUFBNEIsU0FBQTtJQUE3REksV0FBVyxHQUFBRixVQUFBO0lBQUVHLGNBQWMsR0FBQUgsVUFBQTtFQUdsQyxJQUFNSSxXQUFXLEdBQUcsSUFBQUMsa0JBQVcsRUFBQyxVQUFDQyxPQUFnQixFQUFLO0lBQ3BESCxjQUFjLENBQUNHLE9BQU8sQ0FBQztFQUN6QixDQUFDLEVBQUUsRUFBRSxDQUFDO0VBRU4sSUFBTUMsVUFBVSxHQUFHLElBQUFGLGtCQUFXLEVBQUMsVUFBQ0MsT0FBZ0IsRUFBSztJQUNuREUsc0JBQVMsQ0FBQ0MsU0FBUyxDQUFDSCxPQUFPLENBQUNJLE9BQU8sQ0FBQztFQUN0QyxDQUFDLEVBQUUsRUFBRSxDQUFDO0VBRU4sSUFBTUMsV0FBVyxHQUFHLElBQUFOLGtCQUFXO0lBQUEsSUFBQU8sS0FBQSxPQUFBQyxrQkFBQSxDQUFBM0MsT0FBQSxFQUFDLFdBQU9vQyxPQUFnQixFQUFLO01BRTFEUSxrQkFBSyxDQUFDQyxLQUFLLENBQUMsY0FBYyxFQUFFLG1CQUFtQixFQUFFLENBQy9DO1FBQUVDLElBQUksRUFBRSxTQUFTO1FBQUVDLE9BQU8sRUFBRSxTQUFUQSxPQUFPQSxDQUFBO1VBQUEsT0FBUUMsd0JBQVcsQ0FBQ0MsWUFBWSxDQUFDM0IsT0FBTyxFQUFFYyxPQUFPLENBQUNjLEdBQUcsRUFBRSxNQUFNLENBQUM7UUFBQTtNQUFDLENBQUMsRUFDMUY7UUFBRUosSUFBSSxFQUFFLFNBQVM7UUFBRUMsT0FBTyxFQUFFLFNBQVRBLE9BQU9BLENBQUE7VUFBQSxPQUFRQyx3QkFBVyxDQUFDQyxZQUFZLENBQUMzQixPQUFPLEVBQUVjLE9BQU8sQ0FBQ2MsR0FBRyxFQUFFLE1BQU0sQ0FBQztRQUFBO01BQUMsQ0FBQyxFQUMxRjtRQUFFSixJQUFJLEVBQUUsVUFBVTtRQUFFQyxPQUFPLEVBQUUsU0FBVEEsT0FBT0EsQ0FBQTtVQUFBLE9BQVFDLHdCQUFXLENBQUNDLFlBQVksQ0FBQzNCLE9BQU8sRUFBRWMsT0FBTyxDQUFDYyxHQUFHLEVBQUUsT0FBTyxDQUFDO1FBQUE7TUFBQyxDQUFDLEVBQzVGO1FBQUVKLElBQUksRUFBRSxRQUFRO1FBQUVLLEtBQUssRUFBRTtNQUFTLENBQUMsQ0FDcEMsQ0FBQztJQUNKLENBQUM7SUFBQSxpQkFBQUMsRUFBQTtNQUFBLE9BQUFWLEtBQUEsQ0FBQVcsS0FBQSxPQUFBQyxTQUFBO0lBQUE7RUFBQSxLQUFFLENBQUNoQyxPQUFPLENBQUMsQ0FBQztFQUViLElBQU1pQyxZQUFZLEdBQUcsSUFBQXBCLGtCQUFXO0lBQUEsSUFBQXFCLEtBQUEsT0FBQWIsa0JBQUEsQ0FBQTNDLE9BQUEsRUFBQyxXQUFPb0MsT0FBZ0IsRUFBSztNQUMzRFEsa0JBQUssQ0FBQ0MsS0FBSyxDQUNULGdCQUFnQixFQUNoQiwrQ0FBK0MsRUFDL0MsQ0FDRTtRQUFFQyxJQUFJLEVBQUUsUUFBUTtRQUFFSyxLQUFLLEVBQUU7TUFBUyxDQUFDLEVBQ25DO1FBQ0VMLElBQUksRUFBRSxRQUFRO1FBQ2RLLEtBQUssRUFBRSxhQUFhO1FBQ3BCSixPQUFPO1VBQUEsSUFBQVUsUUFBQSxPQUFBZCxrQkFBQSxDQUFBM0MsT0FBQSxFQUFFLGFBQVk7WUFDbkIsSUFBSTtjQUNGLE1BQU0wRCxlQUFVLENBQUNDLGFBQWEsQ0FBQ3JDLE9BQU8sRUFBRWMsT0FBTyxDQUFDYyxHQUFHLENBQUM7WUFDdEQsQ0FBQyxDQUFDLE9BQU9VLEtBQUssRUFBRTtjQUNkaEIsa0JBQUssQ0FBQ0MsS0FBSyxDQUFDLE9BQU8sRUFBRSwwQkFBMEIsQ0FBQztZQUNsRDtVQUNGLENBQUM7VUFBQSxTQU5ERSxPQUFPQSxDQUFBO1lBQUEsT0FBQVUsUUFBQSxDQUFBSixLQUFBLE9BQUFDLFNBQUE7VUFBQTtVQUFBLE9BQVBQLE9BQU87UUFBQTtNQU9ULENBQUMsQ0FFTCxDQUFDO0lBQ0gsQ0FBQztJQUFBLGlCQUFBYyxHQUFBO01BQUEsT0FBQUwsS0FBQSxDQUFBSCxLQUFBLE9BQUFDLFNBQUE7SUFBQTtFQUFBLEtBQUUsQ0FBQ2hDLE9BQU8sQ0FBQyxDQUFDO0VBRWIsSUFBTXdDLGdCQUFnQixHQUFHLElBQUEzQixrQkFBVyxFQUFDLFVBQUNDLE9BQWdCLEVBQUs7SUFDekRRLGtCQUFLLENBQUNDLEtBQUssQ0FBQyxTQUFTLEVBQUUsdUJBQXVCVCxPQUFPLENBQUMyQixJQUFJLEdBQUcsV0FBVyxHQUFHLFlBQVksRUFBRSxDQUFDO0VBQzVGLENBQUMsRUFBRSxFQUFFLENBQUM7RUFFTixJQUFNQyxhQUFhLEdBQUcsSUFBQTdCLGtCQUFXLEVBQy9CLFVBQUE4QixLQUFBLEVBQXVEO0lBQUEsSUFBcERDLElBQUksR0FBQUQsS0FBQSxDQUFKQyxJQUFJO01BQUVDLEtBQUssR0FBQUYsS0FBQSxDQUFMRSxLQUFLO0lBQ1osSUFBTUMsWUFBWSxHQUFHRixJQUFJLENBQUNHLFFBQVEsS0FBS2hELGFBQWEsSUFBSTZDLElBQUksQ0FBQ0csUUFBUSxLQUFLLElBQUk7SUFJOUUsT0FDRSxJQUFBaEYsV0FBQSxDQUFBaUYsR0FBQSxFQUFDdEYsWUFBQSxDQUFBdUYsSUFBSTtNQUFBQyxRQUFBLEVBQ0gsSUFBQW5GLFdBQUEsQ0FBQWlGLEdBQUEsRUFBQ3JGLFlBQUEsQ0FBQXdGLFdBQVc7UUFDVnJDLE9BQU8sRUFBRThCLElBQUs7UUFDZEMsS0FBSyxFQUFFQSxLQUFNO1FBQ2JqRCxRQUFRLEVBQUVBLFFBQVM7UUFDbkJFLFFBQVEsRUFBRUEsUUFBUztRQUNuQjJCLE9BQU8sRUFBRXhCLGNBQWU7UUFDeEJtRCxXQUFXLEVBQUVsRCxrQkFBbUI7UUFDaENtRCxPQUFPLEVBQUVsRDtNQUFlLENBQ3pCO0lBQUMsQ0FDRSxDQUFDO0VBRVgsQ0FBQyxFQUNELENBQUNQLFFBQVEsRUFBRUUsUUFBUSxFQUFFQyxhQUFhLEVBQUVFLGNBQWMsRUFBRUMsa0JBQWtCLEVBQUVDLGNBQWMsQ0FDeEYsQ0FBQztFQUVELElBQU1tRCxxQkFBcUIsR0FBRyxJQUFBekMsa0JBQVcsRUFDdkM7SUFBQSxPQUFNLElBQUE5QyxXQUFBLENBQUFpRixHQUFBLEVBQUNwRixnQkFBQSxDQUFBMkYsZUFBZTtNQUFDMUQsV0FBVyxFQUFFQTtJQUFZLENBQUUsQ0FBQztFQUFBLEdBQ25ELENBQUNBLFdBQVcsQ0FDZCxDQUFDO0VBRUQsSUFBTTJELFlBQVksR0FBRyxJQUFBM0Msa0JBQVcsRUFBQyxVQUFDK0IsSUFBYTtJQUFBLE9BQUtBLElBQUksQ0FBQ2hCLEdBQUc7RUFBQSxHQUFFLEVBQUUsQ0FBQztFQUVqRSxJQUFNNkIsYUFBYSxHQUFHLElBQUE1QyxrQkFBVyxFQUMvQixVQUFDNkMsSUFBMkMsRUFBRWIsS0FBYSxFQUFLO0lBRTlELElBQU0vQixPQUFPLEdBQUc0QyxJQUFJLG9CQUFKQSxJQUFJLENBQUdiLEtBQUssQ0FBQztJQUM3QixJQUFJYyxlQUFlLEdBQUcsRUFBRTtJQUV4QixJQUFJN0MsT0FBTyxFQUFFO01BRVgsSUFBSUEsT0FBTyxDQUFDSSxPQUFPLENBQUMwQyxNQUFNLEdBQUcsR0FBRyxFQUFFRCxlQUFlLElBQUksRUFBRTtNQUd2RCxJQUFJN0MsT0FBTyxDQUFDK0MsT0FBTyxFQUFFRixlQUFlLElBQUksRUFBRTtNQUcxQyxJQUFJN0MsT0FBTyxDQUFDZ0QsUUFBUSxJQUFJaEQsT0FBTyxDQUFDaUQsSUFBSSxLQUFLLE9BQU8sRUFBRUosZUFBZSxJQUFJLEdBQUc7SUFDMUU7SUFFQSxPQUFPO01BQ0xDLE1BQU0sRUFBRUQsZUFBZTtNQUN2QkssTUFBTSxFQUFFTCxlQUFlLEdBQUdkLEtBQUs7TUFDL0JBLEtBQUssRUFBTEE7SUFDRixDQUFDO0VBQ0gsQ0FBQyxFQUNELEVBQ0YsQ0FBQztFQUVELE9BQ0UsSUFBQTlFLFdBQUEsQ0FBQWlGLEdBQUEsRUFBQ3RGLFlBQUEsQ0FBQXVGLElBQUk7SUFBQ3BCLEtBQUssRUFBRW9DLE1BQU0sQ0FBQ0MsU0FBVTtJQUFBaEIsUUFBQSxFQUM1QixJQUFBbkYsV0FBQSxDQUFBaUYsR0FBQSxFQUFDdEYsWUFBQSxDQUFBeUcsUUFBUTtNQUNQQyxHQUFHLEVBQUVoRSxXQUFZO01BQ2pCc0QsSUFBSSxFQUFFOUQsUUFBUztNQUNmeUUsVUFBVSxFQUFFM0IsYUFBYztNQUMxQmMsWUFBWSxFQUFFQSxZQUFhO01BQzNCYyw0QkFBNEIsRUFBRSxLQUFNO01BQ3BDQyxxQkFBcUIsRUFBRU4sTUFBTSxDQUFDTyxnQkFBaUI7TUFDL0NuRSxRQUFRLEVBQUVBLFFBQVM7TUFDbkJvRSxtQkFBbUIsRUFBRSxHQUFJO01BQ3pCQyxrQkFBa0IsRUFBRSxFQUFHO01BQ3ZCQyxVQUFVLEVBQUUsRUFBRztNQUNmQyxtQkFBbUIsRUFBRSxFQUFHO01BQ3hCQyx5QkFBeUIsRUFBRSxFQUFHO01BQzlCQyxxQkFBcUIsRUFBRSxJQUFLO01BQzVCckIsYUFBYSxFQUFFQSxhQUFjO01BQzdCc0IsbUJBQW1CLEVBQUV6QjtJQUFzQixDQUM1QztFQUFDLENBQ0UsQ0FBQztBQUVYO0FBRUEsSUFBTVcsTUFBTSxHQUFHZSx1QkFBVSxDQUFDQyxNQUFNLENBQUM7RUFDL0JmLFNBQVMsRUFBRTtJQUNUZ0IsSUFBSSxFQUFFO0VBQ1IsQ0FBQztFQUNEVixnQkFBZ0IsRUFBRTtJQUNoQlcsaUJBQWlCLEVBQUUvRixPQUFPLENBQUNHLEVBQUU7SUFDN0I2RixlQUFlLEVBQUVoRyxPQUFPLENBQUNFLEVBQUU7SUFDM0IrRixhQUFhLEVBQUVqRyxPQUFPLENBQUNJO0VBQ3pCO0FBQ0YsQ0FBQyxDQUFDIiwiaWdub3JlTGlzdCI6W119