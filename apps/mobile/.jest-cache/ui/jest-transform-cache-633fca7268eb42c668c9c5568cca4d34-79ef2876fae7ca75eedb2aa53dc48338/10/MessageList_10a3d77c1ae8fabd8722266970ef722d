4d42128dea34f683a6e9dc0a6459f8f7
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.MessageList = MessageList;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _react = _interopRequireWildcard(require("react"));
var _reactNative = require("react-native");
var _MessageItem = require("./MessageItem");
var _TypingIndicator = require("./TypingIndicator");
var _chatService = require("../../services/chatService");
var _api = require("../../services/api");
var _jsxRuntime = require("react/jsx-runtime");
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function _interopRequireWildcard(e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (var _t2 in e) "default" !== _t2 && {}.hasOwnProperty.call(e, _t2) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, _t2)) && (i.get || i.set) ? o(f, _t2, i) : f[_t2] = e[_t2]); return f; })(e, t); }
var Spacing = {
  xs: 4,
  sm: 8,
  md: 16,
  lg: 24,
  xl: 32
};
function MessageList(_ref) {
  var messages = _ref.messages,
    typingUsers = _ref.typingUsers,
    isOnline = _ref.isOnline,
    currentUserId = _ref.currentUserId,
    matchId = _ref.matchId,
    onMessagePress = _ref.onMessagePress,
    onMessageLongPress = _ref.onMessageLongPress,
    onRetryMessage = _ref.onRetryMessage,
    flatListRef = _ref.flatListRef,
    onScroll = _ref.onScroll;
  var _useState = (0, _react.useState)(null),
    _useState2 = (0, _slicedToArray2.default)(_useState, 2),
    replyTarget = _useState2[0],
    setReplyTarget = _useState2[1];
  var handleReply = (0, _react.useCallback)(function (message) {
    setReplyTarget(message);
  }, []);
  var handleCopy = (0, _react.useCallback)(function (message) {
    _reactNative.Clipboard.setString(message.content);
  }, []);
  var handleReact = (0, _react.useCallback)(function () {
    var _ref2 = (0, _asyncToGenerator2.default)(function* (message) {
      _reactNative.Alert.alert("Add Reaction", "Choose a reaction", [{
        text: "ðŸ‘ Like",
        onPress: function onPress() {
          return _chatService.chatService.sendReaction(matchId, message._id, "like");
        }
      }, {
        text: "â¤ï¸ Love",
        onPress: function onPress() {
          return _chatService.chatService.sendReaction(matchId, message._id, "love");
        }
      }, {
        text: "ðŸ˜‚ Laugh",
        onPress: function onPress() {
          return _chatService.chatService.sendReaction(matchId, message._id, "laugh");
        }
      }, {
        text: "Cancel",
        style: "cancel"
      }]);
    });
    return function (_x) {
      return _ref2.apply(this, arguments);
    };
  }(), [matchId]);
  var handleDelete = (0, _react.useCallback)(function () {
    var _ref3 = (0, _asyncToGenerator2.default)(function* (message) {
      _reactNative.Alert.alert("Delete Message", "Are you sure you want to delete this message?", [{
        text: "Cancel",
        style: "cancel"
      }, {
        text: "Delete",
        style: "destructive",
        onPress: function () {
          var _onPress = (0, _asyncToGenerator2.default)(function* () {
            try {
              yield _api.matchesAPI.deleteMessage(matchId, message._id);
            } catch (error) {
              _reactNative.Alert.alert("Error", "Failed to delete message");
            }
          });
          function onPress() {
            return _onPress.apply(this, arguments);
          }
          return onPress;
        }()
      }]);
    });
    return function (_x2) {
      return _ref3.apply(this, arguments);
    };
  }(), [matchId]);
  var handleShowReadBy = (0, _react.useCallback)(function (message) {
    _reactNative.Alert.alert("Read by", `Message was read by ${message.read ? "recipient" : "no one yet"}`);
  }, []);
  var renderMessage = (0, _react.useCallback)(function (_ref4) {
    var item = _ref4.item,
      index = _ref4.index;
    var isOwnMessage = item.senderId === currentUserId || item.senderId === "me";
    return (0, _jsxRuntime.jsx)(_reactNative.View, {
      children: (0, _jsxRuntime.jsx)(_MessageItem.MessageItem, {
        message: item,
        index: index,
        messages: messages,
        isOnline: isOnline,
        onPress: onMessagePress,
        onLongPress: onMessageLongPress,
        onRetry: onRetryMessage
      })
    });
  }, [messages, isOnline, currentUserId, onMessagePress, onMessageLongPress, onRetryMessage]);
  var renderTypingIndicator = (0, _react.useCallback)(function () {
    return (0, _jsxRuntime.jsx)(_TypingIndicator.TypingIndicator, {
      typingUsers: typingUsers
    });
  }, [typingUsers]);
  var keyExtractor = (0, _react.useCallback)(function (item) {
    return item._id;
  }, []);
  var getItemLayout = (0, _react.useCallback)(function (data, index) {
    var message = data == null ? void 0 : data[index];
    var estimatedHeight = 80;
    if (message) {
      if (message.content.length > 100) estimatedHeight += 20;
      if (message.replyTo) estimatedHeight += 40;
      if (message.audioUrl || message.type === 'image') estimatedHeight += 120;
    }
    return {
      length: estimatedHeight,
      offset: estimatedHeight * index,
      index: index
    };
  }, []);
  return (0, _jsxRuntime.jsx)(_reactNative.View, {
    style: styles.container,
    children: (0, _jsxRuntime.jsx)(_reactNative.FlatList, {
      ref: flatListRef,
      data: messages,
      renderItem: renderMessage,
      keyExtractor: keyExtractor,
      showsVerticalScrollIndicator: false,
      contentContainerStyle: styles.contentContainer,
      onScroll: onScroll,
      scrollEventThrottle: 100,
      initialNumToRender: 20,
      windowSize: 10,
      maxToRenderPerBatch: 10,
      updateCellsBatchingPeriod: 50,
      removeClippedSubviews: true,
      getItemLayout: getItemLayout,
      ListFooterComponent: renderTypingIndicator
    })
  });
}
var styles = _reactNative.StyleSheet.create({
  container: {
    flex: 1
  },
  contentContainer: {
    paddingHorizontal: Spacing.md,
    paddingVertical: Spacing.sm,
    paddingBottom: Spacing.lg
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsInJlcXVpcmUiLCJfcmVhY3ROYXRpdmUiLCJfTWVzc2FnZUl0ZW0iLCJfVHlwaW5nSW5kaWNhdG9yIiwiX2NoYXRTZXJ2aWNlIiwiX2FwaSIsIl9qc3hSdW50aW1lIiwiZSIsInQiLCJXZWFrTWFwIiwiciIsIm4iLCJfX2VzTW9kdWxlIiwibyIsImkiLCJmIiwiX19wcm90b19fIiwiZGVmYXVsdCIsImhhcyIsImdldCIsInNldCIsIl90MiIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiU3BhY2luZyIsInhzIiwic20iLCJtZCIsImxnIiwieGwiLCJNZXNzYWdlTGlzdCIsIl9yZWYiLCJtZXNzYWdlcyIsInR5cGluZ1VzZXJzIiwiaXNPbmxpbmUiLCJjdXJyZW50VXNlcklkIiwibWF0Y2hJZCIsIm9uTWVzc2FnZVByZXNzIiwib25NZXNzYWdlTG9uZ1ByZXNzIiwib25SZXRyeU1lc3NhZ2UiLCJmbGF0TGlzdFJlZiIsIm9uU2Nyb2xsIiwiX3VzZVN0YXRlIiwidXNlU3RhdGUiLCJfdXNlU3RhdGUyIiwiX3NsaWNlZFRvQXJyYXkyIiwicmVwbHlUYXJnZXQiLCJzZXRSZXBseVRhcmdldCIsImhhbmRsZVJlcGx5IiwidXNlQ2FsbGJhY2siLCJtZXNzYWdlIiwiaGFuZGxlQ29weSIsIkNsaXBib2FyZCIsInNldFN0cmluZyIsImNvbnRlbnQiLCJoYW5kbGVSZWFjdCIsIl9yZWYyIiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwiQWxlcnQiLCJhbGVydCIsInRleHQiLCJvblByZXNzIiwiY2hhdFNlcnZpY2UiLCJzZW5kUmVhY3Rpb24iLCJfaWQiLCJzdHlsZSIsIl94IiwiYXBwbHkiLCJhcmd1bWVudHMiLCJoYW5kbGVEZWxldGUiLCJfcmVmMyIsIl9vblByZXNzIiwibWF0Y2hlc0FQSSIsImRlbGV0ZU1lc3NhZ2UiLCJlcnJvciIsIl94MiIsImhhbmRsZVNob3dSZWFkQnkiLCJyZWFkIiwicmVuZGVyTWVzc2FnZSIsIl9yZWY0IiwiaXRlbSIsImluZGV4IiwiaXNPd25NZXNzYWdlIiwic2VuZGVySWQiLCJqc3giLCJWaWV3IiwiY2hpbGRyZW4iLCJNZXNzYWdlSXRlbSIsIm9uTG9uZ1ByZXNzIiwib25SZXRyeSIsInJlbmRlclR5cGluZ0luZGljYXRvciIsIlR5cGluZ0luZGljYXRvciIsImtleUV4dHJhY3RvciIsImdldEl0ZW1MYXlvdXQiLCJkYXRhIiwiZXN0aW1hdGVkSGVpZ2h0IiwibGVuZ3RoIiwicmVwbHlUbyIsImF1ZGlvVXJsIiwidHlwZSIsIm9mZnNldCIsInN0eWxlcyIsImNvbnRhaW5lciIsIkZsYXRMaXN0IiwicmVmIiwicmVuZGVySXRlbSIsInNob3dzVmVydGljYWxTY3JvbGxJbmRpY2F0b3IiLCJjb250ZW50Q29udGFpbmVyU3R5bGUiLCJjb250ZW50Q29udGFpbmVyIiwic2Nyb2xsRXZlbnRUaHJvdHRsZSIsImluaXRpYWxOdW1Ub1JlbmRlciIsIndpbmRvd1NpemUiLCJtYXhUb1JlbmRlclBlckJhdGNoIiwidXBkYXRlQ2VsbHNCYXRjaGluZ1BlcmlvZCIsInJlbW92ZUNsaXBwZWRTdWJ2aWV3cyIsIkxpc3RGb290ZXJDb21wb25lbnQiLCJTdHlsZVNoZWV0IiwiY3JlYXRlIiwiZmxleCIsInBhZGRpbmdIb3Jpem9udGFsIiwicGFkZGluZ1ZlcnRpY2FsIiwicGFkZGluZ0JvdHRvbSJdLCJzb3VyY2VzIjpbIk1lc3NhZ2VMaXN0LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlQ2FsbGJhY2ssIHVzZVN0YXRlIH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQge1xuICBGbGF0TGlzdCxcbiAgVmlldyxcbiAgU3R5bGVTaGVldCxcbiAgQ2xpcGJvYXJkLFxuICBBbGVydCxcbiAgdHlwZSBOYXRpdmVTeW50aGV0aWNFdmVudCxcbiAgdHlwZSBOYXRpdmVTY3JvbGxFdmVudCxcbn0gZnJvbSBcInJlYWN0LW5hdGl2ZVwiO1xuaW1wb3J0IHR5cGUgeyBNZXNzYWdlIH0gZnJvbSBcIi4uLy4uL2hvb2tzL3VzZUNoYXREYXRhXCI7XG5pbXBvcnQgeyBNZXNzYWdlSXRlbSB9IGZyb20gXCIuL01lc3NhZ2VJdGVtXCI7XG5pbXBvcnQgeyBNZXNzYWdlQnViYmxlRW5oYW5jZWQgfSBmcm9tIFwiLi9NZXNzYWdlQnViYmxlRW5oYW5jZWRcIjtcbmltcG9ydCB7IFR5cGluZ0luZGljYXRvciB9IGZyb20gXCIuL1R5cGluZ0luZGljYXRvclwiO1xuaW1wb3J0IHsgY2hhdFNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvY2hhdFNlcnZpY2VcIjtcbmltcG9ydCB7IG1hdGNoZXNBUEkgfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvYXBpXCI7XG5cbmNvbnN0IFNwYWNpbmcgPSB7XG4gIHhzOiA0LFxuICBzbTogOCxcbiAgbWQ6IDE2LFxuICBsZzogMjQsXG4gIHhsOiAzMixcbn07XG5cbmludGVyZmFjZSBNZXNzYWdlTGlzdFByb3BzIHtcbiAgbWVzc2FnZXM6IE1lc3NhZ2VbXTtcbiAgdHlwaW5nVXNlcnM6IHN0cmluZ1tdO1xuICBpc09ubGluZTogYm9vbGVhbjtcbiAgY3VycmVudFVzZXJJZDogc3RyaW5nO1xuICBtYXRjaElkOiBzdHJpbmc7XG4gIG9uTWVzc2FnZVByZXNzPzogKG1lc3NhZ2U6IE1lc3NhZ2UpID0+IHZvaWQ7XG4gIG9uTWVzc2FnZUxvbmdQcmVzcz86IChtZXNzYWdlOiBNZXNzYWdlKSA9PiB2b2lkO1xuICBvblJldHJ5TWVzc2FnZT86IChtZXNzYWdlSWQ6IHN0cmluZykgPT4gdm9pZDtcbiAgZmxhdExpc3RSZWY/OiBSZWFjdC5SZWZPYmplY3Q8RmxhdExpc3Q8TWVzc2FnZT4+O1xuICBvblNjcm9sbD86IChldmVudDogTmF0aXZlU3ludGhldGljRXZlbnQ8TmF0aXZlU2Nyb2xsRXZlbnQ+KSA9PiB2b2lkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gTWVzc2FnZUxpc3Qoe1xuICBtZXNzYWdlcyxcbiAgdHlwaW5nVXNlcnMsXG4gIGlzT25saW5lLFxuICBjdXJyZW50VXNlcklkLFxuICBtYXRjaElkLFxuICBvbk1lc3NhZ2VQcmVzcyxcbiAgb25NZXNzYWdlTG9uZ1ByZXNzLFxuICBvblJldHJ5TWVzc2FnZSxcbiAgZmxhdExpc3RSZWYsXG4gIG9uU2Nyb2xsLFxufTogTWVzc2FnZUxpc3RQcm9wcyk6IFJlYWN0LkpTWC5FbGVtZW50IHtcbiAgY29uc3QgW3JlcGx5VGFyZ2V0LCBzZXRSZXBseVRhcmdldF0gPSB1c2VTdGF0ZTxNZXNzYWdlIHwgbnVsbD4obnVsbCk7XG4gIFxuICAvLyBBY3Rpb24gaGFuZGxlcnMgZm9yIGVuaGFuY2VkIGJ1YmJsZVxuICBjb25zdCBoYW5kbGVSZXBseSA9IHVzZUNhbGxiYWNrKChtZXNzYWdlOiBNZXNzYWdlKSA9PiB7XG4gICAgc2V0UmVwbHlUYXJnZXQobWVzc2FnZSk7XG4gIH0sIFtdKTtcbiAgXG4gIGNvbnN0IGhhbmRsZUNvcHkgPSB1c2VDYWxsYmFjaygobWVzc2FnZTogTWVzc2FnZSkgPT4ge1xuICAgIENsaXBib2FyZC5zZXRTdHJpbmcobWVzc2FnZS5jb250ZW50KTtcbiAgfSwgW10pO1xuICBcbiAgY29uc3QgaGFuZGxlUmVhY3QgPSB1c2VDYWxsYmFjayhhc3luYyAobWVzc2FnZTogTWVzc2FnZSkgPT4ge1xuICAgIC8vIE9wZW4gcmVhY3Rpb24gcGlja2VyXG4gICAgQWxlcnQuYWxlcnQoXCJBZGQgUmVhY3Rpb25cIiwgXCJDaG9vc2UgYSByZWFjdGlvblwiLCBbXG4gICAgICB7IHRleHQ6IFwi8J+RjSBMaWtlXCIsIG9uUHJlc3M6ICgpID0+IGNoYXRTZXJ2aWNlLnNlbmRSZWFjdGlvbihtYXRjaElkLCBtZXNzYWdlLl9pZCwgXCJsaWtlXCIpIH0sXG4gICAgICB7IHRleHQ6IFwi4p2k77iPIExvdmVcIiwgb25QcmVzczogKCkgPT4gY2hhdFNlcnZpY2Uuc2VuZFJlYWN0aW9uKG1hdGNoSWQsIG1lc3NhZ2UuX2lkLCBcImxvdmVcIikgfSxcbiAgICAgIHsgdGV4dDogXCLwn5iCIExhdWdoXCIsIG9uUHJlc3M6ICgpID0+IGNoYXRTZXJ2aWNlLnNlbmRSZWFjdGlvbihtYXRjaElkLCBtZXNzYWdlLl9pZCwgXCJsYXVnaFwiKSB9LFxuICAgICAgeyB0ZXh0OiBcIkNhbmNlbFwiLCBzdHlsZTogXCJjYW5jZWxcIiB9LFxuICAgIF0pO1xuICB9LCBbbWF0Y2hJZF0pO1xuICBcbiAgY29uc3QgaGFuZGxlRGVsZXRlID0gdXNlQ2FsbGJhY2soYXN5bmMgKG1lc3NhZ2U6IE1lc3NhZ2UpID0+IHtcbiAgICBBbGVydC5hbGVydChcbiAgICAgIFwiRGVsZXRlIE1lc3NhZ2VcIixcbiAgICAgIFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSB0aGlzIG1lc3NhZ2U/XCIsXG4gICAgICBbXG4gICAgICAgIHsgdGV4dDogXCJDYW5jZWxcIiwgc3R5bGU6IFwiY2FuY2VsXCIgfSxcbiAgICAgICAgeyBcbiAgICAgICAgICB0ZXh0OiBcIkRlbGV0ZVwiLCBcbiAgICAgICAgICBzdHlsZTogXCJkZXN0cnVjdGl2ZVwiLFxuICAgICAgICAgIG9uUHJlc3M6IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGF3YWl0IG1hdGNoZXNBUEkuZGVsZXRlTWVzc2FnZShtYXRjaElkLCBtZXNzYWdlLl9pZCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICBBbGVydC5hbGVydChcIkVycm9yXCIsIFwiRmFpbGVkIHRvIGRlbGV0ZSBtZXNzYWdlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgIF1cbiAgICApO1xuICB9LCBbbWF0Y2hJZF0pO1xuICBcbiAgY29uc3QgaGFuZGxlU2hvd1JlYWRCeSA9IHVzZUNhbGxiYWNrKChtZXNzYWdlOiBNZXNzYWdlKSA9PiB7XG4gICAgQWxlcnQuYWxlcnQoXCJSZWFkIGJ5XCIsIGBNZXNzYWdlIHdhcyByZWFkIGJ5ICR7bWVzc2FnZS5yZWFkID8gXCJyZWNpcGllbnRcIiA6IFwibm8gb25lIHlldFwifWApO1xuICB9LCBbXSk7XG5cbiAgY29uc3QgcmVuZGVyTWVzc2FnZSA9IHVzZUNhbGxiYWNrKFxuICAgICh7IGl0ZW0sIGluZGV4IH06IHsgaXRlbTogTWVzc2FnZTsgaW5kZXg6IG51bWJlciB9KSA9PiB7XG4gICAgICBjb25zdCBpc093bk1lc3NhZ2UgPSBpdGVtLnNlbmRlcklkID09PSBjdXJyZW50VXNlcklkIHx8IGl0ZW0uc2VuZGVySWQgPT09IFwibWVcIjtcbiAgICAgIFxuICAgICAgLy8gVXNlIGVuaGFuY2VkIGJ1YmJsZSB3aGVuIGluIHByb2R1Y3Rpb24tcmVhZHkgbW9kZVxuICAgICAgLy8gRm9yIG5vdywga2VlcCB1c2luZyBNZXNzYWdlSXRlbSBmb3IgY29tcGF0aWJpbGl0eVxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPFZpZXc+XG4gICAgICAgICAgPE1lc3NhZ2VJdGVtXG4gICAgICAgICAgICBtZXNzYWdlPXtpdGVtfVxuICAgICAgICAgICAgaW5kZXg9e2luZGV4fVxuICAgICAgICAgICAgbWVzc2FnZXM9e21lc3NhZ2VzfVxuICAgICAgICAgICAgaXNPbmxpbmU9e2lzT25saW5lfVxuICAgICAgICAgICAgb25QcmVzcz17b25NZXNzYWdlUHJlc3N9XG4gICAgICAgICAgICBvbkxvbmdQcmVzcz17b25NZXNzYWdlTG9uZ1ByZXNzfVxuICAgICAgICAgICAgb25SZXRyeT17b25SZXRyeU1lc3NhZ2V9XG4gICAgICAgICAgLz5cbiAgICAgICAgPC9WaWV3PlxuICAgICAgKTtcbiAgICB9LFxuICAgIFttZXNzYWdlcywgaXNPbmxpbmUsIGN1cnJlbnRVc2VySWQsIG9uTWVzc2FnZVByZXNzLCBvbk1lc3NhZ2VMb25nUHJlc3MsIG9uUmV0cnlNZXNzYWdlXSxcbiAgKTtcblxuICBjb25zdCByZW5kZXJUeXBpbmdJbmRpY2F0b3IgPSB1c2VDYWxsYmFjayhcbiAgICAoKSA9PiA8VHlwaW5nSW5kaWNhdG9yIHR5cGluZ1VzZXJzPXt0eXBpbmdVc2Vyc30gLz4sXG4gICAgW3R5cGluZ1VzZXJzXSxcbiAgKTtcblxuICBjb25zdCBrZXlFeHRyYWN0b3IgPSB1c2VDYWxsYmFjaygoaXRlbTogTWVzc2FnZSkgPT4gaXRlbS5faWQsIFtdKTtcblxuICBjb25zdCBnZXRJdGVtTGF5b3V0ID0gdXNlQ2FsbGJhY2soXG4gICAgKGRhdGE6IEFycmF5TGlrZTxNZXNzYWdlPiB8IG51bGwgfCB1bmRlZmluZWQsIGluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgIC8vIER5bmFtaWMgaGVpZ2h0IGNhbGN1bGF0aW9uIGJhc2VkIG9uIG1lc3NhZ2UgY29udGVudFxuICAgICAgY29uc3QgbWVzc2FnZSA9IGRhdGE/LltpbmRleF07XG4gICAgICBsZXQgZXN0aW1hdGVkSGVpZ2h0ID0gODA7XG4gICAgICBcbiAgICAgIGlmIChtZXNzYWdlKSB7XG4gICAgICAgIC8vIEFjY291bnQgZm9yIG1lc3NhZ2UgY29udGVudFxuICAgICAgICBpZiAobWVzc2FnZS5jb250ZW50Lmxlbmd0aCA+IDEwMCkgZXN0aW1hdGVkSGVpZ2h0ICs9IDIwO1xuICAgICAgICBcbiAgICAgICAgLy8gQWNjb3VudCBmb3IgcmVwbHkgdG8gbWVzc2FnZVxuICAgICAgICBpZiAobWVzc2FnZS5yZXBseVRvKSBlc3RpbWF0ZWRIZWlnaHQgKz0gNDA7XG4gICAgICAgIFxuICAgICAgICAvLyBBY2NvdW50IGZvciBhdHRhY2htZW50XG4gICAgICAgIGlmIChtZXNzYWdlLmF1ZGlvVXJsIHx8IG1lc3NhZ2UudHlwZSA9PT0gJ2ltYWdlJykgZXN0aW1hdGVkSGVpZ2h0ICs9IDEyMDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbGVuZ3RoOiBlc3RpbWF0ZWRIZWlnaHQsXG4gICAgICAgIG9mZnNldDogZXN0aW1hdGVkSGVpZ2h0ICogaW5kZXgsXG4gICAgICAgIGluZGV4LFxuICAgICAgfTtcbiAgICB9LFxuICAgIFtdLFxuICApO1xuXG4gIHJldHVybiAoXG4gICAgPFZpZXcgc3R5bGU9e3N0eWxlcy5jb250YWluZXJ9PlxuICAgICAgPEZsYXRMaXN0PE1lc3NhZ2U+XG4gICAgICAgIHJlZj17ZmxhdExpc3RSZWZ9XG4gICAgICAgIGRhdGE9e21lc3NhZ2VzfVxuICAgICAgICByZW5kZXJJdGVtPXtyZW5kZXJNZXNzYWdlfVxuICAgICAgICBrZXlFeHRyYWN0b3I9e2tleUV4dHJhY3Rvcn1cbiAgICAgICAgc2hvd3NWZXJ0aWNhbFNjcm9sbEluZGljYXRvcj17ZmFsc2V9XG4gICAgICAgIGNvbnRlbnRDb250YWluZXJTdHlsZT17c3R5bGVzLmNvbnRlbnRDb250YWluZXJ9XG4gICAgICAgIG9uU2Nyb2xsPXtvblNjcm9sbH1cbiAgICAgICAgc2Nyb2xsRXZlbnRUaHJvdHRsZT17MTAwfVxuICAgICAgICBpbml0aWFsTnVtVG9SZW5kZXI9ezIwfVxuICAgICAgICB3aW5kb3dTaXplPXsxMH1cbiAgICAgICAgbWF4VG9SZW5kZXJQZXJCYXRjaD17MTB9XG4gICAgICAgIHVwZGF0ZUNlbGxzQmF0Y2hpbmdQZXJpb2Q9ezUwfVxuICAgICAgICByZW1vdmVDbGlwcGVkU3Vidmlld3M9e3RydWV9XG4gICAgICAgIGdldEl0ZW1MYXlvdXQ9e2dldEl0ZW1MYXlvdXR9XG4gICAgICAgIExpc3RGb290ZXJDb21wb25lbnQ9e3JlbmRlclR5cGluZ0luZGljYXRvcn1cbiAgICAgIC8+XG4gICAgPC9WaWV3PlxuICApO1xufVxuXG5jb25zdCBzdHlsZXMgPSBTdHlsZVNoZWV0LmNyZWF0ZSh7XG4gIGNvbnRhaW5lcjoge1xuICAgIGZsZXg6IDEsXG4gIH0sXG4gIGNvbnRlbnRDb250YWluZXI6IHtcbiAgICBwYWRkaW5nSG9yaXpvbnRhbDogU3BhY2luZy5tZCxcbiAgICBwYWRkaW5nVmVydGljYWw6IFNwYWNpbmcuc20sXG4gICAgcGFkZGluZ0JvdHRvbTogU3BhY2luZy5sZyxcbiAg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