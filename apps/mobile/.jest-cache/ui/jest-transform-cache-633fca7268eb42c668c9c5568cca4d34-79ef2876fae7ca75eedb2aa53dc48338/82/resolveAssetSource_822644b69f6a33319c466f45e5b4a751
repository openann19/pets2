f74829ff4207cb5dcfc4126011b5f1b7
'use strict';

var AssetSourceResolver = require("./AssetSourceResolver");
var _require = require("./AssetUtils"),
  pickScale = _require.pickScale;
var AssetRegistry = require('@react-native/assets-registry/registry');
var _customSourceTransformer, _serverURL, _scriptURL;
var _sourceCodeScriptURL;
function getSourceCodeScriptURL() {
  if (_sourceCodeScriptURL) {
    return _sourceCodeScriptURL;
  }
  var sourceCode = global.nativeExtensions && global.nativeExtensions.SourceCode;
  if (!sourceCode) {
    sourceCode = require("../NativeModules/specs/NativeSourceCode").default;
  }
  _sourceCodeScriptURL = sourceCode.getConstants().scriptURL;
  return _sourceCodeScriptURL;
}
function getDevServerURL() {
  if (_serverURL === undefined) {
    var sourceCodeScriptURL = getSourceCodeScriptURL();
    var match = sourceCodeScriptURL && sourceCodeScriptURL.match(/^https?:\/\/.*?\//);
    if (match) {
      _serverURL = match[0];
    } else {
      _serverURL = null;
    }
  }
  return _serverURL;
}
function _coerceLocalScriptURL(scriptURL) {
  if (scriptURL) {
    if (scriptURL.startsWith('assets://')) {
      return null;
    }
    scriptURL = scriptURL.substring(0, scriptURL.lastIndexOf('/') + 1);
    if (!scriptURL.includes('://')) {
      scriptURL = 'file://' + scriptURL;
    }
  }
  return scriptURL;
}
function getScriptURL() {
  if (_scriptURL === undefined) {
    _scriptURL = _coerceLocalScriptURL(getSourceCodeScriptURL());
  }
  return _scriptURL;
}
function setCustomSourceTransformer(transformer) {
  _customSourceTransformer = transformer;
}
function resolveAssetSource(source) {
  if (typeof source === 'object') {
    return source;
  }
  var asset = AssetRegistry.getAssetByID(source);
  if (!asset) {
    return null;
  }
  var resolver = new AssetSourceResolver(getDevServerURL(), getScriptURL(), asset);
  if (_customSourceTransformer) {
    return _customSourceTransformer(resolver);
  }
  return resolver.defaultAsset();
}
resolveAssetSource.pickScale = pickScale;
resolveAssetSource.setCustomSourceTransformer = setCustomSourceTransformer;
module.exports = resolveAssetSource;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJBc3NldFNvdXJjZVJlc29sdmVyIiwicmVxdWlyZSIsIl9yZXF1aXJlIiwicGlja1NjYWxlIiwiQXNzZXRSZWdpc3RyeSIsIl9jdXN0b21Tb3VyY2VUcmFuc2Zvcm1lciIsIl9zZXJ2ZXJVUkwiLCJfc2NyaXB0VVJMIiwiX3NvdXJjZUNvZGVTY3JpcHRVUkwiLCJnZXRTb3VyY2VDb2RlU2NyaXB0VVJMIiwic291cmNlQ29kZSIsImdsb2JhbCIsIm5hdGl2ZUV4dGVuc2lvbnMiLCJTb3VyY2VDb2RlIiwiZGVmYXVsdCIsImdldENvbnN0YW50cyIsInNjcmlwdFVSTCIsImdldERldlNlcnZlclVSTCIsInVuZGVmaW5lZCIsInNvdXJjZUNvZGVTY3JpcHRVUkwiLCJtYXRjaCIsIl9jb2VyY2VMb2NhbFNjcmlwdFVSTCIsInN0YXJ0c1dpdGgiLCJzdWJzdHJpbmciLCJsYXN0SW5kZXhPZiIsImluY2x1ZGVzIiwiZ2V0U2NyaXB0VVJMIiwic2V0Q3VzdG9tU291cmNlVHJhbnNmb3JtZXIiLCJ0cmFuc2Zvcm1lciIsInJlc29sdmVBc3NldFNvdXJjZSIsInNvdXJjZSIsImFzc2V0IiwiZ2V0QXNzZXRCeUlEIiwicmVzb2x2ZXIiLCJkZWZhdWx0QXNzZXQiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsicmVzb2x2ZUFzc2V0U291cmNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBNZXRhIFBsYXRmb3JtcywgSW5jLiBhbmQgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZm9ybWF0XG4gKiBAZmxvd1xuICovXG5cbi8vIFJlc29sdmVzIGFuIGFzc2V0IGludG8gYSBgc291cmNlYCBmb3IgYEltYWdlYC5cblxuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgdHlwZSB7UmVzb2x2ZWRBc3NldFNvdXJjZX0gZnJvbSAnLi9Bc3NldFNvdXJjZVJlc29sdmVyJztcblxuY29uc3QgQXNzZXRTb3VyY2VSZXNvbHZlciA9IHJlcXVpcmUoJy4vQXNzZXRTb3VyY2VSZXNvbHZlcicpO1xuY29uc3Qge3BpY2tTY2FsZX0gPSByZXF1aXJlKCcuL0Fzc2V0VXRpbHMnKTtcbmNvbnN0IEFzc2V0UmVnaXN0cnkgPSByZXF1aXJlKCdAcmVhY3QtbmF0aXZlL2Fzc2V0cy1yZWdpc3RyeS9yZWdpc3RyeScpO1xuXG5sZXQgX2N1c3RvbVNvdXJjZVRyYW5zZm9ybWVyLCBfc2VydmVyVVJMLCBfc2NyaXB0VVJMO1xuXG5sZXQgX3NvdXJjZUNvZGVTY3JpcHRVUkw6ID9zdHJpbmc7XG5mdW5jdGlvbiBnZXRTb3VyY2VDb2RlU2NyaXB0VVJMKCk6ID9zdHJpbmcge1xuICBpZiAoX3NvdXJjZUNvZGVTY3JpcHRVUkwpIHtcbiAgICByZXR1cm4gX3NvdXJjZUNvZGVTY3JpcHRVUkw7XG4gIH1cblxuICBsZXQgc291cmNlQ29kZSA9XG4gICAgZ2xvYmFsLm5hdGl2ZUV4dGVuc2lvbnMgJiYgZ2xvYmFsLm5hdGl2ZUV4dGVuc2lvbnMuU291cmNlQ29kZTtcbiAgaWYgKCFzb3VyY2VDb2RlKSB7XG4gICAgc291cmNlQ29kZSA9IHJlcXVpcmUoJy4uL05hdGl2ZU1vZHVsZXMvc3BlY3MvTmF0aXZlU291cmNlQ29kZScpLmRlZmF1bHQ7XG4gIH1cbiAgX3NvdXJjZUNvZGVTY3JpcHRVUkwgPSBzb3VyY2VDb2RlLmdldENvbnN0YW50cygpLnNjcmlwdFVSTDtcbiAgcmV0dXJuIF9zb3VyY2VDb2RlU2NyaXB0VVJMO1xufVxuXG5mdW5jdGlvbiBnZXREZXZTZXJ2ZXJVUkwoKTogP3N0cmluZyB7XG4gIGlmIChfc2VydmVyVVJMID09PSB1bmRlZmluZWQpIHtcbiAgICBjb25zdCBzb3VyY2VDb2RlU2NyaXB0VVJMID0gZ2V0U291cmNlQ29kZVNjcmlwdFVSTCgpO1xuICAgIGNvbnN0IG1hdGNoID1cbiAgICAgIHNvdXJjZUNvZGVTY3JpcHRVUkwgJiYgc291cmNlQ29kZVNjcmlwdFVSTC5tYXRjaCgvXmh0dHBzPzpcXC9cXC8uKj9cXC8vKTtcbiAgICBpZiAobWF0Y2gpIHtcbiAgICAgIC8vIGpzQnVuZGxlIHdhcyBsb2FkZWQgZnJvbSBuZXR3b3JrXG4gICAgICBfc2VydmVyVVJMID0gbWF0Y2hbMF07XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGpzQnVuZGxlIHdhcyBsb2FkZWQgZnJvbSBmaWxlXG4gICAgICBfc2VydmVyVVJMID0gbnVsbDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIF9zZXJ2ZXJVUkw7XG59XG5cbmZ1bmN0aW9uIF9jb2VyY2VMb2NhbFNjcmlwdFVSTChzY3JpcHRVUkw6ID9zdHJpbmcpOiA/c3RyaW5nIHtcbiAgaWYgKHNjcmlwdFVSTCkge1xuICAgIGlmIChzY3JpcHRVUkwuc3RhcnRzV2l0aCgnYXNzZXRzOi8vJykpIHtcbiAgICAgIC8vIGFuZHJvaWQ6IHJ1bm5pbmcgZnJvbSB3aXRoaW4gYXNzZXRzLCBubyBvZmZsaW5lIHBhdGggdG8gdXNlXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgc2NyaXB0VVJMID0gc2NyaXB0VVJMLnN1YnN0cmluZygwLCBzY3JpcHRVUkwubGFzdEluZGV4T2YoJy8nKSArIDEpO1xuICAgIGlmICghc2NyaXB0VVJMLmluY2x1ZGVzKCc6Ly8nKSkge1xuICAgICAgLy8gQWRkIGZpbGUgcHJvdG9jb2wgaW4gY2FzZSB3ZSBoYXZlIGFuIGFic29sdXRlIGZpbGUgcGF0aCBhbmQgbm90IGEgVVJMLlxuICAgICAgLy8gVGhpcyBzaG91bGRuJ3QgcmVhbGx5IGJlIG5lY2Vzc2FyeS4gc2NyaXB0VVJMIHNob3VsZCBiZSBhIFVSTC5cbiAgICAgIHNjcmlwdFVSTCA9ICdmaWxlOi8vJyArIHNjcmlwdFVSTDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHNjcmlwdFVSTDtcbn1cblxuZnVuY3Rpb24gZ2V0U2NyaXB0VVJMKCk6ID9zdHJpbmcge1xuICBpZiAoX3NjcmlwdFVSTCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgX3NjcmlwdFVSTCA9IF9jb2VyY2VMb2NhbFNjcmlwdFVSTChnZXRTb3VyY2VDb2RlU2NyaXB0VVJMKCkpO1xuICB9XG4gIHJldHVybiBfc2NyaXB0VVJMO1xufVxuXG5mdW5jdGlvbiBzZXRDdXN0b21Tb3VyY2VUcmFuc2Zvcm1lcihcbiAgdHJhbnNmb3JtZXI6IChyZXNvbHZlcjogQXNzZXRTb3VyY2VSZXNvbHZlcikgPT4gUmVzb2x2ZWRBc3NldFNvdXJjZSxcbik6IHZvaWQge1xuICBfY3VzdG9tU291cmNlVHJhbnNmb3JtZXIgPSB0cmFuc2Zvcm1lcjtcbn1cblxuLyoqXG4gKiBgc291cmNlYCBpcyBlaXRoZXIgYSBudW1iZXIgKG9wYXF1ZSB0eXBlIHJldHVybmVkIGJ5IHJlcXVpcmUoJy4vZm9vLnBuZycpKVxuICogb3IgYW4gYEltYWdlU291cmNlYCBsaWtlIHsgdXJpOiAnPGh0dHAgbG9jYXRpb24gfHwgZmlsZSBwYXRoPicgfVxuICovXG5mdW5jdGlvbiByZXNvbHZlQXNzZXRTb3VyY2Uoc291cmNlOiBhbnkpOiA/UmVzb2x2ZWRBc3NldFNvdXJjZSB7XG4gIGlmICh0eXBlb2Ygc291cmNlID09PSAnb2JqZWN0Jykge1xuICAgIHJldHVybiBzb3VyY2U7XG4gIH1cblxuICBjb25zdCBhc3NldCA9IEFzc2V0UmVnaXN0cnkuZ2V0QXNzZXRCeUlEKHNvdXJjZSk7XG4gIGlmICghYXNzZXQpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGNvbnN0IHJlc29sdmVyID0gbmV3IEFzc2V0U291cmNlUmVzb2x2ZXIoXG4gICAgZ2V0RGV2U2VydmVyVVJMKCksXG4gICAgZ2V0U2NyaXB0VVJMKCksXG4gICAgYXNzZXQsXG4gICk7XG4gIGlmIChfY3VzdG9tU291cmNlVHJhbnNmb3JtZXIpIHtcbiAgICByZXR1cm4gX2N1c3RvbVNvdXJjZVRyYW5zZm9ybWVyKHJlc29sdmVyKTtcbiAgfVxuICByZXR1cm4gcmVzb2x2ZXIuZGVmYXVsdEFzc2V0KCk7XG59XG5cbnJlc29sdmVBc3NldFNvdXJjZS5waWNrU2NhbGUgPSBwaWNrU2NhbGU7XG5yZXNvbHZlQXNzZXRTb3VyY2Uuc2V0Q3VzdG9tU291cmNlVHJhbnNmb3JtZXIgPSBzZXRDdXN0b21Tb3VyY2VUcmFuc2Zvcm1lcjtcbm1vZHVsZS5leHBvcnRzID0gcmVzb2x2ZUFzc2V0U291cmNlO1xuIl0sIm1hcHBpbmdzIjoiQUFZQSxZQUFZOztBQUlaLElBQU1BLG1CQUFtQixHQUFHQyxPQUFPLHdCQUF3QixDQUFDO0FBQzVELElBQUFDLFFBQUEsR0FBb0JELE9BQU8sZUFBZSxDQUFDO0VBQXBDRSxTQUFTLEdBQUFELFFBQUEsQ0FBVEMsU0FBUztBQUNoQixJQUFNQyxhQUFhLEdBQUdILE9BQU8sQ0FBQyx3Q0FBd0MsQ0FBQztBQUV2RSxJQUFJSSx3QkFBd0IsRUFBRUMsVUFBVSxFQUFFQyxVQUFVO0FBRXBELElBQUlDLG9CQUE2QjtBQUNqQyxTQUFTQyxzQkFBc0JBLENBQUEsRUFBWTtFQUN6QyxJQUFJRCxvQkFBb0IsRUFBRTtJQUN4QixPQUFPQSxvQkFBb0I7RUFDN0I7RUFFQSxJQUFJRSxVQUFVLEdBQ1pDLE1BQU0sQ0FBQ0MsZ0JBQWdCLElBQUlELE1BQU0sQ0FBQ0MsZ0JBQWdCLENBQUNDLFVBQVU7RUFDL0QsSUFBSSxDQUFDSCxVQUFVLEVBQUU7SUFDZkEsVUFBVSxHQUFHVCxPQUFPLDBDQUEwQyxDQUFDLENBQUNhLE9BQU87RUFDekU7RUFDQU4sb0JBQW9CLEdBQUdFLFVBQVUsQ0FBQ0ssWUFBWSxDQUFDLENBQUMsQ0FBQ0MsU0FBUztFQUMxRCxPQUFPUixvQkFBb0I7QUFDN0I7QUFFQSxTQUFTUyxlQUFlQSxDQUFBLEVBQVk7RUFDbEMsSUFBSVgsVUFBVSxLQUFLWSxTQUFTLEVBQUU7SUFDNUIsSUFBTUMsbUJBQW1CLEdBQUdWLHNCQUFzQixDQUFDLENBQUM7SUFDcEQsSUFBTVcsS0FBSyxHQUNURCxtQkFBbUIsSUFBSUEsbUJBQW1CLENBQUNDLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQztJQUN2RSxJQUFJQSxLQUFLLEVBQUU7TUFFVGQsVUFBVSxHQUFHYyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQ3ZCLENBQUMsTUFBTTtNQUVMZCxVQUFVLEdBQUcsSUFBSTtJQUNuQjtFQUNGO0VBQ0EsT0FBT0EsVUFBVTtBQUNuQjtBQUVBLFNBQVNlLHFCQUFxQkEsQ0FBQ0wsU0FBa0IsRUFBVztFQUMxRCxJQUFJQSxTQUFTLEVBQUU7SUFDYixJQUFJQSxTQUFTLENBQUNNLFVBQVUsQ0FBQyxXQUFXLENBQUMsRUFBRTtNQUVyQyxPQUFPLElBQUk7SUFDYjtJQUNBTixTQUFTLEdBQUdBLFNBQVMsQ0FBQ08sU0FBUyxDQUFDLENBQUMsRUFBRVAsU0FBUyxDQUFDUSxXQUFXLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2xFLElBQUksQ0FBQ1IsU0FBUyxDQUFDUyxRQUFRLENBQUMsS0FBSyxDQUFDLEVBQUU7TUFHOUJULFNBQVMsR0FBRyxTQUFTLEdBQUdBLFNBQVM7SUFDbkM7RUFDRjtFQUNBLE9BQU9BLFNBQVM7QUFDbEI7QUFFQSxTQUFTVSxZQUFZQSxDQUFBLEVBQVk7RUFDL0IsSUFBSW5CLFVBQVUsS0FBS1csU0FBUyxFQUFFO0lBQzVCWCxVQUFVLEdBQUdjLHFCQUFxQixDQUFDWixzQkFBc0IsQ0FBQyxDQUFDLENBQUM7RUFDOUQ7RUFDQSxPQUFPRixVQUFVO0FBQ25CO0FBRUEsU0FBU29CLDBCQUEwQkEsQ0FDakNDLFdBQW1FLEVBQzdEO0VBQ052Qix3QkFBd0IsR0FBR3VCLFdBQVc7QUFDeEM7QUFNQSxTQUFTQyxrQkFBa0JBLENBQUNDLE1BQVcsRUFBd0I7RUFDN0QsSUFBSSxPQUFPQSxNQUFNLEtBQUssUUFBUSxFQUFFO0lBQzlCLE9BQU9BLE1BQU07RUFDZjtFQUVBLElBQU1DLEtBQUssR0FBRzNCLGFBQWEsQ0FBQzRCLFlBQVksQ0FBQ0YsTUFBTSxDQUFDO0VBQ2hELElBQUksQ0FBQ0MsS0FBSyxFQUFFO0lBQ1YsT0FBTyxJQUFJO0VBQ2I7RUFFQSxJQUFNRSxRQUFRLEdBQUcsSUFBSWpDLG1CQUFtQixDQUN0Q2lCLGVBQWUsQ0FBQyxDQUFDLEVBQ2pCUyxZQUFZLENBQUMsQ0FBQyxFQUNkSyxLQUNGLENBQUM7RUFDRCxJQUFJMUIsd0JBQXdCLEVBQUU7SUFDNUIsT0FBT0Esd0JBQXdCLENBQUM0QixRQUFRLENBQUM7RUFDM0M7RUFDQSxPQUFPQSxRQUFRLENBQUNDLFlBQVksQ0FBQyxDQUFDO0FBQ2hDO0FBRUFMLGtCQUFrQixDQUFDMUIsU0FBUyxHQUFHQSxTQUFTO0FBQ3hDMEIsa0JBQWtCLENBQUNGLDBCQUEwQixHQUFHQSwwQkFBMEI7QUFDMUVRLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHUCxrQkFBa0IiLCJpZ25vcmVMaXN0IjpbXX0=