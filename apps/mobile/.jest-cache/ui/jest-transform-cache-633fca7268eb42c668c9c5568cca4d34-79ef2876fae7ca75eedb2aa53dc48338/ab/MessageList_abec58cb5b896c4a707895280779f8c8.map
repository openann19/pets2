{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNative","_MessageItem","_TypingIndicator","_chatService","_api","_jsxRuntime","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","_t","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","Spacing","xs","sm","md","lg","xl","MessageList","_ref","messages","typingUsers","isOnline","currentUserId","matchId","onMessagePress","onMessageLongPress","onRetryMessage","flatListRef","onScroll","_useState","useState","_useState2","_slicedToArray2","replyTarget","setReplyTarget","handleReply","useCallback","message","handleCopy","Clipboard","setString","content","handleReact","_ref2","_asyncToGenerator2","Alert","alert","text","onPress","chatService","sendReaction","_id","style","_x","apply","arguments","handleDelete","_ref3","_onPress","matchesAPI","deleteMessage","error","_x2","handleShowReadBy","read","renderMessage","_ref4","item","index","isOwnMessage","senderId","jsx","View","children","MessageItem","onLongPress","onRetry","renderTypingIndicator","TypingIndicator","keyExtractor","getItemLayout","data","estimatedHeight","length","replyTo","audioUrl","type","offset","styles","container","FlatList","ref","renderItem","showsVerticalScrollIndicator","contentContainerStyle","contentContainer","scrollEventThrottle","initialNumToRender","windowSize","maxToRenderPerBatch","updateCellsBatchingPeriod","removeClippedSubviews","ListFooterComponent","StyleSheet","create","flex","paddingHorizontal","paddingVertical","paddingBottom"],"sources":["MessageList.tsx"],"sourcesContent":["import React, { useCallback, useState } from \"react\";\nimport {\n  FlatList,\n  View,\n  StyleSheet,\n  Clipboard,\n  Alert,\n  type NativeSyntheticEvent,\n  type NativeScrollEvent,\n} from \"react-native\";\nimport type { Message } from \"../../hooks/useChatData\";\nimport { MessageItem } from \"./MessageItem\";\nimport { MessageBubbleEnhanced } from \"./MessageBubbleEnhanced\";\nimport { TypingIndicator } from \"./TypingIndicator\";\nimport { chatService } from \"../../services/chatService\";\nimport { matchesAPI } from \"../../services/api\";\n\nconst Spacing = {\n  xs: 4,\n  sm: 8,\n  md: 16,\n  lg: 24,\n  xl: 32,\n};\n\ninterface MessageListProps {\n  messages: Message[];\n  typingUsers: string[];\n  isOnline: boolean;\n  currentUserId: string;\n  matchId: string;\n  onMessagePress?: (message: Message) => void;\n  onMessageLongPress?: (message: Message) => void;\n  onRetryMessage?: (messageId: string) => void;\n  flatListRef?: React.RefObject<FlatList<Message>>;\n  onScroll?: (event: NativeSyntheticEvent<NativeScrollEvent>) => void;\n}\n\nexport function MessageList({\n  messages,\n  typingUsers,\n  isOnline,\n  currentUserId,\n  matchId,\n  onMessagePress,\n  onMessageLongPress,\n  onRetryMessage,\n  flatListRef,\n  onScroll,\n}: MessageListProps): React.JSX.Element {\n  const [replyTarget, setReplyTarget] = useState<Message | null>(null);\n  \n  // Action handlers for enhanced bubble\n  const handleReply = useCallback((message: Message) => {\n    setReplyTarget(message);\n  }, []);\n  \n  const handleCopy = useCallback((message: Message) => {\n    Clipboard.setString(message.content);\n  }, []);\n  \n  const handleReact = useCallback(async (message: Message) => {\n    // Open reaction picker\n    Alert.alert(\"Add Reaction\", \"Choose a reaction\", [\n      { text: \"👍 Like\", onPress: () => chatService.sendReaction(matchId, message._id, \"like\") },\n      { text: \"❤️ Love\", onPress: () => chatService.sendReaction(matchId, message._id, \"love\") },\n      { text: \"😂 Laugh\", onPress: () => chatService.sendReaction(matchId, message._id, \"laugh\") },\n      { text: \"Cancel\", style: \"cancel\" },\n    ]);\n  }, [matchId]);\n  \n  const handleDelete = useCallback(async (message: Message) => {\n    Alert.alert(\n      \"Delete Message\",\n      \"Are you sure you want to delete this message?\",\n      [\n        { text: \"Cancel\", style: \"cancel\" },\n        { \n          text: \"Delete\", \n          style: \"destructive\",\n          onPress: async () => {\n            try {\n              await matchesAPI.deleteMessage(matchId, message._id);\n            } catch (error) {\n              Alert.alert(\"Error\", \"Failed to delete message\");\n            }\n          }\n        },\n      ]\n    );\n  }, [matchId]);\n  \n  const handleShowReadBy = useCallback((message: Message) => {\n    Alert.alert(\"Read by\", `Message was read by ${message.read ? \"recipient\" : \"no one yet\"}`);\n  }, []);\n\n  const renderMessage = useCallback(\n    ({ item, index }: { item: Message; index: number }) => {\n      const isOwnMessage = item.senderId === currentUserId || item.senderId === \"me\";\n      \n      // Use enhanced bubble when in production-ready mode\n      // For now, keep using MessageItem for compatibility\n      return (\n        <View>\n          <MessageItem\n            message={item}\n            index={index}\n            messages={messages}\n            isOnline={isOnline}\n            onPress={onMessagePress}\n            onLongPress={onMessageLongPress}\n            onRetry={onRetryMessage}\n          />\n        </View>\n      );\n    },\n    [messages, isOnline, currentUserId, onMessagePress, onMessageLongPress, onRetryMessage],\n  );\n\n  const renderTypingIndicator = useCallback(\n    () => <TypingIndicator typingUsers={typingUsers} />,\n    [typingUsers],\n  );\n\n  const keyExtractor = useCallback((item: Message) => item._id, []);\n\n  const getItemLayout = useCallback(\n    (data: ArrayLike<Message> | null | undefined, index: number) => {\n      // Dynamic height calculation based on message content\n      const message = data?.[index];\n      let estimatedHeight = 80;\n      \n      if (message) {\n        // Account for message content\n        if (message.content.length > 100) estimatedHeight += 20;\n        \n        // Account for reply to message\n        if (message.replyTo) estimatedHeight += 40;\n        \n        // Account for attachment\n        if (message.audioUrl || message.type === 'image') estimatedHeight += 120;\n      }\n      \n      return {\n        length: estimatedHeight,\n        offset: estimatedHeight * index,\n        index,\n      };\n    },\n    [],\n  );\n\n  return (\n    <View style={styles.container}>\n      <FlatList<Message>\n        ref={flatListRef}\n        data={messages}\n        renderItem={renderMessage}\n        keyExtractor={keyExtractor}\n        showsVerticalScrollIndicator={false}\n        contentContainerStyle={styles.contentContainer}\n        onScroll={onScroll}\n        scrollEventThrottle={100}\n        initialNumToRender={20}\n        windowSize={10}\n        maxToRenderPerBatch={10}\n        updateCellsBatchingPeriod={50}\n        removeClippedSubviews={true}\n        getItemLayout={getItemLayout}\n        ListFooterComponent={renderTypingIndicator}\n      />\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  contentContainer: {\n    paddingHorizontal: Spacing.md,\n    paddingVertical: Spacing.sm,\n    paddingBottom: Spacing.lg,\n  },\n});\n"],"mappings":"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","ignoreList":[]}