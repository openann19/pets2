c12ac1b6a12eacce35d8d1229d3a4662
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
exports.useSocket = useSocket;
exports.useSocketEmit = useSocketEmit;
exports.useSocketWithStatus = useSocketWithStatus;
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _core = require("@pawfectmatch/core");
var _react = require("react");
var _socket = require("socket.io-client");
function useSocket() {
  var _useState = (0, _react.useState)(null),
    _useState2 = (0, _slicedToArray2.default)(_useState, 2),
    socket = _useState2[0],
    setSocket = _useState2[1];
  var _useState3 = (0, _react.useState)(false),
    _useState4 = (0, _slicedToArray2.default)(_useState3, 2),
    _isConnected = _useState4[0],
    setIsConnected = _useState4[1];
  var _useState5 = (0, _react.useState)(null),
    _useState6 = (0, _slicedToArray2.default)(_useState5, 2),
    error = _useState6[0],
    setError = _useState6[1];
  var _useAuthStore = (0, _core.useAuthStore)(),
    user = _useAuthStore.user,
    accessToken = _useAuthStore.accessToken;
  var reconnectAttempts = (0, _react.useRef)(0);
  var maxReconnectAttempts = 5;
  (0, _react.useEffect)(function () {
    if (!user || !accessToken) {
      return;
    }
    function connectSocket() {
      try {
        var socketUrl = process.env["EXPO_PUBLIC_SOCKET_URL"] || "http://localhost:3001";
        var newSocket = (0, _socket.io)(socketUrl, {
          auth: {
            token: accessToken,
            userId: user._id
          },
          transports: ["websocket"],
          timeout: 10000,
          reconnection: true,
          reconnectionAttempts: maxReconnectAttempts,
          reconnectionDelay: 1000
        });
        newSocket.on("connect", function () {
          _core.logger.info("Socket connected:", {
            socketId: newSocket.id
          });
          setIsConnected(true);
          setError(null);
          reconnectAttempts.current = 0;
        });
        newSocket.on("disconnect", function (reason) {
          _core.logger.info("Socket disconnected:", {
            reason: reason
          });
          setIsConnected(false);
          if (reason === "io server disconnect") {
            newSocket.connect();
          }
        });
        newSocket.on("connect_error", function (err) {
          _core.logger.error("Socket connection error:", {
            error: err
          });
          setError(err.message);
          reconnectAttempts.current++;
          if (reconnectAttempts.current >= maxReconnectAttempts) {
            setError("Failed to connect after multiple attempts");
          }
        });
        newSocket.on("error", function (err) {
          _core.logger.error("Socket error:", {
            error: error
          });
          setError(err.message || "Socket error occurred");
        });
        newSocket.on("auth_error", function (_err) {
          _core.logger.error("Socket auth error:", {
            error: error
          });
          setError("Authentication failed");
          newSocket.disconnect();
        });
        newSocket.on("user_online", function (data) {
          _core.logger.info("User came online:", {
            data: data
          });
        });
        newSocket.on("user_offline", function (data) {
          _core.logger.info("User went offline:", {
            data: data
          });
        });
        newSocket.on("new_match", function (data) {
          _core.logger.info("New match:", {
            data: data
          });
        });
        newSocket.on("new_message", function (data) {
          _core.logger.info("New message:", {
            data: data
          });
        });
        newSocket.on("incoming_call", function (data) {
          _core.logger.info("Incoming call:", {
            data: data
          });
        });
        setSocket(newSocket);
        return newSocket;
      } catch (err) {
        _core.logger.error("Error creating socket:", {
          error: error
        });
        setError("Failed to create socket connection");
        return null;
      }
    }
    var socketInstance = connectSocket();
    return function () {
      if (socketInstance) {
        _core.logger.info("Cleaning up socket connection");
        socketInstance.removeAllListeners();
        socketInstance.disconnect();
      }
      setSocket(null);
      setIsConnected(false);
      setError(null);
    };
  }, [user, accessToken]);
  return socket;
}
function useSocketWithStatus() {
  var _useState7 = (0, _react.useState)(null),
    _useState8 = (0, _slicedToArray2.default)(_useState7, 2),
    socket = _useState8[0],
    setSocket = _useState8[1];
  var _useState9 = (0, _react.useState)(false),
    _useState0 = (0, _slicedToArray2.default)(_useState9, 2),
    isConnected = _useState0[0],
    setIsConnected = _useState0[1];
  var _useState1 = (0, _react.useState)(null),
    _useState10 = (0, _slicedToArray2.default)(_useState1, 2),
    error = _useState10[0],
    setError = _useState10[1];
  var _useAuthStore2 = (0, _core.useAuthStore)(),
    user = _useAuthStore2.user,
    accessToken = _useAuthStore2.accessToken;
  (0, _react.useEffect)(function () {
    if (!user || !accessToken) {
      return;
    }
    var socketUrl = process.env["EXPO_PUBLIC_SOCKET_URL"] || "http://localhost:3001";
    var newSocket = (0, _socket.io)(socketUrl, {
      auth: {
        token: accessToken,
        userId: user._id
      },
      transports: ["websocket"]
    });
    newSocket.on("connect", function () {
      setIsConnected(true);
      setError(null);
    });
    newSocket.on("disconnect", function () {
      setIsConnected(false);
    });
    newSocket.on("connect_error", function (err) {
      setError(err.message);
      setIsConnected(false);
    });
    setSocket(newSocket);
    return function () {
      newSocket.removeAllListeners();
      newSocket.disconnect();
      setSocket(null);
      setIsConnected(false);
      setError(null);
    };
  }, [user, accessToken]);
  return {
    socket: socket,
    isConnected: isConnected,
    error: error
  };
}
function useSocketEmit() {
  var socket = useSocket();
  function emit(event, data) {
    if (socket && socket.connected) {
      socket.emit(event, data);
      return true;
    }
    _core.logger.warn("Socket not connected, cannot emit:", {
      event: event
    });
    return false;
  }
  return emit;
}
var _default = exports.default = useSocket;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfY29yZSIsInJlcXVpcmUiLCJfcmVhY3QiLCJfc29ja2V0IiwidXNlU29ja2V0IiwiX3VzZVN0YXRlIiwidXNlU3RhdGUiLCJfdXNlU3RhdGUyIiwiX3NsaWNlZFRvQXJyYXkyIiwiZGVmYXVsdCIsInNvY2tldCIsInNldFNvY2tldCIsIl91c2VTdGF0ZTMiLCJfdXNlU3RhdGU0IiwiX2lzQ29ubmVjdGVkIiwic2V0SXNDb25uZWN0ZWQiLCJfdXNlU3RhdGU1IiwiX3VzZVN0YXRlNiIsImVycm9yIiwic2V0RXJyb3IiLCJfdXNlQXV0aFN0b3JlIiwidXNlQXV0aFN0b3JlIiwidXNlciIsImFjY2Vzc1Rva2VuIiwicmVjb25uZWN0QXR0ZW1wdHMiLCJ1c2VSZWYiLCJtYXhSZWNvbm5lY3RBdHRlbXB0cyIsInVzZUVmZmVjdCIsImNvbm5lY3RTb2NrZXQiLCJzb2NrZXRVcmwiLCJwcm9jZXNzIiwiZW52IiwibmV3U29ja2V0IiwiaW8iLCJhdXRoIiwidG9rZW4iLCJ1c2VySWQiLCJfaWQiLCJ0cmFuc3BvcnRzIiwidGltZW91dCIsInJlY29ubmVjdGlvbiIsInJlY29ubmVjdGlvbkF0dGVtcHRzIiwicmVjb25uZWN0aW9uRGVsYXkiLCJvbiIsImxvZ2dlciIsImluZm8iLCJzb2NrZXRJZCIsImlkIiwiY3VycmVudCIsInJlYXNvbiIsImNvbm5lY3QiLCJlcnIiLCJtZXNzYWdlIiwiX2VyciIsImRpc2Nvbm5lY3QiLCJkYXRhIiwic29ja2V0SW5zdGFuY2UiLCJyZW1vdmVBbGxMaXN0ZW5lcnMiLCJ1c2VTb2NrZXRXaXRoU3RhdHVzIiwiX3VzZVN0YXRlNyIsIl91c2VTdGF0ZTgiLCJfdXNlU3RhdGU5IiwiX3VzZVN0YXRlMCIsImlzQ29ubmVjdGVkIiwiX3VzZVN0YXRlMSIsIl91c2VTdGF0ZTEwIiwiX3VzZUF1dGhTdG9yZTIiLCJ1c2VTb2NrZXRFbWl0IiwiZW1pdCIsImV2ZW50IiwiY29ubmVjdGVkIiwid2FybiIsIl9kZWZhdWx0IiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInVzZVNvY2tldC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB1c2VBdXRoU3RvcmUgfSBmcm9tIFwiQHBhd2ZlY3RtYXRjaC9jb3JlXCI7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwiQHBhd2ZlY3RtYXRjaC9jb3JlXCI7XG5pbXBvcnQgeyB1c2VFZmZlY3QsIHVzZVN0YXRlLCB1c2VSZWYgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB0eXBlIHsgU29ja2V0IH0gZnJvbSBcInNvY2tldC5pby1jbGllbnRcIjtcbmltcG9ydCB7IGlvIH0gZnJvbSBcInNvY2tldC5pby1jbGllbnRcIjtcbmltcG9ydCB0eXBlIHtcbiAgVXNlclR5cGluZ0V2ZW50LFxuICBOZXdNZXNzYWdlRXZlbnQsXG4gIFVzZXJTdGF0dXNFdmVudCxcbiAgT25saW5lVXNlcnNVcGRhdGUsXG59IGZyb20gXCJAcGF3ZmVjdG1hdGNoL2NvcmVcIjtcblxuaW50ZXJmYWNlIFVzZVNvY2tldFJldHVybiB7XG4gIHNvY2tldDogU29ja2V0IHwgbnVsbDtcbiAgaXNDb25uZWN0ZWQ6IGJvb2xlYW47XG4gIGVycm9yOiBzdHJpbmcgfCBudWxsO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdXNlU29ja2V0KCk6IFNvY2tldCB8IG51bGwge1xuICBjb25zdCBbc29ja2V0LCBzZXRTb2NrZXRdID0gdXNlU3RhdGU8U29ja2V0IHwgbnVsbD4obnVsbCk7XG4gIGNvbnN0IFtfaXNDb25uZWN0ZWQsIHNldElzQ29ubmVjdGVkXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW2Vycm9yLCBzZXRFcnJvcl0gPSB1c2VTdGF0ZTxzdHJpbmcgfCBudWxsPihudWxsKTtcbiAgY29uc3QgeyB1c2VyLCBhY2Nlc3NUb2tlbiB9ID0gdXNlQXV0aFN0b3JlKCk7XG4gIGNvbnN0IHJlY29ubmVjdEF0dGVtcHRzID0gdXNlUmVmKDApO1xuICBjb25zdCBtYXhSZWNvbm5lY3RBdHRlbXB0cyA9IDU7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoIXVzZXIgfHwgIWFjY2Vzc1Rva2VuKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY29ubmVjdFNvY2tldCgpOiBTb2NrZXQgfCBudWxsIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHNvY2tldFVybCA9XG4gICAgICAgICAgcHJvY2Vzcy5lbnZbXCJFWFBPX1BVQkxJQ19TT0NLRVRfVVJMXCJdIHx8IFwiaHR0cDovL2xvY2FsaG9zdDozMDAxXCI7XG4gICAgICAgIGNvbnN0IG5ld1NvY2tldCA9IGlvKHNvY2tldFVybCwge1xuICAgICAgICAgIGF1dGg6IHtcbiAgICAgICAgICAgIHRva2VuOiBhY2Nlc3NUb2tlbixcbiAgICAgICAgICAgIHVzZXJJZDogdXNlciEuX2lkLCAvLyBOb24tbnVsbCBhc3NlcnRpb24sIGd1YXJkZWQgYnkgY2hlY2sgYWJvdmVcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRyYW5zcG9ydHM6IFtcIndlYnNvY2tldFwiXSxcbiAgICAgICAgICB0aW1lb3V0OiAxMDAwMCxcbiAgICAgICAgICByZWNvbm5lY3Rpb246IHRydWUsXG4gICAgICAgICAgcmVjb25uZWN0aW9uQXR0ZW1wdHM6IG1heFJlY29ubmVjdEF0dGVtcHRzLFxuICAgICAgICAgIHJlY29ubmVjdGlvbkRlbGF5OiAxMDAwLFxuICAgICAgICB9KTtcblxuICAgICAgICBuZXdTb2NrZXQub24oXCJjb25uZWN0XCIsICgpID0+IHtcbiAgICAgICAgICBsb2dnZXIuaW5mbyhcIlNvY2tldCBjb25uZWN0ZWQ6XCIsIHsgc29ja2V0SWQ6IG5ld1NvY2tldC5pZCB9KTtcbiAgICAgICAgICBzZXRJc0Nvbm5lY3RlZCh0cnVlKTtcbiAgICAgICAgICBzZXRFcnJvcihudWxsKTtcbiAgICAgICAgICByZWNvbm5lY3RBdHRlbXB0cy5jdXJyZW50ID0gMDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbmV3U29ja2V0Lm9uKFwiZGlzY29ubmVjdFwiLCAocmVhc29uOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICBsb2dnZXIuaW5mbyhcIlNvY2tldCBkaXNjb25uZWN0ZWQ6XCIsIHsgcmVhc29uIH0pO1xuICAgICAgICAgIHNldElzQ29ubmVjdGVkKGZhbHNlKTtcblxuICAgICAgICAgIGlmIChyZWFzb24gPT09IFwiaW8gc2VydmVyIGRpc2Nvbm5lY3RcIikge1xuICAgICAgICAgICAgLy8gU2VydmVyIGRpc2Nvbm5lY3RlZCwgdHJ5IHRvIHJlY29ubmVjdFxuICAgICAgICAgICAgbmV3U29ja2V0LmNvbm5lY3QoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIG5ld1NvY2tldC5vbihcImNvbm5lY3RfZXJyb3JcIiwgKGVycjogRXJyb3IpID0+IHtcbiAgICAgICAgICBsb2dnZXIuZXJyb3IoXCJTb2NrZXQgY29ubmVjdGlvbiBlcnJvcjpcIiwgeyBlcnJvcjogZXJyIH0pO1xuICAgICAgICAgIHNldEVycm9yKGVyci5tZXNzYWdlKTtcbiAgICAgICAgICByZWNvbm5lY3RBdHRlbXB0cy5jdXJyZW50Kys7XG5cbiAgICAgICAgICBpZiAocmVjb25uZWN0QXR0ZW1wdHMuY3VycmVudCA+PSBtYXhSZWNvbm5lY3RBdHRlbXB0cykge1xuICAgICAgICAgICAgc2V0RXJyb3IoXCJGYWlsZWQgdG8gY29ubmVjdCBhZnRlciBtdWx0aXBsZSBhdHRlbXB0c1wiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIG5ld1NvY2tldC5vbihcImVycm9yXCIsIChlcnI6IEVycm9yKSA9PiB7XG4gICAgICAgICAgbG9nZ2VyLmVycm9yKFwiU29ja2V0IGVycm9yOlwiLCB7IGVycm9yIH0pO1xuICAgICAgICAgIHNldEVycm9yKGVyci5tZXNzYWdlIHx8IFwiU29ja2V0IGVycm9yIG9jY3VycmVkXCIpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBBdXRoZW50aWNhdGlvbiBlcnJvclxuICAgICAgICBuZXdTb2NrZXQub24oXCJhdXRoX2Vycm9yXCIsIChfZXJyOiBFcnJvcikgPT4ge1xuICAgICAgICAgIGxvZ2dlci5lcnJvcihcIlNvY2tldCBhdXRoIGVycm9yOlwiLCB7IGVycm9yIH0pO1xuICAgICAgICAgIHNldEVycm9yKFwiQXV0aGVudGljYXRpb24gZmFpbGVkXCIpO1xuICAgICAgICAgIG5ld1NvY2tldC5kaXNjb25uZWN0KCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFVzZXItc3BlY2lmaWMgZXZlbnRzXG4gICAgICAgIG5ld1NvY2tldC5vbihcInVzZXJfb25saW5lXCIsIChkYXRhOiBVc2VyU3RhdHVzRXZlbnQpID0+IHtcbiAgICAgICAgICBsb2dnZXIuaW5mbyhcIlVzZXIgY2FtZSBvbmxpbmU6XCIsIHsgZGF0YSB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbmV3U29ja2V0Lm9uKFwidXNlcl9vZmZsaW5lXCIsIChkYXRhOiBVc2VyU3RhdHVzRXZlbnQpID0+IHtcbiAgICAgICAgICBsb2dnZXIuaW5mbyhcIlVzZXIgd2VudCBvZmZsaW5lOlwiLCB7IGRhdGEgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIE1hdGNoIGV2ZW50c1xuICAgICAgICBuZXdTb2NrZXQub24oXCJuZXdfbWF0Y2hcIiwgKGRhdGE6IE5ld01lc3NhZ2VFdmVudCkgPT4ge1xuICAgICAgICAgIGxvZ2dlci5pbmZvKFwiTmV3IG1hdGNoOlwiLCB7IGRhdGEgfSk7XG4gICAgICAgICAgLy8gSGFuZGxlIG5ldyBtYXRjaCBub3RpZmljYXRpb25cbiAgICAgICAgfSk7XG5cbiAgICAgICAgbmV3U29ja2V0Lm9uKFwibmV3X21lc3NhZ2VcIiwgKGRhdGE6IE5ld01lc3NhZ2VFdmVudCkgPT4ge1xuICAgICAgICAgIGxvZ2dlci5pbmZvKFwiTmV3IG1lc3NhZ2U6XCIsIHsgZGF0YSB9KTtcbiAgICAgICAgICAvLyBIYW5kbGUgbmV3IG1lc3NhZ2Ugbm90aWZpY2F0aW9uXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENhbGwgZXZlbnRzIChoYW5kbGVkIGJ5IFdlYlJUQyBzZXJ2aWNlKVxuICAgICAgICBuZXdTb2NrZXQub24oXCJpbmNvbWluZ19jYWxsXCIsIChkYXRhOiBPbmxpbmVVc2Vyc1VwZGF0ZSkgPT4ge1xuICAgICAgICAgIGxvZ2dlci5pbmZvKFwiSW5jb21pbmcgY2FsbDpcIiwgeyBkYXRhIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBzZXRTb2NrZXQobmV3U29ja2V0KTtcblxuICAgICAgICByZXR1cm4gbmV3U29ja2V0O1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcihcIkVycm9yIGNyZWF0aW5nIHNvY2tldDpcIiwgeyBlcnJvciB9KTtcbiAgICAgICAgc2V0RXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIHNvY2tldCBjb25uZWN0aW9uXCIpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBzb2NrZXRJbnN0YW5jZSA9IGNvbm5lY3RTb2NrZXQoKTtcblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBpZiAoc29ja2V0SW5zdGFuY2UpIHtcbiAgICAgICAgbG9nZ2VyLmluZm8oXCJDbGVhbmluZyB1cCBzb2NrZXQgY29ubmVjdGlvblwiKTtcbiAgICAgICAgc29ja2V0SW5zdGFuY2UucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gICAgICAgIHNvY2tldEluc3RhbmNlLmRpc2Nvbm5lY3QoKTtcbiAgICAgIH1cbiAgICAgIHNldFNvY2tldChudWxsKTtcbiAgICAgIHNldElzQ29ubmVjdGVkKGZhbHNlKTtcbiAgICAgIHNldEVycm9yKG51bGwpO1xuICAgIH07XG4gIH0sIFt1c2VyLCBhY2Nlc3NUb2tlbl0pO1xuXG4gIHJldHVybiBzb2NrZXQ7XG59XG5cbi8vIEhvb2sgZm9yIHNvY2tldCB3aXRoIGNvbm5lY3Rpb24gc3RhdHVzXG5leHBvcnQgZnVuY3Rpb24gdXNlU29ja2V0V2l0aFN0YXR1cygpOiBVc2VTb2NrZXRSZXR1cm4ge1xuICBjb25zdCBbc29ja2V0LCBzZXRTb2NrZXRdID0gdXNlU3RhdGU8U29ja2V0IHwgbnVsbD4obnVsbCk7XG4gIGNvbnN0IFtpc0Nvbm5lY3RlZCwgc2V0SXNDb25uZWN0ZWRdID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCBbZXJyb3IsIHNldEVycm9yXSA9IHVzZVN0YXRlPHN0cmluZyB8IG51bGw+KG51bGwpO1xuICBjb25zdCB7IHVzZXIsIGFjY2Vzc1Rva2VuIH0gPSB1c2VBdXRoU3RvcmUoKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmICghdXNlciB8fCAhYWNjZXNzVG9rZW4pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBzb2NrZXRVcmwgPVxuICAgICAgcHJvY2Vzcy5lbnZbXCJFWFBPX1BVQkxJQ19TT0NLRVRfVVJMXCJdIHx8IFwiaHR0cDovL2xvY2FsaG9zdDozMDAxXCI7XG4gICAgY29uc3QgbmV3U29ja2V0ID0gaW8oc29ja2V0VXJsLCB7XG4gICAgICBhdXRoOiB7XG4gICAgICAgIHRva2VuOiBhY2Nlc3NUb2tlbixcbiAgICAgICAgdXNlcklkOiB1c2VyLl9pZCwgLy8gTm9uLW51bGwgYXNzZXJ0aW9uLCBndWFyZGVkIGJ5IGNoZWNrIGFib3ZlXG4gICAgICB9LFxuICAgICAgdHJhbnNwb3J0czogW1wid2Vic29ja2V0XCJdLFxuICAgIH0pO1xuXG4gICAgbmV3U29ja2V0Lm9uKFwiY29ubmVjdFwiLCAoKSA9PiB7XG4gICAgICBzZXRJc0Nvbm5lY3RlZCh0cnVlKTtcbiAgICAgIHNldEVycm9yKG51bGwpO1xuICAgIH0pO1xuXG4gICAgbmV3U29ja2V0Lm9uKFwiZGlzY29ubmVjdFwiLCAoKSA9PiB7XG4gICAgICBzZXRJc0Nvbm5lY3RlZChmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBuZXdTb2NrZXQub24oXCJjb25uZWN0X2Vycm9yXCIsIChlcnI6IEVycm9yKSA9PiB7XG4gICAgICBzZXRFcnJvcihlcnIubWVzc2FnZSk7XG4gICAgICBzZXRJc0Nvbm5lY3RlZChmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBzZXRTb2NrZXQobmV3U29ja2V0KTtcblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBuZXdTb2NrZXQucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gICAgICBuZXdTb2NrZXQuZGlzY29ubmVjdCgpO1xuICAgICAgc2V0U29ja2V0KG51bGwpO1xuICAgICAgc2V0SXNDb25uZWN0ZWQoZmFsc2UpO1xuICAgICAgc2V0RXJyb3IobnVsbCk7XG4gICAgfTtcbiAgfSwgW3VzZXIsIGFjY2Vzc1Rva2VuXSk7XG5cbiAgcmV0dXJuIHsgc29ja2V0LCBpc0Nvbm5lY3RlZCwgZXJyb3IgfTtcbn1cblxuLy8gRW1pdCBoZWxwZXJcbmV4cG9ydCBmdW5jdGlvbiB1c2VTb2NrZXRFbWl0KCk6IChcbiAgZXZlbnQ6IHN0cmluZyxcbiAgZGF0YT86IFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuKSA9PiBib29sZWFuIHtcbiAgY29uc3Qgc29ja2V0ID0gdXNlU29ja2V0KCk7XG5cbiAgZnVuY3Rpb24gZW1pdChldmVudDogc3RyaW5nLCBkYXRhPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pOiBib29sZWFuIHtcbiAgICBpZiAoc29ja2V0ICYmIHNvY2tldC5jb25uZWN0ZWQpIHtcbiAgICAgIHNvY2tldC5lbWl0KGV2ZW50LCBkYXRhKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBsb2dnZXIud2FybihcIlNvY2tldCBub3QgY29ubmVjdGVkLCBjYW5ub3QgZW1pdDpcIiwgeyBldmVudCB9KTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICByZXR1cm4gZW1pdDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgdXNlU29ja2V0O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBLElBQUFBLEtBQUEsR0FBQUMsT0FBQTtBQUVBLElBQUFDLE1BQUEsR0FBQUQsT0FBQTtBQUVBLElBQUFFLE9BQUEsR0FBQUYs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