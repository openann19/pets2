0c5051b9acf932d4f5fe41d94148a73e
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useStories = void 0;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _react = require("react");
var Haptics = _interopRequireWildcard(require("expo-haptics"));
var _reactQuery = require("@tanstack/react-query");
var _core = require("@pawfectmatch/core");
var _useSocket = require("../../useSocket");
var _apiClient = _interopRequireDefault(require("../../../services/apiClient"));
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function _interopRequireWildcard(e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (var _t in e) "default" !== _t && {}.hasOwnProperty.call(e, _t) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, _t)) && (i.get || i.set) ? o(f, _t, i) : f[_t] = e[_t]); return f; })(e, t); }
var useStories = exports.useStories = function useStories() {
  var initialGroupIndex = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
  var _useState = (0, _react.useState)(initialGroupIndex),
    _useState2 = (0, _slicedToArray2.default)(_useState, 2),
    currentGroupIndex = _useState2[0],
    setCurrentGroupIndex = _useState2[1];
  var _useState3 = (0, _react.useState)(0),
    _useState4 = (0, _slicedToArray2.default)(_useState3, 2),
    currentStoryIndex = _useState4[0],
    setCurrentStoryIndex = _useState4[1];
  var _useState5 = (0, _react.useState)(false),
    _useState6 = (0, _slicedToArray2.default)(_useState5, 2),
    isPaused = _useState6[0],
    setIsPaused = _useState6[1];
  var _useState7 = (0, _react.useState)(false),
    _useState8 = (0, _slicedToArray2.default)(_useState7, 2),
    isMuted = _useState8[0],
    setIsMuted = _useState8[1];
  var _useState9 = (0, _react.useState)(0),
    _useState0 = (0, _slicedToArray2.default)(_useState9, 2),
    progress = _useState0[0],
    setProgress = _useState0[1];
  var _useState1 = (0, _react.useState)(0),
    _useState10 = (0, _slicedToArray2.default)(_useState1, 2),
    viewCount = _useState10[0],
    setViewCount = _useState10[1];
  var timerRef = (0, _react.useRef)(null);
  var progressIntervalRef = (0, _react.useRef)(null);
  var longPressTimer = (0, _react.useRef)(null);
  var socket = (0, _useSocket.useSocket)();
  var _useQuery = (0, _reactQuery.useQuery)({
      queryKey: ["stories-feed"],
      queryFn: function () {
        var _queryFn = (0, _asyncToGenerator2.default)(function* () {
          var response = yield _apiClient.default.get("/stories");
          return response.stories;
        });
        function queryFn() {
          return _queryFn.apply(this, arguments);
        }
        return queryFn;
      }()
    }),
    storyGroups = _useQuery.data,
    isLoading = _useQuery.isLoading,
    error = _useQuery.error,
    refetch = _useQuery.refetch;
  var currentGroup = storyGroups == null ? void 0 : storyGroups[currentGroupIndex];
  var refreshStories = (0, _react.useCallback)((0, _asyncToGenerator2.default)(function* () {
    yield refetch();
  }), [refetch]);
  var currentStory = currentGroup == null ? void 0 : currentGroup.stories[currentStoryIndex];
  var viewStoryMutation = (0, _reactQuery.useMutation)({
    mutationFn: function () {
      var _mutationFn = (0, _asyncToGenerator2.default)(function* (storyId) {
        var response = yield _apiClient.default.post(`/stories/${storyId}/view`);
        return response;
      });
      function mutationFn(_x) {
        return _mutationFn.apply(this, arguments);
      }
      return mutationFn;
    }(),
    onSuccess: function onSuccess(data) {
      setViewCount(data.viewCount);
    }
  });
  var goToNextStory = (0, _react.useCallback)(function () {
    if (!currentGroup) return;
    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
    if (currentStoryIndex < currentGroup.stories.length - 1) {
      setCurrentStoryIndex(function (prev) {
        return prev + 1;
      });
      setProgress(0);
    } else if (storyGroups && currentGroupIndex < storyGroups.length - 1) {
      setCurrentGroupIndex(function (prev) {
        return prev + 1;
      });
      setCurrentStoryIndex(0);
      setProgress(0);
    } else {
      _core.logger.info("Reached end of stories");
    }
  }, [currentGroup, currentStoryIndex, currentGroupIndex, storyGroups]);
  var goToPreviousStory = (0, _react.useCallback)(function () {
    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
    if (currentStoryIndex > 0) {
      setCurrentStoryIndex(function (prev) {
        return prev - 1;
      });
      setProgress(0);
    } else if (currentGroupIndex > 0 && storyGroups) {
      var prevGroupIndex = currentGroupIndex - 1;
      var prevGroup = storyGroups[prevGroupIndex];
      if (prevGroup) {
        setCurrentGroupIndex(prevGroupIndex);
        setCurrentStoryIndex(prevGroup.stories.length - 1);
        setProgress(0);
      }
    }
  }, [currentStoryIndex, currentGroupIndex, storyGroups]);
  var goToGroup = (0, _react.useCallback)(function (groupIndex) {
    if (groupIndex >= 0 && storyGroups && groupIndex < storyGroups.length) {
      setCurrentGroupIndex(groupIndex);
      setCurrentStoryIndex(0);
      setProgress(0);
    }
  }, [storyGroups]);
  var goToStory = (0, _react.useCallback)(function (groupIndex, storyIndex) {
    if (groupIndex >= 0 && storyGroups && groupIndex < storyGroups.length) {
      var group = storyGroups[groupIndex];
      if (group && storyIndex >= 0 && storyIndex < group.stories.length) {
        setCurrentGroupIndex(groupIndex);
        setCurrentStoryIndex(storyIndex);
        setProgress(0);
      }
    }
  }, [storyGroups]);
  (0, _react.useEffect)(function () {
    if (!currentStory || isPaused) return;
    var duration = currentStory.duration * 1000;
    var startTime = Date.now();
    progressIntervalRef.current = setInterval(function () {
      var elapsed = Date.now() - startTime;
      var newProgress = Math.min(elapsed / duration * 100, 100);
      setProgress(newProgress);
    }, 16);
    timerRef.current = setTimeout(function () {
      goToNextStory();
    }, duration);
    return function () {
      if (timerRef.current) clearTimeout(timerRef.current);
      if (progressIntervalRef.current) clearInterval(progressIntervalRef.current);
    };
  }, [currentStory, isPaused, goToNextStory]);
  (0, _react.useEffect)(function () {
    if (currentStory) {
      viewStoryMutation.mutate(currentStory._id);
    }
  }, [currentStory == null ? void 0 : currentStory._id]);
  (0, _react.useEffect)(function () {
    if (!socket || !currentStory) return;
    var handleStoryViewed = function handleStoryViewed(data) {
      if (data.storyId === currentStory._id) {
        setViewCount(data.viewCount);
      }
    };
    socket.on("story:viewed", handleStoryViewed);
    return function () {
      socket.off("story:viewed", handleStoryViewed);
    };
  }, [socket, currentStory == null ? void 0 : currentStory._id]);
  var markAsViewed = (0, _react.useCallback)(function () {
    var _ref2 = (0, _asyncToGenerator2.default)(function* (storyId) {
      try {
        yield viewStoryMutation.mutateAsync(storyId);
      } catch (error) {
        _core.logger.error("Failed to mark story as viewed", {
          error: error,
          storyId: storyId
        });
      }
    });
    return function (_x2) {
      return _ref2.apply(this, arguments);
    };
  }(), [viewStoryMutation]);
  var setPaused = (0, _react.useCallback)(function (paused) {
    setIsPaused(paused);
  }, []);
  var setMuted = (0, _react.useCallback)(function (muted) {
    setIsMuted(muted);
  }, []);
  return {
    storyGroups: storyGroups,
    isLoading: isLoading,
    error: (error == null ? void 0 : error.message) || null,
    currentGroupIndex: currentGroupIndex,
    currentStoryIndex: currentStoryIndex,
    currentGroup: currentGroup,
    currentStory: currentStory,
    progress: progress,
    viewCount: viewCount,
    isPaused: isPaused,
    isMuted: isMuted,
    setPaused: setPaused,
    setMuted: setMuted,
    goToNextStory: goToNextStory,
    goToPreviousStory: goToPreviousStory,
    goToGroup: goToGroup,
    goToStory: goToStory,
    markAsViewed: markAsViewed,
    refreshStories: refreshStories,
    timerRef: timerRef,
    progressIntervalRef: progressIntervalRef,
    longPressTimer: longPressTimer
  };
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwiSGFwdGljcyIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwiX3JlYWN0UXVlcnkiLCJfY29yZSIsIl91c2VTb2NrZXQiLCJfYXBpQ2xpZW50IiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsImUiLCJ0IiwiV2Vha01hcCIsInIiLCJuIiwiX19lc01vZHVsZSIsIm8iLCJpIiwiZiIsIl9fcHJvdG9fXyIsImRlZmF1bHQiLCJoYXMiLCJnZXQiLCJzZXQiLCJfdCIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwidXNlU3RvcmllcyIsImV4cG9ydHMiLCJpbml0aWFsR3JvdXBJbmRleCIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsIl91c2VTdGF0ZSIsInVzZVN0YXRlIiwiX3VzZVN0YXRlMiIsIl9zbGljZWRUb0FycmF5MiIsImN1cnJlbnRHcm91cEluZGV4Iiwic2V0Q3VycmVudEdyb3VwSW5kZXgiLCJfdXNlU3RhdGUzIiwiX3VzZVN0YXRlNCIsImN1cnJlbnRTdG9yeUluZGV4Iiwic2V0Q3VycmVudFN0b3J5SW5kZXgiLCJfdXNlU3RhdGU1IiwiX3VzZVN0YXRlNiIsImlzUGF1c2VkIiwic2V0SXNQYXVzZWQiLCJfdXNlU3RhdGU3IiwiX3VzZVN0YXRlOCIsImlzTXV0ZWQiLCJzZXRJc011dGVkIiwiX3VzZVN0YXRlOSIsIl91c2VTdGF0ZTAiLCJwcm9ncmVzcyIsInNldFByb2dyZXNzIiwiX3VzZVN0YXRlMSIsIl91c2VTdGF0ZTEwIiwidmlld0NvdW50Iiwic2V0Vmlld0NvdW50IiwidGltZXJSZWYiLCJ1c2VSZWYiLCJwcm9ncmVzc0ludGVydmFsUmVmIiwibG9uZ1ByZXNzVGltZXIiLCJzb2NrZXQiLCJ1c2VTb2NrZXQiLCJfdXNlUXVlcnkiLCJ1c2VRdWVyeSIsInF1ZXJ5S2V5IiwicXVlcnlGbiIsIl9xdWVyeUZuIiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwicmVzcG9uc2UiLCJhcGlDbGllbnQiLCJzdG9yaWVzIiwiYXBwbHkiLCJzdG9yeUdyb3VwcyIsImRhdGEiLCJpc0xvYWRpbmciLCJlcnJvciIsInJlZmV0Y2giLCJjdXJyZW50R3JvdXAiLCJyZWZyZXNoU3RvcmllcyIsInVzZUNhbGxiYWNrIiwiY3VycmVudFN0b3J5Iiwidmlld1N0b3J5TXV0YXRpb24iLCJ1c2VNdXRhdGlvbiIsIm11dGF0aW9uRm4iLCJfbXV0YXRpb25GbiIsInN0b3J5SWQiLCJwb3N0IiwiX3giLCJvblN1Y2Nlc3MiLCJnb1RvTmV4dFN0b3J5IiwiaW1wYWN0QXN5bmMiLCJJbXBhY3RGZWVkYmFja1N0eWxlIiwiTGlnaHQiLCJwcmV2IiwibG9nZ2VyIiwiaW5mbyIsImdvVG9QcmV2aW91c1N0b3J5IiwicHJldkdyb3VwSW5kZXgiLCJwcmV2R3JvdXAiLCJnb1RvR3JvdXAiLCJncm91cEluZGV4IiwiZ29Ub1N0b3J5Iiwic3RvcnlJbmRleCIsImdyb3VwIiwidXNlRWZmZWN0IiwiZHVyYXRpb24iLCJzdGFydFRpbWUiLCJEYXRlIiwibm93IiwiY3VycmVudCIsInNldEludGVydmFsIiwiZWxhcHNlZCIsIm5ld1Byb2dyZXNzIiwiTWF0aCIsIm1pbiIsInNldFRpbWVvdXQiLCJjbGVhclRpbWVvdXQiLCJjbGVhckludGVydmFsIiwibXV0YXRlIiwiX2lkIiwiaGFuZGxlU3RvcnlWaWV3ZWQiLCJvbiIsIm9mZiIsIm1hcmtBc1ZpZXdlZCIsIl9yZWYyIiwibXV0YXRlQXN5bmMiLCJfeDIiLCJzZXRQYXVzZWQiLCJwYXVzZWQiLCJzZXRNdXRlZCIsIm11dGVkIiwibWVzc2FnZSJdLCJzb3VyY2VzIjpbInVzZVN0b3JpZXMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiB1c2VTdG9yaWVzIEhvb2tcbiAqIE1hbmFnZXMgc3RvcmllcyBmZWVkLCBuYXZpZ2F0aW9uLCBwcm9ncmVzcyB0cmFja2luZywgYW5kIHZpZXdpbmcgaW50ZXJhY3Rpb25zXG4gKi9cbmltcG9ydCB7IHVzZUNhbGxiYWNrLCB1c2VFZmZlY3QsIHVzZVJlZiwgdXNlU3RhdGUgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCAqIGFzIEhhcHRpY3MgZnJvbSBcImV4cG8taGFwdGljc1wiO1xuaW1wb3J0IHsgdXNlUXVlcnksIHVzZU11dGF0aW9uIH0gZnJvbSBcIkB0YW5zdGFjay9yZWFjdC1xdWVyeVwiO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIkBwYXdmZWN0bWF0Y2gvY29yZVwiO1xuaW1wb3J0IHsgdXNlU29ja2V0IH0gZnJvbSBcIi4uLy4uL3VzZVNvY2tldFwiO1xuaW1wb3J0IGFwaUNsaWVudCBmcm9tIFwiLi4vLi4vLi4vc2VydmljZXMvYXBpQ2xpZW50XCI7XG5cbmludGVyZmFjZSBTdG9yeSB7XG4gIF9pZDogc3RyaW5nO1xuICB1c2VySWQ6IHN0cmluZztcbiAgbWVkaWFUeXBlOiBcInBob3RvXCIgfCBcInZpZGVvXCI7XG4gIG1lZGlhVXJsOiBzdHJpbmc7XG4gIGNhcHRpb24/OiBzdHJpbmc7XG4gIGR1cmF0aW9uOiBudW1iZXI7XG4gIHZpZXdDb3VudDogbnVtYmVyO1xuICBjcmVhdGVkQXQ6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIFN0b3J5VXNlciB7XG4gIF9pZDogc3RyaW5nO1xuICB1c2VybmFtZTogc3RyaW5nO1xuICBwcm9maWxlUGhvdG8/OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBTdG9yeUdyb3VwIHtcbiAgdXNlcklkOiBzdHJpbmc7XG4gIHVzZXI6IFN0b3J5VXNlcjtcbiAgc3RvcmllczogU3RvcnlbXTtcbiAgc3RvcnlDb3VudDogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgU3Rvcmllc0ZlZWRSZXNwb25zZSB7XG4gIHN0b3JpZXM6IFN0b3J5R3JvdXBbXTtcbiAgc3VjY2VzczogYm9vbGVhbjtcbn1cblxuaW50ZXJmYWNlIFZpZXdTdG9yeVJlc3BvbnNlIHtcbiAgc3VjY2VzczogYm9vbGVhbjtcbiAgdmlld0NvdW50OiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBVc2VTdG9yaWVzUmV0dXJuIHtcbiAgLy8gRGF0YVxuICBzdG9yeUdyb3VwczogU3RvcnlHcm91cFtdIHwgdW5kZWZpbmVkO1xuICBpc0xvYWRpbmc6IGJvb2xlYW47XG4gIGVycm9yOiBzdHJpbmcgfCBudWxsO1xuXG4gIC8vIEN1cnJlbnQgbmF2aWdhdGlvbiBzdGF0ZVxuICBjdXJyZW50R3JvdXBJbmRleDogbnVtYmVyO1xuICBjdXJyZW50U3RvcnlJbmRleDogbnVtYmVyO1xuICBjdXJyZW50R3JvdXA6IFN0b3J5R3JvdXAgfCB1bmRlZmluZWQ7XG4gIGN1cnJlbnRTdG9yeTogU3RvcnkgfCB1bmRlZmluZWQ7XG4gIHByb2dyZXNzOiBudW1iZXI7XG4gIHZpZXdDb3VudDogbnVtYmVyO1xuXG4gIC8vIENvbnRyb2xzXG4gIGlzUGF1c2VkOiBib29sZWFuO1xuICBpc011dGVkOiBib29sZWFuO1xuICBzZXRQYXVzZWQ6IChwYXVzZWQ6IGJvb2xlYW4pID0+IHZvaWQ7XG4gIHNldE11dGVkOiAobXV0ZWQ6IGJvb2xlYW4pID0+IHZvaWQ7XG5cbiAgLy8gTmF2aWdhdGlvblxuICBnb1RvTmV4dFN0b3J5OiAoKSA9PiB2b2lkO1xuICBnb1RvUHJldmlvdXNTdG9yeTogKCkgPT4gdm9pZDtcbiAgZ29Ub0dyb3VwOiAoZ3JvdXBJbmRleDogbnVtYmVyKSA9PiB2b2lkO1xuICBnb1RvU3Rvcnk6IChncm91cEluZGV4OiBudW1iZXIsIHN0b3J5SW5kZXg6IG51bWJlcikgPT4gdm9pZDtcblxuICAvLyBBY3Rpb25zXG4gIG1hcmtBc1ZpZXdlZDogKHN0b3J5SWQ6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPjtcbiAgcmVmcmVzaFN0b3JpZXM6ICgpID0+IFByb21pc2U8dm9pZD47XG5cbiAgLy8gUmVmcyBmb3IgZXh0ZXJuYWwgdXNlICh2aWRlbywgdGltZXJzLCBldGMuKVxuICB0aW1lclJlZjogUmVhY3QuTXV0YWJsZVJlZk9iamVjdDxOb2RlSlMuVGltZW91dCB8IG51bGw+O1xuICBwcm9ncmVzc0ludGVydmFsUmVmOiBSZWFjdC5NdXRhYmxlUmVmT2JqZWN0PE5vZGVKUy5UaW1lb3V0IHwgbnVsbD47XG4gIGxvbmdQcmVzc1RpbWVyOiBSZWFjdC5NdXRhYmxlUmVmT2JqZWN0PE5vZGVKUy5UaW1lb3V0IHwgbnVsbD47XG59XG5cbmV4cG9ydCBjb25zdCB1c2VTdG9yaWVzID0gKGluaXRpYWxHcm91cEluZGV4OiBudW1iZXIgPSAwKTogVXNlU3Rvcmllc1JldHVybiA9PiB7XG4gIGNvbnN0IFtjdXJyZW50R3JvdXBJbmRleCwgc2V0Q3VycmVudEdyb3VwSW5kZXhdID0gdXNlU3RhdGUoaW5pdGlhbEdyb3VwSW5kZXgpO1xuICBjb25zdCBbY3VycmVudFN0b3J5SW5kZXgsIHNldEN1cnJlbnRTdG9yeUluZGV4XSA9IHVzZVN0YXRlKDApO1xuICBjb25zdCBbaXNQYXVzZWQsIHNldElzUGF1c2VkXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW2lzTXV0ZWQsIHNldElzTXV0ZWRdID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCBbcHJvZ3Jlc3MsIHNldFByb2dyZXNzXSA9IHVzZVN0YXRlKDApO1xuICBjb25zdCBbdmlld0NvdW50LCBzZXRWaWV3Q291bnRdID0gdXNlU3RhdGUoMCk7XG5cbiAgY29uc3QgdGltZXJSZWYgPSB1c2VSZWY8Tm9kZUpTLlRpbWVvdXQgfCBudWxsPihudWxsKTtcbiAgY29uc3QgcHJvZ3Jlc3NJbnRlcnZhbFJlZiA9IHVzZVJlZjxOb2RlSlMuVGltZW91dCB8IG51bGw+KG51bGwpO1xuICBjb25zdCBsb25nUHJlc3NUaW1lciA9IHVzZVJlZjxOb2RlSlMuVGltZW91dCB8IG51bGw+KG51bGwpO1xuICBjb25zdCBzb2NrZXQgPSB1c2VTb2NrZXQoKTtcblxuICAvLyBGZXRjaCBzdG9yaWVzIGZlZWRcbiAgY29uc3Qge1xuICAgIGRhdGE6IHN0b3J5R3JvdXBzLFxuICAgIGlzTG9hZGluZyxcbiAgICBlcnJvcixcbiAgICByZWZldGNoLFxuICB9ID0gdXNlUXVlcnkoe1xuICAgIHF1ZXJ5S2V5OiBbXCJzdG9yaWVzLWZlZWRcIl0sXG4gICAgcXVlcnlGbjogYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhcGlDbGllbnQuZ2V0PFN0b3JpZXNGZWVkUmVzcG9uc2U+KFwiL3N0b3JpZXNcIik7XG4gICAgICByZXR1cm4gcmVzcG9uc2Uuc3RvcmllcztcbiAgICB9LFxuICB9KTtcblxuICBjb25zdCBjdXJyZW50R3JvdXAgPSBzdG9yeUdyb3Vwcz8uW2N1cnJlbnRHcm91cEluZGV4XTtcblxuICAvLyBXcmFwcGVyIGZ1bmN0aW9uIHRvIG1hdGNoIGV4cGVjdGVkIGludGVyZmFjZVxuICBjb25zdCByZWZyZXNoU3RvcmllcyA9IHVzZUNhbGxiYWNrKGFzeW5jICgpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICBhd2FpdCByZWZldGNoKCk7XG4gIH0sIFtyZWZldGNoXSk7XG5cbiAgY29uc3QgY3VycmVudFN0b3J5ID0gY3VycmVudEdyb3VwPy5zdG9yaWVzW2N1cnJlbnRTdG9yeUluZGV4XTtcblxuICAvLyBNYXJrIHN0b3J5IGFzIHZpZXdlZCBtdXRhdGlvblxuICBjb25zdCB2aWV3U3RvcnlNdXRhdGlvbiA9IHVzZU11dGF0aW9uKHtcbiAgICBtdXRhdGlvbkZuOiBhc3luYyAoc3RvcnlJZDogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGFwaUNsaWVudC5wb3N0PFZpZXdTdG9yeVJlc3BvbnNlPihcbiAgICAgICAgYC9zdG9yaWVzLyR7c3RvcnlJZH0vdmlld2AsXG4gICAgICApO1xuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH0sXG4gICAgb25TdWNjZXNzOiAoZGF0YTogVmlld1N0b3J5UmVzcG9uc2UpID0+IHtcbiAgICAgIHNldFZpZXdDb3VudChkYXRhLnZpZXdDb3VudCk7XG4gICAgfSxcbiAgfSk7XG5cbiAgLy8gTmF2aWdhdGlvbiBmdW5jdGlvbnNcbiAgY29uc3QgZ29Ub05leHRTdG9yeSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBpZiAoIWN1cnJlbnRHcm91cCkgcmV0dXJuO1xuXG4gICAgSGFwdGljcy5pbXBhY3RBc3luYyhIYXB0aWNzLkltcGFjdEZlZWRiYWNrU3R5bGUuTGlnaHQpO1xuXG4gICAgaWYgKGN1cnJlbnRTdG9yeUluZGV4IDwgY3VycmVudEdyb3VwLnN0b3JpZXMubGVuZ3RoIC0gMSkge1xuICAgICAgc2V0Q3VycmVudFN0b3J5SW5kZXgoKHByZXYpID0+IHByZXYgKyAxKTtcbiAgICAgIHNldFByb2dyZXNzKDApO1xuICAgIH0gZWxzZSBpZiAoc3RvcnlHcm91cHMgJiYgY3VycmVudEdyb3VwSW5kZXggPCBzdG9yeUdyb3Vwcy5sZW5ndGggLSAxKSB7XG4gICAgICBzZXRDdXJyZW50R3JvdXBJbmRleCgocHJldikgPT4gcHJldiArIDEpO1xuICAgICAgc2V0Q3VycmVudFN0b3J5SW5kZXgoMCk7XG4gICAgICBzZXRQcm9ncmVzcygwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gRW5kIG9mIHN0b3JpZXMgLSBjb3VsZCBlbWl0IGV2ZW50IGZvciBwYXJlbnQgdG8gaGFuZGxlIG5hdmlnYXRpb25cbiAgICAgIGxvZ2dlci5pbmZvKFwiUmVhY2hlZCBlbmQgb2Ygc3Rvcmllc1wiKTtcbiAgICB9XG4gIH0sIFtjdXJyZW50R3JvdXAsIGN1cnJlbnRTdG9yeUluZGV4LCBjdXJyZW50R3JvdXBJbmRleCwgc3RvcnlHcm91cHNdKTtcblxuICBjb25zdCBnb1RvUHJldmlvdXNTdG9yeSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBIYXB0aWNzLmltcGFjdEFzeW5jKEhhcHRpY3MuSW1wYWN0RmVlZGJhY2tTdHlsZS5MaWdodCk7XG5cbiAgICBpZiAoY3VycmVudFN0b3J5SW5kZXggPiAwKSB7XG4gICAgICBzZXRDdXJyZW50U3RvcnlJbmRleCgocHJldikgPT4gcHJldiAtIDEpO1xuICAgICAgc2V0UHJvZ3Jlc3MoMCk7XG4gICAgfSBlbHNlIGlmIChjdXJyZW50R3JvdXBJbmRleCA+IDAgJiYgc3RvcnlHcm91cHMpIHtcbiAgICAgIGNvbnN0IHByZXZHcm91cEluZGV4ID0gY3VycmVudEdyb3VwSW5kZXggLSAxO1xuICAgICAgY29uc3QgcHJldkdyb3VwID0gc3RvcnlHcm91cHNbcHJldkdyb3VwSW5kZXhdO1xuICAgICAgaWYgKHByZXZHcm91cCkge1xuICAgICAgICBzZXRDdXJyZW50R3JvdXBJbmRleChwcmV2R3JvdXBJbmRleCk7XG4gICAgICAgIHNldEN1cnJlbnRTdG9yeUluZGV4KHByZXZHcm91cC5zdG9yaWVzLmxlbmd0aCAtIDEpO1xuICAgICAgICBzZXRQcm9ncmVzcygwKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sIFtjdXJyZW50U3RvcnlJbmRleCwgY3VycmVudEdyb3VwSW5kZXgsIHN0b3J5R3JvdXBzXSk7XG5cbiAgY29uc3QgZ29Ub0dyb3VwID0gdXNlQ2FsbGJhY2soXG4gICAgKGdyb3VwSW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgaWYgKGdyb3VwSW5kZXggPj0gMCAmJiBzdG9yeUdyb3VwcyAmJiBncm91cEluZGV4IDwgc3RvcnlHcm91cHMubGVuZ3RoKSB7XG4gICAgICAgIHNldEN1cnJlbnRHcm91cEluZGV4KGdyb3VwSW5kZXgpO1xuICAgICAgICBzZXRDdXJyZW50U3RvcnlJbmRleCgwKTtcbiAgICAgICAgc2V0UHJvZ3Jlc3MoMCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBbc3RvcnlHcm91cHNdLFxuICApO1xuXG4gIGNvbnN0IGdvVG9TdG9yeSA9IHVzZUNhbGxiYWNrKFxuICAgIChncm91cEluZGV4OiBudW1iZXIsIHN0b3J5SW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgaWYgKGdyb3VwSW5kZXggPj0gMCAmJiBzdG9yeUdyb3VwcyAmJiBncm91cEluZGV4IDwgc3RvcnlHcm91cHMubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IGdyb3VwID0gc3RvcnlHcm91cHNbZ3JvdXBJbmRleF07XG4gICAgICAgIGlmIChncm91cCAmJiBzdG9yeUluZGV4ID49IDAgJiYgc3RvcnlJbmRleCA8IGdyb3VwLnN0b3JpZXMubGVuZ3RoKSB7XG4gICAgICAgICAgc2V0Q3VycmVudEdyb3VwSW5kZXgoZ3JvdXBJbmRleCk7XG4gICAgICAgICAgc2V0Q3VycmVudFN0b3J5SW5kZXgoc3RvcnlJbmRleCk7XG4gICAgICAgICAgc2V0UHJvZ3Jlc3MoMCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIFtzdG9yeUdyb3Vwc10sXG4gICk7XG5cbiAgLy8gQXV0by1hZHZhbmNlIHRpbWVyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKCFjdXJyZW50U3RvcnkgfHwgaXNQYXVzZWQpIHJldHVybjtcblxuICAgIGNvbnN0IGR1cmF0aW9uID0gY3VycmVudFN0b3J5LmR1cmF0aW9uICogMTAwMDtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuXG4gICAgLy8gUHJvZ3Jlc3MgdXBkYXRlIGludGVydmFsXG4gICAgcHJvZ3Jlc3NJbnRlcnZhbFJlZi5jdXJyZW50ID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgY29uc3QgZWxhcHNlZCA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICBjb25zdCBuZXdQcm9ncmVzcyA9IE1hdGgubWluKChlbGFwc2VkIC8gZHVyYXRpb24pICogMTAwLCAxMDApO1xuICAgICAgc2V0UHJvZ3Jlc3MobmV3UHJvZ3Jlc3MpO1xuICAgIH0sIDE2KTsgLy8gfjYwZnBzXG5cbiAgICAvLyBBdXRvLWFkdmFuY2UgdGltZXJcbiAgICB0aW1lclJlZi5jdXJyZW50ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBnb1RvTmV4dFN0b3J5KCk7XG4gICAgfSwgZHVyYXRpb24pO1xuXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGlmICh0aW1lclJlZi5jdXJyZW50KSBjbGVhclRpbWVvdXQodGltZXJSZWYuY3VycmVudCk7XG4gICAgICBpZiAocHJvZ3Jlc3NJbnRlcnZhbFJlZi5jdXJyZW50KVxuICAgICAgICBjbGVhckludGVydmFsKHByb2dyZXNzSW50ZXJ2YWxSZWYuY3VycmVudCk7XG4gICAgfTtcbiAgfSwgW2N1cnJlbnRTdG9yeSwgaXNQYXVzZWQsIGdvVG9OZXh0U3RvcnldKTtcblxuICAvLyBNYXJrIHN0b3J5IGFzIHZpZXdlZFxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmIChjdXJyZW50U3RvcnkpIHtcbiAgICAgIHZpZXdTdG9yeU11dGF0aW9uLm11dGF0ZShjdXJyZW50U3RvcnkuX2lkKTtcbiAgICB9XG4gIH0sIFtjdXJyZW50U3Rvcnk/Ll9pZF0pO1xuXG4gIC8vIFNvY2tldC5pbyByZWFsLXRpbWUgdmlldyB1cGRhdGVzXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKCFzb2NrZXQgfHwgIWN1cnJlbnRTdG9yeSkgcmV0dXJuO1xuXG4gICAgY29uc3QgaGFuZGxlU3RvcnlWaWV3ZWQgPSAoZGF0YToge1xuICAgICAgc3RvcnlJZDogc3RyaW5nO1xuICAgICAgdmlld0NvdW50OiBudW1iZXI7XG4gICAgfSkgPT4ge1xuICAgICAgaWYgKGRhdGEuc3RvcnlJZCA9PT0gY3VycmVudFN0b3J5Ll9pZCkge1xuICAgICAgICBzZXRWaWV3Q291bnQoZGF0YS52aWV3Q291bnQpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBzb2NrZXQub24oXCJzdG9yeTp2aWV3ZWRcIiwgaGFuZGxlU3RvcnlWaWV3ZWQpO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBzb2NrZXQub2ZmKFwic3Rvcnk6dmlld2VkXCIsIGhhbmRsZVN0b3J5Vmlld2VkKTtcbiAgICB9O1xuICB9LCBbc29ja2V0LCBjdXJyZW50U3Rvcnk/Ll9pZF0pO1xuXG4gIGNvbnN0IG1hcmtBc1ZpZXdlZCA9IHVzZUNhbGxiYWNrKFxuICAgIGFzeW5jIChzdG9yeUlkOiBzdHJpbmcpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHZpZXdTdG9yeU11dGF0aW9uLm11dGF0ZUFzeW5jKHN0b3J5SWQpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKFwiRmFpbGVkIHRvIG1hcmsgc3RvcnkgYXMgdmlld2VkXCIsIHsgZXJyb3IsIHN0b3J5SWQgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBbdmlld1N0b3J5TXV0YXRpb25dLFxuICApO1xuXG4gIGNvbnN0IHNldFBhdXNlZCA9IHVzZUNhbGxiYWNrKChwYXVzZWQ6IGJvb2xlYW4pID0+IHtcbiAgICBzZXRJc1BhdXNlZChwYXVzZWQpO1xuICB9LCBbXSk7XG5cbiAgY29uc3Qgc2V0TXV0ZWQgPSB1c2VDYWxsYmFjaygobXV0ZWQ6IGJvb2xlYW4pID0+IHtcbiAgICBzZXRJc011dGVkKG11dGVkKTtcbiAgfSwgW10pO1xuXG4gIHJldHVybiB7XG4gICAgLy8gRGF0YVxuICAgIHN0b3J5R3JvdXBzLFxuICAgIGlzTG9hZGluZyxcbiAgICBlcnJvcjogZXJyb3I/Lm1lc3NhZ2UgfHwgbnVsbCxcblxuICAgIC8vIEN1cnJlbnQgbmF2aWdhdGlvbiBzdGF0ZVxuICAgIGN1cnJlbnRHcm91cEluZGV4LFxuICAgIGN1cnJlbnRTdG9yeUluZGV4LFxuICAgIGN1cnJlbnRHcm91cCxcbiAgICBjdXJyZW50U3RvcnksXG4gICAgcHJvZ3Jlc3MsXG4gICAgdmlld0NvdW50LFxuXG4gICAgLy8gQ29udHJvbHNcbiAgICBpc1BhdXNlZCxcbiAgICBpc011dGVkLFxuICAgIHNldFBhdXNlZCxcbiAgICBzZXRNdXRlZCxcblxuICAgIC8vIE5hdmlnYXRpb25cbiAgICBnb1RvTmV4dFN0b3J5LFxuICAgIGdvVG9QcmV2aW91c1N0b3J5LFxuICAgIGdvVG9Hcm91cCxcbiAgICBnb1RvU3RvcnksXG5cbiAgICAvLyBBY3Rpb25zXG4gICAgbWFya0FzVmlld2VkLFxuICAgIHJlZnJlc2hTdG9yaWVzLFxuXG4gICAgLy8gUmVmcyBmb3IgZXh0ZXJuYWwgdXNlXG4gICAgdGlt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