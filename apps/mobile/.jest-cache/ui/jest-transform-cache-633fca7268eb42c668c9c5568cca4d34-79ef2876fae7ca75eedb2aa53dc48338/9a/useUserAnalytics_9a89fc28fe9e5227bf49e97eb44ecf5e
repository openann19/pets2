3a207d6581c4e51eed0a7490687bb649
"use strict";
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useUserAnalytics = useUserAnalytics;
var react_1 = require("react");
var logger_1 = require("../utils/logger");
var env_1 = require("../utils/env");
function useUserAnalytics() {
  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  var userId = options.userId,
    _options$autoRefresh = options.autoRefresh,
    autoRefresh = _options$autoRefresh === void 0 ? false : _options$autoRefresh,
    _options$refreshInter = options.refreshInterval,
    refreshInterval = _options$refreshInter === void 0 ? 60000 : _options$refreshInter;
  var _ref = (0, react_1.useState)(null),
    _ref2 = (0, _slicedToArray2.default)(_ref, 2),
    analytics = _ref2[0],
    setAnalytics = _ref2[1];
  var _ref3 = (0, react_1.useState)(true),
    _ref4 = (0, _slicedToArray2.default)(_ref3, 2),
    isLoading = _ref4[0],
    setIsLoading = _ref4[1];
  var _ref5 = (0, react_1.useState)(null),
    _ref6 = (0, _slicedToArray2.default)(_ref5, 2),
    error = _ref6[0],
    setError = _ref6[1];
  var fetchAnalytics = (0, react_1.useCallback)((0, _asyncToGenerator2.default)(function* () {
    if (!userId) {
      setIsLoading(false);
      return;
    }
    try {
      var _ref8;
      setIsLoading(true);
      setError(null);
      var response = yield fetch(`/api/analytics/user/${userId}`, {
        headers: {
          'Authorization': `Bearer ${(_ref8 = (0, env_1.getLocalStorageItem)('accessToken')) != null ? _ref8 : ''}`
        }
      });
      if (!response.ok) {
        throw new Error(`Failed to fetch analytics: ${response.statusText}`);
      }
      var data = yield response.json();
      if (data.success) {
        setAnalytics(data.data);
      } else {
        throw new Error(data.message || 'Failed to fetch analytics');
      }
    } catch (err) {
      var errorMessage = err instanceof Error ? err.message : 'Unknown error';
      setError(errorMessage);
      logger_1.logger.error('Failed to fetch user analytics', {
        error: errorMessage,
        userId: userId
      });
    } finally {
      setIsLoading(false);
    }
  }), [userId]);
  (0, react_1.useEffect)(function () {
    void fetchAnalytics();
  }, [fetchAnalytics]);
  (0, react_1.useEffect)(function () {
    if (!autoRefresh || !userId) return;
    var interval = setInterval(function () {
      void fetchAnalytics();
    }, refreshInterval);
    return function () {
      return clearInterval(interval);
    };
  }, [autoRefresh, refreshInterval, userId, fetchAnalytics]);
  return {
    analytics: analytics,
    isLoading: isLoading,
    error: error,
    refresh: fetchAnalytics
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9hc3luY1RvR2VuZXJhdG9yMiIsIl9zbGljZWRUb0FycmF5MiIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwidXNlVXNlckFuYWx5dGljcyIsInJlYWN0XzEiLCJsb2dnZXJfMSIsImVudl8xIiwib3B0aW9ucyIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsInVzZXJJZCIsIl9vcHRpb25zJGF1dG9SZWZyZXNoIiwiYXV0b1JlZnJlc2giLCJfb3B0aW9ucyRyZWZyZXNoSW50ZXIiLCJyZWZyZXNoSW50ZXJ2YWwiLCJfcmVmIiwidXNlU3RhdGUiLCJfcmVmMiIsImRlZmF1bHQiLCJhbmFseXRpY3MiLCJzZXRBbmFseXRpY3MiLCJfcmVmMyIsIl9yZWY0IiwiaXNMb2FkaW5nIiwic2V0SXNMb2FkaW5nIiwiX3JlZjUiLCJfcmVmNiIsImVycm9yIiwic2V0RXJyb3IiLCJmZXRjaEFuYWx5dGljcyIsInVzZUNhbGxiYWNrIiwiX3JlZjgiLCJyZXNwb25zZSIsImZldGNoIiwiaGVhZGVycyIsImdldExvY2FsU3RvcmFnZUl0ZW0iLCJvayIsIkVycm9yIiwic3RhdHVzVGV4dCIsImRhdGEiLCJqc29uIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJlcnIiLCJlcnJvck1lc3NhZ2UiLCJsb2dnZXIiLCJ1c2VFZmZlY3QiLCJpbnRlcnZhbCIsInNldEludGVydmFsIiwiY2xlYXJJbnRlcnZhbCIsInJlZnJlc2giXSwic291cmNlcyI6WyJ1c2VVc2VyQW5hbHl0aWNzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuLyoqXG4gKiBVc2VyIEFuYWx5dGljcyBIb29rXG4gKiBUcmFja3MgdXNlciBiZWhhdmlvciBhbmQgcHJvdmlkZXMgYW5hbHl0aWNzIGRhdGFcbiAqL1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy51c2VVc2VyQW5hbHl0aWNzID0gdXNlVXNlckFuYWx5dGljcztcbmNvbnN0IHJlYWN0XzEgPSByZXF1aXJlKFwicmVhY3RcIik7XG5jb25zdCBsb2dnZXJfMSA9IHJlcXVpcmUoXCIuLi91dGlscy9sb2dnZXJcIik7XG5jb25zdCBlbnZfMSA9IHJlcXVpcmUoXCIuLi91dGlscy9lbnZcIik7XG4vKipcbiAqIEhvb2sgdG8gZmV0Y2ggYW5kIHRyYWNrIHVzZXIgYW5hbHl0aWNzXG4gKi9cbmZ1bmN0aW9uIHVzZVVzZXJBbmFseXRpY3Mob3B0aW9ucyA9IHt9KSB7XG4gICAgY29uc3QgeyB1c2VySWQsIGF1dG9SZWZyZXNoID0gZmFsc2UsIHJlZnJlc2hJbnRlcnZhbCA9IDYwMDAwIH0gPSBvcHRpb25zO1xuICAgIGNvbnN0IFthbmFseXRpY3MsIHNldEFuYWx5dGljc10gPSAoMCwgcmVhY3RfMS51c2VTdGF0ZSkobnVsbCk7XG4gICAgY29uc3QgW2lzTG9hZGluZywgc2V0SXNMb2FkaW5nXSA9ICgwLCByZWFjdF8xLnVzZVN0YXRlKSh0cnVlKTtcbiAgICBjb25zdCBbZXJyb3IsIHNldEVycm9yXSA9ICgwLCByZWFjdF8xLnVzZVN0YXRlKShudWxsKTtcbiAgICBjb25zdCBmZXRjaEFuYWx5dGljcyA9ICgwLCByZWFjdF8xLnVzZUNhbGxiYWNrKShhc3luYyAoKSA9PiB7XG4gICAgICAgIGlmICghdXNlcklkKSB7XG4gICAgICAgICAgICBzZXRJc0xvYWRpbmcoZmFsc2UpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBzZXRJc0xvYWRpbmcodHJ1ZSk7XG4gICAgICAgICAgICBzZXRFcnJvcihudWxsKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYC9hcGkvYW5hbHl0aWNzL3VzZXIvJHt1c2VySWR9YCwge1xuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7KDAsIGVudl8xLmdldExvY2FsU3RvcmFnZUl0ZW0pKCdhY2Nlc3NUb2tlbicpID8/ICcnfWAsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIGFuYWx5dGljczogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIGlmIChkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICBzZXRBbmFseXRpY3MoZGF0YS5kYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihkYXRhLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBmZXRjaCBhbmFseXRpY3MnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBlcnIgaW5zdGFuY2VvZiBFcnJvciA/IGVyci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InO1xuICAgICAgICAgICAgc2V0RXJyb3IoZXJyb3JNZXNzYWdlKTtcbiAgICAgICAgICAgIGxvZ2dlcl8xLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGZldGNoIHVzZXIgYW5hbHl0aWNzJywgeyBlcnJvcjogZXJyb3JNZXNzYWdlLCB1c2VySWQgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICBzZXRJc0xvYWRpbmcoZmFsc2UpO1xuICAgICAgICB9XG4gICAgfSwgW3VzZXJJZF0pO1xuICAgIC8vIEluaXRpYWwgZmV0Y2hcbiAgICAoMCwgcmVhY3RfMS51c2VFZmZlY3QpKCgpID0+IHtcbiAgICAgICAgdm9pZCBmZXRjaEFuYWx5dGljcygpO1xuICAgIH0sIFtmZXRjaEFuYWx5dGljc10pO1xuICAgIC8vIEF1dG8tcmVmcmVzaFxuICAgICgwLCByZWFjdF8xLnVzZUVmZmVjdCkoKCkgPT4ge1xuICAgICAgICBpZiAoIWF1dG9SZWZyZXNoIHx8ICF1c2VySWQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IGludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICAgICAgdm9pZCBmZXRjaEFuYWx5dGljcygpO1xuICAgICAgICB9LCByZWZyZXNoSW50ZXJ2YWwpO1xuICAgICAgICByZXR1cm4gKCkgPT4gY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XG4gICAgfSwgW2F1dG9SZWZyZXNoLCByZWZyZXNoSW50ZXJ2YWwsIHVzZXJJZCwgZmV0Y2hBbmFseXRpY3NdKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBhbmFseXRpY3MsXG4gICAgICAgIGlzTG9hZGluZyxcbiAgICAgICAgZXJyb3IsXG4gICAgICAgIHJlZnJlc2g6IGZldGNoQW5hbHl0aWNzLFxuICAgIH07XG59XG4iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7QUFBQyxJQUFBQSxzQkFBQSxHQUFBQyxPQUFBO0FBQUEsSUFBQUMsa0JBQUEsR0FBQUYsc0JBQUEsQ0FBQUMsT0FBQTtBQUFBLElBQUFFLGVBQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUtiRyxNQUFNLENBQUNDLGNBQWMsQ0FBQ0MsT0FBTyxFQUFFLFlBQVksRUFBRTtFQUFFQyxLQUFLLEVBQUU7QUFBSyxDQUFDLENBQUM7QUFDN0RELE9BQU8sQ0FBQ0UsZ0JBQWdCLEdBQUdBLGdCQUFnQjtBQUMzQyxJQUFNQyxPQUFPLEdBQUdSLE9BQU8sQ0FBQyxPQUFPLENBQUM7QUFDaEMsSUFBTVMsUUFBUSxHQUFHVCxPQUFPLGtCQUFrQixDQUFDO0FB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