id: chat-reactions-attachments
owner: api
severity: high
area: mobile+contracts
context: |
  Modern UX requires reactions and media attachments in chat.
  Current implementation: UI elements exist but are non-functional ("coming soon" alerts).
  Missing: reaction service, attachment upload, backend endpoints.
acceptance:
  - services: add sendReaction, sendAttachment, sendVoiceNote methods
  - UI: long-press message â†’ reaction bar modal appears
  - UI: attachment picker integrates with photo library
  - UI: voice note recorder with waveform visualization
  - backend: POST /chat/reactions endpoint implemented
  - backend: POST /chat/attachments endpoint handles file upload
  - backend: POST /chat/voice handles audio upload
  - Optimistic UI updates for all message types
  - tests: unit for reducers, integration for ChatScreen, Detox E2E
states: [loading, selecting, sending, sent, error]
telemetry:
  - event: CHAT_REACTION_SENT
    props: [reaction, messageId, matchId]
  - event: CHAT_ATTACHMENT_SENT
    props: [type, size, matchId]
  - event: CHAT_VOICE_NOTE_SENT
    props: [duration, matchId]
contracts:
  reactions:
    request: { matchId: string, messageId: string, reaction: string }
    response: { success: boolean, messageId: string, reactions: Record<string, number> }
  attachments:
    request: FormData with matchId, file, type
    response: { success: boolean, url: string, type: string, size: number }
  voice:
    request: { matchId: string, audioBlob: Blob, duration: number }
    response: { success: boolean, url: string, duration: number }
assets:
  mocks:
    - mocks/fixtures/chat/reaction.success.json
    - mocks/fixtures/chat/attachment.success.json
    - mocks/fixtures/chat/voice.success.json
  tests:
    - apps/mobile/src/components/chat/__tests__/MessageBubble.reactions.test.tsx
    - apps/mobile/src/components/chat/__tests__/MessageInput.attachments.test.tsx
    - apps/mobile/src/screens/__tests__/ChatScreen.integration.test.tsx
risks:
  - file uploads exceed size limits
  - audio encoding incompatible formats
  - storage costs for media files
rollback:
  - disable UI buttons via feature flag
  - revert to text-only messaging
status: open
