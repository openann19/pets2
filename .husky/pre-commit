#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Professional Pre-commit Hook - 2025 Standards
# This hook runs before every commit and blocks commits with quality issues

echo "ğŸ” Running Pre-commit Quality Checks..."

# 1. TypeScript Type Check - Must pass
echo "ğŸ“ TypeScript Type Check..."
pnpm run type-check
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript type check failed. Commit blocked."
  echo "Please fix type errors before committing."
  exit 1
fi

# 2. ESLint Check - Zero tolerance
echo "ğŸ”§ ESLint Check..."
pnpm run lint:check
if [ $? -ne 0 ]; then
  echo "âŒ ESLint check failed. Commit blocked."
  echo "Please fix linting errors before committing."
  exit 1
fi

# 3. Format Check - Enforce consistent formatting
echo "ğŸ¨ Code Format Check..."
pnpm run format:check
if [ $? -ne 0 ]; then
  echo "âŒ Code formatting check failed. Commit blocked."
  echo "Run 'pnpm run format' to fix formatting issues."
  exit 1
fi

# 4. Test Check - Critical tests must pass
echo "ğŸ§ª Critical Tests..."
pnpm run test:critical
if [ $? -ne 0 ]; then
  echo "âŒ Critical tests failed. Commit blocked."
  echo "Please fix failing tests before committing."
  exit 1
fi

# 5. Security Check - No vulnerabilities
echo "ğŸ”’ Security Check..."
pnpm audit --audit-level moderate
if [ $? -ne 0 ]; then
  echo "âŒ Security vulnerabilities detected. Commit blocked."
  echo "Please fix security issues before committing."
  exit 1
fi

# 6. Bundle Size Check - Prevent bloat
echo "ğŸ“¦ Bundle Size Check..."
pnpm run bundle:check
if [ $? -ne 0 ]; then
  echo "âŒ Bundle size limit exceeded. Commit blocked."
  echo "Please optimize bundle size before committing."
  exit 1
fi

# 7. Performance Check - Maintain performance
echo "âš¡ Performance Check..."
pnpm run perf:check
if [ $? -ne 0 ]; then
  echo "âŒ Performance regression detected. Commit blocked."
  echo "Please fix performance issues before committing."
  exit 1
fi

# 8. Accessibility Check - Maintain accessibility
echo "â™¿ Accessibility Check..."
pnpm run a11y:check
if [ $? -ne 0 ]; then
  echo "âŒ Accessibility issues detected. Commit blocked."
  echo "Please fix accessibility issues before committing."
  exit 1
fi

echo "âœ… All quality checks passed. Commit allowed."
echo "ğŸš€ Your code meets professional standards!"
